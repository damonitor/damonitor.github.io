

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>18. Driver documentation for yealink usb-p1k phones &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/mm/damon/index.html">Monitoring Data Accesses</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../vm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>18. Driver documentation for yealink usb-p1k phones</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/input/devices/yealink.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="driver-documentation-for-yealink-usb-p1k-phones">
<h1>18. Driver documentation for yealink usb-p1k phones<a class="headerlink" href="#driver-documentation-for-yealink-usb-p1k-phones" title="Permalink to this headline">¶</a></h1>
<div class="section" id="status">
<h2>18.1. Status<a class="headerlink" href="#status" title="Permalink to this headline">¶</a></h2>
<p>The p1k is a relatively cheap usb 1.1 phone with:</p>
<blockquote>
<div><ul class="simple">
<li>keyboard            full support, yealink.ko / input event API</li>
<li>LCD                 full support, yealink.ko / sysfs API</li>
<li>LED                 full support, yealink.ko / sysfs API</li>
<li>dialtone            full support, yealink.ko / sysfs API</li>
<li>ringtone            full support, yealink.ko / sysfs API</li>
<li>audio playback      full support, snd_usb_audio.ko / alsa API</li>
<li>audio record        full support, snd_usb_audio.ko / alsa API</li>
</ul>
</div></blockquote>
<p>For vendor documentation see <a class="reference external" href="http://www.yealink.com">http://www.yealink.com</a></p>
</div>
<div class="section" id="keyboard-features">
<h2>18.2. keyboard features<a class="headerlink" href="#keyboard-features" title="Permalink to this headline">¶</a></h2>
<p>The current mapping in the kernel is provided by the map_p1k_to_key
function:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Physical USB-P1K button layout       input events


           up                             up
     IN           OUT                left,   right
          down                           down

   pickup   C    hangup              enter, backspace, escape
     1      2      3                 1, 2, 3
     4      5      6                 4, 5, 6,
     7      8      9                 7, 8, 9,
     *      0      #                 *, 0, #,
</pre></div>
</div>
<p>The “up” and “down” keys, are symbolised by arrows on the button.
The “pickup” and “hangup” keys are symbolised by a green and red phone
on the button.</p>
</div>
<div class="section" id="lcd-features">
<h2>18.3. LCD features<a class="headerlink" href="#lcd-features" title="Permalink to this headline">¶</a></h2>
<p>The LCD is divided and organised as a 3 line display:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  |[]   [][]   [][]   [][]   in   |[][]
  |[] M [][] D [][] : [][]   out  |[][]
                            store

  NEW REP         SU MO TU WE TH FR SA

  [] [] [] [] [] [] [] [] [] [] [] []
  [] [] [] [] [] [] [] [] [] [] [] []


Line 1  Format (see below)    : 18.e8.M8.88...188
        Icon names            :   M  D  :  IN OUT STORE
Line 2  Format                : .........
        Icon name             : NEW REP SU MO TU WE TH FR SA
Line 3  Format                : 888888888888
</pre></div>
</div>
<dl class="docutils">
<dt>Format description:</dt>
<dd><p class="first">From a userspace perspective the world is separated into “digits” and “icons”.
A digit can have a character set, an icon can only be ON or OFF.</p>
<p>Format specifier:</p>
<div class="last highlight-none notranslate"><div class="highlight"><pre><span></span>&#39;8&#39; :  Generic 7 segment digit with individual addressable segments

Reduced capability 7 segment digit, when segments are hard wired together.
&#39;1&#39; : 2 segments digit only able to produce a 1.
&#39;e&#39; : Most significant day of the month digit,
      able to produce at least 1 2 3.
&#39;M&#39; : Most significant minute digit,
      able to produce at least 0 1 2 3 4 5.

Icons or pictograms:
&#39;.&#39; : For example like AM, PM, SU, a &#39;dot&#39; .. or other single segment
      elements.
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="driver-usage">
<h2>18.4. Driver usage<a class="headerlink" href="#driver-usage" title="Permalink to this headline">¶</a></h2>
<p>For userland the following interfaces are available using the sysfs interface:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/sys/.../
         line1        Read/Write, lcd line1
         line2        Read/Write, lcd line2
         line3        Read/Write, lcd line3

         get_icons    Read, returns a set of available icons.
         hide_icon    Write, hide the element by writing the icon name.
         show_icon    Write, display the element by writing the icon name.

         map_seg7     Read/Write, the 7 segments char set, common for all
                      yealink phones. (see map_to_7segment.h)

         ringtone     Write, upload binary representation of a ringtone,
                      see yealink.c. status EXPERIMENTAL due to potential
                      races between async. and sync usb calls.
</pre></div>
</div>
<div class="section" id="linex">
<h3>18.4.1. lineX<a class="headerlink" href="#linex" title="Permalink to this headline">¶</a></h3>
<p>Reading /sys/../lineX will return the format string with its current value.</p>
<blockquote>
<div><p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cat ./line3
888888888888
Linux Rocks!
</pre></div>
</div>
</div></blockquote>
<p>Writing to /sys/../lineX will set the corresponding LCD line.</p>
<blockquote>
<div><ul class="simple">
<li>Excess characters are ignored.</li>
<li>If less characters are written than allowed, the remaining digits are
unchanged.</li>
<li>The tab ‘t’and ‘n’ char does not overwrite the original content.</li>
<li>Writing a space to an icon will always hide its content.</li>
</ul>
<blockquote>
<div><p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>date +&quot;%m.%e.%k:%M&quot;  | sed &#39;s/^0/ /&#39; &gt; ./line1
</pre></div>
</div>
<p>Will update the LCD with the current date &amp; time.</p>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="get-icons">
<h3>18.4.2. get_icons<a class="headerlink" href="#get-icons" title="Permalink to this headline">¶</a></h3>
<p>Reading will return all available icon names and its current settings:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cat ./get_icons
on M
on D
on :
   IN
   OUT
   STORE
   NEW
   REP
   SU
   MO
   TU
   WE
   TH
   FR
   SA
   LED
   DIALTONE
   RINGTONE
</pre></div>
</div>
</div>
<div class="section" id="show-hide-icons">
<h3>18.4.3. show/hide icons<a class="headerlink" href="#show-hide-icons" title="Permalink to this headline">¶</a></h3>
<p>Writing to these files will update the state of the icon.
Only one icon at a time can be updated.</p>
<p>If an icon is also on a ./lineX the corresponding value is
updated with the first letter of the icon.</p>
<blockquote>
<div><p>Example - light up the store icon:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo -n &quot;STORE&quot; &gt; ./show_icon

cat ./line1
18.e8.M8.88...188
              S
</pre></div>
</div>
<p>Example - sound the ringtone for 10 seconds:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo -n RINGTONE &gt; /sys/..../show_icon
sleep 10
echo -n RINGTONE &gt; /sys/..../hide_icon
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="sound-features">
<h2>18.5. Sound features<a class="headerlink" href="#sound-features" title="Permalink to this headline">¶</a></h2>
<p>Sound is supported by the ALSA driver: snd_usb_audio</p>
<p>One 16-bit channel with sample and playback rates of 8000 Hz is the practical
limit of the device.</p>
<blockquote>
<div><p>Example - recording test:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>arecord -v -d 10 -r 8000 -f S16_LE -t wav  foobar.wav
</pre></div>
</div>
<p>Example - playback test:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>aplay foobar.wav
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="troubleshooting">
<h2>18.6. Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Q:</th><td class="field-body">Module yealink compiled and installed without any problem but phone
is not initialized and does not react to any actions.</td>
</tr>
<tr class="field-even field"><th class="field-name">A:</th><td class="field-body">If you see something like:
hiddev0: USB HID v1.00 Device [Yealink Network Technology Ltd. VOIP USB Phone
in dmesg, it means that the hid driver has grabbed the device first. Try to
load module yealink before any other usb hid driver. Please see the
instructions provided by your distribution on module configuration.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Q:</th><td class="field-body">Phone is working now (displays version and accepts keypad input) but I can’t
find the sysfs files.</td>
</tr>
<tr class="field-even field"><th class="field-name">A:</th><td class="field-body">The sysfs files are located on the particular usb endpoint. On most
distributions you can do: “find /sys/ -name get_icons” for a hint.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="credits-acknowledgments">
<h2>18.7. Credits &amp; Acknowledgments<a class="headerlink" href="#credits-acknowledgments" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li>Olivier Vandorpe, for starting the usbb2k-api project doing much of
the reverse engineering.</li>
<li>Martin Diehl, for pointing out how to handle USB memory allocation.</li>
<li>Dmitry Torokhov, for the numerous code reviews and suggestions.</li>
</ul>
</div></blockquote>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>