

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>General Filesystem Caching &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.8.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/mm/damon/index.html">Monitoring Data Accesses</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../vm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>General Filesystem Caching</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/filesystems/caching/fscache.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="general-filesystem-caching">
<h1>General Filesystem Caching<a class="headerlink" href="#general-filesystem-caching" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This facility is a general purpose cache for network filesystems, though it
could be used for caching other things such as ISO9660 filesystems too.</p>
<p>FS-Cache mediates between cache backends (such as CacheFS) and network
filesystems:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>+---------+
|         |                        +--------------+
|   NFS   |--+                     |              |
|         |  |                 +--&gt;|   CacheFS    |
+---------+  |   +----------+  |   |  /dev/hda5   |
             |   |          |  |   +--------------+
+---------+  +--&gt;|          |  |
|         |      |          |--+
|   AFS   |-----&gt;| FS-Cache |
|         |      |          |--+
+---------+  +--&gt;|          |  |
             |   |          |  |   +--------------+
+---------+  |   +----------+  |   |              |
|         |  |                 +--&gt;|  CacheFiles  |
|  ISOFS  |--+                     |  /var/cache  |
|         |                        +--------------+
+---------+
</pre></div>
</div>
<p>Or to look at it another way, FS-Cache is a module that provides a caching
facility to a network filesystem such that the cache is transparent to the
user:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>+---------+
|         |
| Server  |
|         |
+---------+
     |                  NETWORK
~~~~~|~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     |
     |           +----------+
     V           |          |
+---------+      |          |
|         |      |          |
|   NFS   |-----&gt;| FS-Cache |
|         |      |          |--+
+---------+      |          |  |   +--------------+   +--------------+
     |           |          |  |   |              |   |              |
     V           +----------+  +--&gt;|  CacheFiles  |--&gt;|  Ext3        |
+---------+                        |  /var/cache  |   |  /dev/sda6   |
|         |                        +--------------+   +--------------+
|   VFS   |                                ^                     ^
|         |                                |                     |
+---------+                                +--------------+      |
     |                  KERNEL SPACE                      |      |
~~~~~|~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~|~~~~~~|~~~~
     |                  USER SPACE                        |      |
     V                                                    |      |
+---------+                                           +--------------+
|         |                                           |              |
| Process |                                           | cachefilesd  |
|         |                                           |              |
+---------+                                           +--------------+
</pre></div>
</div>
<p>FS-Cache does not follow the idea of completely loading every netfs file
opened in its entirety into a cache before permitting it to be accessed and
then serving the pages out of that cache rather than the netfs inode because:</p>
<blockquote>
<div><ol class="arabic simple">
<li>It must be practical to operate without a cache.</li>
<li>The size of any accessible file must not be limited to the size of the
cache.</li>
<li>The combined size of all opened files (this includes mapped libraries)
must not be limited to the size of the cache.</li>
<li>The user should not be forced to download an entire file just to do a
one-off access of a small portion of it (such as might be done with the
“file” program).</li>
</ol>
</div></blockquote>
<p>It instead serves the cache out in PAGE_SIZE chunks as and when requested by
the netfs(‘s) using it.</p>
<p>FS-Cache provides the following facilities:</p>
<blockquote>
<div><ol class="arabic simple">
<li>More than one cache can be used at once.  Caches can be selected
explicitly by use of tags.</li>
<li>Caches can be added / removed at any time.</li>
<li>The netfs is provided with an interface that allows either party to
withdraw caching facilities from a file (required for (2)).</li>
<li>The interface to the netfs returns as few errors as possible, preferring
rather to let the netfs remain oblivious.</li>
<li>Cookies are used to represent indices, files and other objects to the
netfs.  The simplest cookie is just a NULL pointer - indicating nothing
cached there.</li>
<li>The netfs is allowed to propose - dynamically - any index hierarchy it
desires, though it must be aware that the index search function is
recursive, stack space is limited, and indices can only be children of
indices.</li>
<li>Data I/O is done direct to and from the netfs’s pages.  The netfs
indicates that page A is at index B of the data-file represented by cookie
C, and that it should be read or written.  The cache backend may or may
not start I/O on that page, but if it does, a netfs callback will be
invoked to indicate completion.  The I/O may be either synchronous or
asynchronous.</li>
<li>Cookies can be “retired” upon release.  At this point FS-Cache will mark
them as obsolete and the index hierarchy rooted at that point will get
recycled.</li>
<li>The netfs provides a “match” function for index searches.  In addition to
saying whether a match was made or not, this can also specify that an
entry should be updated or deleted.</li>
</ol>
</div></blockquote>
<ol class="arabic simple" start="10">
<li>As much as possible is done asynchronously.</li>
</ol>
<p>FS-Cache maintains a virtual indexing tree in which all indices, files, objects
and pages are kept.  Bits of this tree may actually reside in one or more
caches:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>                                           FSDEF
                                             |
                        +------------------------------------+
                        |                                    |
                       NFS                                  AFS
                        |                                    |
           +--------------------------+                +-----------+
           |                          |                |           |
        homedir                     mirror          afs.org   redhat.com
           |                          |                            |
     +------------+           +---------------+              +----------+
     |            |           |               |              |          |
   00001        00002       00007           00125        vol00001   vol00002
     |            |           |               |                         |
 +---+---+     +-----+      +---+      +------+------+            +-----+----+
 |   |   |     |     |      |   |      |      |      |            |     |    |
PG0 PG1 PG2   PG0  XATTR   PG0 PG1   DIRENT DIRENT DIRENT        R/W   R/O  Bak
                     |                                            |
                    PG0                                       +-------+
                                                              |       |
                                                            00001   00003
                                                              |
                                                          +---+---+
                                                          |   |   |
                                                         PG0 PG1 PG2
</pre></div>
</div>
<p>In the example above, you can see two netfs’s being backed: NFS and AFS.  These
have different index hierarchies:</p>
<blockquote>
<div><ul class="simple">
<li>The NFS primary index contains per-server indices.  Each server index is
indexed by NFS file handles to get data file objects.  Each data file
objects can have an array of pages, but may also have further child
objects, such as extended attributes and directory entries.  Extended
attribute objects themselves have page-array contents.</li>
<li>The AFS primary index contains per-cell indices.  Each cell index contains
per-logical-volume indices.  Each of volume index contains up to three
indices for the read-write, read-only and backup mirrors of those volumes.
Each of these contains vnode data file objects, each of which contains an
array of pages.</li>
</ul>
</div></blockquote>
<p>The very top index is the FS-Cache master index in which individual netfs’s
have entries.</p>
<p>Any index object may reside in more than one cache, provided it only has index
children.  Any index with non-index object children will be assumed to only
reside in one cache.</p>
<p>The netfs API to FS-Cache can be found in:</p>
<blockquote>
<div>Documentation/filesystems/caching/netfs-api.rst</div></blockquote>
<p>The cache backend API to FS-Cache can be found in:</p>
<blockquote>
<div>Documentation/filesystems/caching/backend-api.rst</div></blockquote>
<p>A description of the internal representations and object state machine can be
found in:</p>
<blockquote>
<div>Documentation/filesystems/caching/object.rst</div></blockquote>
</div>
<div class="section" id="statistical-information">
<h2>Statistical Information<a class="headerlink" href="#statistical-information" title="Permalink to this headline">¶</a></h2>
<p>If FS-Cache is compiled with the following options enabled:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_FSCACHE_STATS=y
CONFIG_FSCACHE_HISTOGRAM=y
</pre></div>
</div>
<p>then it will gather certain statistics and display them through a number of
proc files.</p>
<div class="section" id="proc-fs-fscache-stats">
<h3>/proc/fs/fscache/stats<a class="headerlink" href="#proc-fs-fscache-stats" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>This shows counts of a number of events that can happen in FS-Cache:</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="9%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">CLASS</th>
<th class="head">EVENT</th>
<th class="head">MEANING</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td rowspan="3">Cookies</td>
<td>idx=N</td>
<td>Number of index cookies allocated</td>
</tr>
<tr class="row-odd"><td>dat=N</td>
<td>Number of data storage cookies allocated</td>
</tr>
<tr class="row-even"><td>spc=N</td>
<td>Number of special cookies allocated</td>
</tr>
<tr class="row-odd"><td rowspan="4">Objects</td>
<td>alc=N</td>
<td>Number of objects allocated</td>
</tr>
<tr class="row-even"><td>nal=N</td>
<td>Number of object allocation failures</td>
</tr>
<tr class="row-odd"><td>avl=N</td>
<td>Number of objects that reached the available state</td>
</tr>
<tr class="row-even"><td>ded=N</td>
<td>Number of objects that reached the dead state</td>
</tr>
<tr class="row-odd"><td rowspan="4">ChkAux</td>
<td>non=N</td>
<td>Number of objects that didn’t have a coherency check</td>
</tr>
<tr class="row-even"><td>ok=N</td>
<td>Number of objects that passed a coherency check</td>
</tr>
<tr class="row-odd"><td>upd=N</td>
<td>Number of objects that needed a coherency data update</td>
</tr>
<tr class="row-even"><td>obs=N</td>
<td>Number of objects that were declared obsolete</td>
</tr>
<tr class="row-odd"><td>Pages</td>
<td>mrk=N
unc=N</td>
<td>Number of pages marked as being cached
Number of uncache page requests seen</td>
</tr>
<tr class="row-even"><td rowspan="6">Acquire</td>
<td>n=N</td>
<td>Number of acquire cookie requests seen</td>
</tr>
<tr class="row-odd"><td>nul=N</td>
<td>Number of acq reqs given a NULL parent</td>
</tr>
<tr class="row-even"><td>noc=N</td>
<td>Number of acq reqs rejected due to no cache available</td>
</tr>
<tr class="row-odd"><td>ok=N</td>
<td>Number of acq reqs succeeded</td>
</tr>
<tr class="row-even"><td>nbf=N</td>
<td>Number of acq reqs rejected due to error</td>
</tr>
<tr class="row-odd"><td>oom=N</td>
<td>Number of acq reqs failed on ENOMEM</td>
</tr>
<tr class="row-even"><td rowspan="5">Lookups</td>
<td>n=N</td>
<td>Number of lookup calls made on cache backends</td>
</tr>
<tr class="row-odd"><td>neg=N</td>
<td>Number of negative lookups made</td>
</tr>
<tr class="row-even"><td>pos=N</td>
<td>Number of positive lookups made</td>
</tr>
<tr class="row-odd"><td>crt=N</td>
<td>Number of objects created by lookup</td>
</tr>
<tr class="row-even"><td>tmo=N</td>
<td>Number of lookups timed out and requeued</td>
</tr>
<tr class="row-odd"><td rowspan="3">Updates</td>
<td>n=N</td>
<td>Number of update cookie requests seen</td>
</tr>
<tr class="row-even"><td>nul=N</td>
<td>Number of upd reqs given a NULL parent</td>
</tr>
<tr class="row-odd"><td>run=N</td>
<td>Number of upd reqs granted CPU time</td>
</tr>
<tr class="row-even"><td rowspan="3">Relinqs</td>
<td>n=N</td>
<td>Number of relinquish cookie requests seen</td>
</tr>
<tr class="row-odd"><td>nul=N</td>
<td>Number of rlq reqs given a NULL parent</td>
</tr>
<tr class="row-even"><td>wcr=N</td>
<td>Number of rlq reqs waited on completion of creation</td>
</tr>
<tr class="row-odd"><td rowspan="5">AttrChg</td>
<td>n=N</td>
<td>Number of attribute changed requests seen</td>
</tr>
<tr class="row-even"><td>ok=N</td>
<td>Number of attr changed requests queued</td>
</tr>
<tr class="row-odd"><td>nbf=N</td>
<td>Number of attr changed rejected -ENOBUFS</td>
</tr>
<tr class="row-even"><td>oom=N</td>
<td>Number of attr changed failed -ENOMEM</td>
</tr>
<tr class="row-odd"><td>run=N</td>
<td>Number of attr changed ops given CPU time</td>
</tr>
<tr class="row-even"><td rowspan="8">Allocs</td>
<td>n=N</td>
<td>Number of allocation requests seen</td>
</tr>
<tr class="row-odd"><td>ok=N</td>
<td>Number of successful alloc reqs</td>
</tr>
<tr class="row-even"><td>wt=N</td>
<td>Number of alloc reqs that waited on lookup completion</td>
</tr>
<tr class="row-odd"><td>nbf=N</td>
<td>Number of alloc reqs rejected -ENOBUFS</td>
</tr>
<tr class="row-even"><td>int=N</td>
<td>Number of alloc reqs aborted -ERESTARTSYS</td>
</tr>
<tr class="row-odd"><td>ops=N</td>
<td>Number of alloc reqs submitted</td>
</tr>
<tr class="row-even"><td>owt=N</td>
<td>Number of alloc reqs waited for CPU time</td>
</tr>
<tr class="row-odd"><td>abt=N</td>
<td>Number of alloc reqs aborted due to object death</td>
</tr>
<tr class="row-even"><td rowspan="10">Retrvls</td>
<td>n=N</td>
<td>Number of retrieval (read) requests seen</td>
</tr>
<tr class="row-odd"><td>ok=N</td>
<td>Number of successful retr reqs</td>
</tr>
<tr class="row-even"><td>wt=N</td>
<td>Number of retr reqs that waited on lookup completion</td>
</tr>
<tr class="row-odd"><td>nod=N</td>
<td>Number of retr reqs returned -ENODATA</td>
</tr>
<tr class="row-even"><td>nbf=N</td>
<td>Number of retr reqs rejected -ENOBUFS</td>
</tr>
<tr class="row-odd"><td>int=N</td>
<td>Number of retr reqs aborted -ERESTARTSYS</td>
</tr>
<tr class="row-even"><td>oom=N</td>
<td>Number of retr reqs failed -ENOMEM</td>
</tr>
<tr class="row-odd"><td>ops=N</td>
<td>Number of retr reqs submitted</td>
</tr>
<tr class="row-even"><td>owt=N</td>
<td>Number of retr reqs waited for CPU time</td>
</tr>
<tr class="row-odd"><td>abt=N</td>
<td>Number of retr reqs aborted due to object death</td>
</tr>
<tr class="row-even"><td rowspan="10">Stores</td>
<td>n=N</td>
<td>Number of storage (write) requests seen</td>
</tr>
<tr class="row-odd"><td>ok=N</td>
<td>Number of successful store reqs</td>
</tr>
<tr class="row-even"><td>agn=N</td>
<td>Number of store reqs on a page already pending storage</td>
</tr>
<tr class="row-odd"><td>nbf=N</td>
<td>Number of store reqs rejected -ENOBUFS</td>
</tr>
<tr class="row-even"><td>oom=N</td>
<td>Number of store reqs failed -ENOMEM</td>
</tr>
<tr class="row-odd"><td>ops=N</td>
<td>Number of store reqs submitted</td>
</tr>
<tr class="row-even"><td>run=N</td>
<td>Number of store reqs granted CPU time</td>
</tr>
<tr class="row-odd"><td>pgs=N</td>
<td>Number of pages given store req processing time</td>
</tr>
<tr class="row-even"><td>rxd=N</td>
<td>Number of store reqs deleted from tracking tree</td>
</tr>
<tr class="row-odd"><td>olm=N</td>
<td>Number of store reqs over store limit</td>
</tr>
<tr class="row-even"><td rowspan="4">VmScan</td>
<td>nos=N</td>
<td>Number of release reqs against pages with no
pending store</td>
</tr>
<tr class="row-odd"><td>gon=N</td>
<td>Number of release reqs against pages stored by
time lock granted</td>
</tr>
<tr class="row-even"><td>bsy=N</td>
<td>Number of release reqs ignored due to in-progress store</td>
</tr>
<tr class="row-odd"><td>can=N</td>
<td>Number of page stores cancelled due to release req</td>
</tr>
<tr class="row-even"><td rowspan="9">Ops</td>
<td>pend=N</td>
<td>Number of times async ops added to pending queues</td>
</tr>
<tr class="row-odd"><td>run=N</td>
<td>Number of times async ops given CPU time</td>
</tr>
<tr class="row-even"><td>enq=N</td>
<td>Number of times async ops queued for processing</td>
</tr>
<tr class="row-odd"><td>can=N</td>
<td>Number of async ops cancelled</td>
</tr>
<tr class="row-even"><td>rej=N</td>
<td>Number of async ops rejected due to object
lookup/create failure</td>
</tr>
<tr class="row-odd"><td>ini=N</td>
<td>Number of async ops initialised</td>
</tr>
<tr class="row-even"><td>dfr=N</td>
<td>Number of async ops queued for deferred release</td>
</tr>
<tr class="row-odd"><td>rel=N</td>
<td>Number of async ops released
(should equal ini=N when idle)</td>
</tr>
<tr class="row-even"><td>gc=N</td>
<td>Number of deferred-release async ops garbage collected</td>
</tr>
<tr class="row-odd"><td rowspan="16">CacheOp</td>
<td>alo=N</td>
<td>Number of in-progress alloc_object() cache ops</td>
</tr>
<tr class="row-even"><td>luo=N</td>
<td>Number of in-progress lookup_object() cache ops</td>
</tr>
<tr class="row-odd"><td>luc=N</td>
<td>Number of in-progress lookup_complete() cache ops</td>
</tr>
<tr class="row-even"><td>gro=N</td>
<td>Number of in-progress grab_object() cache ops</td>
</tr>
<tr class="row-odd"><td>upo=N</td>
<td>Number of in-progress update_object() cache ops</td>
</tr>
<tr class="row-even"><td>dro=N</td>
<td>Number of in-progress drop_object() cache ops</td>
</tr>
<tr class="row-odd"><td>pto=N</td>
<td>Number of in-progress put_object() cache ops</td>
</tr>
<tr class="row-even"><td>syn=N</td>
<td>Number of in-progress sync_cache() cache ops</td>
</tr>
<tr class="row-odd"><td>atc=N</td>
<td>Number of in-progress attr_changed() cache ops</td>
</tr>
<tr class="row-even"><td>rap=N</td>
<td>Number of in-progress read_or_alloc_page() cache ops</td>
</tr>
<tr class="row-odd"><td>ras=N</td>
<td>Number of in-progress read_or_alloc_pages() cache ops</td>
</tr>
<tr class="row-even"><td>alp=N</td>
<td>Number of in-progress allocate_page() cache ops</td>
</tr>
<tr class="row-odd"><td>als=N</td>
<td>Number of in-progress allocate_pages() cache ops</td>
</tr>
<tr class="row-even"><td>wrp=N</td>
<td>Number of in-progress write_page() cache ops</td>
</tr>
<tr class="row-odd"><td>ucp=N</td>
<td>Number of in-progress uncache_page() cache ops</td>
</tr>
<tr class="row-even"><td>dsp=N</td>
<td>Number of in-progress dissociate_pages() cache ops</td>
</tr>
<tr class="row-odd"><td rowspan="4">CacheEv</td>
<td>nsp=N</td>
<td>Number of object lookups/creations rejected due to
lack of space</td>
</tr>
<tr class="row-even"><td>stl=N</td>
<td>Number of stale objects deleted</td>
</tr>
<tr class="row-odd"><td>rtr=N</td>
<td>Number of objects retired when relinquished</td>
</tr>
<tr class="row-even"><td>cul=N</td>
<td>Number of objects culled</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="proc-fs-fscache-histogram">
<h3>/proc/fs/fscache/histogram<a class="headerlink" href="#proc-fs-fscache-histogram" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cat /proc/fs/fscache/histogram
JIFS  SECS  OBJ INST  OP RUNS   OBJ RUNS  RETRV DLY RETRIEVLS
===== ===== ========= ========= ========= ========= =========
</pre></div>
</div>
<p>This shows the breakdown of the number of times each amount of time
between 0 jiffies and HZ-1 jiffies a variety of tasks took to run.  The
columns are as follows:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">COLUMN</th>
<th class="head">TIME MEASUREMENT</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>OBJ INST</td>
<td>Length of time to instantiate an object</td>
</tr>
<tr class="row-odd"><td>OP RUNS</td>
<td>Length of time a call to process an operation took</td>
</tr>
<tr class="row-even"><td>OBJ RUNS</td>
<td>Length of time a call to process an object event took</td>
</tr>
<tr class="row-odd"><td>RETRV DLY</td>
<td>Time between an requesting a read and lookup completing</td>
</tr>
<tr class="row-even"><td>RETRIEVLS</td>
<td>Time between beginning and end of a retrieval</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Each row shows the number of events that took a particular range of times.
Each step is 1 jiffy in size.  The JIFS column indicates the particular
jiffy range covered, and the SECS field the equivalent number of seconds.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="object-list">
<h2>Object List<a class="headerlink" href="#object-list" title="Permalink to this headline">¶</a></h2>
<p>If CONFIG_FSCACHE_OBJECT_LIST is enabled, the FS-Cache facility will maintain a
list of all the objects currently allocated and allow them to be viewed
through:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/proc/fs/fscache/objects
</pre></div>
</div>
<p>This will look something like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[root@andromeda ~]# head /proc/fs/fscache/objects
OBJECT   PARENT   STAT CHLDN OPS OOP IPR EX READS EM EV F S | NETFS_COOKIE_DEF TY FL NETFS_DATA       OBJECT_KEY, AUX_DATA
======== ======== ==== ===== === === === == ===== == == = = | ================ == == ================ ================
   17e4b        2 ACTV     0   0   0   0  0     0 7b  4 0 0 | NFS.fh           DT  0 ffff88001dd82820 010006017edcf8bbc93b43298fdfbe71e50b57b13a172c0117f38472, e567634700000000000000000000000063f2404a000000000000000000000000c9030000000000000000000063f2404a
   1693a        2 ACTV     0   0   0   0  0     0 7b  4 0 0 | NFS.fh           DT  0 ffff88002db23380 010006017edcf8bbc93b43298fdfbe71e50b57b1e0162c01a2df0ea6, 420ebc4a000000000000000000000000420ebc4a0000000000000000000000000e1801000000000000000000420ebc4a
</pre></div>
</div>
<p>where the first set of columns before the ‘|’ describe the object:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">COLUMN</th>
<th class="head">DESCRIPTION</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>OBJECT</td>
<td>Object debugging ID (appears as OBJ%x in some debug messages)</td>
</tr>
<tr class="row-odd"><td>PARENT</td>
<td>Debugging ID of parent object</td>
</tr>
<tr class="row-even"><td>STAT</td>
<td>Object state</td>
</tr>
<tr class="row-odd"><td>CHLDN</td>
<td>Number of child objects of this object</td>
</tr>
<tr class="row-even"><td>OPS</td>
<td>Number of outstanding operations on this object</td>
</tr>
<tr class="row-odd"><td>OOP</td>
<td>Number of outstanding child object management operations</td>
</tr>
<tr class="row-even"><td>IPR</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>EX</td>
<td>Number of outstanding exclusive operations</td>
</tr>
<tr class="row-even"><td>READS</td>
<td>Number of outstanding read operations</td>
</tr>
<tr class="row-odd"><td>EM</td>
<td>Object’s event mask</td>
</tr>
<tr class="row-even"><td>EV</td>
<td>Events raised on this object</td>
</tr>
<tr class="row-odd"><td>F</td>
<td>Object flags</td>
</tr>
<tr class="row-even"><td>S</td>
<td>Object work item busy state mask (1:pending 2:running)</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>and the second set of columns describe the object’s cookie, if present:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">COLUMN</th>
<th class="head">DESCRIPTION</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>NETFS_COOKIE_DEF</td>
<td>Name of netfs cookie definition</td>
</tr>
<tr class="row-odd"><td>TY</td>
<td>Cookie type (IX - index, DT - data, hex - special)</td>
</tr>
<tr class="row-even"><td>FL</td>
<td>Cookie flags</td>
</tr>
<tr class="row-odd"><td>NETFS_DATA</td>
<td>Netfs private data stored in the cookie</td>
</tr>
<tr class="row-even"><td>OBJECT_KEY</td>
<td>Object key } 1 column, with separating comma</td>
</tr>
<tr class="row-odd"><td>AUX_DATA</td>
<td>Object aux data } presence may be configured</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The data shown may be filtered by attaching the a key to an appropriate keyring
before viewing the file.  Something like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>keyctl add user fscache:objlist &lt;restrictions&gt; @s
</pre></div>
</div>
<p>where &lt;restrictions&gt; are a selection of the following letters:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="3%" />
<col width="97%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>K</td>
<td>Show hexdump of object key (don’t show if not given)</td>
</tr>
<tr class="row-even"><td>A</td>
<td>Show hexdump of object aux data (don’t show if not given)</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>and the following paired letters:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="3%" />
<col width="97%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>C</td>
<td>Show objects that have a cookie</td>
</tr>
<tr class="row-even"><td>c</td>
<td>Show objects that don’t have a cookie</td>
</tr>
<tr class="row-odd"><td>B</td>
<td>Show objects that are busy</td>
</tr>
<tr class="row-even"><td>b</td>
<td>Show objects that aren’t busy</td>
</tr>
<tr class="row-odd"><td>W</td>
<td>Show objects that have pending writes</td>
</tr>
<tr class="row-even"><td>w</td>
<td>Show objects that don’t have pending writes</td>
</tr>
<tr class="row-odd"><td>R</td>
<td>Show objects that have outstanding reads</td>
</tr>
<tr class="row-even"><td>r</td>
<td>Show objects that don’t have outstanding reads</td>
</tr>
<tr class="row-odd"><td>S</td>
<td>Show objects that have work queued</td>
</tr>
<tr class="row-even"><td>s</td>
<td>Show objects that don’t have work queued</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>If neither side of a letter pair is given, then both are implied.  For example:</p>
<blockquote>
<div>keyctl add user fscache:objlist KB &#64;s</div></blockquote>
<p>shows objects that are busy, and lists their object keys, but does not dump
their auxiliary data.  It also implies “CcWwRrSs”, but as ‘B’ is given, ‘b’ is
not implied.</p>
<p>By default all objects and all fields will be shown.</p>
</div>
<div class="section" id="debugging">
<h2>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h2>
<p>If CONFIG_FSCACHE_DEBUG is enabled, the FS-Cache facility can have runtime
debugging enabled by adjusting the value in:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/sys/module/fscache/parameters/debug
</pre></div>
</div>
<p>This is a bitmask of debugging streams to enable:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="10%" />
<col width="46%" />
<col width="34%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">BIT</th>
<th class="head">VALUE</th>
<th class="head">STREAM</th>
<th class="head">POINT</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>1</td>
<td>Cache management</td>
<td>Function entry trace</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>2</td>
<td>&#160;</td>
<td>Function exit trace</td>
</tr>
<tr class="row-even"><td>2</td>
<td>4</td>
<td>&#160;</td>
<td>General</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>8</td>
<td>Cookie management</td>
<td>Function entry trace</td>
</tr>
<tr class="row-even"><td>4</td>
<td>16</td>
<td>&#160;</td>
<td>Function exit trace</td>
</tr>
<tr class="row-odd"><td>5</td>
<td>32</td>
<td>&#160;</td>
<td>General</td>
</tr>
<tr class="row-even"><td>6</td>
<td>64</td>
<td>Page handling</td>
<td>Function entry trace</td>
</tr>
<tr class="row-odd"><td>7</td>
<td>128</td>
<td>&#160;</td>
<td>Function exit trace</td>
</tr>
<tr class="row-even"><td>8</td>
<td>256</td>
<td>&#160;</td>
<td>General</td>
</tr>
<tr class="row-odd"><td>9</td>
<td>512</td>
<td>Operation management</td>
<td>Function entry trace</td>
</tr>
<tr class="row-even"><td>10</td>
<td>1024</td>
<td>&#160;</td>
<td>Function exit trace</td>
</tr>
<tr class="row-odd"><td>11</td>
<td>2048</td>
<td>&#160;</td>
<td>General</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The appropriate set of values should be OR’d together and the result written to
the control file.  For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo $((1|8|64)) &gt;/sys/module/fscache/parameters/debug
</pre></div>
</div>
<p>will turn on all function entry debugging.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>