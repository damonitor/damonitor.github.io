

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Linux Base Driver for Intel(R) Ethernet Adaptive Virtual Function &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.6.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/mm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
      <li>Linux Base Driver for Intel(R) Ethernet Adaptive Virtual Function</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/networking/device_drivers/intel/iavf.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="linux-base-driver-for-intel-r-ethernet-adaptive-virtual-function">
<h1>Linux Base Driver for Intel(R) Ethernet Adaptive Virtual Function<a class="headerlink" href="#linux-base-driver-for-intel-r-ethernet-adaptive-virtual-function" title="Permalink to this headline">¶</a></h1>
<p>Intel Ethernet Adaptive Virtual Function Linux driver.
Copyright(c) 2013-2018 Intel Corporation.</p>
<div class="section" id="contents">
<h2>Contents<a class="headerlink" href="#contents" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Overview</li>
<li>Identifying Your Adapter</li>
<li>Additional Configurations</li>
<li>Known Issues/Troubleshooting</li>
<li>Support</li>
</ul>
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This file describes the iavf Linux Base Driver. This driver was formerly
called i40evf.</p>
<p>The iavf driver supports the below mentioned virtual function devices and
can only be activated on kernels running the i40e or newer Physical Function
(PF) driver compiled with CONFIG_PCI_IOV.  The iavf driver requires
CONFIG_PCI_MSI to be enabled.</p>
<p>The guest OS loading the iavf driver must support MSI-X interrupts.</p>
</div>
<div class="section" id="identifying-your-adapter">
<h2>Identifying Your Adapter<a class="headerlink" href="#identifying-your-adapter" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>The driver in this kernel is compatible with devices based on the following:</dt>
<dd><ul class="first last simple">
<li>Intel(R) XL710 X710 Virtual Function</li>
<li>Intel(R) X722 Virtual Function</li>
<li>Intel(R) XXV710 Virtual Function</li>
<li>Intel(R) Ethernet Adaptive Virtual Function</li>
</ul>
</dd>
</dl>
<p>For the best performance, make sure the latest NVM/FW is installed on your
device.</p>
<p>For information on how to identify your adapter, and for the latest NVM/FW
images and Intel network drivers, refer to the Intel Support website:
<a class="reference external" href="http://www.intel.com/support">http://www.intel.com/support</a></p>
</div>
<div class="section" id="additional-features-and-configurations">
<h2>Additional Features and Configurations<a class="headerlink" href="#additional-features-and-configurations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="viewing-link-messages">
<h3>Viewing Link Messages<a class="headerlink" href="#viewing-link-messages" title="Permalink to this headline">¶</a></h3>
<p>Link messages will not be displayed to the console if the distribution is
restricting system messages. In order to see network driver link messages on
your console, set dmesg to eight by entering the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># dmesg -n 8
</pre></div>
</div>
<dl class="docutils">
<dt>NOTE:</dt>
<dd>This setting is not saved across reboots.</dd>
</dl>
</div>
<div class="section" id="ethtool">
<h3>ethtool<a class="headerlink" href="#ethtool" title="Permalink to this headline">¶</a></h3>
<p>The driver utilizes the ethtool interface for driver configuration and
diagnostics, as well as displaying statistical information. The latest ethtool
version is required for this functionality. Download it at:
<a class="reference external" href="https://www.kernel.org/pub/software/network/ethtool/">https://www.kernel.org/pub/software/network/ethtool/</a></p>
</div>
<div class="section" id="setting-vlan-tag-stripping">
<h3>Setting VLAN Tag Stripping<a class="headerlink" href="#setting-vlan-tag-stripping" title="Permalink to this headline">¶</a></h3>
<p>If you have applications that require Virtual Functions (VFs) to receive
packets with VLAN tags, you can disable VLAN tag stripping for the VF. The
Physical Function (PF) processes requests issued from the VF to enable or
disable VLAN tag stripping. Note that if the PF has assigned a VLAN to a VF,
then requests from that VF to set VLAN tag stripping will be ignored.</p>
<p>To enable/disable VLAN tag stripping for a VF, issue the following command
from inside the VM in which you are running the VF:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># ethtool -K &lt;if_name&gt; rxvlan on/off
</pre></div>
</div>
<p>or alternatively:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># ethtool --offload &lt;if_name&gt; rxvlan on/off
</pre></div>
</div>
</div>
<div class="section" id="adaptive-virtual-function">
<h3>Adaptive Virtual Function<a class="headerlink" href="#adaptive-virtual-function" title="Permalink to this headline">¶</a></h3>
<p>Adaptive Virtual Function (AVF) allows the virtual function driver, or VF, to
adapt to changing feature sets of the physical function driver (PF) with which
it is associated. This allows system administrators to update a PF without
having to update all the VFs associated with it. All AVFs have a single common
device ID and branding string.</p>
<p>AVFs have a minimum set of features known as “base mode,” but may provide
additional features depending on what features are available in the PF with
which the AVF is associated. The following are base mode features:</p>
<ul class="simple">
<li>4 Queue Pairs (QP) and associated Configuration Status Registers (CSRs)
for Tx/Rx</li>
<li>i40e descriptors and ring format</li>
<li>Descriptor write-back completion</li>
<li>1 control queue, with i40e descriptors, CSRs and ring format</li>
<li>5 MSI-X interrupt vectors and corresponding i40e CSRs</li>
<li>1 Interrupt Throttle Rate (ITR) index</li>
<li>1 Virtual Station Interface (VSI) per VF</li>
<li>1 Traffic Class (TC), TC0</li>
<li>Receive Side Scaling (RSS) with 64 entry indirection table and key,
configured through the PF</li>
<li>1 unicast MAC address reserved per VF</li>
<li>16 MAC address filters for each VF</li>
<li>Stateless offloads - non-tunneled checksums</li>
<li>AVF device ID</li>
<li>HW mailbox is used for VF to PF communications (including on Windows)</li>
</ul>
</div>
<div class="section" id="ieee-802-1ad-qinq-support">
<h3>IEEE 802.1ad (QinQ)&nbsp;Support<a class="headerlink" href="#ieee-802-1ad-qinq-support" title="Permalink to this headline">¶</a></h3>
<p>The IEEE 802.1ad standard, informally known as QinQ, allows for multiple VLAN
IDs within a single Ethernet frame. VLAN IDs are sometimes referred to as
“tags,” and multiple VLAN IDs are thus referred to as a “tag stack.” Tag stacks
allow L2 tunneling and the ability to segregate traffic within a particular
VLAN ID, among other uses.</p>
<p>The following are examples of how to configure 802.1ad (QinQ):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># ip link add link eth0 eth0.24 type vlan proto 802.1ad id 24
# ip link add link eth0.24 eth0.24.371 type vlan proto 802.1Q id 371
</pre></div>
</div>
<p>Where “24” and “371” are example VLAN IDs.</p>
<dl class="docutils">
<dt>NOTES:</dt>
<dd>Receive checksum offloads, cloud filters, and VLAN acceleration are not
supported for 802.1ad (QinQ) packets.</dd>
</dl>
</div>
<div class="section" id="application-device-queues-adq">
<h3>Application Device Queues (ADq)<a class="headerlink" href="#application-device-queues-adq" title="Permalink to this headline">¶</a></h3>
<p>Application Device Queues (ADq) allows you to dedicate one or more queues to a
specific application. This can reduce latency for the specified application,
and allow Tx traffic to be rate limited per application. Follow the steps below
to set ADq.</p>
<p>Requirements:</p>
<ul class="simple">
<li>The sch_mqprio, act_mirred and cls_flower modules must be loaded</li>
<li>The latest version of iproute2</li>
<li>If another driver (for example, DPDK) has set cloud filters, you cannot
enable ADQ</li>
<li>Depending on the underlying PF device, ADQ cannot be enabled when the
following features are enabled:<ul>
<li>Data Center Bridging (DCB)</li>
<li>Multiple Functions per Port (MFP)</li>
<li>Sideband Filters</li>
</ul>
</li>
</ul>
<p>1. Create traffic classes (TCs). Maximum of 8 TCs can be created per interface.
The shaper bw_rlimit parameter is optional.</p>
<p>Example: Sets up two tcs, tc0 and tc1, with 16 queues each and max tx rate set
to 1Gbit for tc0 and 3Gbit for tc1.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>tc qdisc add dev &lt;interface&gt; root mqprio num_tc 2 map 0 0 0 0 1 1 1 1
queues 16@0 16@16 hw 1 mode channel shaper bw_rlimit min_rate 1Gbit 2Gbit
max_rate 1Gbit 3Gbit
</pre></div>
</div>
<p>map: priority mapping for up to 16 priorities to tcs (e.g. map 0 0 0 0 1 1 1 1
sets priorities 0-3 to use tc0 and 4-7 to use tc1)</p>
<p>queues: for each tc, &lt;num queues&gt;&#64;&lt;offset&gt; (e.g. queues 16&#64;0 <a class="reference external" href="mailto:16&#37;&#52;&#48;16">16<span>&#64;</span>16</a> assigns
16 queues to tc0 at offset 0 and 16 queues to tc1 at offset 16. Max total
number of queues for all tcs is 64 or number of cores, whichever is lower.)</p>
<p>hw 1 mode channel: ‘channel’ with ‘hw’ set to 1 is a new new hardware
offload mode in mqprio that makes full use of the mqprio options, the
TCs, the queue configurations, and the QoS parameters.</p>
<p>shaper bw_rlimit: for each tc, sets minimum and maximum bandwidth rates.
Totals must be equal or less than port speed.</p>
<p>For example: min_rate 1Gbit 3Gbit: Verify bandwidth limit using network
monitoring tools such as ifstat or sar –n DEV [interval] [number of samples]</p>
<dl class="docutils">
<dt>NOTE:</dt>
<dd>Setting up channels via ethtool (ethtool -L) is not supported when the
TCs are configured using mqprio.</dd>
</dl>
<ol class="arabic" start="2">
<li><p class="first">Enable HW TC offload on interface:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># ethtool -K &lt;interface&gt; hw-tc-offload on
</pre></div>
</div>
</li>
<li><p class="first">Apply TCs to ingress (RX) flow of interface:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># tc qdisc add dev &lt;interface&gt; ingress
</pre></div>
</div>
</li>
</ol>
<dl class="docutils">
<dt>NOTES:</dt>
<dd><ul class="first last simple">
<li>Run all tc commands from the iproute2 &lt;pathtoiproute2&gt;/tc/ directory</li>
<li>ADq is not compatible with cloud filters</li>
<li>Setting up channels via ethtool (ethtool -L) is not supported when the TCs
are configured using mqprio</li>
<li>You must have iproute2 latest version</li>
<li>NVM version 6.01 or later is required</li>
<li>ADq cannot be enabled when any the following features are enabled: Data
Center Bridging (DCB), Multiple Functions per Port (MFP), or Sideband Filters</li>
<li>If another driver (for example, DPDK) has set cloud filters, you cannot
enable ADq</li>
<li>Tunnel filters are not supported in ADq. If encapsulated packets do arrive
in non-tunnel mode, filtering will be done on the inner headers.  For example,
for VXLAN traffic in non-tunnel mode, PCTYPE is identified as a VXLAN
encapsulated packet, outer headers are ignored. Therefore, inner headers are
matched.</li>
<li>If a TC filter on a PF matches traffic over a VF (on the PF), that traffic
will be routed to the appropriate queue of the PF, and will not be passed on
the VF. Such traffic will end up getting dropped higher up in the TCP/IP
stack as it does not match PF address data.</li>
<li>If traffic matches multiple TC filters that point to different TCs, that
traffic will be duplicated and sent to all matching TC queues.  The hardware
switch mirrors the packet to a VSI list when multiple filters are matched.</li>
</ul>
</dd>
</dl>
</div>
</div>
<div class="section" id="known-issues-troubleshooting">
<h2>Known Issues/Troubleshooting<a class="headerlink" href="#known-issues-troubleshooting" title="Permalink to this headline">¶</a></h2>
<div class="section" id="bonding-fails-with-vfs-bound-to-an-intel-r-ethernet-controller-700-series-device">
<h3>Bonding fails with VFs bound to an Intel(R) Ethernet Controller 700 series device<a class="headerlink" href="#bonding-fails-with-vfs-bound-to-an-intel-r-ethernet-controller-700-series-device" title="Permalink to this headline">¶</a></h3>
<p>If you bind Virtual Functions (VFs) to an Intel(R) Ethernet Controller 700
series based device, the VF slaves may fail when they become the active slave.
If the MAC address of the VF is set by the PF (Physical Function) of the
device, when you add a slave, or change the active-backup slave, Linux bonding
tries to sync the backup slave’s MAC address to the same MAC address as the
active slave. Linux bonding will fail at this point. This issue will not occur
if the VF’s MAC address is not set by the PF.</p>
</div>
<div class="section" id="traffic-is-not-being-passed-between-vm-and-client">
<h3>Traffic Is Not Being Passed Between VM and Client<a class="headerlink" href="#traffic-is-not-being-passed-between-vm-and-client" title="Permalink to this headline">¶</a></h3>
<p>You may not be able to pass traffic between a client system and a
Virtual Machine (VM) running on a separate host if the Virtual Function
(VF, or Virtual NIC) is not in trusted mode and spoof checking is enabled
on the VF. Note that this situation can occur in any combination of client,
host, and guest operating system. For information on how to set the VF to
trusted mode, refer to the section “VLAN Tag Packet Steering” in this
readme document. For information on setting spoof checking, refer to the
section “MAC and VLAN anti-spoofing feature” in this readme document.</p>
</div>
<div class="section" id="do-not-unload-port-driver-if-vf-with-active-vm-is-bound-to-it">
<h3>Do not unload port driver if VF with active VM is bound to it<a class="headerlink" href="#do-not-unload-port-driver-if-vf-with-active-vm-is-bound-to-it" title="Permalink to this headline">¶</a></h3>
<p>Do not unload a port’s driver if a Virtual Function (VF) with an active Virtual
Machine (VM) is bound to it. Doing so will cause the port to appear to hang.
Once the VM shuts down, or otherwise releases the VF, the command will complete.</p>
</div>
<div class="section" id="using-four-traffic-classes-fails">
<h3>Using four traffic classes fails<a class="headerlink" href="#using-four-traffic-classes-fails" title="Permalink to this headline">¶</a></h3>
<p>Do not try to reserve more than three traffic classes in the iavf driver. Doing
so will fail to set any traffic classes and will cause the driver to write
errors to stdout. Use a maximum of three queues to avoid this issue.</p>
</div>
<div class="section" id="multiple-log-error-messages-on-iavf-driver-removal">
<h3>Multiple log error messages on iavf driver removal<a class="headerlink" href="#multiple-log-error-messages-on-iavf-driver-removal" title="Permalink to this headline">¶</a></h3>
<p>If you have several VFs and you remove the iavf driver, several instances of
the following log errors are written to the log:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Unable to send opcode 2 to PF, err I40E_ERR_QUEUE_EMPTY, aq_err ok
Unable to send the message to VF 2 aq_err 12
ARQ Overflow Error detected
</pre></div>
</div>
</div>
<div class="section" id="virtual-machine-does-not-get-link">
<h3>Virtual machine does not get link<a class="headerlink" href="#virtual-machine-does-not-get-link" title="Permalink to this headline">¶</a></h3>
<p>If the virtual machine has more than one virtual port assigned to it, and those
virtual ports are bound to different physical ports, you may not get link on
all of the virtual ports. The following command may work around the issue:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># ethtool -r &lt;PF&gt;
</pre></div>
</div>
<p>Where &lt;PF&gt; is the PF interface in the host, for example: p5p1. You may need to
run the command more than once to get link on all virtual ports.</p>
</div>
<div class="section" id="mac-address-of-virtual-function-changes-unexpectedly">
<h3>MAC address of Virtual Function changes unexpectedly<a class="headerlink" href="#mac-address-of-virtual-function-changes-unexpectedly" title="Permalink to this headline">¶</a></h3>
<p>If a Virtual Function’s MAC address is not assigned in the host, then the VF
(virtual function) driver will use a random MAC address. This random MAC
address may change each time the VF driver is reloaded. You can assign a static
MAC address in the host machine. This static MAC address will survive
a VF driver reload.</p>
</div>
<div class="section" id="driver-buffer-overflow-fix">
<h3>Driver Buffer Overflow Fix<a class="headerlink" href="#driver-buffer-overflow-fix" title="Permalink to this headline">¶</a></h3>
<p>The fix to resolve CVE-2016-8105, referenced in Intel SA-00069
<a class="reference external" href="https://www.intel.com/content/www/us/en/security-center/advisory/intel-sa-00069.html">https://www.intel.com/content/www/us/en/security-center/advisory/intel-sa-00069.html</a>
is included in this and future versions of the driver.</p>
</div>
<div class="section" id="multiple-interfaces-on-same-ethernet-broadcast-network">
<h3>Multiple Interfaces on Same Ethernet Broadcast Network<a class="headerlink" href="#multiple-interfaces-on-same-ethernet-broadcast-network" title="Permalink to this headline">¶</a></h3>
<p>Due to the default ARP behavior on Linux, it is not possible to have one system
on two IP networks in the same Ethernet broadcast domain (non-partitioned
switch) behave as expected. All Ethernet interfaces will respond to IP traffic
for any IP address assigned to the system. This results in unbalanced receive
traffic.</p>
<p>If you have multiple interfaces in a server, either turn on ARP filtering by
entering:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo 1 &gt; /proc/sys/net/ipv4/conf/all/arp_filter
</pre></div>
</div>
<dl class="docutils">
<dt>NOTE:</dt>
<dd><p class="first">This setting is not saved across reboots. The configuration change can be
made permanent by adding the following line to the file /etc/sysctl.conf:</p>
<div class="last highlight-none notranslate"><div class="highlight"><pre><span></span>net.ipv4.conf.all.arp_filter = 1
</pre></div>
</div>
</dd>
</dl>
<p>Another alternative is to install the interfaces in separate broadcast domains
(either in different switches or in a switch partitioned to VLANs).</p>
</div>
<div class="section" id="rx-page-allocation-errors">
<h3>Rx Page Allocation Errors<a class="headerlink" href="#rx-page-allocation-errors" title="Permalink to this headline">¶</a></h3>
<p>‘Page allocation failure. order:0’ errors may occur under stress.
This is caused by the way the Linux kernel reports this stressed condition.</p>
</div>
</div>
<div class="section" id="support">
<h2>Support<a class="headerlink" href="#support" title="Permalink to this headline">¶</a></h2>
<p>For general information, go to the Intel support website at:</p>
<p><a class="reference external" href="https://support.intel.com">https://support.intel.com</a></p>
<p>or the Intel Wired Networking project hosted by Sourceforge at:</p>
<p><a class="reference external" href="https://sourceforge.net/projects/e1000">https://sourceforge.net/projects/e1000</a></p>
<p>If an issue is identified with the released source code on the supported kernel
with a supported adapter, email the specific information related to the issue
to <a class="reference external" href="mailto:e1000-devel&#37;&#52;&#48;lists&#46;sf&#46;net">e1000-devel<span>&#64;</span>lists<span>&#46;</span>sf<span>&#46;</span>net</a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>