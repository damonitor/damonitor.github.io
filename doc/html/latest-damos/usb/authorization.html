

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Authorizing (or not) your USB devices to connect to the system &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/mm/damon/index.html">Monitoring Data Accesses</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../vm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Authorizing (or not) your USB devices to connect to the system</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/usb/authorization.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="authorizing-or-not-your-usb-devices-to-connect-to-the-system">
<h1>Authorizing (or not) your USB devices to connect to the system<a class="headerlink" href="#authorizing-or-not-your-usb-devices-to-connect-to-the-system" title="Permalink to this headline">¶</a></h1>
<p>Copyright (C) 2007 Inaky Perez-Gonzalez &lt;<a class="reference external" href="mailto:inaky&#37;&#52;&#48;linux&#46;intel&#46;com">inaky<span>&#64;</span>linux<span>&#46;</span>intel<span>&#46;</span>com</a>&gt; Intel Corporation</p>
<p>This feature allows you to control if a USB device can be used (or
not) in a system. This feature will allow you to implement a lock-down
of USB devices, fully controlled by user space.</p>
<p>As of now, when a USB device is connected it is configured and
its interfaces are immediately made available to the users.  With this
modification, only if root authorizes the device to be configured will
then it be possible to use it.</p>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>Authorize a device to connect:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo 1 &gt; /sys/bus/usb/devices/DEVICE/authorized
</pre></div>
</div>
<p>De-authorize a device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo 0 &gt; /sys/bus/usb/devices/DEVICE/authorized
</pre></div>
</div>
<p>Set new devices connected to hostX to be deauthorized by default (ie:
lock down):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo 0 &gt; /sys/bus/usb/devices/usbX/authorized_default
</pre></div>
</div>
<p>Remove the lock down:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo 1 &gt; /sys/bus/usb/devices/usbX/authorized_default
</pre></div>
</div>
<p>By default, Wired USB devices are authorized by default to
connect. Wireless USB hosts deauthorize by default all new connected
devices (this is so because we need to do an authentication phase
before authorizing). Writing “2” to the authorized_default attribute
causes kernel to only authorize by default devices connected to internal
USB ports.</p>
<div class="section" id="example-system-lockdown-lame">
<h3>Example system lockdown (lame)<a class="headerlink" href="#example-system-lockdown-lame" title="Permalink to this headline">¶</a></h3>
<p>Imagine you want to implement a lockdown so only devices of type XYZ
can be connected (for example, it is a kiosk machine with a visible
USB port):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>boot up
rc.local -&gt;

 for host in /sys/bus/usb/devices/usb*
 do
    echo 0 &gt; $host/authorized_default
 done
</pre></div>
</div>
<p>Hookup an script to udev, for new USB devices:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>if device_is_my_type $DEV
then
  echo 1 &gt; $device_path/authorized
done
</pre></div>
</div>
<p>Now, device_is_my_type() is where the juice for a lockdown is. Just
checking if the class, type and protocol match something is the worse
security verification you can make (or the best, for someone willing
to break it). If you need something secure, use crypto and Certificate
Authentication or stuff like that. Something simple for an storage key
could be:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>function device_is_my_type()
{
  echo 1 &gt; authorized          # temporarily authorize it
                               # FIXME: make sure none can mount it
  mount DEVICENODE /mntpoint
  sum=$(md5sum /mntpoint/.signature)
  if [ $sum = $(cat /etc/lockdown/keysum) ]
  then
       echo &quot;We are good, connected&quot;
       umount /mntpoint
       # Other stuff so others can use it
  else
       echo 0 &gt; authorized
  fi
}
</pre></div>
</div>
<p>Of course, this is lame, you’d want to do a real certificate
verification stuff with PKI, so you don’t depend on a shared secret,
etc, but you get the idea. Anybody with access to a device gadget kit
can fake descriptors and device info. Don’t trust that. You are
welcome.</p>
</div>
<div class="section" id="interface-authorization">
<h3>Interface authorization<a class="headerlink" href="#interface-authorization" title="Permalink to this headline">¶</a></h3>
<p>There is a similar approach to allow or deny specific USB interfaces.
That allows to block only a subset of an USB device.</p>
<p>Authorize an interface:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo 1 &gt; /sys/bus/usb/devices/INTERFACE/authorized
</pre></div>
</div>
<p>Deauthorize an interface:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo 0 &gt; /sys/bus/usb/devices/INTERFACE/authorized
</pre></div>
</div>
<p>The default value for new interfaces
on a particular USB bus can be changed, too.</p>
<p>Allow interfaces per default:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo 1 &gt; /sys/bus/usb/devices/usbX/interface_authorized_default
</pre></div>
</div>
<p>Deny interfaces per default:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo 0 &gt; /sys/bus/usb/devices/usbX/interface_authorized_default
</pre></div>
</div>
<p>Per default the interface_authorized_default bit is 1.
So all interfaces would authorized per default.</p>
<dl class="docutils">
<dt>Note:</dt>
<dd>If a deauthorized interface will be authorized so the driver probing must
be triggered manually by writing INTERFACE to /sys/bus/usb/drivers_probe</dd>
</dl>
<p>For drivers that need multiple interfaces all needed interfaces should be
authorized first. After that the drivers should be probed.
This avoids side effects.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>