

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Kernel driver lm85 &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.8.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/mm/damon/index.html">Monitoring Data Accesses</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../vm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Kernel driver lm85</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/hwmon/lm85.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="kernel-driver-lm85">
<h1>Kernel driver lm85<a class="headerlink" href="#kernel-driver-lm85" title="Permalink to this headline">¶</a></h1>
<p>Supported chips:</p>
<blockquote>
<div><ul>
<li><p class="first">National Semiconductor LM85 (B and C versions)</p>
<p>Prefix: ‘lm85b’ or ‘lm85c’</p>
<p>Addresses scanned: I2C 0x2c, 0x2d, 0x2e</p>
<p>Datasheet: <a class="reference external" href="http://www.national.com/pf/LM/LM85.html">http://www.national.com/pf/LM/LM85.html</a></p>
</li>
<li><p class="first">Texas Instruments LM96000</p>
<p>Prefix: ‘lm9600’</p>
<p>Addresses scanned: I2C 0x2c, 0x2d, 0x2e</p>
<p>Datasheet: <a class="reference external" href="http://www.ti.com/lit/ds/symlink/lm96000.pdf">http://www.ti.com/lit/ds/symlink/lm96000.pdf</a></p>
</li>
<li><p class="first">Analog Devices ADM1027</p>
<p>Prefix: ‘adm1027’</p>
<p>Addresses scanned: I2C 0x2c, 0x2d, 0x2e</p>
<p>Datasheet: <a class="reference external" href="http://www.onsemi.com/PowerSolutions/product.do?id=ADM1027">http://www.onsemi.com/PowerSolutions/product.do?id=ADM1027</a></p>
</li>
<li><p class="first">Analog Devices ADT7463</p>
<p>Prefix: ‘adt7463’</p>
<p>Addresses scanned: I2C 0x2c, 0x2d, 0x2e</p>
<p>Datasheet: <a class="reference external" href="http://www.onsemi.com/PowerSolutions/product.do?id=ADT7463">http://www.onsemi.com/PowerSolutions/product.do?id=ADT7463</a></p>
</li>
<li><p class="first">Analog Devices ADT7468</p>
<p>Prefix: ‘adt7468’</p>
<p>Addresses scanned: I2C 0x2c, 0x2d, 0x2e</p>
<p>Datasheet: <a class="reference external" href="http://www.onsemi.com/PowerSolutions/product.do?id=ADT7468">http://www.onsemi.com/PowerSolutions/product.do?id=ADT7468</a></p>
</li>
<li><p class="first">SMSC EMC6D100, SMSC EMC6D101</p>
<p>Prefix: ‘emc6d100’</p>
<p>Addresses scanned: I2C 0x2c, 0x2d, 0x2e</p>
<p>Datasheet: <a class="reference external" href="http://www.smsc.com/media/Downloads_Public/discontinued/6d100.pdf">http://www.smsc.com/media/Downloads_Public/discontinued/6d100.pdf</a></p>
</li>
<li><p class="first">SMSC EMC6D102</p>
<p>Prefix: ‘emc6d102’</p>
<p>Addresses scanned: I2C 0x2c, 0x2d, 0x2e</p>
<p>Datasheet: <a class="reference external" href="http://www.smsc.com/main/catalog/emc6d102.html">http://www.smsc.com/main/catalog/emc6d102.html</a></p>
</li>
<li><p class="first">SMSC EMC6D103</p>
<p>Prefix: ‘emc6d103’</p>
<p>Addresses scanned: I2C 0x2c, 0x2d, 0x2e</p>
<p>Datasheet: <a class="reference external" href="http://www.smsc.com/main/catalog/emc6d103.html">http://www.smsc.com/main/catalog/emc6d103.html</a></p>
</li>
<li><p class="first">SMSC EMC6D103S</p>
<p>Prefix: ‘emc6d103s’</p>
<p>Addresses scanned: I2C 0x2c, 0x2d, 0x2e</p>
<p>Datasheet: <a class="reference external" href="http://www.smsc.com/main/catalog/emc6d103s.html">http://www.smsc.com/main/catalog/emc6d103s.html</a></p>
</li>
</ul>
</div></blockquote>
<dl class="docutils">
<dt>Authors:</dt>
<dd><ul class="first last simple">
<li>Philip Pokorny &lt;<a class="reference external" href="mailto:ppokorny&#37;&#52;&#48;penguincomputing&#46;com">ppokorny<span>&#64;</span>penguincomputing<span>&#46;</span>com</a>&gt;,</li>
<li>Frodo Looijaard &lt;<a class="reference external" href="mailto:frodol&#37;&#52;&#48;dds&#46;nl">frodol<span>&#64;</span>dds<span>&#46;</span>nl</a>&gt;,</li>
<li>Richard Barrington &lt;<a class="reference external" href="mailto:rich_b_nz&#37;&#52;&#48;clear&#46;net&#46;nz">rich_b_nz<span>&#64;</span>clear<span>&#46;</span>net<span>&#46;</span>nz</a>&gt;,</li>
<li>Margit Schubert-While &lt;<a class="reference external" href="mailto:margitsw&#37;&#52;&#48;t-online&#46;de">margitsw<span>&#64;</span>t-online<span>&#46;</span>de</a>&gt;,</li>
<li>Justin Thiessen &lt;<a class="reference external" href="mailto:jthiessen&#37;&#52;&#48;penguincomputing&#46;com">jthiessen<span>&#64;</span>penguincomputing<span>&#46;</span>com</a>&gt;</li>
</ul>
</dd>
</dl>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This driver implements support for the National Semiconductor LM85 and
compatible chips including the Analog Devices ADM1027, ADT7463, ADT7468 and
SMSC EMC6D10x chips family.</p>
<p>The LM85 uses the 2-wire interface compatible with the SMBUS 2.0
specification. Using an analog to digital converter it measures three (3)
temperatures and five (5) voltages. It has four (4) 16-bit counters for
measuring fan speed. Five (5) digital inputs are provided for sampling the
VID signals from the processor to the VRM. Lastly, there are three (3) PWM
outputs that can be used to control fan speed.</p>
<p>The voltage inputs have internal scaling resistors so that the following
voltage can be measured without external resistors:</p>
<blockquote>
<div>2.5V, 3.3V, 5V, 12V, and CPU core voltage (2.25V)</div></blockquote>
<p>The temperatures measured are one internal diode, and two remote diodes.
Remote 1 is generally the CPU temperature. These inputs are designed to
measure a thermal diode like the one in a Pentium 4 processor in a socket
423 or socket 478 package. They can also measure temperature using a
transistor like the 2N3904.</p>
<p>A sophisticated control system for the PWM outputs is designed into the
LM85 that allows fan speed to be adjusted automatically based on any of the
three temperature sensors. Each PWM output is individually adjustable and
programmable. Once configured, the LM85 will adjust the PWM outputs in
response to the measured temperatures without further host intervention.
This feature can also be disabled for manual control of the PWM’s.</p>
<p>Each of the measured inputs (voltage, temperature, fan speed) has
corresponding high/low limit values. The LM85 will signal an ALARM if any
measured value exceeds either limit.</p>
<p>The LM85 samples all inputs continuously. The lm85 driver will not read
the registers more often than once a second. Further, configuration data is
only read once each 5 minutes. There is twice as much config data as
measurements, so this would seem to be a worthwhile optimization.</p>
</div>
<div class="section" id="special-features">
<h2>Special Features<a class="headerlink" href="#special-features" title="Permalink to this headline">¶</a></h2>
<p>The LM85 has four fan speed monitoring modes. The ADM1027 has only two.
Both have special circuitry to compensate for PWM interactions with the
TACH signal from the fans. The ADM1027 can be configured to measure the
speed of a two wire fan, but the input conditioning circuitry is different
for 3-wire and 2-wire mode. For this reason, the 2-wire fan modes are not
exposed to user control. The BIOS should initialize them to the correct
mode. If you’ve designed your own ADM1027, you’ll have to modify the
init_client function and add an insmod parameter to set this up.</p>
<p>To smooth the response of fans to changes in temperature, the LM85 has an
optional filter for smoothing temperatures. The ADM1027 has the same
config option but uses it to rate limit the changes to fan speed instead.</p>
<p>The ADM1027, ADT7463 and ADT7468 have a 10-bit ADC and can therefore
measure temperatures with 0.25 degC resolution. They also provide an offset
to the temperature readings that is automatically applied during
measurement. This offset can be used to zero out any errors due to traces
and placement. The documentation says that the offset is in 0.25 degC
steps, but in initial testing of the ADM1027 it was 1.00 degC steps. Analog
Devices has confirmed this “bug”. The ADT7463 is reported to work as
described in the documentation. The current lm85 driver does not show the
offset register.</p>
<p>The ADT7468 has a high-frequency PWM mode, where all PWM outputs are
driven by a 22.5 kHz clock. This is a global mode, not per-PWM output,
which means that setting any PWM frequency above 11.3 kHz will switch
all 3 PWM outputs to a 22.5 kHz frequency. Conversely, setting any PWM
frequency below 11.3 kHz will switch all 3 PWM outputs to a frequency
between 10 and 100 Hz, which can then be tuned separately.</p>
<p>See the vendor datasheets for more information. There is application note
from National (AN-1260) with some additional information about the LM85.
The Analog Devices datasheet is very detailed and describes a procedure for
determining an optimal configuration for the automatic PWM control.</p>
<p>The SMSC EMC6D100 &amp; EMC6D101 monitor external voltages, temperatures, and
fan speeds. They use this monitoring capability to alert the system to out
of limit conditions and can automatically control the speeds of multiple
fans in a PC or embedded system. The EMC6D101, available in a 24-pin SSOP
package, and the EMC6D100, available in a 28-pin SSOP package, are designed
to be register compatible. The EMC6D100 offers all the features of the
EMC6D101 plus additional voltage monitoring and system control features.
Unfortunately it is not possible to distinguish between the package
versions on register level so these additional voltage inputs may read
zero. EMC6D102 and EMC6D103 feature additional ADC bits thus extending precision
of voltage and temperature channels.</p>
<p>SMSC EMC6D103S is similar to EMC6D103, but does not support pwm#_auto_pwm_minctl
and temp#_auto_temp_off.</p>
<p>The LM96000 supports additional high frequency PWM modes (22.5 kHz, 24 kHz,
25.7 kHz, 27.7 kHz and 30 kHz), which can be configured on a per-PWM basis.</p>
</div>
<div class="section" id="hardware-configurations">
<h2>Hardware Configurations<a class="headerlink" href="#hardware-configurations" title="Permalink to this headline">¶</a></h2>
<p>The LM85 can be jumpered for 3 different SMBus addresses. There are
no other hardware configuration options for the LM85.</p>
<p>The lm85 driver detects both LM85B and LM85C revisions of the chip. See the
datasheet for a complete description of the differences. Other than
identifying the chip, the driver behaves no differently with regard to
these two chips. The LM85B is recommended for new designs.</p>
<p>The ADM1027, ADT7463 and ADT7468 chips have an optional SMBALERT output
that can be used to signal the chipset in case a limit is exceeded or the
temperature sensors fail. Individual sensor interrupts can be masked so
they won’t trigger SMBALERT. The SMBALERT output if configured replaces one
of the other functions (PWM2 or IN0). This functionality is not implemented
in current driver.</p>
<p>The ADT7463 and ADT7468 also have an optional THERM output/input which can
be connected to the processor PROC_HOT output. If available, the autofan
control dynamic Tmin feature can be enabled to keep the system temperature
within spec (just?!) with the least possible fan noise.</p>
</div>
<div class="section" id="configuration-notes">
<h2>Configuration Notes<a class="headerlink" href="#configuration-notes" title="Permalink to this headline">¶</a></h2>
<p>Besides standard interfaces driver adds following:</p>
<ul class="simple">
<li>Temperatures and Zones</li>
</ul>
<p>Each temperature sensor is associated with a Zone. There are three
sensors and therefore three zones (# 1, 2 and 3). Each zone has the following
temperature configuration points:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>temp#_auto_temp_off</dt>
<dd><ul class="first last">
<li>temperature below which fans should be off or spinning very low.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>temp#_auto_temp_min</dt>
<dd><ul class="first last">
<li>temperature over which fans start to spin.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>temp#_auto_temp_max</dt>
<dd><ul class="first last">
<li>temperature when fans spin at full speed.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>temp#_auto_temp_crit</dt>
<dd><ul class="first last">
<li>temperature when all fans will run full speed.</li>
</ul>
</dd>
</dl>
</li>
</ul>
<div class="section" id="pwm-control">
<h3>PWM Control<a class="headerlink" href="#pwm-control" title="Permalink to this headline">¶</a></h3>
<p>There are three PWM outputs. The LM85 datasheet suggests that the
pwm3 output control both fan3 and fan4. Each PWM can be individually
configured and assigned to a zone for its control value. Each PWM can be
configured individually according to the following options.</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>pwm#_auto_pwm_min</dt>
<dd><ul class="first last">
<li>this specifies the PWM value for temp#_auto_temp_off
temperature. (PWM value from 0 to 255)</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>pwm#_auto_pwm_minctl</dt>
<dd><ul class="first last">
<li>this flags selects for temp#_auto_temp_off temperature
the behaviour of fans. Write 1 to let fans spinning at
pwm#_auto_pwm_min or write 0 to let them off.</li>
</ul>
</dd>
</dl>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It has been reported that there is a bug in the LM85 that causes
the flag to be associated with the zones not the PWMs. This
contradicts all the published documentation. Setting pwm#_min_ctl
in this case actually affects all PWMs controlled by zone ‘#’.</p>
</div>
</div>
<div class="section" id="pwm-controlling-zone-selection">
<h3>PWM Controlling Zone selection<a class="headerlink" href="#pwm-controlling-zone-selection" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><dl class="first docutils">
<dt>pwm#_auto_channels</dt>
<dd><ul class="first last">
<li>controls zone that is associated with PWM</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Configuration choices:</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="82%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Value</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Controlled by Zone 1</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>Controlled by Zone 2</td>
</tr>
<tr class="row-even"><td>3</td>
<td>Controlled by Zone 3</td>
</tr>
<tr class="row-odd"><td>23</td>
<td>Controlled by higher temp of Zone 2 or 3</td>
</tr>
<tr class="row-even"><td>123</td>
<td>Controlled by highest temp of Zone 1, 2 or 3</td>
</tr>
<tr class="row-odd"><td>0</td>
<td>PWM always 0%  (off)</td>
</tr>
<tr class="row-even"><td>-1</td>
<td>PWM always 100%  (full on)</td>
</tr>
<tr class="row-odd"><td>-2</td>
<td>Manual control (write to ‘pwm#’ to set)</td>
</tr>
</tbody>
</table>
<p>The National LM85’s have two vendor specific configuration
features. Tach. mode and Spinup Control. For more details on these,
see the LM85 datasheet or Application Note AN-1260. These features
are not currently supported by the lm85 driver.</p>
<p>The Analog Devices ADM1027 has several vendor specific enhancements.
The number of pulses-per-rev of the fans can be set, Tach monitoring
can be optimized for PWM operation, and an offset can be applied to
the temperatures to compensate for systemic errors in the
measurements. These features are not currently supported by the lm85
driver.</p>
<p>In addition to the ADM1027 features, the ADT7463 and ADT7468 also have
Tmin control and THERM asserted counts. Automatic Tmin control acts to
adjust the Tmin value to maintain the measured temperature sensor at a
specified temperature. There isn’t much documentation on this feature in
the ADT7463 data sheet. This is not supported by current driver.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>