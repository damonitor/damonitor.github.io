

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Recipe for getting/building/running Xen/ia64 with pv_ops &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.6.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/mm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Recipe for getting/building/running Xen/ia64 with pv_ops</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/ia64/xen.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="recipe-for-getting-building-running-xen-ia64-with-pv-ops">
<h1>Recipe for getting/building/running Xen/ia64 with pv_ops<a class="headerlink" href="#recipe-for-getting-building-running-xen-ia64-with-pv-ops" title="Permalink to this headline">¶</a></h1>
<p>This recipe describes how to get xen-ia64 source and build it,
and run domU with pv_ops.</p>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li>python</li>
<li>mercurial
it (aka “hg”) is an open-source source code
management software. See the below.
<a class="reference external" href="http://www.selenic.com/mercurial/wiki/">http://www.selenic.com/mercurial/wiki/</a></li>
<li>git</li>
<li>bridge-utils</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="getting-and-building-xen-and-dom0">
<h2>Getting and Building Xen and Dom0<a class="headerlink" href="#getting-and-building-xen-and-dom0" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><blockquote>
<div><p>My environment is:</p>
<blockquote>
<div><ul class="simple">
<li>Machine  : Tiger4</li>
<li>Domain0 OS  : RHEL5</li>
<li>DomainU OS  : RHEL5</li>
</ul>
</div></blockquote>
</div></blockquote>
<ol class="arabic">
<li><p class="first">Download source:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># hg clone http://xenbits.xensource.com/ext/ia64/xen-unstable.hg
# cd xen-unstable.hg
# hg clone http://xenbits.xensource.com/ext/ia64/linux-2.6.18-xen.hg
</pre></div>
</div>
</li>
<li><p class="first"># make world</p>
</li>
<li><p class="first"># make install-tools</p>
</li>
<li><p class="first">copy kernels and xen:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cp xen/xen.gz /boot/efi/efi/redhat/
# cp build-linux-2.6.18-xen_ia64/vmlinux.gz \
/boot/efi/efi/redhat/vmlinuz-2.6.18.8-xen
</pre></div>
</div>
</li>
<li><p class="first">make initrd for Dom0/DomU:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># make -C linux-2.6.18-xen.hg ARCH=ia64 modules_install \
  O=$(pwd)/build-linux-2.6.18-xen_ia64
# mkinitrd -f /boot/efi/efi/redhat/initrd-2.6.18.8-xen.img \
  2.6.18.8-xen --builtin mptspi --builtin mptbase \
  --builtin mptscsih --builtin uhci-hcd --builtin ohci-hcd \
  --builtin ehci-hcd
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="making-a-disk-image-for-guest-os">
<h2>Making a disk image for guest OS<a class="headerlink" href="#making-a-disk-image-for-guest-os" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ol class="arabic">
<li><p class="first">make file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># dd if=/dev/zero of=/root/rhel5.img bs=1M seek=4096 count=0
# mke2fs -F -j /root/rhel5.img
# mount -o loop /root/rhel5.img /mnt
# cp -ax /{dev,var,etc,usr,bin,sbin,lib} /mnt
# mkdir /mnt/{root,proc,sys,home,tmp}

Note: You may miss some device files. If so, please create them
with mknod. Or you can use tar instead of cp.
</pre></div>
</div>
</li>
<li><p class="first">modify DomU’s fstab:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># vi /mnt/etc/fstab
   /dev/xvda1  /            ext3    defaults        1 1
   none        /dev/pts     devpts  gid=5,mode=620  0 0
   none        /dev/shm     tmpfs   defaults        0 0
   none        /proc        proc    defaults        0 0
   none        /sys         sysfs   defaults        0 0
</pre></div>
</div>
</li>
<li><p class="first">modify inittab</p>
<p>set runlevel to 3 to avoid X trying to start:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># vi /mnt/etc/inittab
   id:3:initdefault:
</pre></div>
</div>
<p>Start a getty on the hvc0 console:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>X0:2345:respawn:/sbin/mingetty hvc0
</pre></div>
</div>
<p>tty1-6 mingetty can be commented out</p>
</li>
<li><p class="first">add hvc0 into /etc/securetty:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># vi /mnt/etc/securetty (add hvc0)
</pre></div>
</div>
</li>
<li><p class="first">umount:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># umount /mnt
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
<p>FYI, virt-manager can also make a disk image for guest OS.
It’s GUI tools and easy to make it.</p>
</div>
<div class="section" id="boot-xen-domain0">
<h2>Boot Xen &amp; Domain0<a class="headerlink" href="#boot-xen-domain0" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ol class="arabic">
<li><p class="first">replace elilo
elilo of RHEL5 can boot Xen and Dom0.
If you use old elilo (e.g RHEL4), please download from the below
<a class="reference external" href="http://elilo.sourceforge.net/cgi-bin/blosxom">http://elilo.sourceforge.net/cgi-bin/blosxom</a>
and copy into /boot/efi/efi/redhat/:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cp elilo-3.6-ia64.efi /boot/efi/efi/redhat/elilo.efi
</pre></div>
</div>
</li>
<li><p class="first">modify elilo.conf (like the below):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># vi /boot/efi/efi/redhat/elilo.conf
prompt
timeout=20
default=xen
relocatable

image=vmlinuz-2.6.18.8-xen
       label=xen
       vmm=xen.gz
       initrd=initrd-2.6.18.8-xen.img
       read-only
       append=&quot; -- rhgb root=/dev/sda2&quot;
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
<p>The append options before “–” are for xen hypervisor,
the options after “–” are for dom0.</p>
<p>FYI, your machine may need console options like
“com1=19200,8n1 console=vga,com1”. For example,
append=”com1=19200,8n1 console=vga,com1 – rhgb console=tty0 console=ttyS0 root=/dev/sda2”</p>
</div>
<div class="section" id="getting-and-building-domu-with-pv-ops">
<h2>Getting and Building domU with pv_ops<a class="headerlink" href="#getting-and-building-domu-with-pv-ops" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ol class="arabic">
<li><p class="first">get pv_ops tree:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># git clone http://people.valinux.co.jp/~yamahata/xen-ia64/linux-2.6-xen-ia64.git/
</pre></div>
</div>
</li>
<li><p class="first">git branch (if necessary):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd linux-2.6-xen-ia64/
# git checkout -b your_branch origin/xen-ia64-domu-minimal-2008may19
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><dl class="docutils">
<dt>Note:</dt>
<dd><p class="first">The current branch is xen-ia64-domu-minimal-2008may19.
But you would find the new branch. You can see with
“git branch -r” to get the branch lists.</p>
<blockquote>
<div><a class="reference external" href="http://people.valinux.co.jp/~yamahata/xen-ia64/for_eagl/linux-2.6-ia64-pv-ops.git/">http://people.valinux.co.jp/~yamahata/xen-ia64/for_eagl/linux-2.6-ia64-pv-ops.git/</a></div></blockquote>
<p>is also available.</p>
<p>The tree is based on</p>
<blockquote class="last">
<div>git://git.kernel.org/pub/scm/linux/kernel/git/aegl/linux-2.6 test)</div></blockquote>
</dd>
</dl>
</div></blockquote>
<ol class="arabic" start="3">
<li><p class="first">copy .config for pv_ops of domU:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cp arch/ia64/configs/xen_domu_wip_defconfig .config
</pre></div>
</div>
</li>
<li><p class="first">make kernel with pv_ops:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># make oldconfig
# make
</pre></div>
</div>
</li>
<li><p class="first">install the kernel and initrd:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cp vmlinux.gz /boot/efi/efi/redhat/vmlinuz-2.6-pv_ops-xenU
# make modules_install
# mkinitrd -f /boot/efi/efi/redhat/initrd-2.6-pv_ops-xenU.img \
  2.6.26-rc3xen-ia64-08941-g1b12161 --builtin mptspi \
  --builtin mptbase --builtin mptscsih --builtin uhci-hcd \
  --builtin ohci-hcd --builtin ehci-hcd
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="boot-domainu-with-pv-ops">
<h2>Boot DomainU with pv_ops<a class="headerlink" href="#boot-domainu-with-pv-ops" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ol class="arabic">
<li><p class="first">make config of DomU:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># vi /etc/xen/rhel5
  kernel = &quot;/boot/efi/efi/redhat/vmlinuz-2.6-pv_ops-xenU&quot;
  ramdisk = &quot;/boot/efi/efi/redhat/initrd-2.6-pv_ops-xenU.img&quot;
  vcpus = 1
  memory = 512
  name = &quot;rhel5&quot;
  disk = [ &#39;file:/root/rhel5.img,xvda1,w&#39; ]
  root = &quot;/dev/xvda1 ro&quot;
  extra= &quot;rhgb console=hvc0&quot;
</pre></div>
</div>
</li>
<li><p class="first">After boot xen and dom0, start xend:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># /etc/init.d/xend start
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div>( In the debugging case, <cite># XEND_DEBUG=1 xend trace_start</cite> )</div></blockquote>
<ol class="arabic" start="3">
<li><p class="first">start domU:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># xm create -c rhel5
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="reference">
<h2>Reference<a class="headerlink" href="#reference" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Wiki of Xen/IA64 upstream merge
<a class="reference external" href="http://wiki.xensource.com/xenwiki/XenIA64/UpstreamMerge">http://wiki.xensource.com/xenwiki/XenIA64/UpstreamMerge</a></li>
</ul>
<p>Written by Akio Takebe &lt;<a class="reference external" href="mailto:takebe_akio&#37;&#52;&#48;jp&#46;fujitsu&#46;com">takebe_akio<span>&#64;</span>jp<span>&#46;</span>fujitsu<span>&#46;</span>com</a>&gt; on 28 May 2008</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>