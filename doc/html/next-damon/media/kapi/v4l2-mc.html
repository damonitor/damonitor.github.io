

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1.18. V4L2 Media Controller functions and data structures &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/mm/damon/index.html">Monitoring Data Accesses</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../vm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>1.18. V4L2 Media Controller functions and data structures</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/media/kapi/v4l2-mc.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="v4l2-media-controller-functions-and-data-structures">
<h1>1.18. V4L2 Media Controller functions and data structures<a class="headerlink" href="#v4l2-media-controller-functions-and-data-structures" title="Permalink to this headline">¶</a></h1>
<dl class="function">
<dt id="c.v4l2_mc_create_media_graph">
int <code class="descname">v4l2_mc_create_media_graph</code><span class="sig-paren">(</span>struct <a class="reference internal" href="mc-core.html#c.media_device" title="media_device">media_device</a> *<em>&nbsp;mdev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_mc_create_media_graph" title="Permalink to this definition">¶</a></dt>
<dd><p>create Media Controller links at the graph.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">media_device</span> <span class="pre">*</span> <span class="pre">mdev</span></code></dt>
<dd>pointer to the <a class="reference internal" href="mc-core.html#c.media_device" title="media_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">media_device</span></code></a> struct.</dd>
</dl>
<p><strong>Description</strong></p>
<p>Add links between the entities commonly found on PC customer’s hardware at
the V4L2 side: camera sensors, audio and video PLL-IF decoders, tuners,
analog TV decoder and I/O entities (video, VBI and Software Defined Radio).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Webcams are modelled on a very simple way: the sensor is
connected directly to the I/O entity. All dirty details, like
scaler and crop HW are hidden. While such mapping is enough for v4l2
interface centric PC-consumer’s hardware, V4L2 subdev centric camera
hardware should not use this routine, as it will not build the right graph.</p>
</div>
<dl class="function">
<dt id="c.v4l_enable_media_source">
int <code class="descname">v4l_enable_media_source</code><span class="sig-paren">(</span>struct <a class="reference internal" href="v4l2-dev.html#c.video_device" title="video_device">video_device</a> *<em>&nbsp;vdev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l_enable_media_source" title="Permalink to this definition">¶</a></dt>
<dd><p>Hold media source for exclusive use if free</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">video_device</span> <span class="pre">*</span> <span class="pre">vdev</span></code></dt>
<dd>pointer to struct video_device</dd>
</dl>
<p><strong>Description</strong></p>
<p>This interface calls enable_source handler to determine if
media source is free for use. The enable_source handler is
responsible for checking is the media source is free and
start a pipeline between the media source and the media
entity associated with the video device. This interface
should be called from v4l2-core and dvb-core interfaces
that change the source configuration.</p>
<p><strong>Return</strong></p>
<p>returns zero on success or a negative error code.</p>
<dl class="function">
<dt id="c.v4l_disable_media_source">
void <code class="descname">v4l_disable_media_source</code><span class="sig-paren">(</span>struct <a class="reference internal" href="v4l2-dev.html#c.video_device" title="video_device">video_device</a> *<em>&nbsp;vdev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l_disable_media_source" title="Permalink to this definition">¶</a></dt>
<dd><p>Release media source</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">video_device</span> <span class="pre">*</span> <span class="pre">vdev</span></code></dt>
<dd>pointer to struct video_device</dd>
</dl>
<p><strong>Description</strong></p>
<p>This interface calls disable_source handler to release
the media source. The disable_source handler stops the
active media pipeline between the media source and the
media entity associated with the video device.</p>
<p><strong>Return</strong></p>
<p>returns zero on success or a negative error code.</p>
<dl class="function">
<dt id="c.v4l2_pipeline_pm_get">
int <code class="descname">v4l2_pipeline_pm_get</code><span class="sig-paren">(</span>struct <a class="reference internal" href="mc-core.html#c.media_entity" title="media_entity">media_entity</a> *<em>&nbsp;entity</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_pipeline_pm_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Increase the use count of a pipeline</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">media_entity</span> <span class="pre">*</span> <span class="pre">entity</span></code></dt>
<dd>The root entity of a pipeline</dd>
</dl>
<p><strong>Description</strong></p>
<p>Update the use count of all entities in the pipeline and power entities on.</p>
<p>This function is intended to be called in video node open. It uses
struct media_entity.use_count to track the power status. The use
of this function should be paired with <a class="reference internal" href="#c.v4l2_pipeline_link_notify" title="v4l2_pipeline_link_notify"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_pipeline_link_notify()</span></code></a>.</p>
<p>Return 0 on success or a negative error code on failure.</p>
<dl class="function">
<dt id="c.v4l2_pipeline_pm_put">
void <code class="descname">v4l2_pipeline_pm_put</code><span class="sig-paren">(</span>struct <a class="reference internal" href="mc-core.html#c.media_entity" title="media_entity">media_entity</a> *<em>&nbsp;entity</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_pipeline_pm_put" title="Permalink to this definition">¶</a></dt>
<dd><p>Decrease the use count of a pipeline</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">media_entity</span> <span class="pre">*</span> <span class="pre">entity</span></code></dt>
<dd>The root entity of a pipeline</dd>
</dl>
<p><strong>Description</strong></p>
<p>Update the use count of all entities in the pipeline and power entities off.</p>
<p>This function is intended to be called in video node release. It uses
struct media_entity.use_count to track the power status. The use
of this function should be paired with <a class="reference internal" href="#c.v4l2_pipeline_link_notify" title="v4l2_pipeline_link_notify"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_pipeline_link_notify()</span></code></a>.</p>
<dl class="function">
<dt id="c.v4l2_pipeline_link_notify">
int <code class="descname">v4l2_pipeline_link_notify</code><span class="sig-paren">(</span>struct <a class="reference internal" href="mc-core.html#c.media_link" title="media_link">media_link</a> *<em>&nbsp;link</em>, u32<em>&nbsp;flags</em>, unsigned int<em>&nbsp;notification</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_pipeline_link_notify" title="Permalink to this definition">¶</a></dt>
<dd><p>Link management notification callback</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">media_link</span> <span class="pre">*</span> <span class="pre">link</span></code></dt>
<dd>The link</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">flags</span></code></dt>
<dd>New link flags that will be applied</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">notification</span></code></dt>
<dd>The link’s state change notification type (MEDIA_DEV_NOTIFY_*)</dd>
</dl>
<p><strong>Description</strong></p>
<p>React to link management on powered pipelines by updating the use count of
all entities in the source and sink sides of the link. Entities are powered
on or off accordingly. The use of this function should be paired
with v4l2_pipeline_pm_{get,put}().</p>
<p>Return 0 on success or a negative error code on failure. Powering entities
off is assumed to never fail. This function will not fail for disconnection
events.</p>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>