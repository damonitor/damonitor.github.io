

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>NFS Fault Injection &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.6.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../mm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>NFS Fault Injection</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/admin-guide/nfs/fault_injection.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="nfs-fault-injection">
<h1>NFS Fault Injection<a class="headerlink" href="#nfs-fault-injection" title="Permalink to this headline">¶</a></h1>
<p>Fault injection is a method for forcing errors that may not normally occur, or
may be difficult to reproduce.  Forcing these errors in a controlled environment
can help the developer find and fix bugs before their code is shipped in a
production system.  Injecting an error on the Linux NFS server will allow us to
observe how the client reacts and if it manages to recover its state correctly.</p>
<p>NFSD_FAULT_INJECTION must be selected when configuring the kernel to use this
feature.</p>
<div class="section" id="using-fault-injection">
<h2>Using Fault Injection<a class="headerlink" href="#using-fault-injection" title="Permalink to this headline">¶</a></h2>
<p>On the client, mount the fault injection server through NFS v4.0+ and do some
work over NFS (open files, take locks, …).</p>
<p>On the server, mount the debugfs filesystem to &lt;debug_dir&gt; and ls
&lt;debug_dir&gt;/nfsd.  This will show a list of files that will be used for
injecting faults on the NFS server.  As root, write a number n to the file
corresponding to the action you want the server to take.  The server will then
process the first n items it finds.  So if you want to forget 5 locks, echo ‘5’
to &lt;debug_dir&gt;/nfsd/forget_locks.  A value of 0 will tell the server to forget
all corresponding items.  A log message will be created containing the number
of items forgotten (check dmesg).</p>
<p>Go back to work on the client and check if the client recovered from the error
correctly.</p>
</div>
<div class="section" id="available-faults">
<h2>Available Faults<a class="headerlink" href="#available-faults" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>forget_clients:</dt>
<dd>The NFS server keeps a list of clients that have placed a mount call.  If
this list is cleared, the server will have no knowledge of who the client
is, forcing the client to reauthenticate with the server.</dd>
<dt>forget_openowners:</dt>
<dd>The NFS server keeps a list of what files are currently opened and who
they were opened by.  Clearing this list will force the client to reopen
its files.</dd>
<dt>forget_locks:</dt>
<dd>The NFS server keeps a list of what files are currently locked in the VFS.
Clearing this list will force the client to reclaim its locks (files are
unlocked through the VFS as they are cleared from this list).</dd>
<dt>forget_delegations:</dt>
<dd>A delegation is used to assure the client that a file, or part of a file,
has not changed since the delegation was awarded.  Clearing this list will
force the client to reacquire its delegation before accessing the file
again.</dd>
<dt>recall_delegations:</dt>
<dd>Delegations can be recalled by the server when another client attempts to
access a file.  This test will notify the client that its delegation has
been revoked, forcing the client to reacquire the delegation before using
the file again.</dd>
</dl>
</div>
<div class="section" id="tools-nfs-inject-faults-sh-script">
<h2>tools/nfs/inject_faults.sh script<a class="headerlink" href="#tools-nfs-inject-faults-sh-script" title="Permalink to this headline">¶</a></h2>
<p>This script has been created to ease the fault injection process.  This script
will detect the mounted debugfs directory and write to the files located there
based on the arguments passed by the user.  For example, running
<cite>inject_faults.sh forget_locks 1</cite> as root will instruct the server to forget
one lock.  Running <cite>inject_faults forget_locks</cite> will instruct the server to
forgetall locks.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>