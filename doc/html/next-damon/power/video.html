

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Video issues with S3 resume &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/mm/damon/index.html">Monitoring Data Accesses</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../vm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Video issues with S3 resume</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/power/video.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="video-issues-with-s3-resume">
<h1>Video issues with S3 resume<a class="headerlink" href="#video-issues-with-s3-resume" title="Permalink to this headline">¶</a></h1>
<p>2003-2006, Pavel Machek</p>
<p>During S3 resume, hardware needs to be reinitialized. For most
devices, this is easy, and kernel driver knows how to do
it. Unfortunately there’s one exception: video card. Those are usually
initialized by BIOS, and kernel does not have enough information to
boot video card. (Kernel usually does not even contain video card
driver – vesafb and vgacon are widely used).</p>
<p>This is not problem for swsusp, because during swsusp resume, BIOS is
run normally so video card is normally initialized. It should not be
problem for S1 standby, because hardware should retain its state over
that.</p>
<p>We either have to run video BIOS during early resume, or interpret it
using vbetool later, or maybe nothing is necessary on particular
system because video state is preserved. Unfortunately different
methods work on different systems, and no known method suits all of
them.</p>
<p>Userland application called s2ram has been developed; it contains long
whitelist of systems, and automatically selects working method for a
given system. It can be downloaded from CVS at
www.sf.net/projects/suspend . If you get a system that is not in the
whitelist, please try to find a working solution, and submit whitelist
entry so that work does not need to be repeated.</p>
<p>Currently, VBE_SAVE method (6 below) works on most
systems. Unfortunately, vbetool only runs after userland is resumed,
so it makes debugging of early resume problems
hard/impossible. Methods that do not rely on userland are preferable.</p>
<div class="section" id="details">
<h2>Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h2>
<p>There are a few types of systems where video works after S3 resume:</p>
<ol class="arabic simple">
<li>systems where video state is preserved over S3.</li>
<li>systems where it is possible to call the video BIOS during S3
resume. Unfortunately, it is not correct to call the video BIOS at
that point, but it happens to work on some machines. Use
acpi_sleep=s3_bios.</li>
<li>systems that initialize video card into vga text mode and where
the BIOS works well enough to be able to set video mode. Use
acpi_sleep=s3_mode on these.</li>
<li>on some systems s3_bios kicks video into text mode, and
acpi_sleep=s3_bios,s3_mode is needed.</li>
<li>radeon systems, where X can soft-boot your video card. You’ll need
a new enough X, and a plain text console (no vesafb or radeonfb). See
<a class="reference external" href="http://www.doesi.gmxhome.de/linux/tm800s3/s3.html">http://www.doesi.gmxhome.de/linux/tm800s3/s3.html</a> for more information.
Alternatively, you should use vbetool (6) instead.</li>
<li>other radeon systems, where vbetool is enough to bring system back
to life. It needs text console to be working. Do vbetool vbestate
save &gt; /tmp/delme; echo 3 &gt; /proc/acpi/sleep; vbetool post; vbetool
vbestate restore &lt; /tmp/delme; setfont &lt;whatever&gt;, and your video
should work.</li>
<li>on some systems, it is possible to boot most of kernel, and then
POSTing bios works. Ole Rohne has patch to do just that at
<a class="reference external" href="http://dev.gentoo.org/~marineam/patch-radeonfb-2.6.11-rc2-mm2">http://dev.gentoo.org/~marineam/patch-radeonfb-2.6.11-rc2-mm2</a>.</li>
<li>on some systems, you can use the video_post utility and or
do echo 3 &gt; /sys/power/state  &amp;&amp; /usr/sbin/video_post - which will
initialize the display in console mode. If you are in X, you can switch
to a virtual terminal and back to X using  CTRL+ALT+F1 - CTRL+ALT+F7 to get
the display working in graphical mode again.</li>
</ol>
<p>Now, if you pass acpi_sleep=something, and it does not work with your
bios, you’ll get a hard crash during resume. Be careful. Also it is
safest to do your experiments with plain old VGA console. The vesafb
and radeonfb (etc) drivers have a tendency to crash the machine during
resume.</p>
<p>You may have a system where none of above works. At that point you
either invent another ugly hack that works, or write proper driver for
your video card (good luck getting docs :-(). Maybe suspending from X
(proper X, knowing your hardware, not XF68_FBcon) might have better
chance of working.</p>
<p>Table of known working notebooks:</p>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Model</th>
<th class="head">hack (or “how to do it”)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Acer Aspire 1406LC</td>
<td>ole’s late BIOS init (7), turn off DRI</td>
</tr>
<tr class="row-odd"><td>Acer TM 230</td>
<td>s3_bios (2)</td>
</tr>
<tr class="row-even"><td>Acer TM 242FX</td>
<td>vbetool (6)</td>
</tr>
<tr class="row-odd"><td>Acer TM C110</td>
<td>video_post (8)</td>
</tr>
<tr class="row-even"><td>Acer TM C300</td>
<td>vga=normal (only suspend on console, not in X),
vbetool (6) or video_post (8)</td>
</tr>
<tr class="row-odd"><td>Acer TM 4052LCi</td>
<td>s3_bios (2)</td>
</tr>
<tr class="row-even"><td>Acer TM 636Lci</td>
<td>s3_bios,s3_mode (4)</td>
</tr>
<tr class="row-odd"><td>Acer TM 650 (Radeon M7)</td>
<td>vga=normal plus boot-radeon (5) gets text
console back</td>
</tr>
<tr class="row-even"><td>Acer TM 660</td>
<td>??? <a class="footnote-reference" href="#f1" id="id1">[1]</a></td>
</tr>
<tr class="row-odd"><td>Acer TM 800</td>
<td>vga=normal, X patches, see webpage (5)
or vbetool (6)</td>
</tr>
<tr class="row-even"><td>Acer TM 803</td>
<td>vga=normal, X patches, see webpage (5)
or vbetool (6)</td>
</tr>
<tr class="row-odd"><td>Acer TM 803LCi</td>
<td>vga=normal, vbetool (6)</td>
</tr>
<tr class="row-even"><td>Arima W730a</td>
<td>vbetool needed (6)</td>
</tr>
<tr class="row-odd"><td>Asus L2400D</td>
<td>s3_mode (3) <a class="footnote-reference" href="#f2" id="id2">[2]</a> (S1 also works OK)</td>
</tr>
<tr class="row-even"><td>Asus L3350M (SiS 740)</td>
<td><ol class="first last arabic simple" start="6">
<li></li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Asus L3800C (Radeon M7)</td>
<td>s3_bios (2) (S1 also works OK)</td>
</tr>
<tr class="row-even"><td>Asus M6887Ne</td>
<td>vga=normal, s3_bios (2), use radeon driver
instead of fglrx in x.org</td>
</tr>
<tr class="row-odd"><td>Athlon64 desktop prototype</td>
<td>s3_bios (2)</td>
</tr>
<tr class="row-even"><td>Compal CL-50</td>
<td>??? <a class="footnote-reference" href="#f1" id="id3">[1]</a></td>
</tr>
<tr class="row-odd"><td>Compaq Armada E500 - P3-700</td>
<td>none (1) (S1 also works OK)</td>
</tr>
<tr class="row-even"><td>Compaq Evo N620c</td>
<td>vga=normal, s3_bios (2)</td>
</tr>
<tr class="row-odd"><td>Dell 600m, ATI R250 Lf</td>
<td>none (1), but needs xorg-x11-6.8.1.902-1</td>
</tr>
<tr class="row-even"><td>Dell D600, ATI RV250</td>
<td>vga=normal and X, or try vbestate (6)</td>
</tr>
<tr class="row-odd"><td>Dell D610</td>
<td>vga=normal and X (possibly vbestate (6) too,
but not tested)</td>
</tr>
<tr class="row-even"><td>Dell Inspiron 4000</td>
<td>??? <a class="footnote-reference" href="#f1" id="id4">[1]</a></td>
</tr>
<tr class="row-odd"><td>Dell Inspiron 500m</td>
<td>??? <a class="footnote-reference" href="#f1" id="id5">[1]</a></td>
</tr>
<tr class="row-even"><td>Dell Inspiron 510m</td>
<td>???</td>
</tr>
<tr class="row-odd"><td>Dell Inspiron 5150</td>
<td>vbetool needed (6)</td>
</tr>
<tr class="row-even"><td>Dell Inspiron 600m</td>
<td>??? <a class="footnote-reference" href="#f1" id="id6">[1]</a></td>
</tr>
<tr class="row-odd"><td>Dell Inspiron 8200</td>
<td>??? <a class="footnote-reference" href="#f1" id="id7">[1]</a></td>
</tr>
<tr class="row-even"><td>Dell Inspiron 8500</td>
<td>??? <a class="footnote-reference" href="#f1" id="id8">[1]</a></td>
</tr>
<tr class="row-odd"><td>Dell Inspiron 8600</td>
<td>??? <a class="footnote-reference" href="#f1" id="id9">[1]</a></td>
</tr>
<tr class="row-even"><td>eMachines athlon64 machines</td>
<td>vbetool needed (6) (someone please get
me model #s)</td>
</tr>
<tr class="row-odd"><td>HP NC6000</td>
<td>s3_bios, may not use radeonfb (2);
or vbetool (6)</td>
</tr>
<tr class="row-even"><td>HP NX7000</td>
<td>??? <a class="footnote-reference" href="#f1" id="id10">[1]</a></td>
</tr>
<tr class="row-odd"><td>HP Pavilion ZD7000</td>
<td>vbetool post needed, need open-source nv
driver for X</td>
</tr>
<tr class="row-even"><td>HP Omnibook XE3 athlon version</td>
<td>none (1)</td>
</tr>
<tr class="row-odd"><td>HP Omnibook XE3GC</td>
<td>none (1), video is S3 Savage/IX-MV</td>
</tr>
<tr class="row-even"><td>HP Omnibook XE3L-GF</td>
<td>vbetool (6)</td>
</tr>
<tr class="row-odd"><td>HP Omnibook 5150</td>
<td>none (1), (S1 also works OK)</td>
</tr>
<tr class="row-even"><td>IBM TP T20, model 2647-44G</td>
<td>none (1), video is S3 Inc. 86C270-294
Savage/IX-MV, vesafb gets “interesting”
but X work.</td>
</tr>
<tr class="row-odd"><td>IBM TP A31 / Type 2652-M5G</td>
<td>s3_mode (3) [works ok with
BIOS 1.04 2002-08-23, but not at all with
BIOS 1.11 2004-11-05 :-(]</td>
</tr>
<tr class="row-even"><td>IBM TP R32 / Type 2658-MMG</td>
<td>none (1)</td>
</tr>
<tr class="row-odd"><td>IBM TP R40 2722B3G</td>
<td>??? <a class="footnote-reference" href="#f1" id="id11">[1]</a></td>
</tr>
<tr class="row-even"><td>IBM TP R50p / Type 1832-22U</td>
<td>s3_bios (2)</td>
</tr>
<tr class="row-odd"><td>IBM TP R51</td>
<td>none (1)</td>
</tr>
<tr class="row-even"><td>IBM TP T30      236681A</td>
<td>??? <a class="footnote-reference" href="#f1" id="id12">[1]</a></td>
</tr>
<tr class="row-odd"><td>IBM TP T40 / Type 2373-MU4</td>
<td>none (1)</td>
</tr>
<tr class="row-even"><td>IBM TP T40p</td>
<td>none (1)</td>
</tr>
<tr class="row-odd"><td>IBM TP R40p</td>
<td>s3_bios (2)</td>
</tr>
<tr class="row-even"><td>IBM TP T41p</td>
<td>s3_bios (2), switch to X after resume</td>
</tr>
<tr class="row-odd"><td>IBM TP T42</td>
<td>s3_bios (2)</td>
</tr>
<tr class="row-even"><td>IBM ThinkPad T42p (2373-GTG)</td>
<td>s3_bios (2)</td>
</tr>
<tr class="row-odd"><td>IBM TP X20</td>
<td>??? <a class="footnote-reference" href="#f1" id="id13">[1]</a></td>
</tr>
<tr class="row-even"><td>IBM TP X30</td>
<td>s3_bios, s3_mode (4)</td>
</tr>
<tr class="row-odd"><td>IBM TP X31 / Type 2672-XXH</td>
<td>none (1), use radeontool
(<a class="reference external" href="http://fdd.com/software/radeon/">http://fdd.com/software/radeon/</a>) to
turn off backlight.</td>
</tr>
<tr class="row-even"><td>IBM TP X32</td>
<td>none (1), but backlight is on and video is
trashed after long suspend. s3_bios,
s3_mode (4) works too. Perhaps that gets
better results?</td>
</tr>
<tr class="row-odd"><td>IBM Thinkpad X40 Type 2371-7JG</td>
<td>s3_bios,s3_mode (4)</td>
</tr>
<tr class="row-even"><td>IBM TP 600e</td>
<td>none(1), but a switch to console and
back to X is needed</td>
</tr>
<tr class="row-odd"><td>Medion MD4220</td>
<td>??? <a class="footnote-reference" href="#f1" id="id14">[1]</a></td>
</tr>
<tr class="row-even"><td>Samsung P35</td>
<td>vbetool needed (6)</td>
</tr>
<tr class="row-odd"><td>Sharp PC-AR10 (ATI rage)</td>
<td>none (1), backlight does not switch off</td>
</tr>
<tr class="row-even"><td>Sony Vaio PCG-C1VRX/K</td>
<td>s3_bios (2)</td>
</tr>
<tr class="row-odd"><td>Sony Vaio PCG-F403</td>
<td>??? <a class="footnote-reference" href="#f1" id="id15">[1]</a></td>
</tr>
<tr class="row-even"><td>Sony Vaio PCG-GRT995MP</td>
<td>none (1), works with ‘nv’ X driver</td>
</tr>
<tr class="row-odd"><td>Sony Vaio PCG-GR7/K</td>
<td>none (1), but needs radeonfb, use
radeontool (<a class="reference external" href="http://fdd.com/software/radeon/">http://fdd.com/software/radeon/</a>)
to turn off backlight.</td>
</tr>
<tr class="row-even"><td>Sony Vaio PCG-N505SN</td>
<td>??? <a class="footnote-reference" href="#f1" id="id16">[1]</a></td>
</tr>
<tr class="row-odd"><td>Sony Vaio vgn-s260</td>
<td>X or boot-radeon can init it (5)</td>
</tr>
<tr class="row-even"><td>Sony Vaio vgn-S580BH</td>
<td>vga=normal, but suspend from X. Console will
be blank unless you return to X.</td>
</tr>
<tr class="row-odd"><td>Sony Vaio vgn-FS115B</td>
<td>s3_bios (2),s3_mode (4)</td>
</tr>
<tr class="row-even"><td>Toshiba Libretto L5</td>
<td>none (1)</td>
</tr>
<tr class="row-odd"><td>Toshiba Libretto 100CT/110CT</td>
<td>vbetool (6)</td>
</tr>
<tr class="row-even"><td>Toshiba Portege 3020CT</td>
<td>s3_mode (3)</td>
</tr>
<tr class="row-odd"><td>Toshiba Satellite 4030CDT</td>
<td>s3_mode (3) (S1 also works OK)</td>
</tr>
<tr class="row-even"><td>Toshiba Satellite 4080XCDT</td>
<td>s3_mode (3) (S1 also works OK)</td>
</tr>
<tr class="row-odd"><td>Toshiba Satellite 4090XCDT</td>
<td>??? <a class="footnote-reference" href="#f1" id="id17">[1]</a></td>
</tr>
<tr class="row-even"><td>Toshiba Satellite P10-554</td>
<td>s3_bios,s3_mode (4)[#f3]_</td>
</tr>
<tr class="row-odd"><td>Toshiba M30</td>
<td><ol class="first last arabic simple" start="2">
<li>xor X with nvidia driver using internal AGP</li>
</ol>
</td>
</tr>
<tr class="row-even"><td>Uniwill 244IIO</td>
<td>??? <a class="footnote-reference" href="#f1" id="id18">[1]</a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="known-working-desktop-systems">
<h2>Known working desktop systems<a class="headerlink" href="#known-working-desktop-systems" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="40%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Mainboard</th>
<th class="head">Graphics card</th>
<th class="head">hack (or “how to do it”)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Asus A7V8X</td>
<td>nVidia RIVA TNT2 model 64</td>
<td>s3_bios,s3_mode (4)</td>
</tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id3">2</a>, <a class="fn-backref" href="#id4">3</a>, <a class="fn-backref" href="#id5">4</a>, <a class="fn-backref" href="#id6">5</a>, <a class="fn-backref" href="#id7">6</a>, <a class="fn-backref" href="#id8">7</a>, <a class="fn-backref" href="#id9">8</a>, <a class="fn-backref" href="#id10">9</a>, <a class="fn-backref" href="#id11">10</a>, <a class="fn-backref" href="#id12">11</a>, <a class="fn-backref" href="#id13">12</a>, <a class="fn-backref" href="#id14">13</a>, <a class="fn-backref" href="#id15">14</a>, <a class="fn-backref" href="#id16">15</a>, <a class="fn-backref" href="#id17">16</a>, <a class="fn-backref" href="#id18">17</a>)</em> from <a class="reference external" href="https://wiki.ubuntu.com/HoaryPMResults">https://wiki.ubuntu.com/HoaryPMResults</a>, not sure
which options to use. If you know, please tell me.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>To be tested with a newer kernel.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[3]</td><td>Not with SMP kernel, UP only.</td></tr>
</tbody>
</table>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>