

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The EFI Boot Stub &mdash; The Linux Kernel  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.13.0-rc7-mm1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="mm/damon/index.html">Monitoring Data Accesses</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../vm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>The EFI Boot Stub</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/admin-guide/efi-stub.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-efi-boot-stub">
<h1>The EFI Boot Stub<a class="headerlink" href="#the-efi-boot-stub" title="Permalink to this headline">¶</a></h1>
<p>On the x86 and ARM platforms, a kernel zImage/bzImage can masquerade
as a PE/COFF image, thereby convincing EFI firmware loaders to load
it as an EFI executable. The code that modifies the bzImage header,
along with the EFI-specific entry point that the firmware loader
jumps to are collectively known as the “EFI boot stub”, and live in
arch/x86/boot/header.S and arch/x86/boot/compressed/eboot.c,
respectively. For ARM the EFI stub is implemented in
arch/arm/boot/compressed/efi-header.S and
arch/arm/boot/compressed/efi-stub.c. EFI stub code that is shared
between architectures is in drivers/firmware/efi/libstub.</p>
<p>For arm64, there is no compressed kernel support, so the Image itself
masquerades as a PE/COFF image and the EFI stub is linked into the
kernel. The arm64 EFI stub lives in arch/arm64/kernel/efi-entry.S
and drivers/firmware/efi/libstub/arm64-stub.c.</p>
<p>By using the EFI boot stub it’s possible to boot a Linux kernel
without the use of a conventional EFI boot loader, such as grub or
elilo. Since the EFI boot stub performs the jobs of a boot loader, in
a certain sense it <em>IS</em> the boot loader.</p>
<p>The EFI boot stub is enabled with the CONFIG_EFI_STUB kernel option.</p>
<div class="section" id="how-to-install-bzimage-efi">
<h2>How to install bzImage.efi<a class="headerlink" href="#how-to-install-bzimage-efi" title="Permalink to this headline">¶</a></h2>
<p>The bzImage located in arch/x86/boot/bzImage must be copied to the EFI
System Partition (ESP) and renamed with the extension “.efi”. Without
the extension the EFI firmware loader will refuse to execute it. It’s
not possible to execute bzImage.efi from the usual Linux file systems
because EFI firmware doesn’t have support for them. For ARM the
arch/arm/boot/zImage should be copied to the system partition, and it
may not need to be renamed. Similarly for arm64, arch/arm64/boot/Image
should be copied but not necessarily renamed.</p>
</div>
<div class="section" id="passing-kernel-parameters-from-the-efi-shell">
<h2>Passing kernel parameters from the EFI shell<a class="headerlink" href="#passing-kernel-parameters-from-the-efi-shell" title="Permalink to this headline">¶</a></h2>
<p>Arguments to the kernel can be passed after bzImage.efi, e.g.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>fs0:&gt; bzImage.efi console=ttyS0 root=/dev/sda4
</pre></div>
</div>
</div>
<div class="section" id="the-initrd-option">
<h2>The “initrd=” option<a class="headerlink" href="#the-initrd-option" title="Permalink to this headline">¶</a></h2>
<p>Like most boot loaders, the EFI stub allows the user to specify
multiple initrd files using the “initrd=” option. This is the only EFI
stub-specific command line parameter, everything else is passed to the
kernel when it boots.</p>
<p>The path to the initrd file must be an absolute path from the
beginning of the ESP, relative path names do not work. Also, the path
is an EFI-style path and directory elements must be separated with
backslashes (). For example, given the following directory layout:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>fs0:&gt;
      Kernels\
                      bzImage.efi
                      initrd-large.img

      Ramdisks\
                      initrd-small.img
                      initrd-medium.img
</pre></div>
</div>
<p>to boot with the initrd-large.img file if the current working
directory is fs0:Kernels, the following command must be used:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>fs0:\Kernels&gt; bzImage.efi initrd=\Kernels\initrd-large.img
</pre></div>
</div>
<p>Notice how bzImage.efi can be specified with a relative path. That’s
because the image we’re executing is interpreted by the EFI shell,
which understands relative paths, whereas the rest of the command line
is passed to bzImage.efi.</p>
</div>
<div class="section" id="the-dtb-option">
<h2>The “dtb=” option<a class="headerlink" href="#the-dtb-option" title="Permalink to this headline">¶</a></h2>
<p>For the ARM and arm64 architectures, a device tree must be provided to
the kernel. Normally firmware shall supply the device tree via the
EFI CONFIGURATION TABLE. However, the “dtb=” command line option can
be used to override the firmware supplied device tree, or to supply
one when firmware is unable to.</p>
<p>Please note: Firmware adds runtime configuration information to the
device tree before booting the kernel. If dtb= is used to override
the device tree, then any runtime data provided by firmware will be
lost. The dtb= option should only be used either as a debug tool, or
as a last resort when a device tree is not provided in the EFI
CONFIGURATION TABLE.</p>
<p>“dtb=” is processed in the same manner as the “initrd=” option that is
described above.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright The kernel development community

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>