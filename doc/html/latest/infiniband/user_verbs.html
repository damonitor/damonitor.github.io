

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Userspace verbs access &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.8.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/mm/damon/index.html">Monitoring Data Accesses</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../vm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Userspace verbs access</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/infiniband/user_verbs.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="userspace-verbs-access">
<h1>Userspace verbs access<a class="headerlink" href="#userspace-verbs-access" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>The ib_uverbs module, built by enabling CONFIG_INFINIBAND_USER_VERBS,
enables direct userspace access to IB hardware via “verbs,” as
described in chapter 11 of the InfiniBand Architecture Specification.</p>
<p>To use the verbs, the libibverbs library, available from
<a class="reference external" href="https://github.com/linux-rdma/rdma-core">https://github.com/linux-rdma/rdma-core</a>, is required. libibverbs contains a
device-independent API for using the ib_uverbs interface.
libibverbs also requires appropriate device-dependent kernel and
userspace driver for your InfiniBand hardware.  For example, to use
a Mellanox HCA, you will need the ib_mthca kernel module and the
libmthca userspace driver be installed.</p>
</div></blockquote>
<div class="section" id="user-kernel-communication">
<h2>User-kernel communication<a class="headerlink" href="#user-kernel-communication" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Userspace communicates with the kernel for slow path, resource
management operations via the /dev/infiniband/uverbsN character
devices.  Fast path operations are typically performed by writing
directly to hardware registers mmap()ed into userspace, with no
system call or context switch into the kernel.</p>
<p>Commands are sent to the kernel via write()s on these device files.
The ABI is defined in drivers/infiniband/include/ib_user_verbs.h.
The structs for commands that require a response from the kernel
contain a 64-bit field used to pass a pointer to an output buffer.
Status is returned to userspace as the return value of the write()
system call.</p>
</div></blockquote>
</div>
<div class="section" id="resource-management">
<h2>Resource management<a class="headerlink" href="#resource-management" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Since creation and destruction of all IB resources is done by
commands passed through a file descriptor, the kernel can keep track
of which resources are attached to a given userspace context.  The
ib_uverbs module maintains idr tables that are used to translate
between kernel pointers and opaque userspace handles, so that kernel
pointers are never exposed to userspace and userspace cannot trick
the kernel into following a bogus pointer.</p>
<p>This also allows the kernel to clean up when a process exits and
prevent one process from touching another process’s resources.</p>
</div></blockquote>
</div>
<div class="section" id="memory-pinning">
<h2>Memory pinning<a class="headerlink" href="#memory-pinning" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Direct userspace I/O requires that memory regions that are potential
I/O targets be kept resident at the same physical address.  The
ib_uverbs module manages pinning and unpinning memory regions via
get_user_pages() and put_page() calls.  It also accounts for the
amount of memory pinned in the process’s pinned_vm, and checks that
unprivileged processes do not exceed their RLIMIT_MEMLOCK limit.</p>
<p>Pages that are pinned multiple times are counted each time they are
pinned, so the value of pinned_vm may be an overestimate of the
number of pages pinned by a process.</p>
</div></blockquote>
</div>
<div class="section" id="dev-files">
<h2>/dev files<a class="headerlink" href="#dev-files" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>To create the appropriate character device files automatically with
udev, a rule like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>KERNEL==&quot;uverbs*&quot;, NAME=&quot;infiniband/%k&quot;
</pre></div>
</div>
<p>can be used.  This will create device nodes named:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/dev/infiniband/uverbs0
</pre></div>
</div>
<p>and so on.  Since the InfiniBand userspace verbs should be safe for
use by non-privileged processes, it may be useful to add an
appropriate MODE or GROUP to the udev rule.</p>
</div></blockquote>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>