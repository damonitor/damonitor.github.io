

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The Linux SYM-2 driver documentation file &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/mm/damon/index.html">Monitoring Data Accesses</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../vm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>The Linux SYM-2 driver documentation file</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/scsi/sym53c8xx_2.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-linux-sym-2-driver-documentation-file">
<h1>The Linux SYM-2 driver documentation file<a class="headerlink" href="#the-linux-sym-2-driver-documentation-file" title="Permalink to this headline">¶</a></h1>
<p>Written by Gerard Roudier &lt;<a class="reference external" href="mailto:groudier&#37;&#52;&#48;free&#46;fr">groudier<span>&#64;</span>free<span>&#46;</span>fr</a>&gt;</p>
<p>21 Rue Carnot</p>
<p>95170 DEUIL LA BARRE - FRANCE</p>
<p>Updated by Matthew Wilcox &lt;<a class="reference external" href="mailto:matthew&#37;&#52;&#48;wil&#46;cx">matthew<span>&#64;</span>wil<span>&#46;</span>cx</a>&gt;</p>
<p>2004-10-09</p>
<div class="section" id="introduction">
<h2>1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This driver supports the whole SYM53C8XX family of PCI-SCSI controllers.
It also support the subset of LSI53C10XX PCI-SCSI controllers that are based
on the SYM53C8XX SCRIPTS language.</p>
<p>It replaces the sym53c8xx+ncr53c8xx driver bundle and shares its core code
with the FreeBSD SYM-2 driver. The ‘glue’ that allows this driver to work
under Linux is contained in 2 files named sym_glue.h and sym_glue.c.
Other drivers files are intended not to depend on the Operating System
on which the driver is used.</p>
<p>The history of this driver can be summarized as follows:</p>
<p>1993: ncr driver written for 386bsd and FreeBSD by:</p>
<blockquote>
<div><ul class="simple">
<li>Wolfgang Stanglmeier        &lt;<a class="reference external" href="mailto:wolf&#37;&#52;&#48;cologne&#46;de">wolf<span>&#64;</span>cologne<span>&#46;</span>de</a>&gt;</li>
<li>Stefan Esser                &lt;<a class="reference external" href="mailto:se&#37;&#52;&#48;mi&#46;Uni-Koeln&#46;de">se<span>&#64;</span>mi<span>&#46;</span>Uni-Koeln<span>&#46;</span>de</a>&gt;</li>
</ul>
</div></blockquote>
<p>1996: port of the ncr driver to Linux-1.2.13 and rename it ncr53c8xx.</p>
<blockquote>
<div><ul class="simple">
<li>Gerard Roudier</li>
</ul>
</div></blockquote>
<dl class="docutils">
<dt>1998: new sym53c8xx driver for Linux based on LOAD/STORE instruction and that</dt>
<dd><p class="first">adds full support for the 896 but drops support for early NCR devices.</p>
<blockquote class="last">
<div><ul class="simple">
<li>Gerard Roudier</li>
</ul>
</div></blockquote>
</dd>
<dt>1999: port of the sym53c8xx driver to FreeBSD and support for the LSI53C1010</dt>
<dd><p class="first">33 MHz and 66MHz Ultra-3 controllers. The new driver is named ‘sym’.</p>
<blockquote class="last">
<div><ul class="simple">
<li>Gerard Roudier</li>
</ul>
</div></blockquote>
</dd>
<dt>2000: Add support for early NCR devices to FreeBSD ‘sym’ driver.</dt>
<dd><p class="first">Break the driver into several sources and separate the OS glue
code from the core code that can be shared among different O/Ses.
Write a glue code for Linux.</p>
<blockquote class="last">
<div><ul class="simple">
<li>Gerard Roudier</li>
</ul>
</div></blockquote>
</dd>
<dt>2004: Remove FreeBSD compatibility code.  Remove support for versions of</dt>
<dd>Linux before 2.6.  Start using Linux facilities.</dd>
</dl>
<p>This README file addresses the Linux version of the driver. Under FreeBSD,
the driver documentation is the sym.8 man page.</p>
<p>Information about new chips is available at LSILOGIC web server:</p>
<blockquote>
<div><a class="reference external" href="http://www.lsilogic.com/">http://www.lsilogic.com/</a></div></blockquote>
<p>SCSI standard documentations are available at T10 site:</p>
<blockquote>
<div><a class="reference external" href="http://www.t10.org/">http://www.t10.org/</a></div></blockquote>
<p>Useful SCSI tools written by Eric Youngdale are part of most Linux
distributions:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>scsiinfo</td>
<td>command line tool</td>
</tr>
<tr class="row-even"><td>scsi-config</td>
<td>TCL/Tk tool using scsiinfo</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="supported-chips-and-scsi-features">
<h2>2. Supported chips and SCSI features<a class="headerlink" href="#supported-chips-and-scsi-features" title="Permalink to this headline">¶</a></h2>
<p>The following features are supported for all chips:</p>
<blockquote>
<div><ul class="simple">
<li>Synchronous negotiation</li>
<li>Disconnection</li>
<li>Tagged command queuing</li>
<li>SCSI parity checking</li>
<li>PCI Master parity checking</li>
</ul>
</div></blockquote>
<p>Other features depends on chip capabilities.</p>
<p>The driver notably uses optimized SCRIPTS for devices that support
LOAD/STORE and handles PHASE MISMATCH from SCRIPTS for devices that
support the corresponding feature.</p>
<p>The following table shows some characteristics of the chip family.</p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="16%" />
<col width="7%" />
<col width="16%" />
<col width="18%" />
<col width="18%" />
<col width="13%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Chip</td>
<td>On board
SDMS BIOS</td>
<td>Wide</td>
<td>SCSI std.</td>
<td>Max. sync</td>
<td>Load/store
scripts</td>
<td>Hardware
phase
mismatch</td>
</tr>
<tr class="row-even"><td>810</td>
<td>N</td>
<td>N</td>
<td>FAST10</td>
<td>10 MB/s</td>
<td>N</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>810A</td>
<td>N</td>
<td>N</td>
<td>FAST10</td>
<td>10 MB/s</td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-even"><td>815</td>
<td>Y</td>
<td>N</td>
<td>FAST10</td>
<td>10 MB/s</td>
<td>N</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>825</td>
<td>Y</td>
<td>Y</td>
<td>FAST10</td>
<td>20 MB/s</td>
<td>N</td>
<td>N</td>
</tr>
<tr class="row-even"><td>825A</td>
<td>Y</td>
<td>Y</td>
<td>FAST10</td>
<td>20 MB/s</td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>860</td>
<td>N</td>
<td>N</td>
<td>FAST20</td>
<td>20 MB/s</td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-even"><td>875</td>
<td>Y</td>
<td>Y</td>
<td>FAST20</td>
<td>40 MB/s</td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>875A</td>
<td>Y</td>
<td>Y</td>
<td>FAST20</td>
<td>40 MB/s</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr class="row-even"><td>876</td>
<td>Y</td>
<td>Y</td>
<td>FAST20</td>
<td>40 MB/s</td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>895</td>
<td>Y</td>
<td>Y</td>
<td>FAST40</td>
<td>80 MB/s</td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-even"><td>895A</td>
<td>Y</td>
<td>Y</td>
<td>FAST40</td>
<td>80 MB/s</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr class="row-odd"><td>896</td>
<td>Y</td>
<td>Y</td>
<td>FAST40</td>
<td>80 MB/s</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr class="row-even"><td>897</td>
<td>Y</td>
<td>Y</td>
<td>FAST40</td>
<td>80 MB/s</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr class="row-odd"><td>1510D</td>
<td>Y</td>
<td>Y</td>
<td>FAST40</td>
<td>80 MB/s</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr class="row-even"><td>1010</td>
<td>Y</td>
<td>Y</td>
<td>FAST80</td>
<td>160 MB/s</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr class="row-odd"><td>1010_66
<a class="footnote-reference" href="#id2" id="id1">[1]</a></td>
<td>Y</td>
<td>Y</td>
<td>FAST80</td>
<td>160 MB/s</td>
<td>Y</td>
<td>Y</td>
</tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Chip supports 33MHz and 66MHz PCI bus clock.</td></tr>
</tbody>
</table>
<p>Summary of other supported features:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Module:</th><td class="field-body">allow to load the driver</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Memory mapped I/O:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body">increases performance</td>
</tr>
<tr class="field-odd field"><th class="field-name" colspan="2">Control commands:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body">write operations to the proc SCSI file system</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Debugging information:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body">written to syslog (expert only)</td>
</tr>
<tr class="field-odd field"><th class="field-name">Serial NVRAM:</th><td class="field-body">Symbios and Tekram formats</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Scatter / gather</li>
<li>Shared interrupt</li>
<li>Boot setup commands</li>
</ul>
</div>
<div class="section" id="advantages-of-this-driver-for-newer-chips">
<h2>3. Advantages of this driver for newer chips.<a class="headerlink" href="#advantages-of-this-driver-for-newer-chips" title="Permalink to this headline">¶</a></h2>
<div class="section" id="optimized-scsi-scripts">
<h3>3.1 Optimized SCSI SCRIPTS<a class="headerlink" href="#optimized-scsi-scripts" title="Permalink to this headline">¶</a></h3>
<p>All chips except the 810, 815 and 825, support new SCSI SCRIPTS instructions
named LOAD and STORE that allow to move up to 1 DWORD from/to an IO register
to/from memory much faster that the MOVE MEMORY instruction that is supported
by the 53c7xx and 53c8xx family.</p>
<p>The LOAD/STORE instructions support absolute and DSA relative addressing
modes. The SCSI SCRIPTS had been entirely rewritten using LOAD/STORE instead
of MOVE MEMORY instructions.</p>
<p>Due to the lack of LOAD/STORE SCRIPTS instructions by earlier chips, this
driver also incorporates a different SCRIPTS set based on MEMORY MOVE, in
order to provide support for the entire SYM53C8XX chips family.</p>
</div>
<div class="section" id="new-features-appeared-with-the-sym53c896">
<h3>3.2 New features appeared with the SYM53C896<a class="headerlink" href="#new-features-appeared-with-the-sym53c896" title="Permalink to this headline">¶</a></h3>
<p>Newer chips (see above) allows handling of the phase mismatch context from
SCRIPTS (avoids the phase mismatch interrupt that stops the SCSI processor
until the C code has saved the context of the transfer).</p>
<p>The 896 and 1010 chips support 64 bit PCI transactions and addressing,
while the 895A supports 32 bit PCI transactions and 64 bit addressing.
The SCRIPTS processor of these chips is not true 64 bit, but uses segment
registers for bit 32-63. Another interesting feature is that LOAD/STORE
instructions that address the on-chip RAM (8k) remain internal to the chip.</p>
</div>
</div>
<div class="section" id="memory-mapped-i-o-versus-normal-i-o">
<h2>4. Memory mapped I/O versus normal I/O<a class="headerlink" href="#memory-mapped-i-o-versus-normal-i-o" title="Permalink to this headline">¶</a></h2>
<p>Memory mapped I/O has less latency than normal I/O and is the recommended
way for doing IO with PCI devices. Memory mapped I/O seems to work fine on
most hardware configurations, but some poorly designed chipsets may break
this feature. A configuration option is provided for normal I/O to be
used but the driver defaults to MMIO.</p>
</div>
<div class="section" id="tagged-command-queueing">
<h2>5. Tagged command queueing<a class="headerlink" href="#tagged-command-queueing" title="Permalink to this headline">¶</a></h2>
<p>Queuing more than 1 command at a time to a device allows it to perform
optimizations based on actual head positions and its mechanical
characteristics. This feature may also reduce average command latency.
In order to really gain advantage of this feature, devices must have
a reasonable cache size (No miracle is to be expected for a low-end
hard disk with 128 KB or less).</p>
<p>Some known old SCSI devices do not properly support tagged command queuing.
Generally, firmware revisions that fix this kind of problems are available
at respective vendor web/ftp sites.</p>
<p>All I can say is that I never have had problem with tagged queuing using
this driver and its predecessors. Hard disks that behaved correctly for
me using tagged commands are the following:</p>
<ul class="simple">
<li>IBM S12 0662</li>
<li>Conner 1080S</li>
<li>Quantum Atlas I</li>
<li>Quantum Atlas II</li>
<li>Seagate Cheetah I</li>
<li>Quantum Viking II</li>
<li>IBM DRVS</li>
<li>Quantum Atlas IV</li>
<li>Seagate Cheetah II</li>
</ul>
<p>If your controller has NVRAM, you can configure this feature per target
from the user setup tool. The Tekram Setup program allows to tune the
maximum number of queued commands up to 32. The Symbios Setup only allows
to enable or disable this feature.</p>
<p>The maximum number of simultaneous tagged commands queued to a device
is currently set to 16 by default.  This value is suitable for most SCSI
disks.  With large SCSI disks (&gt;= 2GB, cache &gt;= 512KB, average seek time
&lt;= 10 ms), using a larger value may give better performances.</p>
<p>This driver supports up to 255 commands per device, and but using more than
64 is generally not worth-while, unless you are using a very large disk or
disk arrays. It is noticeable that most of recent hard disks seem not to
accept more than 64 simultaneous commands. So, using more than 64 queued
commands is probably just resource wasting.</p>
<p>If your controller does not have NVRAM or if it is managed by the SDMS
BIOS/SETUP, you can configure tagged queueing feature and device queue
depths from the boot command-line. For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sym53c8xx=tags:4/t2t3q15-t4q7/t1u0q32
</pre></div>
</div>
<p>will set tagged commands queue depths as follow:</p>
<ul class="simple">
<li>target 2  all luns  on controller 0 –&gt; 15</li>
<li>target 3  all luns  on controller 0 –&gt; 15</li>
<li>target 4  all luns  on controller 0 –&gt;  7</li>
<li>target 1  lun 0     on controller 1 –&gt; 32</li>
<li>all other target/lun                –&gt;  4</li>
</ul>
<p>In some special conditions, some SCSI disk firmwares may return a
QUEUE FULL status for a SCSI command. This behaviour is managed by the
driver using the following heuristic:</p>
<ul class="simple">
<li>Each time a QUEUE FULL status is returned, tagged queue depth is reduced
to the actual number of disconnected commands.</li>
<li>Every 200 successfully completed SCSI commands, if allowed by the
current limit, the maximum number of queueable commands is incremented.</li>
</ul>
<p>Since QUEUE FULL status reception and handling is resource wasting, the
driver notifies by default this problem to user by indicating the actual
number of commands used and their status, as well as its decision on the
device queue depth change.
The heuristic used by the driver in handling QUEUE FULL ensures that the
impact on performances is not too bad. You can get rid of the messages by
setting verbose level to zero, as follow:</p>
<dl class="docutils">
<dt>1st method:</dt>
<dd>boot your system using ‘sym53c8xx=verb:0’ option.</dd>
<dt>2nd method:</dt>
<dd>apply “setverbose 0” control command to the proc fs entry
corresponding to your controller after boot-up.</dd>
</dl>
</div>
<div class="section" id="parity-checking">
<h2>6. Parity checking<a class="headerlink" href="#parity-checking" title="Permalink to this headline">¶</a></h2>
<p>The driver supports SCSI parity checking and PCI bus master parity
checking.  These features must be enabled in order to ensure safe
data transfers.  Some flawed devices or mother boards may have problems
with parity.  The options to defeat parity checking have been removed
from the driver.</p>
</div>
<div class="section" id="profiling-information">
<h2>7. Profiling information<a class="headerlink" href="#profiling-information" title="Permalink to this headline">¶</a></h2>
<p>This driver does not provide profiling information as did its predecessors.
This feature was not this useful and added complexity to the code.
As the driver code got more complex, I have decided to remove everything
that didn’t seem actually useful.</p>
</div>
<div class="section" id="control-commands">
<h2>8. Control commands<a class="headerlink" href="#control-commands" title="Permalink to this headline">¶</a></h2>
<p>Control commands can be sent to the driver with write operations to
the proc SCSI file system. The generic command syntax is the
following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo &quot;&lt;verb&gt; &lt;parameters&gt;&quot; &gt;/proc/scsi/sym53c8xx/0
(assumes controller number is 0)
</pre></div>
</div>
<p>Using “all” for “&lt;target&gt;” parameter with the commands below will
apply to all targets of the SCSI chain (except the controller).</p>
<p>Available commands:</p>
<div class="section" id="set-minimum-synchronous-period-factor">
<h3>8.1 Set minimum synchronous period factor<a class="headerlink" href="#set-minimum-synchronous-period-factor" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>setsync &lt;target&gt; &lt;period factor&gt;</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">target:</th><td class="field-body">target number</td>
</tr>
<tr class="field-even field"><th class="field-name">period:</th><td class="field-body">minimum synchronous period.
Maximum speed = 1000/(4*period factor) except for special
cases below.</td>
</tr>
</tbody>
</table>
<p>Specify a period of 0, to force asynchronous transfer mode.</p>
<blockquote>
<div><ul class="simple">
<li>9 means 12.5 nano-seconds synchronous period</li>
<li>10 means 25 nano-seconds synchronous period</li>
<li>11 means 30 nano-seconds synchronous period</li>
<li>12 means 50 nano-seconds synchronous period</li>
</ul>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="set-wide-size">
<h3>8.2 Set wide size<a class="headerlink" href="#set-wide-size" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>setwide &lt;target&gt; &lt;size&gt;</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">target:</th><td class="field-body">target number</td>
</tr>
<tr class="field-even field"><th class="field-name">size:</th><td class="field-body">0=8 bits, 1=16bits</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="set-maximum-number-of-concurrent-tagged-commands">
<h3>8.3 Set maximum number of concurrent tagged commands<a class="headerlink" href="#set-maximum-number-of-concurrent-tagged-commands" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>settags &lt;target&gt; &lt;tags&gt;</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">target:</th><td class="field-body">target number</td>
</tr>
<tr class="field-even field"><th class="field-name">tags:</th><td class="field-body">number of concurrent tagged commands
must not be greater than configured (default: 16)</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="set-debug-mode">
<h3>8.4 Set debug mode<a class="headerlink" href="#set-debug-mode" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>setdebug &lt;list of debug flags&gt;</p>
<p>Available debug flags:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>alloc</td>
<td>print info about memory allocations (ccb, lcb)</td>
</tr>
<tr class="row-even"><td>queue</td>
<td>print info about insertions into the command start queue</td>
</tr>
<tr class="row-odd"><td>result</td>
<td>print sense data on CHECK CONDITION status</td>
</tr>
<tr class="row-even"><td>scatter</td>
<td>print info about the scatter process</td>
</tr>
<tr class="row-odd"><td>scripts</td>
<td>print info about the script binding process</td>
</tr>
<tr class="row-even"><td>tiny</td>
<td>print minimal debugging information</td>
</tr>
<tr class="row-odd"><td>timing</td>
<td>print timing information of the NCR chip</td>
</tr>
<tr class="row-even"><td>nego</td>
<td>print information about SCSI negotiations</td>
</tr>
<tr class="row-odd"><td>phase</td>
<td>print information on script interruptions</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Use “setdebug” with no argument to reset debug flags.</p>
</div></blockquote>
</div>
<div class="section" id="set-flag-no-disc">
<h3>8.5 Set flag (no_disc)<a class="headerlink" href="#set-flag-no-disc" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>setflag &lt;target&gt; &lt;flag&gt;</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">target:</th><td class="field-body">target number</td>
</tr>
</tbody>
</table>
<p>For the moment, only one flag is available:</p>
<blockquote>
<div>no_disc:   not allow target to disconnect.</div></blockquote>
<p>Do not specify any flag in order to reset the flag. For example:</p>
<dl class="docutils">
<dt>setflag 4</dt>
<dd>will reset no_disc flag for target 4, so will allow it disconnections.</dd>
<dt>setflag all</dt>
<dd>will allow disconnection for all devices on the SCSI bus.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="set-verbose-level">
<h3>8.6 Set verbose level<a class="headerlink" href="#set-verbose-level" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>setverbose #level</p>
<p>The driver default verbose level is 1. This command allows to change
th driver verbose level after boot-up.</p>
</div></blockquote>
</div>
<div class="section" id="reset-all-logical-units-of-a-target">
<h3>8.7 Reset all logical units of a target<a class="headerlink" href="#reset-all-logical-units-of-a-target" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>resetdev &lt;target&gt;</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">target:</th><td class="field-body">target number</td>
</tr>
</tbody>
</table>
<p>The driver will try to send a BUS DEVICE RESET message to the target.</p>
</div></blockquote>
</div>
<div class="section" id="abort-all-tasks-of-all-logical-units-of-a-target">
<h3>8.8 Abort all tasks of all logical units of a target<a class="headerlink" href="#abort-all-tasks-of-all-logical-units-of-a-target" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>cleardev &lt;target&gt;</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">target:</th><td class="field-body">target number</td>
</tr>
</tbody>
</table>
<p>The driver will try to send a ABORT message to all the logical units
of the target.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="configuration-parameters">
<h2>9. Configuration parameters<a class="headerlink" href="#configuration-parameters" title="Permalink to this headline">¶</a></h2>
<p>Under kernel configuration tools (make menuconfig, for example), it is
possible to change some default driver configuration parameters.
If the firmware of all your devices is perfect enough, all the
features supported by the driver can be enabled at start-up. However,
if only one has a flaw for some SCSI feature, you can disable the
support by the driver of this feature at linux start-up and enable
this feature after boot-up only for devices that support it safely.</p>
<p>Configuration parameters:</p>
<dl class="docutils">
<dt>Use normal IO                         (default answer: n)</dt>
<dd>Answer “y” if you suspect your mother board to not allow memory mapped I/O.
May slow down performance a little.</dd>
<dt>Default tagged command queue depth    (default answer: 16)</dt>
<dd>Entering 0 defaults to tagged commands not being used.
This parameter can be specified from the boot command line.</dd>
<dt>Maximum number of queued commands     (default answer: 32)</dt>
<dd>This option allows you to specify the maximum number of tagged commands
that can be queued to a device. The maximum supported value is 255.</dd>
<dt>Synchronous transfers frequency       (default answer: 80)</dt>
<dd>This option allows you to specify the frequency in MHz the driver
will use at boot time for synchronous data transfer negotiations.
0 means “asynchronous data transfers”.</dd>
</dl>
</div>
<div class="section" id="boot-setup-commands">
<h2>10. Boot setup commands<a class="headerlink" href="#boot-setup-commands" title="Permalink to this headline">¶</a></h2>
<div class="section" id="syntax">
<h3>10.1 Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h3>
<p>Setup commands can be passed to the driver either at boot time or as
parameters to modprobe, as described in Documentation/admin-guide/kernel-parameters.rst</p>
<p>Example of boot setup command under lilo prompt:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>lilo: linux root=/dev/sda2 sym53c8xx.cmd_per_lun=4 sym53c8xx.sync=10 sym53c8xx.debug=0x200
</pre></div>
</div>
<ul class="simple">
<li>enable tagged commands, up to 4 tagged commands queued.</li>
<li>set synchronous negotiation speed to 10 Mega-transfers / second.</li>
<li>set DEBUG_NEGO flag.</li>
</ul>
<p>The following command will install the driver module with the same
options as above:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>modprobe sym53c8xx cmd_per_lun=4 sync=10 debug=0x200
</pre></div>
</div>
</div>
<div class="section" id="available-arguments">
<h3>10.2 Available arguments<a class="headerlink" href="#available-arguments" title="Permalink to this headline">¶</a></h3>
<div class="section" id="default-number-of-tagged-commands">
<h4>10.2.1  Default number of tagged commands<a class="headerlink" href="#default-number-of-tagged-commands" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><blockquote>
<div><ul class="simple">
<li>cmd_per_lun=0 (or cmd_per_lun=1) tagged command queuing disabled</li>
<li>cmd_per_lun=#tags (#tags &gt; 1) tagged command queuing enabled</li>
</ul>
</div></blockquote>
<p>#tags will be truncated to the max queued commands configuration parameter.</p>
</div></blockquote>
</div>
<div class="section" id="burst-max">
<h4>10.2.2 Burst max<a class="headerlink" href="#burst-max" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>burst=0</td>
<td>burst disabled</td>
</tr>
<tr class="row-even"><td>burst=255</td>
<td>get burst length from initial IO register settings.</td>
</tr>
<tr class="row-odd"><td>burst=#x</td>
<td><p class="first">burst enabled (1&lt;&lt;#x burst transfers max)</p>
<p class="last">#x is an integer value which is log base 2 of the burst
transfers max.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>By default the driver uses the maximum value supported by the chip.</p>
</div></blockquote>
</div>
<div class="section" id="led-support">
<h4>10.2.3 LED support<a class="headerlink" href="#led-support" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>led=1</td>
<td>enable  LED support</td>
</tr>
<tr class="row-even"><td>led=0</td>
<td>disable LED support</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Do not enable LED support if your scsi board does not use SDMS BIOS.
(See ‘Configuration parameters’)</p>
</div></blockquote>
</div>
<div class="section" id="differential-mode">
<h4>10.2.4 Differential mode<a class="headerlink" href="#differential-mode" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>diff=0</td>
<td>never set up diff mode</td>
</tr>
<tr class="row-even"><td>diff=1</td>
<td>set up diff mode if BIOS set it</td>
</tr>
<tr class="row-odd"><td>diff=2</td>
<td>always set up diff mode</td>
</tr>
<tr class="row-even"><td>diff=3</td>
<td>set diff mode if GPIO3 is not set</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="irq-mode">
<h4>10.2.5 IRQ mode<a class="headerlink" href="#irq-mode" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>irqm=0</td>
<td>always open drain</td>
</tr>
<tr class="row-even"><td>irqm=1</td>
<td>same as initial settings (assumed BIOS settings)</td>
</tr>
<tr class="row-odd"><td>irqm=2</td>
<td>always totem pole</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="check-scsi-bus">
<h4>10.2.6 Check SCSI BUS<a class="headerlink" href="#check-scsi-bus" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><blockquote>
<div>buschk=&lt;option bits&gt;</div></blockquote>
<p>Available option bits:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="94%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>0x0</td>
<td>No check.</td>
</tr>
<tr class="row-even"><td>0x1</td>
<td>Check and do not attach the controller on error.</td>
</tr>
<tr class="row-odd"><td>0x2</td>
<td>Check and just warn on error.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="suggest-a-default-scsi-id-for-hosts">
<h4>10.2.7 Suggest a default SCSI id for hosts<a class="headerlink" href="#suggest-a-default-scsi-id-for-hosts" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>hostid=255</td>
<td>no id suggested.</td>
</tr>
<tr class="row-even"><td>hostid=#x</td>
<td>(0 &lt; x &lt; 7) x suggested for hosts SCSI id.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>If a host SCSI id is available from the NVRAM, the driver will ignore
any value suggested as boot option. Otherwise, if a suggested value
different from 255 has been supplied, it will use it. Otherwise, it will
try to deduce the value previously set in the hardware and use value
7 if the hardware value is zero.</p>
</div></blockquote>
</div>
<div class="section" id="verbosity-level">
<h4>10.2.8  Verbosity level<a class="headerlink" href="#verbosity-level" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="57%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>verb=0</td>
<td>minimal</td>
</tr>
<tr class="row-even"><td>verb=1</td>
<td>normal</td>
</tr>
<tr class="row-odd"><td>verb=2</td>
<td>too much</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="debug-mode">
<h4>10.2.9 Debug mode<a class="headerlink" href="#debug-mode" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>debug=0</td>
<td>clear debug flags</td>
</tr>
<tr class="row-even"><td>debug=#x</td>
<td><p class="first">set debug flags</p>
<p>#x is an integer value combining the
following power-of-2 values:</p>
<table border="1" class="last docutils">
<colgroup>
<col width="68%" />
<col width="32%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>DEBUG_ALLOC</td>
<td>0x1</td>
</tr>
<tr class="row-even"><td>DEBUG_PHASE</td>
<td>0x2</td>
</tr>
<tr class="row-odd"><td>DEBUG_POLL</td>
<td>0x4</td>
</tr>
<tr class="row-even"><td>DEBUG_QUEUE</td>
<td>0x8</td>
</tr>
<tr class="row-odd"><td>DEBUG_RESULT</td>
<td>0x10</td>
</tr>
<tr class="row-even"><td>DEBUG_SCATTER</td>
<td>0x20</td>
</tr>
<tr class="row-odd"><td>DEBUG_SCRIPT</td>
<td>0x40</td>
</tr>
<tr class="row-even"><td>DEBUG_TINY</td>
<td>0x80</td>
</tr>
<tr class="row-odd"><td>DEBUG_TIMING</td>
<td>0x100</td>
</tr>
<tr class="row-even"><td>DEBUG_NEGO</td>
<td>0x200</td>
</tr>
<tr class="row-odd"><td>DEBUG_TAGS</td>
<td>0x400</td>
</tr>
<tr class="row-even"><td>DEBUG_FREEZE</td>
<td>0x800</td>
</tr>
<tr class="row-odd"><td>DEBUG_RESTART</td>
<td>0x1000</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>You can play safely with DEBUG_NEGO. However, some of these flags may
generate bunches of syslog messages.</p>
</div></blockquote>
</div>
<div class="section" id="settle-delay">
<h4>10.2.10 Settle delay<a class="headerlink" href="#settle-delay" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>settle=n</td>
<td>delay for n seconds</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>After a bus reset, the driver will delay for n seconds before talking
to any device on the bus.  The default is 3 seconds and safe mode will
default it to 10.</p>
</div></blockquote>
</div>
<div class="section" id="serial-nvram">
<h4>10.2.11 Serial NVRAM<a class="headerlink" href="#serial-nvram" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">option not currently implemented.</p>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>nvram=n</td>
<td>do not look for serial NVRAM</td>
</tr>
<tr class="row-even"><td>nvram=y</td>
<td>test controllers for onboard serial NVRAM</td>
</tr>
</tbody>
</table>
<p>(alternate binary form)</p>
<p>nvram=&lt;bits options&gt;</p>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="94%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>0x01</td>
<td>look for NVRAM  (equivalent to nvram=y)</td>
</tr>
<tr class="row-even"><td>0x02</td>
<td>ignore NVRAM “Synchronous negotiation” parameters for all devices</td>
</tr>
<tr class="row-odd"><td>0x04</td>
<td>ignore NVRAM “Wide negotiation”  parameter for all devices</td>
</tr>
<tr class="row-even"><td>0x08</td>
<td>ignore NVRAM “Scan at boot time” parameter for all devices</td>
</tr>
<tr class="row-odd"><td>0x80</td>
<td>also attach controllers set to OFF in the NVRAM (sym53c8xx only)</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="exclude-a-host-from-being-attached">
<h4>10.2.12 Exclude a host from being attached<a class="headerlink" href="#exclude-a-host-from-being-attached" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><blockquote>
<div>excl=&lt;io_address&gt;,…</div></blockquote>
<p>Prevent host at a given io address from being attached.
For example ‘excl=0xb400,0xc000’ indicate to the
driver not to attach hosts at address 0xb400 and 0xc000.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="converting-from-old-style-options">
<h3>10.3 Converting from old style options<a class="headerlink" href="#converting-from-old-style-options" title="Permalink to this headline">¶</a></h3>
<p>Previously, the sym2 driver accepted arguments of the form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sym53c8xx=tags:4,sync:10,debug:0x200
</pre></div>
</div>
<p>As a result of the new module parameters, this is no longer available.
Most of the options have remained the same, but tags has become
cmd_per_lun to reflect its different purposes.  The sample above would
be specified as:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>modprobe sym53c8xx cmd_per_lun=4 sync=10 debug=0x200
</pre></div>
</div>
<p>or on the kernel boot line as:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sym53c8xx.cmd_per_lun=4 sym53c8xx.sync=10 sym53c8xx.debug=0x200
</pre></div>
</div>
</div>
<div class="section" id="scsi-bus-checking-boot-option">
<h3>10.4 SCSI BUS checking boot option<a class="headerlink" href="#scsi-bus-checking-boot-option" title="Permalink to this headline">¶</a></h3>
<p>When this option is set to a non-zero value, the driver checks SCSI lines
logic state, 100 micro-seconds after having asserted the SCSI RESET line.
The driver just reads SCSI lines and checks all lines read FALSE except RESET.
Since SCSI devices shall release the BUS at most 800 nano-seconds after SCSI
RESET has been asserted, any signal to TRUE may indicate a SCSI BUS problem.
Unfortunately, the following common SCSI BUS problems are not detected:</p>
<ul class="simple">
<li>Only 1 terminator installed.</li>
<li>Misplaced terminators.</li>
<li>Bad quality terminators.</li>
</ul>
<p>On the other hand, either bad cabling, broken devices, not conformant
devices, … may cause a SCSI signal to be wrong when te driver reads it.</p>
</div>
</div>
<div class="section" id="scsi-problem-troubleshooting">
<h2>15. SCSI problem troubleshooting<a class="headerlink" href="#scsi-problem-troubleshooting" title="Permalink to this headline">¶</a></h2>
<div class="section" id="problem-tracking">
<h3>15.1 Problem tracking<a class="headerlink" href="#problem-tracking" title="Permalink to this headline">¶</a></h3>
<p>Most SCSI problems are due to a non conformant SCSI bus or too buggy
devices.  If unfortunately you have SCSI problems, you can check the
following things:</p>
<ul class="simple">
<li>SCSI bus cables</li>
<li>terminations at both end of the SCSI chain</li>
<li>linux syslog messages (some of them may help you)</li>
</ul>
<p>If you do not find the source of problems, you can configure the
driver or devices in the NVRAM with minimal features.</p>
<ul class="simple">
<li>only asynchronous data transfers</li>
<li>tagged commands disabled</li>
<li>disconnections not allowed</li>
</ul>
<p>Now, if your SCSI bus is ok, your system has every chance to work
with this safe configuration but performances will not be optimal.</p>
<p>If it still fails, then you can send your problem description to
appropriate mailing lists or news-groups.  Send me a copy in order to
be sure I will receive it.  Obviously, a bug in the driver code is
possible.</p>
<blockquote>
<div>My current email address: Gerard Roudier &lt;<a class="reference external" href="mailto:groudier&#37;&#52;&#48;free&#46;fr">groudier<span>&#64;</span>free<span>&#46;</span>fr</a>&gt;</div></blockquote>
<p>Allowing disconnections is important if you use several devices on
your SCSI bus but often causes problems with buggy devices.
Synchronous data transfers increases throughput of fast devices like
hard disks.  Good SCSI hard disks with a large cache gain advantage of
tagged commands queuing.</p>
</div>
<div class="section" id="understanding-hardware-error-reports">
<h3>15.2 Understanding hardware error reports<a class="headerlink" href="#understanding-hardware-error-reports" title="Permalink to this headline">¶</a></h3>
<p>When the driver detects an unexpected error condition, it may display a
message of the following pattern:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sym0:1: ERROR (0:48) (1-21-65) (f/95/0) @ (script 7c0:19000000).
sym0: script cmd = 19000000
sym0: regdump: da 10 80 95 47 0f 01 07 75 01 81 21 80 01 09 00.
</pre></div>
</div>
<p>Some fields in such a message may help you understand the cause of the
problem, as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sym0:1: ERROR (0:48) (1-21-65) (f/95/0) @ (script 7c0:19000000).
.....A.........B.C....D.E..F....G.H..I.......J.....K...L.......
</pre></div>
</div>
<dl class="docutils">
<dt>Field A <span class="classifier-delimiter">:</span> <span class="classifier">target number.</span></dt>
<dd>SCSI ID of the device the controller was talking with at the moment the
error occurs.</dd>
<dt>Field B <span class="classifier-delimiter">:</span> <span class="classifier">DSTAT io register (DMA STATUS)</span></dt>
<dd><table border="1" class="first docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Bit 0x40</td>
<td>MDPE Master Data Parity Error
Data parity error detected on the PCI BUS.</td>
</tr>
<tr class="row-even"><td>Bit 0x20</td>
<td>BF   Bus Fault
PCI bus fault condition detected</td>
</tr>
<tr class="row-odd"><td>Bit 0x01</td>
<td>IID  Illegal Instruction Detected
Set by the chip when it detects an Illegal Instruction format
on some condition that makes an instruction illegal.</td>
</tr>
<tr class="row-even"><td>Bit 0x80</td>
<td>DFE Dma Fifo Empty
Pure status bit that does not indicate an error.</td>
</tr>
</tbody>
</table>
<p class="last">If the reported DSTAT value contains a combination of MDPE (0x40),
BF (0x20), then the cause may be likely due to a PCI BUS problem.</p>
</dd>
<dt>Field C <span class="classifier-delimiter">:</span> <span class="classifier">SIST io register (SCSI Interrupt Status)</span></dt>
<dd><table border="1" class="first docutils">
<colgroup>
<col width="6%" />
<col width="94%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Bit 0x08</td>
<td>SGE  SCSI GROSS ERROR
Indicates that the chip detected a severe error condition
on the SCSI BUS that prevents the SCSI protocol from functioning
properly.</td>
</tr>
<tr class="row-even"><td>Bit 0x04</td>
<td>UDC  Unexpected Disconnection
Indicates that the device released the SCSI BUS when the chip
was not expecting this to happen. A device may behave so to
indicate the SCSI initiator that an error condition not reportable              using the SCSI protocol has occurred.</td>
</tr>
<tr class="row-odd"><td>Bit 0x02</td>
<td>RST  SCSI BUS Reset
Generally SCSI targets do not reset the SCSI BUS, although any
device on the BUS can reset it at any time.</td>
</tr>
<tr class="row-even"><td>Bit 0x01</td>
<td>PAR  Parity
SCSI parity error detected.</td>
</tr>
</tbody>
</table>
<p class="last">On a faulty SCSI BUS, any error condition among SGE (0x08), UDC (0x04) and
PAR (0x01) may be detected by the chip. If your SCSI system sometimes
encounters such error conditions, especially SCSI GROSS ERROR, then a SCSI
BUS problem is likely the cause of these errors.</p>
</dd>
</dl>
<p>For fields D,E,F,G and H, you may look into the sym53c8xx_defs.h file
that contains some minimal comments on IO register bits.</p>
<dl class="docutils">
<dt>Field D <span class="classifier-delimiter">:</span> <span class="classifier">SOCL  Scsi Output Control Latch</span></dt>
<dd>This register reflects the state of the SCSI control lines the
chip want to drive or compare against.</dd>
<dt>Field E <span class="classifier-delimiter">:</span> <span class="classifier">SBCL  Scsi Bus Control Lines</span></dt>
<dd>Actual value of control lines on the SCSI BUS.</dd>
<dt>Field F <span class="classifier-delimiter">:</span> <span class="classifier">SBDL  Scsi Bus Data Lines</span></dt>
<dd>Actual value of data lines on the SCSI BUS.</dd>
<dt>Field G <span class="classifier-delimiter">:</span> <span class="classifier">SXFER  SCSI Transfer</span></dt>
<dd>Contains the setting of the Synchronous Period for output and
the current Synchronous offset (offset 0 means asynchronous).</dd>
<dt>Field H <span class="classifier-delimiter">:</span> <span class="classifier">SCNTL3 Scsi Control Register 3</span></dt>
<dd>Contains the setting of timing values for both asynchronous and
synchronous data transfers.</dd>
<dt>Field I <span class="classifier-delimiter">:</span> <span class="classifier">SCNTL4 Scsi Control Register 4</span></dt>
<dd>Only meaningful for 53C1010 Ultra3 controllers.</dd>
</dl>
<p>Understanding Fields J, K, L and dumps requires to have good knowledge of
SCSI standards, chip cores functionnals and internal driver data structures.
You are not required to decode and understand them, unless you want to help
maintain the driver code.</p>
</div>
</div>
<div class="section" id="serial-nvram-added-by-richard-waltham-dormouse-farsrobt-demon-co-uk">
<h2>17. Serial NVRAM (added by Richard Waltham: <a class="reference external" href="mailto:dormouse&#37;&#52;&#48;farsrobt&#46;demon&#46;co&#46;uk">dormouse<span>&#64;</span>farsrobt<span>&#46;</span>demon<span>&#46;</span>co<span>&#46;</span>uk</a>)<a class="headerlink" href="#serial-nvram-added-by-richard-waltham-dormouse-farsrobt-demon-co-uk" title="Permalink to this headline">¶</a></h2>
<div class="section" id="features">
<h3>17.1 Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h3>
<p>Enabling serial NVRAM support enables detection of the serial NVRAM included
on Symbios and some Symbios compatible host adaptors, and Tekram boards. The
serial NVRAM is used by Symbios and Tekram to hold set up parameters for the
host adaptor and its attached drives.</p>
<p>The Symbios NVRAM also holds data on the boot order of host adaptors in a
system with more than one host adaptor.  This information is no longer used
as it’s fundamentally incompatible with the hotplug PCI model.</p>
<p>Tekram boards using Symbios chips, DC390W/F/U, which have NVRAM are detected
and this is used to distinguish between Symbios compatible and Tekram host
adaptors. This is used to disable the Symbios compatible “diff” setting
incorrectly set on Tekram boards if the CONFIG_SCSI_53C8XX_SYMBIOS_COMPAT
configuration parameter is set enabling both Symbios and Tekram boards to be
used together with the Symbios cards using all their features, including
“diff” support. (“led pin” support for Symbios compatible cards can remain
enabled when using Tekram cards. It does nothing useful for Tekram host
adaptors but does not cause problems either.)</p>
<p>The parameters the driver is able to get from the NVRAM depend on the
data format used, as follow:</p>
<table border="1" class="docutils">
<colgroup>
<col width="49%" />
<col width="29%" />
<col width="22%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>&#160;</td>
<td>Tekram format</td>
<td>Symbios format</td>
</tr>
<tr class="row-even"><td>General and host parameters</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td><ul class="first last simple">
<li>Boot order</li>
</ul>
</td>
<td>N</td>
<td>Y</td>
</tr>
<tr class="row-even"><td><ul class="first last simple">
<li>Host SCSI ID</li>
</ul>
</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr class="row-odd"><td><ul class="first last simple">
<li>SCSI parity checking</li>
</ul>
</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr class="row-even"><td><ul class="first last simple">
<li>Verbose boot messages</li>
</ul>
</td>
<td>N</td>
<td>Y</td>
</tr>
<tr class="row-odd"><td colspan="3">SCSI devices parameters</td>
</tr>
<tr class="row-even"><td><ul class="first last simple">
<li>Synchronous transfer speed</li>
</ul>
</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr class="row-odd"><td><ul class="first last simple">
<li>Wide 16 / Narrow</li>
</ul>
</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr class="row-even"><td><ul class="first last simple">
<li>Tagged Command Queuing
enabled</li>
</ul>
</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr class="row-odd"><td><ul class="first last simple">
<li>Disconnections enabled</li>
</ul>
</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr class="row-even"><td><ul class="first last simple">
<li>Scan at boot time</li>
</ul>
</td>
<td>N</td>
<td>Y</td>
</tr>
</tbody>
</table>
<p>In order to speed up the system boot, for each device configured without
the “scan at boot time” option, the driver forces an error on the
first TEST UNIT READY command received for this device.</p>
</div>
<div class="section" id="symbios-nvram-layout">
<h3>17.2 Symbios NVRAM layout<a class="headerlink" href="#symbios-nvram-layout" title="Permalink to this headline">¶</a></h3>
<p>typical data at NVRAM address 0x100 (53c810a NVRAM):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>00 00
64 01
8e 0b

00 30 00 00 00 00 07 00 00 00 00 00 00 00 07 04 10 04 00 00

04 00 0f 00 00 10 00 50 00 00 01 00 00 62
04 00 03 00 00 10 00 58 00 00 01 00 00 63
04 00 01 00 00 10 00 48 00 00 01 00 00 61
00 00 00 00 00 00 00 00 00 00 00 00 00 00

0f 00 08 08 64 00 0a 00
0f 00 08 08 64 00 0a 00
0f 00 08 08 64 00 0a 00
0f 00 08 08 64 00 0a 00
0f 00 08 08 64 00 0a 00
0f 00 08 08 64 00 0a 00
0f 00 08 08 64 00 0a 00
0f 00 08 08 64 00 0a 00

0f 00 08 08 64 00 0a 00
0f 00 08 08 64 00 0a 00
0f 00 08 08 64 00 0a 00
0f 00 08 08 64 00 0a 00
0f 00 08 08 64 00 0a 00
0f 00 08 08 64 00 0a 00
0f 00 08 08 64 00 0a 00
0f 00 08 08 64 00 0a 00

00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00

00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00

00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00

fe fe
00 00
00 00
</pre></div>
</div>
<p>NVRAM layout details</p>
<table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">NVRAM Address</th>
<th class="head">&#160;</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0x000-0x0ff</td>
<td>not used</td>
</tr>
<tr class="row-odd"><td>0x100-0x26f</td>
<td>initialised data</td>
</tr>
<tr class="row-even"><td>0x270-0x7ff</td>
<td>not used</td>
</tr>
</tbody>
</table>
<p>general layout:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>header  -   6 bytes,
data    - 356 bytes (checksum is byte sum of this data)
trailer -   6 bytes
          ---
total     368 bytes
</pre></div>
</div>
<p>data area layout:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>controller set up  -  20 bytes
boot configuration -  56 bytes (4x14 bytes)
device set up      - 128 bytes (16x8 bytes)
unused (spare?)    - 152 bytes (19x8 bytes)
                     ---
total                356 bytes
</pre></div>
</div>
<p>header:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>00 00   - ?? start marker
64 01   - byte count (lsb/msb excludes header/trailer)
8e 0b   - checksum (lsb/msb excludes header/trailer)
</pre></div>
</div>
<p>controller set up:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>00 30 00 00 00 00 07 00 00 00 00 00 00 00 07 04 10 04 00 00
                |     |           |     |
                |     |           |      -- host ID
                |     |           |
                |     |            --Removable Media Support
                |     |               0x00 = none
                |     |               0x01 = Bootable Device
                |     |               0x02 = All with Media
                |     |
                |      --flag bits 2
                |        0x00000001= scan order hi-&gt;low
                |            (default 0x00 - scan low-&gt;hi)
                    --flag bits 1
                    0x00000001 scam enable
                    0x00000010 parity enable
                    0x00000100 verbose boot msgs
</pre></div>
</div>
<p>remaining bytes unknown - they do not appear to change in my
current set up for any of the controllers.</p>
<p>default set up is identical for 53c810a and 53c875 NVRAM
(Removable Media added Symbios BIOS version 4.09)</p>
<p>boot configuration</p>
<p>boot order set by order of the devices in this table:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>04 00 0f 00 00 10 00 50 00 00 01 00 00 62 -- 1st controller
04 00 03 00 00 10 00 58 00 00 01 00 00 63    2nd controller
04 00 01 00 00 10 00 48 00 00 01 00 00 61    3rd controller
00 00 00 00 00 00 00 00 00 00 00 00 00 00    4th controller
    |  |  |  |     |        |     |  |
    |  |  |  |     |        |      ---- PCI io port adr
    |  |  |  |     |         --0x01 init/scan at boot time
    |  |  |  |      --PCI device/function number (0xdddddfff)
    |  |   ----- ?? PCI vendor ID (lsb/msb)
        ----PCI device ID (lsb/msb)
</pre></div>
</div>
<p>?? use of this data is a guess but seems reasonable</p>
<p>remaining bytes unknown - they do not appear to change in my
current set up</p>
<p>default set up is identical for 53c810a and 53c875 NVRAM</p>
<p>device set up (up to 16 devices - includes controller):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0f 00 08 08 64 00 0a 00 - id 0
0f 00 08 08 64 00 0a 00
0f 00 08 08 64 00 0a 00
0f 00 08 08 64 00 0a 00
0f 00 08 08 64 00 0a 00
0f 00 08 08 64 00 0a 00
0f 00 08 08 64 00 0a 00
0f 00 08 08 64 00 0a 00

0f 00 08 08 64 00 0a 00
0f 00 08 08 64 00 0a 00
0f 00 08 08 64 00 0a 00
0f 00 08 08 64 00 0a 00
0f 00 08 08 64 00 0a 00
0f 00 08 08 64 00 0a 00
0f 00 08 08 64 00 0a 00
0f 00 08 08 64 00 0a 00 - id 15
|     |  |  |     |  |
|     |  |  |      ----timeout (lsb/msb)
|     |  |   --synch period (0x?? 40 Mtrans/sec- fast 40) (probably 0x28)
|     |  |                  (0x30 20 Mtrans/sec- fast 20)
|     |  |                  (0x64 10 Mtrans/sec- fast )
|     |  |                  (0xc8  5 Mtrans/sec)
|     |  |                  (0x00  asynchronous)
|     |   -- ?? max sync offset (0x08 in NVRAM on 53c810a)
|     |                         (0x10 in NVRAM on 53c875)
|      --device bus width (0x08 narrow)
|                         (0x10 16 bit wide)
--flag bits
    0x00000001 - disconnect enabled
    0x00000010 - scan at boot time
    0x00000100 - scan luns
    0x00001000 - queue tags enabled
</pre></div>
</div>
<p>remaining bytes unknown - they do not appear to change in my
current set up</p>
<p>?? use of this data is a guess but seems reasonable
(but it could be max bus width)</p>
<p>default set up for 53c810a NVRAM
default set up for 53c875 NVRAM</p>
<blockquote>
<div><ul class="simple">
<li>bus width     - 0x10</li>
<li>sync offset ? - 0x10</li>
<li>sync period   - 0x30</li>
</ul>
</div></blockquote>
<p>?? spare device space (32 bit bus ??):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>00 00 00 00 00 00 00 00  (19x8bytes)
.
.
00 00 00 00 00 00 00 00
</pre></div>
</div>
<p>default set up is identical for 53c810a and 53c875 NVRAM</p>
<p>trailer:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>fe fe   - ? end marker ?
00 00
00 00
</pre></div>
</div>
<p>default set up is identical for 53c810a and 53c875 NVRAM</p>
</div>
<div class="section" id="tekram-nvram-layout">
<h3>17.3 Tekram NVRAM layout<a class="headerlink" href="#tekram-nvram-layout" title="Permalink to this headline">¶</a></h3>
<p>nvram 64x16 (1024 bit)</p>
<p>Drive settings:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Drive ID 0-15 (addr 0x0yyyy0 = device setup, yyyy = ID)
            (addr 0x0yyyy1 = 0x0000)

    x x x x  x x x x  x x x x  x x x x
            | | |      | |  | | | |
            | | |      | |  | | |  ----- parity check   0 - off
            | | |      | |  | | |                       1 - on
            | | |      | |  | | |
            | | |      | |  | |  ------- sync neg       0 - off
            | | |      | |  | |                         1 - on
            | | |      | |  | |
            | | |      | |  |  --------- disconnect     0 - off
            | | |      | |  |                           1 - on
            | | |      | |  |
            | | |      | |   ----------- start cmd      0 - off
            | | |      | |                              1 - on
            | | |      | |
            | | |      |  -------------- tagged cmds    0 - off
            | | |      |                                1 - on
            | | |      |
            | | |       ---------------- wide neg       0 - off
            | | |                                       1 - on
            | | |
                --------------------------- sync rate      0 - 10.0 Mtrans/sec
                                                        1 -  8.0
                                                        2 -  6.6
                                                        3 -  5.7
                                                        4 -  5.0
                                                        5 -  4.0
                                                        6 -  3.0
                                                        7 -  2.0
                                                        7 -  2.0
                                                        8 - 20.0
                                                        9 - 16.7
                                                        a - 13.9
                                                        b - 11.9
</pre></div>
</div>
<p>Global settings</p>
<p>Host flags 0 (addr 0x100000, 32):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>x x x x  x x x x  x x x x  x x x x
| | | |  | | | |           | | | |
| | | |  | | | |            ----------- host ID    0x00 - 0x0f
| | | |  | | | |
| | | |  | | |  ----------------------- support for    0 - off
| | | |  | | |                          &gt; 2 drives     1 - on
| | | |  | | |
| | | |  | |  ------------------------- support drives 0 - off
| | | |  | |                            &gt; 1Gbytes      1 - on
| | | |  | |
| | | |  |  --------------------------- bus reset on   0 - off
| | | |  |                                power on     1 - on
| | | |  |
| | | |   ----------------------------- active neg     0 - off
| | | |                                                1 - on
| | | |
| | |  -------------------------------- imm seek       0 - off
| | |                                                  1 - on
| | |
| |  ---------------------------------- scan luns      0 - off
| |                                                    1 - on
| |
 -------------------------------------- removable      0 - disable
                                        as BIOS dev    1 - boot device
                                                       2 - all
</pre></div>
</div>
<p>Host flags 1 (addr 0x100001, 33):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>x x x x  x x x x  x x x x  x x x x
           | | |             | | |
           | | |              --------- boot delay     0 -   3 sec
           | | |                                       1 -   5
           | | |                                       2 -  10
           | | |                                       3 -  20
           | | |                                       4 -  30
           | | |                                       5 -  60
           | | |                                       6 - 120
           | | |
            --------------------------- max tag cmds   0 -  2
                                                       1 -  4
                                                       2 -  8
                                                       3 - 16
                                                       4 - 32
</pre></div>
</div>
<p>Host flags 2 (addr 0x100010, 34):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>x x x x  x x x x  x x x x  x x x x
                                 |
                                  ----- F2/F6 enable   0 - off ???
                                                       1 - on  ???
</pre></div>
</div>
<p>checksum (addr 0x111111)</p>
<p>checksum = 0x1234 - (sum addr 0-63)</p>
<hr class="docutils" />
<p>default nvram data:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0x0037 0x0000 0x0037 0x0000 0x0037 0x0000 0x0037 0x0000
0x0037 0x0000 0x0037 0x0000 0x0037 0x0000 0x0037 0x0000
0x0037 0x0000 0x0037 0x0000 0x0037 0x0000 0x0037 0x0000
0x0037 0x0000 0x0037 0x0000 0x0037 0x0000 0x0037 0x0000

0x0f07 0x0400 0x0001 0x0000 0x0000 0x0000 0x0000 0x0000
0x0000 0x0000 0x0000 0x0000 0x0000 0x0000 0x0000 0x0000
0x0000 0x0000 0x0000 0x0000 0x0000 0x0000 0x0000 0x0000
0x0000 0x0000 0x0000 0x0000 0x0000 0x0000 0x0000 0xfbbc
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>