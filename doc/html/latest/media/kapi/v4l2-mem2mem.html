

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1.20. V4L2 Memory to Memory functions and data structures &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="1.21. V4L2 async kAPI" href="v4l2-async.html" />
    <link rel="prev" title="1.19. V4L2 Media Bus functions and data structures" href="v4l2-mediabus.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.6.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../leds/index.html">LEDs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Linux Media Subsystem Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../media_uapi.html">Linux Media Infrastructure userspace API</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../media_kapi.html">Media subsystem kernel internal API</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="v4l2-core.html">1. Video4Linux devices</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="v4l2-intro.html">1.1. Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-intro.html#structure-of-a-v4l-driver">1.2. Structure of a V4L driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-intro.html#structure-of-the-v4l2-framework">1.3. Structure of the V4L2 framework</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-dev.html">1.4. Video device’ s internal representation</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-device.html">1.5. V4L2 device instance</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-fh.html">1.6. V4L2 File handlers</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-subdev.html">1.7. V4L2 sub-devices</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-subdev.html#v4l2-sub-device-userspace-api">1.8. V4L2 sub-device userspace API</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-subdev.html#i2c-sub-device-drivers">1.9. I2C sub-device drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-subdev.html#v4l2-sub-device-functions-and-data-structures">1.10. V4L2 sub-device functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-event.html">1.11. V4L2 events</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-controls.html">1.12. V4L2 Controls</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-videobuf.html">1.13. Videobuf Framework</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-videobuf2.html">1.14. V4L2 videobuf2 functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-clocks.html">1.15. V4L2 clocks</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-dv-timings.html">1.16. V4L2 DV Timings functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-flash-led-class.html">1.17. V4L2 flash functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-mc.html">1.18. V4L2 Media Controller functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-mediabus.html">1.19. V4L2 Media Bus functions and data structures</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">1.20. V4L2 Memory to Memory functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-async.html">1.21. V4L2 async kAPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-fwnode.html">1.22. V4L2 fwnode kAPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-rect.html">1.23. V4L2 rect helper functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-tuner.html">1.24. Tuner functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-common.html">1.25. V4L2 common functions and data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="v4l2-tveeprom.html">1.26. Hauppauge TV EEPROM functions and data structures</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="dtv-core.html">2. Digital TV (DVB) devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="rc-core.html">3. Remote Controller devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc-core.html">4. Media Controller devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="cec-core.html">5. CEC Kernel Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="csi2.html">6. MIPI CSI-2</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dvb-drivers/index.html">Linux Digital TV driver-specific documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../v4l-drivers/index.html">Video4Linux (V4L)  driver-specific documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cec-drivers/index.html">CEC driver-specific documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mic/index.html">Intel Many Integrated Core (MIC) architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scheduler/index.html">Linux Scheduler</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arm/index.html">ARM Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../arm64/index.html">ARM64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ia64/index.html">IA-64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../m68k/index.html">m68k Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mips/index.html">MIPS-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nios2/nios2.html">Linux on the Nios II architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openrisc/index.html">OpenRISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parisc/index.html">PA-RISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../powerpc/index.html">powerpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../riscv/index.html">RISC-V architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../s390/index.html">s390 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sparc/index.html">Sparc Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../x86/index.html">x86-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../xtensa/index.html">Xtensa Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Linux Media Subsystem Documentation</a> &raquo;</li>
        
          <li><a href="../media_kapi.html">Media subsystem kernel internal API</a> &raquo;</li>
        
          <li><a href="v4l2-core.html">1. Video4Linux devices</a> &raquo;</li>
        
      <li>1.20. V4L2 Memory to Memory functions and data structures</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/media/kapi/v4l2-mem2mem.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="v4l2-memory-to-memory-functions-and-data-structures">
<h1>1.20. V4L2 Memory to Memory functions and data structures<a class="headerlink" href="#v4l2-memory-to-memory-functions-and-data-structures" title="Permalink to this headline">¶</a></h1>
<dl class="type">
<dt id="c.v4l2_m2m_ops">
struct <code class="descname">v4l2_m2m_ops</code><a class="headerlink" href="#c.v4l2_m2m_ops" title="Permalink to this definition">¶</a></dt>
<dd><p>mem-to-mem device driver callbacks</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct v4l2_m2m_ops {
  void (*device_run)(void *priv);
  int (*job_ready)(void *priv);
  void (*job_abort)(void *priv);
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">device_run</span></code></dt>
<dd>required. Begin the actual job (transaction) inside this
callback.
The job does NOT have to end before this callback returns
(and it will be the usual case). When the job finishes,
<a class="reference internal" href="#c.v4l2_m2m_job_finish" title="v4l2_m2m_job_finish"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_m2m_job_finish()</span></code></a> or <a class="reference internal" href="#c.v4l2_m2m_buf_done_and_job_finish" title="v4l2_m2m_buf_done_and_job_finish"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_m2m_buf_done_and_job_finish()</span></code></a>
has to be called.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">job_ready</span></code></dt>
<dd>optional. Should return 0 if the driver does not have a job
fully prepared to run yet (i.e. it will not be able to finish a
transaction without sleeping). If not provided, it will be
assumed that one source and one destination buffer are all
that is required for the driver to perform one full transaction.
This method may not sleep.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">job_abort</span></code></dt>
<dd>optional. Informs the driver that it has to abort the currently
running transaction as soon as possible (i.e. as soon as it can
stop the device safely; e.g. in the next interrupt handler),
even if the transaction would not have been finished by then.
After the driver performs the necessary steps, it has to call
<a class="reference internal" href="#c.v4l2_m2m_job_finish" title="v4l2_m2m_job_finish"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_m2m_job_finish()</span></code></a> or <a class="reference internal" href="#c.v4l2_m2m_buf_done_and_job_finish" title="v4l2_m2m_buf_done_and_job_finish"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_m2m_buf_done_and_job_finish()</span></code></a> as
if the transaction ended normally.
This function does not have to (and will usually not) wait
until the device enters a state when it can be stopped.</dd>
</dl>
<dl class="type">
<dt id="c.v4l2_m2m_queue_ctx">
struct <code class="descname">v4l2_m2m_queue_ctx</code><a class="headerlink" href="#c.v4l2_m2m_queue_ctx" title="Permalink to this definition">¶</a></dt>
<dd><p>represents a queue for buffers ready to be processed</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct v4l2_m2m_queue_ctx {
  struct vb2_queue        q;
  struct list_head        rdy_queue;
  spinlock_t rdy_spinlock;
  u8 num_rdy;
  bool buffered;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">q</span></code></dt>
<dd>pointer to struct <a class="reference internal" href="v4l2-videobuf2.html#c.vb2_queue" title="vb2_queue"><code class="xref c c-type docutils literal notranslate"><span class="pre">vb2_queue</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">rdy_queue</span></code></dt>
<dd>List of V4L2 mem-to-mem queues</dd>
<dt><code class="docutils literal notranslate"><span class="pre">rdy_spinlock</span></code></dt>
<dd>spin lock to protect the struct usage</dd>
<dt><code class="docutils literal notranslate"><span class="pre">num_rdy</span></code></dt>
<dd>number of buffers ready to be processed</dd>
<dt><code class="docutils literal notranslate"><span class="pre">buffered</span></code></dt>
<dd>is the queue buffered?</dd>
</dl>
<p><strong>Description</strong></p>
<p>Queue for buffers ready to be processed as soon as this
instance receives access to the device.</p>
<dl class="type">
<dt id="c.v4l2_m2m_ctx">
struct <code class="descname">v4l2_m2m_ctx</code><a class="headerlink" href="#c.v4l2_m2m_ctx" title="Permalink to this definition">¶</a></dt>
<dd><p>Memory to memory context structure</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct v4l2_m2m_ctx {
  struct mutex                    *q_lock;
  bool new_frame;
  struct v4l2_m2m_dev             *m2m_dev;
  struct v4l2_m2m_queue_ctx       cap_q_ctx;
  struct v4l2_m2m_queue_ctx       out_q_ctx;
  struct list_head                queue;
  unsigned long                   job_flags;
  wait_queue_head_t finished;
  void *priv;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">q_lock</span></code></dt>
<dd>struct <code class="xref c c-type docutils literal notranslate"><span class="pre">mutex</span></code> lock</dd>
<dt><code class="docutils literal notranslate"><span class="pre">new_frame</span></code></dt>
<dd>valid in the device_run callback: if true, then this
starts a new frame; if false, then this is a new slice
for an existing frame. This is always true unless
V4L2_BUF_CAP_SUPPORTS_M2M_HOLD_CAPTURE_BUF is set, which
indicates slicing support.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">m2m_dev</span></code></dt>
<dd>opaque pointer to the internal data to handle M2M context</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cap_q_ctx</span></code></dt>
<dd>Capture (output to memory) queue context</dd>
<dt><code class="docutils literal notranslate"><span class="pre">out_q_ctx</span></code></dt>
<dd>Output (input from memory) queue context</dd>
<dt><code class="docutils literal notranslate"><span class="pre">queue</span></code></dt>
<dd>List of memory to memory contexts</dd>
<dt><code class="docutils literal notranslate"><span class="pre">job_flags</span></code></dt>
<dd>Job queue flags, used internally by v4l2-mem2mem.c:
<code class="docutils literal notranslate"><span class="pre">TRANS_QUEUED</span></code>, <code class="docutils literal notranslate"><span class="pre">TRANS_RUNNING</span></code> and <code class="docutils literal notranslate"><span class="pre">TRANS_ABORT</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">finished</span></code></dt>
<dd>Wait queue used to signalize when a job queue finished.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">priv</span></code></dt>
<dd>Instance private data</dd>
</dl>
<p><strong>Description</strong></p>
<p>The memory to memory context is specific to a file handle, NOT to e.g.
a device.</p>
<dl class="type">
<dt id="c.v4l2_m2m_buffer">
struct <code class="descname">v4l2_m2m_buffer</code><a class="headerlink" href="#c.v4l2_m2m_buffer" title="Permalink to this definition">¶</a></dt>
<dd><p>Memory to memory buffer</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct v4l2_m2m_buffer {
  struct vb2_v4l2_buffer  vb;
  struct list_head        list;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">vb</span></code></dt>
<dd>pointer to struct <a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer"><code class="xref c c-type docutils literal notranslate"><span class="pre">vb2_v4l2_buffer</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">list</span></code></dt>
<dd>list of m2m buffers</dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_get_curr_priv">
void * <code class="descname">v4l2_m2m_get_curr_priv</code><span class="sig-paren">(</span>struct v4l2_m2m_dev *<em>&nbsp;m2m_dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_get_curr_priv" title="Permalink to this definition">¶</a></dt>
<dd><p>return driver private data for the currently running instance or NULL if no instance is running</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_dev</span> <span class="pre">*</span> <span class="pre">m2m_dev</span></code></dt>
<dd>opaque pointer to the internal data to handle M2M context</dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_get_vq">
struct <a class="reference internal" href="v4l2-videobuf2.html#c.vb2_queue" title="vb2_queue">vb2_queue</a> * <code class="descname">v4l2_m2m_get_vq</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em>, enum <a class="reference internal" href="../uapi/v4l/buffer.html#c.v4l2_buf_type" title="v4l2_buf_type">v4l2_buf_type</a><em>&nbsp;type</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_get_vq" title="Permalink to this definition">¶</a></dt>
<dd><p>return vb2_queue for the given type</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">v4l2_buf_type</span> <span class="pre">type</span></code></dt>
<dd>type of the V4L2 buffer, as defined by enum <a class="reference internal" href="../uapi/v4l/buffer.html#c.v4l2_buf_type" title="v4l2_buf_type"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_buf_type</span></code></a></dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_try_schedule">
void <code class="descname">v4l2_m2m_try_schedule</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_try_schedule" title="Permalink to this definition">¶</a></dt>
<dd><p>check whether an instance is ready to be added to the pending job queue and add it if so.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
</dl>
<p><strong>Description</strong></p>
<p>There are three basic requirements an instance has to meet to be able to run:
1) at least one source buffer has to be queued,
2) at least one destination buffer has to be queued,
3) streaming has to be on.</p>
<p>If a queue is buffered (for example a decoder hardware ringbuffer that has
to be drained before doing streamoff), allow scheduling without v4l2 buffers
on that queue.</p>
<p>There may also be additional, custom requirements. In such case the driver
should supply a custom callback (job_ready in v4l2_m2m_ops) that should
return 1 if the instance is ready.
An example of the above could be an instance that requires more than one
src/dst buffer per transaction.</p>
<dl class="function">
<dt id="c.v4l2_m2m_job_finish">
void <code class="descname">v4l2_m2m_job_finish</code><span class="sig-paren">(</span>struct v4l2_m2m_dev *<em>&nbsp;m2m_dev</em>, struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_job_finish" title="Permalink to this definition">¶</a></dt>
<dd><p>inform the framework that a job has been finished and have it clean up</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_dev</span> <span class="pre">*</span> <span class="pre">m2m_dev</span></code></dt>
<dd>opaque pointer to the internal data to handle M2M context</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
</dl>
<p><strong>Description</strong></p>
<p>Called by a driver to yield back the device after it has finished with it.
Should be called as soon as possible after reaching a state which allows
other instances to take control of the device.</p>
<p>This function has to be called only after <a class="reference internal" href="#c.v4l2_m2m_ops" title="v4l2_m2m_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ops-&gt;device_run</span></code></a>
callback has been called on the driver. To prevent recursion, it should
not be called directly from the <a class="reference internal" href="#c.v4l2_m2m_ops" title="v4l2_m2m_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ops-&gt;device_run</span></code></a> callback though.</p>
<dl class="function">
<dt id="c.v4l2_m2m_buf_done_and_job_finish">
void <code class="descname">v4l2_m2m_buf_done_and_job_finish</code><span class="sig-paren">(</span>struct v4l2_m2m_dev *<em>&nbsp;m2m_dev</em>, struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em>, enum <a class="reference internal" href="v4l2-videobuf2.html#c.vb2_buffer_state" title="vb2_buffer_state">vb2_buffer_state</a><em>&nbsp;state</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_buf_done_and_job_finish" title="Permalink to this definition">¶</a></dt>
<dd><p>return source/destination buffers with state and inform the framework that a job has been finished and have it clean up</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_dev</span> <span class="pre">*</span> <span class="pre">m2m_dev</span></code></dt>
<dd>opaque pointer to the internal data to handle M2M context</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">vb2_buffer_state</span> <span class="pre">state</span></code></dt>
<dd>vb2 buffer state passed to v4l2_m2m_buf_done().</dd>
</dl>
<p><strong>Description</strong></p>
<p>Drivers that set V4L2_BUF_CAP_SUPPORTS_M2M_HOLD_CAPTURE_BUF must use this
function instead of job_finish() to take held buffers into account. It is
optional for other drivers.</p>
<p>This function removes the source buffer from the ready list and returns
it with the given state. The same is done for the destination buffer, unless
it is marked ‘held’. In that case the buffer is kept on the ready list.</p>
<p>After that the job is finished (see job_finish()).</p>
<p>This allows for multiple output buffers to be used to fill in a single
capture buffer. This is typically used by stateless decoders where
multiple e.g. H.264 slices contribute to a single decoded frame.</p>
<dl class="function">
<dt id="c.v4l2_m2m_reqbufs">
int <code class="descname">v4l2_m2m_reqbufs</code><span class="sig-paren">(</span>struct file *<em>&nbsp;file</em>, struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em>, struct <a class="reference internal" href="../uapi/v4l/vidioc-reqbufs.html#c.v4l2_requestbuffers" title="v4l2_requestbuffers">v4l2_requestbuffers</a> *<em>&nbsp;reqbufs</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_reqbufs" title="Permalink to this definition">¶</a></dt>
<dd><p>multi-queue-aware REQBUFS multiplexer</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*</span> <span class="pre">file</span></code></dt>
<dd>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">file</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_requestbuffers</span> <span class="pre">*</span> <span class="pre">reqbufs</span></code></dt>
<dd>pointer to struct <a class="reference internal" href="../uapi/v4l/vidioc-reqbufs.html#c.v4l2_requestbuffers" title="v4l2_requestbuffers"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_requestbuffers</span></code></a></dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_querybuf">
int <code class="descname">v4l2_m2m_querybuf</code><span class="sig-paren">(</span>struct file *<em>&nbsp;file</em>, struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em>, struct <a class="reference internal" href="../uapi/v4l/buffer.html#c.v4l2_buffer" title="v4l2_buffer">v4l2_buffer</a> *<em>&nbsp;buf</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_querybuf" title="Permalink to this definition">¶</a></dt>
<dd><p>multi-queue-aware QUERYBUF multiplexer</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*</span> <span class="pre">file</span></code></dt>
<dd>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">file</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_buffer</span> <span class="pre">*</span> <span class="pre">buf</span></code></dt>
<dd>pointer to struct <a class="reference internal" href="../uapi/v4l/buffer.html#c.v4l2_buffer" title="v4l2_buffer"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_buffer</span></code></a></dd>
</dl>
<p><strong>Description</strong></p>
<p>See <a class="reference internal" href="#c.v4l2_m2m_mmap" title="v4l2_m2m_mmap"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_m2m_mmap()</span></code></a> documentation for details.</p>
<dl class="function">
<dt id="c.v4l2_m2m_qbuf">
int <code class="descname">v4l2_m2m_qbuf</code><span class="sig-paren">(</span>struct file *<em>&nbsp;file</em>, struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em>, struct <a class="reference internal" href="../uapi/v4l/buffer.html#c.v4l2_buffer" title="v4l2_buffer">v4l2_buffer</a> *<em>&nbsp;buf</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_qbuf" title="Permalink to this definition">¶</a></dt>
<dd><p>enqueue a source or destination buffer, depending on the type</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*</span> <span class="pre">file</span></code></dt>
<dd>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">file</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_buffer</span> <span class="pre">*</span> <span class="pre">buf</span></code></dt>
<dd>pointer to struct <a class="reference internal" href="../uapi/v4l/buffer.html#c.v4l2_buffer" title="v4l2_buffer"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_buffer</span></code></a></dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_dqbuf">
int <code class="descname">v4l2_m2m_dqbuf</code><span class="sig-paren">(</span>struct file *<em>&nbsp;file</em>, struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em>, struct <a class="reference internal" href="../uapi/v4l/buffer.html#c.v4l2_buffer" title="v4l2_buffer">v4l2_buffer</a> *<em>&nbsp;buf</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_dqbuf" title="Permalink to this definition">¶</a></dt>
<dd><p>dequeue a source or destination buffer, depending on the type</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*</span> <span class="pre">file</span></code></dt>
<dd>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">file</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_buffer</span> <span class="pre">*</span> <span class="pre">buf</span></code></dt>
<dd>pointer to struct <a class="reference internal" href="../uapi/v4l/buffer.html#c.v4l2_buffer" title="v4l2_buffer"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_buffer</span></code></a></dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_prepare_buf">
int <code class="descname">v4l2_m2m_prepare_buf</code><span class="sig-paren">(</span>struct file *<em>&nbsp;file</em>, struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em>, struct <a class="reference internal" href="../uapi/v4l/buffer.html#c.v4l2_buffer" title="v4l2_buffer">v4l2_buffer</a> *<em>&nbsp;buf</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_prepare_buf" title="Permalink to this definition">¶</a></dt>
<dd><p>prepare a source or destination buffer, depending on the type</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*</span> <span class="pre">file</span></code></dt>
<dd>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">file</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_buffer</span> <span class="pre">*</span> <span class="pre">buf</span></code></dt>
<dd>pointer to struct <a class="reference internal" href="../uapi/v4l/buffer.html#c.v4l2_buffer" title="v4l2_buffer"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_buffer</span></code></a></dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_create_bufs">
int <code class="descname">v4l2_m2m_create_bufs</code><span class="sig-paren">(</span>struct file *<em>&nbsp;file</em>, struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em>, struct <a class="reference internal" href="../uapi/v4l/vidioc-create-bufs.html#c.v4l2_create_buffers" title="v4l2_create_buffers">v4l2_create_buffers</a> *<em>&nbsp;create</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_create_bufs" title="Permalink to this definition">¶</a></dt>
<dd><p>create a source or destination buffer, depending on the type</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*</span> <span class="pre">file</span></code></dt>
<dd>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">file</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_create_buffers</span> <span class="pre">*</span> <span class="pre">create</span></code></dt>
<dd>pointer to struct <a class="reference internal" href="../uapi/v4l/vidioc-create-bufs.html#c.v4l2_create_buffers" title="v4l2_create_buffers"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_create_buffers</span></code></a></dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_expbuf">
int <code class="descname">v4l2_m2m_expbuf</code><span class="sig-paren">(</span>struct file *<em>&nbsp;file</em>, struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em>, struct <a class="reference internal" href="../uapi/v4l/vidioc-expbuf.html#c.v4l2_exportbuffer" title="v4l2_exportbuffer">v4l2_exportbuffer</a> *<em>&nbsp;eb</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_expbuf" title="Permalink to this definition">¶</a></dt>
<dd><p>export a source or destination buffer, depending on the type</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*</span> <span class="pre">file</span></code></dt>
<dd>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">file</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_exportbuffer</span> <span class="pre">*</span> <span class="pre">eb</span></code></dt>
<dd>pointer to struct <a class="reference internal" href="../uapi/v4l/vidioc-expbuf.html#c.v4l2_exportbuffer" title="v4l2_exportbuffer"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_exportbuffer</span></code></a></dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_streamon">
int <code class="descname">v4l2_m2m_streamon</code><span class="sig-paren">(</span>struct file *<em>&nbsp;file</em>, struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em>, enum <a class="reference internal" href="../uapi/v4l/buffer.html#c.v4l2_buf_type" title="v4l2_buf_type">v4l2_buf_type</a><em>&nbsp;type</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_streamon" title="Permalink to this definition">¶</a></dt>
<dd><p>turn on streaming for a video queue</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*</span> <span class="pre">file</span></code></dt>
<dd>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">file</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">v4l2_buf_type</span> <span class="pre">type</span></code></dt>
<dd>type of the V4L2 buffer, as defined by enum <a class="reference internal" href="../uapi/v4l/buffer.html#c.v4l2_buf_type" title="v4l2_buf_type"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_buf_type</span></code></a></dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_streamoff">
int <code class="descname">v4l2_m2m_streamoff</code><span class="sig-paren">(</span>struct file *<em>&nbsp;file</em>, struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em>, enum <a class="reference internal" href="../uapi/v4l/buffer.html#c.v4l2_buf_type" title="v4l2_buf_type">v4l2_buf_type</a><em>&nbsp;type</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_streamoff" title="Permalink to this definition">¶</a></dt>
<dd><p>turn off streaming for a video queue</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*</span> <span class="pre">file</span></code></dt>
<dd>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">file</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">v4l2_buf_type</span> <span class="pre">type</span></code></dt>
<dd>type of the V4L2 buffer, as defined by enum <a class="reference internal" href="../uapi/v4l/buffer.html#c.v4l2_buf_type" title="v4l2_buf_type"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_buf_type</span></code></a></dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_poll">
__poll_t <code class="descname">v4l2_m2m_poll</code><span class="sig-paren">(</span>struct file *<em>&nbsp;file</em>, struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em>, struct poll_table_struct *<em>&nbsp;wait</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_poll" title="Permalink to this definition">¶</a></dt>
<dd><p>poll replacement, for destination buffers only</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*</span> <span class="pre">file</span></code></dt>
<dd>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">file</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">poll_table_struct</span> <span class="pre">*</span> <span class="pre">wait</span></code></dt>
<dd>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">poll_table_struct</span></code></dd>
</dl>
<p><strong>Description</strong></p>
<p>Call from the driver’s poll() function. Will poll both queues. If a buffer
is available to dequeue (with dqbuf) from the source queue, this will
indicate that a non-blocking write can be performed, while read will be
returned in case of the destination queue.</p>
<dl class="function">
<dt id="c.v4l2_m2m_mmap">
int <code class="descname">v4l2_m2m_mmap</code><span class="sig-paren">(</span>struct file *<em>&nbsp;file</em>, struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em>, struct vm_area_struct *<em>&nbsp;vma</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_mmap" title="Permalink to this definition">¶</a></dt>
<dd><p>source and destination queues-aware mmap multiplexer</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*</span> <span class="pre">file</span></code></dt>
<dd>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">file</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vm_area_struct</span> <span class="pre">*</span> <span class="pre">vma</span></code></dt>
<dd>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">vm_area_struct</span></code></dd>
</dl>
<p><strong>Description</strong></p>
<p>Call from driver’s mmap() function. Will handle mmap() for both queues
seamlessly for videobuffer, which will receive normal per-queue offsets and
proper videobuf queue pointers. The differentiation is made outside videobuf
by adding a predefined offset to buffers from one of the queues and
subtracting it before passing it back to videobuf. Only drivers (and
thus applications) receive modified offsets.</p>
<dl class="function">
<dt id="c.v4l2_m2m_init">
struct v4l2_m2m_dev * <code class="descname">v4l2_m2m_init</code><span class="sig-paren">(</span>const struct <a class="reference internal" href="#c.v4l2_m2m_ops" title="v4l2_m2m_ops">v4l2_m2m_ops</a> *<em>&nbsp;m2m_ops</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_init" title="Permalink to this definition">¶</a></dt>
<dd><p>initialize per-driver m2m data</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">v4l2_m2m_ops</span> <span class="pre">*</span> <span class="pre">m2m_ops</span></code></dt>
<dd>pointer to struct v4l2_m2m_ops</dd>
</dl>
<p><strong>Description</strong></p>
<p>Usually called from driver’s <code class="docutils literal notranslate"><span class="pre">probe()</span></code> function.</p>
<p><strong>Return</strong></p>
<p>returns an opaque pointer to the internal data to handle M2M context</p>
<dl class="function">
<dt id="c.v4l2_m2m_release">
void <code class="descname">v4l2_m2m_release</code><span class="sig-paren">(</span>struct v4l2_m2m_dev *<em>&nbsp;m2m_dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_release" title="Permalink to this definition">¶</a></dt>
<dd><p>cleans up and frees a m2m_dev structure</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_dev</span> <span class="pre">*</span> <span class="pre">m2m_dev</span></code></dt>
<dd>opaque pointer to the internal data to handle M2M context</dd>
</dl>
<p><strong>Description</strong></p>
<p>Usually called from driver’s <code class="docutils literal notranslate"><span class="pre">remove()</span></code> function.</p>
<dl class="function">
<dt id="c.v4l2_m2m_ctx_init">
struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> * <code class="descname">v4l2_m2m_ctx_init</code><span class="sig-paren">(</span>struct v4l2_m2m_dev *<em>&nbsp;m2m_dev</em>, void *<em>&nbsp;drv_priv</em>, int (*queue_init) (void<em>&nbsp;*priv</em>, struct <a class="reference internal" href="v4l2-videobuf2.html#c.vb2_queue" title="vb2_queue">vb2_queue</a><em>&nbsp;*src_vq</em>, struct <a class="reference internal" href="v4l2-videobuf2.html#c.vb2_queue" title="vb2_queue">vb2_queue</a><em>&nbsp;*dst_vq</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_ctx_init" title="Permalink to this definition">¶</a></dt>
<dd><p>allocate and initialize a m2m context</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_dev</span> <span class="pre">*</span> <span class="pre">m2m_dev</span></code></dt>
<dd>opaque pointer to the internal data to handle M2M context</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*</span> <span class="pre">drv_priv</span></code></dt>
<dd>driver’s instance private data</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">(*)(void</span> <span class="pre">*priv,</span> <span class="pre">struct</span> <span class="pre">vb2_queue</span> <span class="pre">*src_vq,</span> <span class="pre">struct</span> <span class="pre">vb2_queue</span> <span class="pre">*dst_vq)</span> <span class="pre">queue_init</span></code></dt>
<dd>a callback for queue type-specific initialization function
to be used for initializing videobuf_queues</dd>
</dl>
<p><strong>Description</strong></p>
<p>Usually called from driver’s <code class="docutils literal notranslate"><span class="pre">open()</span></code> function.</p>
<dl class="function">
<dt id="c.v4l2_m2m_ctx_release">
void <code class="descname">v4l2_m2m_ctx_release</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_ctx_release" title="Permalink to this definition">¶</a></dt>
<dd><p>release m2m context</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
</dl>
<p><strong>Description</strong></p>
<p>Usually called from driver’s release() function.</p>
<dl class="function">
<dt id="c.v4l2_m2m_buf_queue">
void <code class="descname">v4l2_m2m_buf_queue</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em>, struct <a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer">vb2_v4l2_buffer</a> *<em>&nbsp;vbuf</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_buf_queue" title="Permalink to this definition">¶</a></dt>
<dd><p>add a buffer to the proper ready buffers list.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vb2_v4l2_buffer</span> <span class="pre">*</span> <span class="pre">vbuf</span></code></dt>
<dd>pointer to struct <a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer"><code class="xref c c-type docutils literal notranslate"><span class="pre">vb2_v4l2_buffer</span></code></a></dd>
</dl>
<p><strong>Description</strong></p>
<p>Call from videobuf_queue_ops-&gt;ops-&gt;buf_queue, videobuf_queue_ops callback.</p>
<dl class="function">
<dt id="c.v4l2_m2m_num_src_bufs_ready">
unsigned int <code class="descname">v4l2_m2m_num_src_bufs_ready</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_num_src_bufs_ready" title="Permalink to this definition">¶</a></dt>
<dd><p>return the number of source buffers ready for use</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_num_dst_bufs_ready">
unsigned int <code class="descname">v4l2_m2m_num_dst_bufs_ready</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_num_dst_bufs_ready" title="Permalink to this definition">¶</a></dt>
<dd><p>return the number of destination buffers ready for use</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_next_buf">
struct <a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer">vb2_v4l2_buffer</a> * <code class="descname">v4l2_m2m_next_buf</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_m2m_queue_ctx" title="v4l2_m2m_queue_ctx">v4l2_m2m_queue_ctx</a> *<em>&nbsp;q_ctx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_next_buf" title="Permalink to this definition">¶</a></dt>
<dd><p>return next buffer from the list of ready buffers</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_queue_ctx</span> <span class="pre">*</span> <span class="pre">q_ctx</span></code></dt>
<dd>pointer to struct <strong>v4l2_m2m_queue_ctx</strong></dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_next_src_buf">
struct <a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer">vb2_v4l2_buffer</a> * <code class="descname">v4l2_m2m_next_src_buf</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_next_src_buf" title="Permalink to this definition">¶</a></dt>
<dd><p>return next source buffer from the list of ready buffers</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_next_dst_buf">
struct <a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer">vb2_v4l2_buffer</a> * <code class="descname">v4l2_m2m_next_dst_buf</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_next_dst_buf" title="Permalink to this definition">¶</a></dt>
<dd><p>return next destination buffer from the list of ready buffers</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_last_buf">
struct <a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer">vb2_v4l2_buffer</a> * <code class="descname">v4l2_m2m_last_buf</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_m2m_queue_ctx" title="v4l2_m2m_queue_ctx">v4l2_m2m_queue_ctx</a> *<em>&nbsp;q_ctx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_last_buf" title="Permalink to this definition">¶</a></dt>
<dd><p>return last buffer from the list of ready buffers</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_queue_ctx</span> <span class="pre">*</span> <span class="pre">q_ctx</span></code></dt>
<dd>pointer to struct <strong>v4l2_m2m_queue_ctx</strong></dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_last_src_buf">
struct <a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer">vb2_v4l2_buffer</a> * <code class="descname">v4l2_m2m_last_src_buf</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_last_src_buf" title="Permalink to this definition">¶</a></dt>
<dd><p>return last destination buffer from the list of ready buffers</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_last_dst_buf">
struct <a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer">vb2_v4l2_buffer</a> * <code class="descname">v4l2_m2m_last_dst_buf</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_last_dst_buf" title="Permalink to this definition">¶</a></dt>
<dd><p>return last destination buffer from the list of ready buffers</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_for_each_dst_buf">
<code class="descname">v4l2_m2m_for_each_dst_buf</code><span class="sig-paren">(</span><em>m2m_ctx</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_for_each_dst_buf" title="Permalink to this definition">¶</a></dt>
<dd><p>iterate over a list of destination ready buffers</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">b</span></code></dt>
<dd>current buffer of type struct v4l2_m2m_buffer</dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_for_each_src_buf">
<code class="descname">v4l2_m2m_for_each_src_buf</code><span class="sig-paren">(</span><em>m2m_ctx</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_for_each_src_buf" title="Permalink to this definition">¶</a></dt>
<dd><p>iterate over a list of source ready buffers</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">b</span></code></dt>
<dd>current buffer of type struct v4l2_m2m_buffer</dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_for_each_dst_buf_safe">
<code class="descname">v4l2_m2m_for_each_dst_buf_safe</code><span class="sig-paren">(</span><em>m2m_ctx</em>, <em>b</em>, <em>n</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_for_each_dst_buf_safe" title="Permalink to this definition">¶</a></dt>
<dd><p>iterate over a list of destination ready buffers safely</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">b</span></code></dt>
<dd>current buffer of type struct v4l2_m2m_buffer</dd>
<dt><code class="docutils literal notranslate"><span class="pre">n</span></code></dt>
<dd>used as temporary storage</dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_for_each_src_buf_safe">
<code class="descname">v4l2_m2m_for_each_src_buf_safe</code><span class="sig-paren">(</span><em>m2m_ctx</em>, <em>b</em>, <em>n</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_for_each_src_buf_safe" title="Permalink to this definition">¶</a></dt>
<dd><p>iterate over a list of source ready buffers safely</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">b</span></code></dt>
<dd>current buffer of type struct v4l2_m2m_buffer</dd>
<dt><code class="docutils literal notranslate"><span class="pre">n</span></code></dt>
<dd>used as temporary storage</dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_get_src_vq">
struct <a class="reference internal" href="v4l2-videobuf2.html#c.vb2_queue" title="vb2_queue">vb2_queue</a> * <code class="descname">v4l2_m2m_get_src_vq</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_get_src_vq" title="Permalink to this definition">¶</a></dt>
<dd><p>return vb2_queue for source buffers</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_get_dst_vq">
struct <a class="reference internal" href="v4l2-videobuf2.html#c.vb2_queue" title="vb2_queue">vb2_queue</a> * <code class="descname">v4l2_m2m_get_dst_vq</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_get_dst_vq" title="Permalink to this definition">¶</a></dt>
<dd><p>return vb2_queue for destination buffers</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_buf_remove">
struct <a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer">vb2_v4l2_buffer</a> * <code class="descname">v4l2_m2m_buf_remove</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_m2m_queue_ctx" title="v4l2_m2m_queue_ctx">v4l2_m2m_queue_ctx</a> *<em>&nbsp;q_ctx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_buf_remove" title="Permalink to this definition">¶</a></dt>
<dd><p>take off a buffer from the list of ready buffers and return it</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_queue_ctx</span> <span class="pre">*</span> <span class="pre">q_ctx</span></code></dt>
<dd>pointer to struct <strong>v4l2_m2m_queue_ctx</strong></dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_src_buf_remove">
struct <a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer">vb2_v4l2_buffer</a> * <code class="descname">v4l2_m2m_src_buf_remove</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_src_buf_remove" title="Permalink to this definition">¶</a></dt>
<dd><p>take off a source buffer from the list of ready buffers and return it</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_dst_buf_remove">
struct <a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer">vb2_v4l2_buffer</a> * <code class="descname">v4l2_m2m_dst_buf_remove</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_dst_buf_remove" title="Permalink to this definition">¶</a></dt>
<dd><p>take off a destination buffer from the list of ready buffers and return it</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_buf_remove_by_buf">
void <code class="descname">v4l2_m2m_buf_remove_by_buf</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_m2m_queue_ctx" title="v4l2_m2m_queue_ctx">v4l2_m2m_queue_ctx</a> *<em>&nbsp;q_ctx</em>, struct <a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer">vb2_v4l2_buffer</a> *<em>&nbsp;vbuf</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_buf_remove_by_buf" title="Permalink to this definition">¶</a></dt>
<dd><p>take off exact buffer from the list of ready buffers</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_queue_ctx</span> <span class="pre">*</span> <span class="pre">q_ctx</span></code></dt>
<dd>pointer to struct <strong>v4l2_m2m_queue_ctx</strong></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vb2_v4l2_buffer</span> <span class="pre">*</span> <span class="pre">vbuf</span></code></dt>
<dd>the buffer to be removed</dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_src_buf_remove_by_buf">
void <code class="descname">v4l2_m2m_src_buf_remove_by_buf</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em>, struct <a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer">vb2_v4l2_buffer</a> *<em>&nbsp;vbuf</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_src_buf_remove_by_buf" title="Permalink to this definition">¶</a></dt>
<dd><p>take off exact source buffer from the list of ready buffers</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vb2_v4l2_buffer</span> <span class="pre">*</span> <span class="pre">vbuf</span></code></dt>
<dd>the buffer to be removed</dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_dst_buf_remove_by_buf">
void <code class="descname">v4l2_m2m_dst_buf_remove_by_buf</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx">v4l2_m2m_ctx</a> *<em>&nbsp;m2m_ctx</em>, struct <a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer">vb2_v4l2_buffer</a> *<em>&nbsp;vbuf</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_dst_buf_remove_by_buf" title="Permalink to this definition">¶</a></dt>
<dd><p>take off exact destination buffer from the list of ready buffers</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*</span> <span class="pre">m2m_ctx</span></code></dt>
<dd>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vb2_v4l2_buffer</span> <span class="pre">*</span> <span class="pre">vbuf</span></code></dt>
<dd>the buffer to be removed</dd>
</dl>
<dl class="function">
<dt id="c.v4l2_m2m_buf_copy_metadata">
void <code class="descname">v4l2_m2m_buf_copy_metadata</code><span class="sig-paren">(</span>const struct <a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer">vb2_v4l2_buffer</a> *<em>&nbsp;out_vb</em>, struct <a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer">vb2_v4l2_buffer</a> *<em>&nbsp;cap_vb</em>, bool<em>&nbsp;copy_frame_flags</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_buf_copy_metadata" title="Permalink to this definition">¶</a></dt>
<dd><p>copy buffer metadata from the output buffer to the capture buffer</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">vb2_v4l2_buffer</span> <span class="pre">*</span> <span class="pre">out_vb</span></code></dt>
<dd>the output buffer that is the source of the metadata.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vb2_v4l2_buffer</span> <span class="pre">*</span> <span class="pre">cap_vb</span></code></dt>
<dd>the capture buffer that will receive the metadata.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">copy_frame_flags</span></code></dt>
<dd>copy the KEY/B/PFRAME flags as well.</dd>
</dl>
<p><strong>Description</strong></p>
<p>This helper function copies the timestamp, timecode (if the TIMECODE
buffer flag was set), field and the TIMECODE, KEYFRAME, BFRAME, PFRAME
and TSTAMP_SRC_MASK flags from <strong>out_vb</strong> to <strong>cap_vb</strong>.</p>
<p>If <strong>copy_frame_flags</strong> is false, then the KEYFRAME, BFRAME and PFRAME
flags are not copied. This is typically needed for encoders that
set this bits explicitly.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="v4l2-async.html" class="btn btn-neutral float-right" title="1.21. V4L2 async kAPI" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="v4l2-mediabus.html" class="btn btn-neutral float-left" title="1.19. V4L2 Media Bus functions and data structures" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>