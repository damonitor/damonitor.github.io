

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>20. OMAP 3 Image Signal Processor (ISP) driver &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="21. OMAP4 ISS Driver" href="omap4_camera.html" />
    <link rel="prev" title="19. Vaio Picturebook Motion Eye Camera Driver" href="meye.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.6.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../leds/index.html">LEDs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Linux Media Subsystem Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../media_uapi.html">Linux Media Infrastructure userspace API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../media_kapi.html">Media subsystem kernel internal API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dvb-drivers/index.html">Linux Digital TV driver-specific documentation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Video4Linux (V4L)  driver-specific documentation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="fourcc.html">1. Guidelines for Video4Linux pixel format 4CCs</a></li>
<li class="toctree-l3"><a class="reference internal" href="v4l-with-ir.html">2. Infrared remote control support in video4linux drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="v4l-with-ir.html#using-with-lircd">3. Using with lircd</a></li>
<li class="toctree-l3"><a class="reference internal" href="v4l-with-ir.html#using-without-lircd">4. Using without lircd</a></li>
<li class="toctree-l3"><a class="reference internal" href="tuners.html">5. Tuner drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="cardlist.html">6. Cards List</a></li>
<li class="toctree-l3"><a class="reference internal" href="bttv.html">7. The bttv driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="cafe_ccic.html">8. The cafe_ccic driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="cpia2.html">9. The cpia2 driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="cx2341x.html">10. The cx2341x driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="cx88.html">11. The cx88 driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="davinci-vpbe.html">12. The VPBE V4L2 driver design</a></li>
<li class="toctree-l3"><a class="reference internal" href="fimc.html">13. The Samsung S5P/EXYNOS4 FIMC driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="imx.html">14. i.MX Video Capture Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="imx7.html">15. i.MX7 Video Capture Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="ipu3.html">16. Intel Image Processing Unit 3 (IPU3) Imaging Unit (ImgU) driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="ivtv.html">17. The ivtv driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="max2175.html">18. Maxim Integrated MAX2175 RF to bits tuner driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="meye.html">19. Vaio Picturebook Motion Eye Camera Driver</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">20. OMAP 3 Image Signal Processor (ISP) driver</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">20.1. Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#split-to-subdevs">20.2. Split to subdevs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#controlling-the-omap-3-isp">20.3. Controlling the OMAP 3 ISP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#events">20.4. Events</a></li>
<li class="toctree-l4"><a class="reference internal" href="#private-ioctls">20.5. Private IOCTLs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ccdc-and-preview-block-ioctls">20.6. CCDC and preview block IOCTLs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#statistic-blocks-ioctls">20.7. Statistic blocks IOCTLs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vidioc-omap3isp-stat-en">20.8. VIDIOC_OMAP3ISP_STAT_EN</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vidioc-omap3isp-aewb-cfg-vidioc-omap3isp-hist-cfg-and-vidioc-omap3isp-af-cfg">20.9. VIDIOC_OMAP3ISP_AEWB_CFG, VIDIOC_OMAP3ISP_HIST_CFG and VIDIOC_OMAP3ISP_AF_CFG</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vidioc-omap3isp-stat-req">20.10. VIDIOC_OMAP3ISP_STAT_REQ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#technical-reference-manuals-trms-and-other-documentation">20.11. Technical reference manuals (TRMs) and other documentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#references">20.12. References</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="omap4_camera.html">21. OMAP4 ISS Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="philips.html">22. Philips webcams (pwc driver)</a></li>
<li class="toctree-l3"><a class="reference internal" href="pvrusb2.html">23. The pvrusb2 driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="pxa_camera.html">24. PXA-Camera Host Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="qcom_camss.html">25. Qualcomm Camera Subsystem driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="radiotrack.html">26. The Radiotrack radio driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="rcar-fdp1.html">27. Renesas R-Car Fine Display Processor (FDP1) Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="saa7134.html">28. The saa7134 driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="sh_mobile_ceu_camera.html">29. Cropping and Scaling algorithm, used in the sh_mobile_ceu_camera driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="si470x.html">30. The Silicon Labs Si470x FM Radio Receivers driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="si4713.html">31. The Silicon Labs Si4713 FM Radio Transmitter Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="si476x.html">32. The SI476x Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="soc-camera.html">33. The Soc-Camera Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="uvcvideo.html">34. The Linux USB Video Class (UVC) driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="vimc.html">35. The Virtual Media Controller Driver (vimc)</a></li>
<li class="toctree-l3"><a class="reference internal" href="vivid.html">36. The Virtual Video Test Driver (vivid)</a></li>
<li class="toctree-l3"><a class="reference internal" href="zr364xx.html">37. Zoran 364xx based USB webcam module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cec-drivers/index.html">CEC driver-specific documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mic/index.html">Intel Many Integrated Core (MIC) architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scheduler/index.html">Linux Scheduler</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arm/index.html">ARM Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../arm64/index.html">ARM64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ia64/index.html">IA-64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../m68k/index.html">m68k Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mips/index.html">MIPS-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nios2/nios2.html">Linux on the Nios II architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openrisc/index.html">OpenRISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parisc/index.html">PA-RISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../powerpc/index.html">powerpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../riscv/index.html">RISC-V architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../s390/index.html">s390 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sparc/index.html">Sparc Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../x86/index.html">x86-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../xtensa/index.html">Xtensa Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Linux Media Subsystem Documentation</a> &raquo;</li>
        
          <li><a href="index.html">Video4Linux (V4L)  driver-specific documentation</a> &raquo;</li>
        
      <li>20. OMAP 3 Image Signal Processor (ISP) driver</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/media/v4l-drivers/omap3isp.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="omap-3-image-signal-processor-isp-driver">
<h1>20. OMAP 3 Image Signal Processor (ISP) driver<a class="headerlink" href="#omap-3-image-signal-processor-isp-driver" title="Permalink to this headline">¶</a></h1>
<p>Copyright © 2010 Nokia Corporation</p>
<p>Copyright © 2009 Texas Instruments, Inc.</p>
<p>Contacts: Laurent Pinchart &lt;<a class="reference external" href="mailto:laurent&#46;pinchart&#37;&#52;&#48;ideasonboard&#46;com">laurent<span>&#46;</span>pinchart<span>&#64;</span>ideasonboard<span>&#46;</span>com</a>&gt;,
Sakari Ailus &lt;<a class="reference external" href="mailto:sakari&#46;ailus&#37;&#52;&#48;iki&#46;fi">sakari<span>&#46;</span>ailus<span>&#64;</span>iki<span>&#46;</span>fi</a>&gt;, David Cohen &lt;<a class="reference external" href="mailto:dacohen&#37;&#52;&#48;gmail&#46;com">dacohen<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p>
<div class="section" id="introduction">
<h2>20.1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This file documents the Texas Instruments OMAP 3 Image Signal Processor (ISP)
driver located under drivers/media/platform/omap3isp. The original driver was
written by Texas Instruments but since that it has been rewritten (twice) at
Nokia.</p>
<p>The driver has been successfully used on the following versions of OMAP 3:</p>
<ul class="simple">
<li>3430</li>
<li>3530</li>
<li>3630</li>
</ul>
<p>The driver implements V4L2, Media controller and v4l2_subdev interfaces.
Sensor, lens and flash drivers using the v4l2_subdev interface in the kernel
are supported.</p>
</div>
<div class="section" id="split-to-subdevs">
<h2>20.2. Split to subdevs<a class="headerlink" href="#split-to-subdevs" title="Permalink to this headline">¶</a></h2>
<p>The OMAP 3 ISP is split into V4L2 subdevs, each of the blocks inside the ISP
having one subdev to represent it. Each of the subdevs provide a V4L2 subdev
interface to userspace.</p>
<ul class="simple">
<li>OMAP3 ISP CCP2</li>
<li>OMAP3 ISP CSI2a</li>
<li>OMAP3 ISP CCDC</li>
<li>OMAP3 ISP preview</li>
<li>OMAP3 ISP resizer</li>
<li>OMAP3 ISP AEWB</li>
<li>OMAP3 ISP AF</li>
<li>OMAP3 ISP histogram</li>
</ul>
<p>Each possible link in the ISP is modelled by a link in the Media controller
interface. For an example program see <a class="footnote-reference" href="#f2" id="id1">[2]</a>.</p>
</div>
<div class="section" id="controlling-the-omap-3-isp">
<h2>20.3. Controlling the OMAP 3 ISP<a class="headerlink" href="#controlling-the-omap-3-isp" title="Permalink to this headline">¶</a></h2>
<p>In general, the settings given to the OMAP 3 ISP take effect at the beginning
of the following frame. This is done when the module becomes idle during the
vertical blanking period on the sensor. In memory-to-memory operation the pipe
is run one frame at a time. Applying the settings is done between the frames.</p>
<p>All the blocks in the ISP, excluding the CSI-2 and possibly the CCP2 receiver,
insist on receiving complete frames. Sensors must thus never send the ISP
partial frames.</p>
<p>Autoidle does have issues with some ISP blocks on the 3430, at least.
Autoidle is only enabled on 3630 when the omap3isp module parameter autoidle
is non-zero.</p>
</div>
<div class="section" id="events">
<h2>20.4. Events<a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h2>
<p>The OMAP 3 ISP driver does support the V4L2 event interface on CCDC and
statistics (AEWB, AF and histogram) subdevs.</p>
<p>The CCDC subdev produces V4L2_EVENT_FRAME_SYNC type event on HS_VS
interrupt which is used to signal frame start. Earlier version of this
driver used V4L2_EVENT_OMAP3ISP_HS_VS for this purpose. The event is
triggered exactly when the reception of the first line of the frame starts
in the CCDC module. The event can be subscribed on the CCDC subdev.</p>
<p>(When using parallel interface one must pay account to correct configuration
of the VS signal polarity. This is automatically correct when using the serial
receivers.)</p>
<p>Each of the statistics subdevs is able to produce events. An event is
generated whenever a statistics buffer can be dequeued by a user space
application using the VIDIOC_OMAP3ISP_STAT_REQ IOCTL. The events available
are:</p>
<ul class="simple">
<li>V4L2_EVENT_OMAP3ISP_AEWB</li>
<li>V4L2_EVENT_OMAP3ISP_AF</li>
<li>V4L2_EVENT_OMAP3ISP_HIST</li>
</ul>
<p>The type of the event data is struct omap3isp_stat_event_status for these
ioctls. If there is an error calculating the statistics, there will be an
event as usual, but no related statistics buffer. In this case
omap3isp_stat_event_status.buf_err is set to non-zero.</p>
</div>
<div class="section" id="private-ioctls">
<h2>20.5. Private IOCTLs<a class="headerlink" href="#private-ioctls" title="Permalink to this headline">¶</a></h2>
<p>The OMAP 3 ISP driver supports standard V4L2 IOCTLs and controls where
possible and practical. Much of the functions provided by the ISP, however,
does not fall under the standard IOCTLs — gamma tables and configuration of
statistics collection are examples of such.</p>
<p>In general, there is a private ioctl for configuring each of the blocks
containing hardware-dependent functions.</p>
<p>The following private IOCTLs are supported:</p>
<ul class="simple">
<li>VIDIOC_OMAP3ISP_CCDC_CFG</li>
<li>VIDIOC_OMAP3ISP_PRV_CFG</li>
<li>VIDIOC_OMAP3ISP_AEWB_CFG</li>
<li>VIDIOC_OMAP3ISP_HIST_CFG</li>
<li>VIDIOC_OMAP3ISP_AF_CFG</li>
<li>VIDIOC_OMAP3ISP_STAT_REQ</li>
<li>VIDIOC_OMAP3ISP_STAT_EN</li>
</ul>
<p>The parameter structures used by these ioctls are described in
include/linux/omap3isp.h. The detailed functions of the ISP itself related to
a given ISP block is described in the Technical Reference Manuals (TRMs) —
see the end of the document for those.</p>
<p>While it is possible to use the ISP driver without any use of these private
IOCTLs it is not possible to obtain optimal image quality this way. The AEWB,
AF and histogram modules cannot be used without configuring them using the
appropriate private IOCTLs.</p>
</div>
<div class="section" id="ccdc-and-preview-block-ioctls">
<h2>20.6. CCDC and preview block IOCTLs<a class="headerlink" href="#ccdc-and-preview-block-ioctls" title="Permalink to this headline">¶</a></h2>
<p>The VIDIOC_OMAP3ISP_CCDC_CFG and VIDIOC_OMAP3ISP_PRV_CFG IOCTLs are used to
configure, enable and disable functions in the CCDC and preview blocks,
respectively. Both IOCTLs control several functions in the blocks they
control. VIDIOC_OMAP3ISP_CCDC_CFG IOCTL accepts a pointer to struct
omap3isp_ccdc_update_config as its argument. Similarly VIDIOC_OMAP3ISP_PRV_CFG
accepts a pointer to struct omap3isp_prev_update_config. The definition of
both structures is available in <a class="footnote-reference" href="#f1" id="id2">[1]</a>.</p>
<p>The update field in the structures tells whether to update the configuration
for the specific function and the flag tells whether to enable or disable the
function.</p>
<p>The update and flag bit masks accept the following values. Each separate
functions in the CCDC and preview blocks is associated with a flag (either
disable or enable; part of the flag field in the structure) and a pointer to
configuration data for the function.</p>
<p>Valid values for the update and flag fields are listed here for
VIDIOC_OMAP3ISP_CCDC_CFG. Values may be or’ed to configure more than one
function in the same IOCTL call.</p>
<ul class="simple">
<li>OMAP3ISP_CCDC_ALAW</li>
<li>OMAP3ISP_CCDC_LPF</li>
<li>OMAP3ISP_CCDC_BLCLAMP</li>
<li>OMAP3ISP_CCDC_BCOMP</li>
<li>OMAP3ISP_CCDC_FPC</li>
<li>OMAP3ISP_CCDC_CULL</li>
<li>OMAP3ISP_CCDC_CONFIG_LSC</li>
<li>OMAP3ISP_CCDC_TBL_LSC</li>
</ul>
<p>The corresponding values for the VIDIOC_OMAP3ISP_PRV_CFG are here:</p>
<ul class="simple">
<li>OMAP3ISP_PREV_LUMAENH</li>
<li>OMAP3ISP_PREV_INVALAW</li>
<li>OMAP3ISP_PREV_HRZ_MED</li>
<li>OMAP3ISP_PREV_CFA</li>
<li>OMAP3ISP_PREV_CHROMA_SUPP</li>
<li>OMAP3ISP_PREV_WB</li>
<li>OMAP3ISP_PREV_BLKADJ</li>
<li>OMAP3ISP_PREV_RGB2RGB</li>
<li>OMAP3ISP_PREV_COLOR_CONV</li>
<li>OMAP3ISP_PREV_YC_LIMIT</li>
<li>OMAP3ISP_PREV_DEFECT_COR</li>
<li>OMAP3ISP_PREV_GAMMABYPASS</li>
<li>OMAP3ISP_PREV_DRK_FRM_CAPTURE</li>
<li>OMAP3ISP_PREV_DRK_FRM_SUBTRACT</li>
<li>OMAP3ISP_PREV_LENS_SHADING</li>
<li>OMAP3ISP_PREV_NF</li>
<li>OMAP3ISP_PREV_GAMMA</li>
</ul>
<p>The associated configuration pointer for the function may not be NULL when
enabling the function. When disabling a function the configuration pointer is
ignored.</p>
</div>
<div class="section" id="statistic-blocks-ioctls">
<h2>20.7. Statistic blocks IOCTLs<a class="headerlink" href="#statistic-blocks-ioctls" title="Permalink to this headline">¶</a></h2>
<p>The statistics subdevs do offer more dynamic configuration options than the
other subdevs. They can be enabled, disable and reconfigured when the pipeline
is in streaming state.</p>
<p>The statistics blocks always get the input image data from the CCDC (as the
histogram memory read isn’t implemented). The statistics are dequeueable by
the user from the statistics subdev nodes using private IOCTLs.</p>
<p>The private IOCTLs offered by the AEWB, AF and histogram subdevs are heavily
reflected by the register level interface offered by the ISP hardware. There
are aspects that are purely related to the driver implementation and these are
discussed next.</p>
</div>
<div class="section" id="vidioc-omap3isp-stat-en">
<h2>20.8. VIDIOC_OMAP3ISP_STAT_EN<a class="headerlink" href="#vidioc-omap3isp-stat-en" title="Permalink to this headline">¶</a></h2>
<p>This private IOCTL enables/disables a statistic module. If this request is
done before streaming, it will take effect as soon as the pipeline starts to
stream.  If the pipeline is already streaming, it will take effect as soon as
the CCDC becomes idle.</p>
</div>
<div class="section" id="vidioc-omap3isp-aewb-cfg-vidioc-omap3isp-hist-cfg-and-vidioc-omap3isp-af-cfg">
<h2>20.9. VIDIOC_OMAP3ISP_AEWB_CFG, VIDIOC_OMAP3ISP_HIST_CFG and VIDIOC_OMAP3ISP_AF_CFG<a class="headerlink" href="#vidioc-omap3isp-aewb-cfg-vidioc-omap3isp-hist-cfg-and-vidioc-omap3isp-af-cfg" title="Permalink to this headline">¶</a></h2>
<p>Those IOCTLs are used to configure the modules. They require user applications
to have an in-depth knowledge of the hardware. Most of the fields explanation
can be found on OMAP’s TRMs. The two following fields common to all the above
configure private IOCTLs require explanation for better understanding as they
are not part of the TRM.</p>
<p>omap3isp_[h3a_af/h3a_aewb/hist]_config.buf_size:</p>
<p>The modules handle their buffers internally. The necessary buffer size for the
module’s data output depends on the requested configuration. Although the
driver supports reconfiguration while streaming, it does not support a
reconfiguration which requires bigger buffer size than what is already
internally allocated if the module is enabled. It will return -EBUSY on this
case. In order to avoid such condition, either disable/reconfigure/enable the
module or request the necessary buffer size during the first configuration
while the module is disabled.</p>
<p>The internal buffer size allocation considers the requested configuration’s
minimum buffer size and the value set on buf_size field. If buf_size field is
out of [minimum, maximum] buffer size range, it’s clamped to fit in there.
The driver then selects the biggest value. The corrected buf_size value is
written back to user application.</p>
<p>omap3isp_[h3a_af/h3a_aewb/hist]_config.config_counter:</p>
<p>As the configuration doesn’t take effect synchronously to the request, the
driver must provide a way to track this information to provide more accurate
data. After a configuration is requested, the config_counter returned to user
space application will be an unique value associated to that request. When
user application receives an event for buffer availability or when a new
buffer is requested, this config_counter is used to match a buffer data and a
configuration.</p>
</div>
<div class="section" id="vidioc-omap3isp-stat-req">
<h2>20.10. VIDIOC_OMAP3ISP_STAT_REQ<a class="headerlink" href="#vidioc-omap3isp-stat-req" title="Permalink to this headline">¶</a></h2>
<p>Send to user space the oldest data available in the internal buffer queue and
discards such buffer afterwards. The field omap3isp_stat_data.frame_number
matches with the video buffer’s field_count.</p>
</div>
<div class="section" id="technical-reference-manuals-trms-and-other-documentation">
<h2>20.11. Technical reference manuals (TRMs) and other documentation<a class="headerlink" href="#technical-reference-manuals-trms-and-other-documentation" title="Permalink to this headline">¶</a></h2>
<p>OMAP 3430 TRM:
&lt;URL:http://focus.ti.com/pdfs/wtbu/OMAP34xx_ES3.1.x_PUBLIC_TRM_vZM.zip&gt;
Referenced 2011-03-05.</p>
<p>OMAP 35xx TRM:
&lt;URL:http://www.ti.com/litv/pdf/spruf98o&gt; Referenced 2011-03-05.</p>
<p>OMAP 3630 TRM:
&lt;URL:http://focus.ti.com/pdfs/wtbu/OMAP36xx_ES1.x_PUBLIC_TRM_vQ.zip&gt;
Referenced 2011-03-05.</p>
<p>DM 3730 TRM:
&lt;URL:http://www.ti.com/litv/pdf/sprugn4h&gt; Referenced 2011-03-06.</p>
</div>
<div class="section" id="references">
<h2>20.12. References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<table class="docutils footnote" frame="void" id="f1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td>include/linux/omap3isp.h</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[2]</a></td><td><a class="reference external" href="http://git.ideasonboard.org/?p=media-ctl.git;a=summary">http://git.ideasonboard.org/?p=media-ctl.git;a=summary</a></td></tr>
</tbody>
</table>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="omap4_camera.html" class="btn btn-neutral float-right" title="21. OMAP4 ISS Driver" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="meye.html" class="btn btn-neutral float-left" title="19. Vaio Picturebook Motion Eye Camera Driver" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>