

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>How to conserve battery power using laptop-mode &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="LG Gram laptop extra features" href="lg-laptop.html" />
    <link rel="prev" title="Hard disk shock protection" href="disk-shock-protection.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.6.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">The Linux kernel user’s and administrator’s guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../README.html">Linux kernel release 5.x &lt;http://kernel.org/&gt;</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kernel-parameters.html">The kernel’s command-line parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devices.html">Linux allocated devices (4.x+ version)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sysctl/index.html">Documentation for /proc/sys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw-vuln/index.html">Hardware vulnerabilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reporting-bugs.html">Reporting bugs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security-bugs.html">Security bugs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bug-hunting.html">Bug hunting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bug-bisect.html">Bisecting a bug</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tainted-kernels.html">Tainted kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ramoops.html">Ramoops oops/panic logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dynamic-debug-howto.html">Dynamic debug</a></li>
<li class="toctree-l2"><a class="reference internal" href="../init.html">Explaining the dreaded “No init found.” boot hang message</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kdump/index.html">Documentation for Kdump - The kexec-based Crash Dumping Solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../perf/index.html">Performance monitor support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sysfs-rules.html">Rules on how to access information in sysfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../acpi/index.html">ACPI Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../aoe/index.html">ATA over Ethernet (AoE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auxdisplay/index.html">Auxiliary Display Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bcache.html">A block layer cache (bcache)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../binderfs.html">The Android binderfs Filesystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../binfmt-misc.html">Kernel Support for miscellaneous (your favourite) Binary Formats v1.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../blockdev/index.html">The Linux RapidIO Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bootconfig.html">Boot Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../braille-console.html">Linux Braille Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="../btmrvl.html">btmrvl driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cgroup-v1/index.html">Control Groups version 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cgroup-v2.html">Control Group v2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cifs/index.html">CIFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../clearing-warn-once.html">Clearing WARN_ONCE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cpu-load.html">CPU load</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cputopology.html">How CPU topology info is exported via sysfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dell_rbu.html">Dell Remote BIOS Update driver (dell_rbu)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device-mapper/index.html">Device Mapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../efi-stub.html">The EFI Boot Stub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ext4.html">ext4 General Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nfs/index.html">NFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gpio/index.html">gpio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../highuid.html">Notes on the change from 16-bit UIDs to 32-bit UIDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw_random.html">Linux support for random number generator in i8xx chipsets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../initrd.html">Using the initial RAM disk (initrd)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iostats.html">I/O statistics fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../java.html">Java(tm) Binary Kernel Support for Linux v1.03</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jfs.html">IBM’s Journaled File System (JFS) for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kernel-per-CPU-kthreads.html">Reducing OS jitter due to per-cpu kthreads</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Laptop Drivers</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="asus-laptop.html">Asus Laptop Extras</a></li>
<li class="toctree-l3"><a class="reference internal" href="disk-shock-protection.html">Hard disk shock protection</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">How to conserve battery power using laptop-mode</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#caveats">Caveats</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-details">The Details</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tips-tricks">Tips &amp; Tricks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration-file-for-control-and-acpi-battery-scripts">Configuration file for control and ACPI battery scripts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#control-script">Control script</a></li>
<li class="toctree-l4"><a class="reference internal" href="#acpi-integration">ACPI integration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#monitoring-tool">Monitoring tool</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="lg-laptop.html">LG Gram laptop extra features</a></li>
<li class="toctree-l3"><a class="reference internal" href="sony-laptop.html">Sony Notebook Control Driver (SNC) Readme</a></li>
<li class="toctree-l3"><a class="reference internal" href="sonypi.html">Sony Programmable I/O Control Device Driver Readme</a></li>
<li class="toctree-l3"><a class="reference internal" href="thinkpad-acpi.html">ThinkPad ACPI Extras Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="toshiba_haps.html">Toshiba HDD Active Protection Sensor</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../lcd-panel-cgram.html">Parallel port LCD/Keypad Panel support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ldm.html">LDM - Logical Disk Manager (Dynamic Disks)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lockup-watchdogs.html">Softlockup detector and hardlockup detector (aka nmi_watchdog)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../LSM/index.html">Linux Security Module Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../md.html">RAID arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mm/index.html">Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../module-signing.html">Kernel module signing facility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mono.html">Mono(tm) Binary Kernel Support for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../namespaces/index.html">Namespaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../numastat.html">Numa policy hit/miss statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../parport.html">Parport</a></li>
<li class="toctree-l2"><a class="reference internal" href="../perf-security.html">Perf Events and tool security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pm/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pnp.html">Linux Plug and Play Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rapidio.html">RapidIO Subsystem Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ras.html">Reliability, Availability and Serviceability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rtc.html">Real Time Clock (RTC) Drivers for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../serial-console.html">Linux Serial Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="../svga.html">Video Mode Selection Support 2.13</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sysrq.html">Linux Magic System Request Key Hacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../thunderbolt.html">USB4 and Thunderbolt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ufs.html">Using UFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../unicode.html">Unicode support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vga-softcursor.html">Software cursor for VGA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../video-output.html">Video Output Switcher Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wimax/index.html">WiMAX subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../xfs.html">The SGI XFS Filesystem</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../media/index.html">Linux Media Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mic/index.html">Intel Many Integrated Core (MIC) architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scheduler/index.html">Linux Scheduler</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arm/index.html">ARM Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../arm64/index.html">ARM64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ia64/index.html">IA-64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../m68k/index.html">m68k Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mips/index.html">MIPS-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nios2/nios2.html">Linux on the Nios II architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openrisc/index.html">OpenRISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parisc/index.html">PA-RISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../powerpc/index.html">powerpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../riscv/index.html">RISC-V architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../s390/index.html">s390 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sparc/index.html">Sparc Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../x86/index.html">x86-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../xtensa/index.html">Xtensa Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">The Linux kernel user’s and administrator’s guide</a> &raquo;</li>
        
          <li><a href="index.html">Laptop Drivers</a> &raquo;</li>
        
      <li>How to conserve battery power using laptop-mode</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/admin-guide/laptops/laptop-mode.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="how-to-conserve-battery-power-using-laptop-mode">
<h1>How to conserve battery power using laptop-mode<a class="headerlink" href="#how-to-conserve-battery-power-using-laptop-mode" title="Permalink to this headline">¶</a></h1>
<p>Document Author: Bart Samwel (<a class="reference external" href="mailto:bart&#37;&#52;&#48;samwel&#46;tk">bart<span>&#64;</span>samwel<span>&#46;</span>tk</a>)</p>
<p>Date created: January 2, 2004</p>
<p>Last modified: December 06, 2004</p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Laptop mode is used to minimize the time that the hard disk needs to be spun up,
to conserve battery power on laptops. It has been reported to cause significant
power savings.</p>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>To use laptop mode, you don’t need to set any kernel configuration options
or anything. Simply install all the files included in this document, and
laptop mode will automatically be started when you’re on battery. For
your convenience, a tarball containing an installer can be downloaded at:</p>
<blockquote>
<div><a class="reference external" href="http://www.samwel.tk/laptop_mode/laptop_mode/">http://www.samwel.tk/laptop_mode/laptop_mode/</a></div></blockquote>
<p>To configure laptop mode, you need to edit the configuration file, which is
located in /etc/default/laptop-mode on Debian-based systems, or in
/etc/sysconfig/laptop-mode on other systems.</p>
<p>Unfortunately, automatic enabling of laptop mode does not work for
laptops that don’t have ACPI. On those laptops, you need to start laptop
mode manually. To start laptop mode, run “laptop_mode start”, and to
stop it, run “laptop_mode stop”. (Note: The laptop mode tools package now
has experimental support for APM, you might want to try that first.)</p>
</div>
<div class="section" id="caveats">
<h2>Caveats<a class="headerlink" href="#caveats" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>The downside of laptop mode is that you have a chance of losing up to 10
minutes of work. If you cannot afford this, don’t use it! The supplied ACPI
scripts automatically turn off laptop mode when the battery almost runs out,
so that you won’t lose any data at the end of your battery life.</li>
<li>Most desktop hard drives have a very limited lifetime measured in spindown
cycles, typically about 50.000 times (it’s usually listed on the spec sheet).
Check your drive’s rating, and don’t wear down your drive’s lifetime if you
don’t need to.</li>
<li>If you mount some of your ext3/reiserfs filesystems with the -n option, then
the control script will not be able to remount them correctly. You must set
DO_REMOUNTS=0 in the control script, otherwise it will remount them with the
wrong options – or it will fail because it cannot write to /etc/mtab.</li>
<li>If you have your filesystems listed as type “auto” in fstab, like I did, then
the control script will not recognize them as filesystems that need remounting.
You must list the filesystems with their true type instead.</li>
<li>It has been reported that some versions of the mutt mail client use file access
times to determine whether a folder contains new mail. If you use mutt and
experience this, you must disable the noatime remounting by setting the option
DO_REMOUNT_NOATIME to 0 in the configuration file.</li>
</ul>
</div>
<div class="section" id="the-details">
<h2>The Details<a class="headerlink" href="#the-details" title="Permalink to this headline">¶</a></h2>
<p>Laptop mode is controlled by the knob /proc/sys/vm/laptop_mode. This knob is
present for all kernels that have the laptop mode patch, regardless of any
configuration options. When the knob is set, any physical disk I/O (that might
have caused the hard disk to spin up) causes Linux to flush all dirty blocks. The
result of this is that after a disk has spun down, it will not be spun up
anymore to write dirty blocks, because those blocks had already been written
immediately after the most recent read operation. The value of the laptop_mode
knob determines the time between the occurrence of disk I/O and when the flush
is triggered. A sensible value for the knob is 5 seconds. Setting the knob to
0 disables laptop mode.</p>
<p>To increase the effectiveness of the laptop_mode strategy, the laptop_mode
control script increases dirty_expire_centisecs and dirty_writeback_centisecs in
/proc/sys/vm to about 10 minutes (by default), which means that pages that are
dirtied are not forced to be written to disk as often. The control script also
changes the dirty background ratio, so that background writeback of dirty pages
is not done anymore. Combined with a higher commit value (also 10 minutes) for
ext3 or ReiserFS filesystems (also done automatically by the control script),
this results in concentration of disk activity in a small time interval which
occurs only once every 10 minutes, or whenever the disk is forced to spin up by
a cache miss. The disk can then be spun down in the periods of inactivity.</p>
<p>If you want to find out which process caused the disk to spin up, you can
gather information by setting the flag /proc/sys/vm/block_dump. When this flag
is set, Linux reports all disk read and write operations that take place, and
all block dirtyings done to files. This makes it possible to debug why a disk
needs to spin up, and to increase battery life even more. The output of
block_dump is written to the kernel output, and it can be retrieved using
“dmesg”. When you use block_dump and your kernel logging level also includes
kernel debugging messages, you probably want to turn off klogd, otherwise
the output of block_dump will be logged, causing disk activity that is not
normally there.</p>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>The laptop mode configuration file is located in /etc/default/laptop-mode on
Debian-based systems, or in /etc/sysconfig/laptop-mode on other systems. It
contains the following options:</p>
<p>MAX_AGE:</p>
<p>Maximum time, in seconds, of hard drive spindown time that you are
comfortable with. Worst case, it’s possible that you could lose this
amount of work if your battery fails while you’re in laptop mode.</p>
<p>MINIMUM_BATTERY_MINUTES:</p>
<p>Automatically disable laptop mode if the remaining number of minutes of
battery power is less than this value. Default is 10 minutes.</p>
<p>AC_HD/BATT_HD:</p>
<p>The idle timeout that should be set on your hard drive when laptop mode
is active (BATT_HD) and when it is not active (AC_HD). The defaults are
20 seconds (value 4) for BATT_HD  and 2 hours (value 244) for AC_HD. The
possible values are those listed in the manual page for “hdparm” for the
“-S” option.</p>
<p>HD:</p>
<p>The devices for which the spindown timeout should be adjusted by laptop mode.
Default is /dev/hda. If you specify multiple devices, separate them by a space.</p>
<p>READAHEAD:</p>
<p>Disk readahead, in 512-byte sectors, while laptop mode is active. A large
readahead can prevent disk accesses for things like executable pages (which are
loaded on demand while the application executes) and sequentially accessed data
(MP3s).</p>
<p>DO_REMOUNTS:</p>
<p>The control script automatically remounts any mounted journaled filesystems
with appropriate commit interval options. When this option is set to 0, this
feature is disabled.</p>
<p>DO_REMOUNT_NOATIME:</p>
<p>When remounting, should the filesystems be remounted with the noatime option?
Normally, this is set to “1” (enabled), but there may be programs that require
access time recording.</p>
<p>DIRTY_RATIO:</p>
<p>The percentage of memory that is allowed to contain “dirty” or unsaved data
before a writeback is forced, while laptop mode is active. Corresponds to
the /proc/sys/vm/dirty_ratio sysctl.</p>
<p>DIRTY_BACKGROUND_RATIO:</p>
<p>The percentage of memory that is allowed to contain “dirty” or unsaved data
after a forced writeback is done due to an exceeding of DIRTY_RATIO. Set
this nice and low. This corresponds to the /proc/sys/vm/dirty_background_ratio
sysctl.</p>
<p>Note that the behaviour of dirty_background_ratio is quite different
when laptop mode is active and when it isn’t. When laptop mode is inactive,
dirty_background_ratio is the threshold percentage at which background writeouts
start taking place. When laptop mode is active, however, background writeouts
are disabled, and the dirty_background_ratio only determines how much writeback
is done when dirty_ratio is reached.</p>
<p>DO_CPU:</p>
<p>Enable CPU frequency scaling when in laptop mode. (Requires CPUFreq to be setup.
See Documentation/admin-guide/pm/cpufreq.rst for more info. Disabled by default.)</p>
<p>CPU_MAXFREQ:</p>
<p>When on battery, what is the maximum CPU speed that the system should use? Legal
values are “slowest” for the slowest speed that your CPU is able to operate at,
or a value listed in /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_frequencies.</p>
</div>
<div class="section" id="tips-tricks">
<h2>Tips &amp; Tricks<a class="headerlink" href="#tips-tricks" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Bartek Kania reports getting up to 50 minutes of extra battery life (on top
of his regular 3 to 3.5 hours) using a spindown time of 5 seconds (BATT_HD=1).</li>
<li>You can spin down the disk while playing MP3, by setting disk readahead
to 8MB (READAHEAD=16384). Effectively, the disk will read a complete MP3 at
once, and will then spin down while the MP3 is playing. (Thanks to Bartek
Kania.)</li>
<li>Drew Scott Daniels observed: “I don’t know why, but when I decrease the number
of colours that my display uses it consumes less battery power. I’ve seen
this on powerbooks too. I hope that this is a piece of information that
might be useful to the Laptop Mode patch or its users.”</li>
<li>In syslog.conf, you can prefix entries with a dash <cite>-</cite> to omit syncing the
file after every logging. When you’re using laptop-mode and your disk doesn’t
spin down, this is a likely culprit.</li>
<li>Richard Atterer observed that laptop mode does not work well with noflushd
(<a class="reference external" href="http://noflushd.sourceforge.net/">http://noflushd.sourceforge.net/</a>), it seems that noflushd prevents laptop-mode
from doing its thing.</li>
<li>If you’re worried about your data, you might want to consider using a USB
memory stick or something like that as a “working area”. (Be aware though
that flash memory can only handle a limited number of writes, and overuse
may wear out your memory stick pretty quickly. Do _not_ use journalling
filesystems on flash memory sticks.)</li>
</ul>
</div>
<div class="section" id="configuration-file-for-control-and-acpi-battery-scripts">
<h2>Configuration file for control and ACPI battery scripts<a class="headerlink" href="#configuration-file-for-control-and-acpi-battery-scripts" title="Permalink to this headline">¶</a></h2>
<p>This allows the tunables to be changed for the scripts via an external
configuration file</p>
<p>It should be installed as /etc/default/laptop-mode on Debian, and as
/etc/sysconfig/laptop-mode on Red Hat, SUSE, Mandrake, and other work-alikes.</p>
<p>Config file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Maximum time, in seconds, of hard drive spindown time that you are
# comfortable with. Worst case, it&#39;s possible that you could lose this
# amount of work if your battery fails you while in laptop mode.
#MAX_AGE=600

# Automatically disable laptop mode when the number of minutes of battery
# that you have left goes below this threshold.
MINIMUM_BATTERY_MINUTES=10

# Read-ahead, in 512-byte sectors. You can spin down the disk while playing MP3/OGG
# by setting the disk readahead to 8MB (READAHEAD=16384). Effectively, the disk
# will read a complete MP3 at once, and will then spin down while the MP3/OGG is
# playing.
#READAHEAD=4096

# Shall we remount journaled fs. with appropriate commit interval? (1=yes)
#DO_REMOUNTS=1

# And shall we add the &quot;noatime&quot; option to that as well? (1=yes)
#DO_REMOUNT_NOATIME=1

# Dirty synchronous ratio.  At this percentage of dirty pages the process
# which
# calls write() does its own writeback
#DIRTY_RATIO=40

#
# Allowed dirty background ratio, in percent.  Once DIRTY_RATIO has been
# exceeded, the kernel will wake flusher threads which will then reduce the
# amount of dirty memory to dirty_background_ratio.  Set this nice and low,
# so once some writeout has commenced, we do a lot of it.
#
#DIRTY_BACKGROUND_RATIO=5

# kernel default dirty buffer age
#DEF_AGE=30
#DEF_UPDATE=5
#DEF_DIRTY_BACKGROUND_RATIO=10
#DEF_DIRTY_RATIO=40
#DEF_XFS_AGE_BUFFER=15
#DEF_XFS_SYNC_INTERVAL=30
#DEF_XFS_BUFD_INTERVAL=1

# This must be adjusted manually to the value of HZ in the running kernel
# on 2.4, until the XFS people change their 2.4 external interfaces to work in
# centisecs. This can be automated, but it&#39;s a work in progress that still
# needs# some fixes. On 2.6 kernels, XFS uses USER_HZ instead of HZ for
# external interfaces, and that is currently always set to 100. So you don&#39;t
# need to change this on 2.6.
#XFS_HZ=100

# Should the maximum CPU frequency be adjusted down while on battery?
# Requires CPUFreq to be setup.
# See Documentation/admin-guide/pm/cpufreq.rst for more info
#DO_CPU=0

# When on battery what is the maximum CPU speed that the system should
# use? Legal values are &quot;slowest&quot; for the slowest speed that your
# CPU is able to operate at, or a value listed in:
# /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_frequencies
# Only applicable if DO_CPU=1.
#CPU_MAXFREQ=slowest

# Idle timeout for your hard drive (man hdparm for valid values, -S option)
# Default is 2 hours on AC (AC_HD=244) and 20 seconds for battery (BATT_HD=4).
#AC_HD=244
#BATT_HD=4

# The drives for which to adjust the idle timeout. Separate them by a space,
# e.g. HD=&quot;/dev/hda /dev/hdb&quot;.
#HD=&quot;/dev/hda&quot;

# Set the spindown timeout on a hard drive?
#DO_HD=1
</pre></div>
</div>
</div>
<div class="section" id="control-script">
<h2>Control script<a class="headerlink" href="#control-script" title="Permalink to this headline">¶</a></h2>
<p>Please note that this control script works for the Linux 2.4 and 2.6 series (thanks
to Kiko Piris).</p>
<p>Control script:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#!/bin/bash

# start or stop laptop_mode, best run by a power management daemon when
# ac gets connected/disconnected from a laptop
#
# install as /sbin/laptop_mode
#
# Contributors to this script:   Kiko Piris
#                              Bart Samwel
#                              Micha Feigin
#                              Andrew Morton
#                              Herve Eychenne
#                              Dax Kelson
#
# Original Linux 2.4 version by: Jens Axboe

#############################################################################

# Source config
if [ -f /etc/default/laptop-mode ] ; then
      # Debian
      . /etc/default/laptop-mode
elif [ -f /etc/sysconfig/laptop-mode ] ; then
      # Others
        . /etc/sysconfig/laptop-mode
fi

# Don&#39;t raise an error if the config file is incomplete
# set defaults instead:

# Maximum time, in seconds, of hard drive spindown time that you are
# comfortable with. Worst case, it&#39;s possible that you could lose this
# amount of work if your battery fails you while in laptop mode.
MAX_AGE=${MAX_AGE:-&#39;600&#39;}

# Read-ahead, in kilobytes
READAHEAD=${READAHEAD:-&#39;4096&#39;}

# Shall we remount journaled fs. with appropriate commit interval? (1=yes)
DO_REMOUNTS=${DO_REMOUNTS:-&#39;1&#39;}

# And shall we add the &quot;noatime&quot; option to that as well? (1=yes)
DO_REMOUNT_NOATIME=${DO_REMOUNT_NOATIME:-&#39;1&#39;}

# Shall we adjust the idle timeout on a hard drive?
DO_HD=${DO_HD:-&#39;1&#39;}

# Adjust idle timeout on which hard drive?
HD=&quot;${HD:-&#39;/dev/hda&#39;}&quot;

# spindown time for HD (hdparm -S values)
AC_HD=${AC_HD:-&#39;244&#39;}
BATT_HD=${BATT_HD:-&#39;4&#39;}

# Dirty synchronous ratio.  At this percentage of dirty pages the process which
# calls write() does its own writeback
DIRTY_RATIO=${DIRTY_RATIO:-&#39;40&#39;}

# cpu frequency scaling
# See Documentation/admin-guide/pm/cpufreq.rst for more info
DO_CPU=${CPU_MANAGE:-&#39;0&#39;}
CPU_MAXFREQ=${CPU_MAXFREQ:-&#39;slowest&#39;}

#
# Allowed dirty background ratio, in percent.  Once DIRTY_RATIO has been
# exceeded, the kernel will wake flusher threads which will then reduce the
# amount of dirty memory to dirty_background_ratio.  Set this nice and low,
# so once some writeout has commenced, we do a lot of it.
#
DIRTY_BACKGROUND_RATIO=${DIRTY_BACKGROUND_RATIO:-&#39;5&#39;}

# kernel default dirty buffer age
DEF_AGE=${DEF_AGE:-&#39;30&#39;}
DEF_UPDATE=${DEF_UPDATE:-&#39;5&#39;}
DEF_DIRTY_BACKGROUND_RATIO=${DEF_DIRTY_BACKGROUND_RATIO:-&#39;10&#39;}
DEF_DIRTY_RATIO=${DEF_DIRTY_RATIO:-&#39;40&#39;}
DEF_XFS_AGE_BUFFER=${DEF_XFS_AGE_BUFFER:-&#39;15&#39;}
DEF_XFS_SYNC_INTERVAL=${DEF_XFS_SYNC_INTERVAL:-&#39;30&#39;}
DEF_XFS_BUFD_INTERVAL=${DEF_XFS_BUFD_INTERVAL:-&#39;1&#39;}

# This must be adjusted manually to the value of HZ in the running kernel
# on 2.4, until the XFS people change their 2.4 external interfaces to work in
# centisecs. This can be automated, but it&#39;s a work in progress that still needs
# some fixes. On 2.6 kernels, XFS uses USER_HZ instead of HZ for external
# interfaces, and that is currently always set to 100. So you don&#39;t need to
# change this on 2.6.
XFS_HZ=${XFS_HZ:-&#39;100&#39;}

#############################################################################

KLEVEL=&quot;$(uname -r |
             {
             IFS=&#39;.&#39; read a b c
             echo $a.$b
           }
)&quot;
case &quot;$KLEVEL&quot; in
      &quot;2.4&quot;|&quot;2.6&quot;)
              ;;
      *)
              echo &quot;Unhandled kernel version: $KLEVEL (&#39;uname -r&#39; = &#39;$(uname -r)&#39;)&quot; &gt;&amp;2
              exit 1
              ;;
esac

if [ ! -e /proc/sys/vm/laptop_mode ] ; then
      echo &quot;Kernel is not patched with laptop_mode patch.&quot; &gt;&amp;2
      exit 1
fi

if [ ! -w /proc/sys/vm/laptop_mode ] ; then
      echo &quot;You do not have enough privileges to enable laptop_mode.&quot; &gt;&amp;2
      exit 1
fi

# Remove an option (the first parameter) of the form option=&lt;number&gt; from
# a mount options string (the rest of the parameters).
parse_mount_opts () {
      OPT=&quot;$1&quot;
      shift
      echo &quot;,$*,&quot; | sed               \
       -e &#39;s/,&#39;&quot;$OPT&quot;&#39;=[0-9]*,/,/g&#39;   \
       -e &#39;s/,,*/,/g&#39;                 \
       -e &#39;s/^,//&#39;                    \
       -e &#39;s/,$//&#39;
}

# Remove an option (the first parameter) without any arguments from
# a mount option string (the rest of the parameters).
parse_nonumber_mount_opts () {
      OPT=&quot;$1&quot;
      shift
      echo &quot;,$*,&quot; | sed               \
       -e &#39;s/,&#39;&quot;$OPT&quot;&#39;,/,/g&#39;          \
       -e &#39;s/,,*/,/g&#39;                 \
       -e &#39;s/^,//&#39;                    \
       -e &#39;s/,$//&#39;
}

# Find out the state of a yes/no option (e.g. &quot;atime&quot;/&quot;noatime&quot;) in
# fstab for a given filesystem, and use this state to replace the
# value of the option in another mount options string. The device
# is the first argument, the option name the second, and the default
# value the third. The remainder is the mount options string.
#
# Example:
# parse_yesno_opts_wfstab /dev/hda1 atime atime defaults,noatime
#
# If fstab contains, say, &quot;rw&quot; for this filesystem, then the result
# will be &quot;defaults,atime&quot;.
parse_yesno_opts_wfstab () {
      L_DEV=&quot;$1&quot;
      OPT=&quot;$2&quot;
      DEF_OPT=&quot;$3&quot;
      shift 3
      L_OPTS=&quot;$*&quot;
      PARSEDOPTS1=&quot;$(parse_nonumber_mount_opts $OPT $L_OPTS)&quot;
      PARSEDOPTS1=&quot;$(parse_nonumber_mount_opts no$OPT $PARSEDOPTS1)&quot;
      # Watch for a default atime in fstab
      FSTAB_OPTS=&quot;$(awk &#39;$1 == &quot;&#39;$L_DEV&#39;&quot; { print $4 }&#39; /etc/fstab)&quot;
      if echo &quot;$FSTAB_OPTS&quot; | grep &quot;$OPT&quot; &gt; /dev/null ; then
              # option specified in fstab: extract the value and use it
              if echo &quot;$FSTAB_OPTS&quot; | grep &quot;no$OPT&quot; &gt; /dev/null ; then
                      echo &quot;$PARSEDOPTS1,no$OPT&quot;
              else
                      # no$OPT not found -- so we must have $OPT.
                      echo &quot;$PARSEDOPTS1,$OPT&quot;
              fi
      else
              # option not specified in fstab -- choose the default.
              echo &quot;$PARSEDOPTS1,$DEF_OPT&quot;
      fi
}

# Find out the state of a numbered option (e.g. &quot;commit=NNN&quot;) in
# fstab for a given filesystem, and use this state to replace the
# value of the option in another mount options string. The device
# is the first argument, and the option name the second. The
# remainder is the mount options string in which the replacement
# must be done.
#
# Example:
# parse_mount_opts_wfstab /dev/hda1 commit defaults,commit=7
#
# If fstab contains, say, &quot;commit=3,rw&quot; for this filesystem, then the
# result will be &quot;rw,commit=3&quot;.
parse_mount_opts_wfstab () {
      L_DEV=&quot;$1&quot;
      OPT=&quot;$2&quot;
      shift 2
      L_OPTS=&quot;$*&quot;
      PARSEDOPTS1=&quot;$(parse_mount_opts $OPT $L_OPTS)&quot;
      # Watch for a default commit in fstab
      FSTAB_OPTS=&quot;$(awk &#39;$1 == &quot;&#39;$L_DEV&#39;&quot; { print $4 }&#39; /etc/fstab)&quot;
      if echo &quot;$FSTAB_OPTS&quot; | grep &quot;$OPT=&quot; &gt; /dev/null ; then
              # option specified in fstab: extract the value, and use it
              echo -n &quot;$PARSEDOPTS1,$OPT=&quot;
              echo &quot;,$FSTAB_OPTS,&quot; | sed \
               -e &#39;s/.*,&#39;&quot;$OPT&quot;&#39;=//&#39;  \
               -e &#39;s/,.*//&#39;
      else
              # option not specified in fstab: set it to 0
              echo &quot;$PARSEDOPTS1,$OPT=0&quot;
      fi
}

deduce_fstype () {
      MP=&quot;$1&quot;
      # My root filesystem unfortunately has
      # type &quot;unknown&quot; in /etc/mtab. If we encounter
      # &quot;unknown&quot;, we try to get the type from fstab.
      cat /etc/fstab |
      grep -v &#39;^#&#39; |
      while read FSTAB_DEV FSTAB_MP FSTAB_FST FSTAB_OPTS FSTAB_DUMP FSTAB_DUMP ; do
              if [ &quot;$FSTAB_MP&quot; = &quot;$MP&quot; ]; then
                      echo $FSTAB_FST
                      exit 0
              fi
      done
}

if [ $DO_REMOUNT_NOATIME -eq 1 ] ; then
      NOATIME_OPT=&quot;,noatime&quot;
fi

case &quot;$1&quot; in
      start)
              AGE=$((100*$MAX_AGE))
              XFS_AGE=$(($XFS_HZ*$MAX_AGE))
              echo -n &quot;Starting laptop_mode&quot;

              if [ -d /proc/sys/vm/pagebuf ] ; then
                      # (For 2.4 and early 2.6.)
                      # This only needs to be set, not reset -- it is only used when
                      # laptop mode is enabled.
                      echo $XFS_AGE &gt; /proc/sys/vm/pagebuf/lm_flush_age
                      echo $XFS_AGE &gt; /proc/sys/fs/xfs/lm_sync_interval
              elif [ -f /proc/sys/fs/xfs/lm_age_buffer ] ; then
                      # (A couple of early 2.6 laptop mode patches had these.)
                      # The same goes for these.
                      echo $XFS_AGE &gt; /proc/sys/fs/xfs/lm_age_buffer
                      echo $XFS_AGE &gt; /proc/sys/fs/xfs/lm_sync_interval
              elif [ -f /proc/sys/fs/xfs/age_buffer ] ; then
                      # (2.6.6)
                      # But not for these -- they are also used in normal
                      # operation.
                      echo $XFS_AGE &gt; /proc/sys/fs/xfs/age_buffer
                      echo $XFS_AGE &gt; /proc/sys/fs/xfs/sync_interval
              elif [ -f /proc/sys/fs/xfs/age_buffer_centisecs ] ; then
                      # (2.6.7 upwards)
                      # And not for these either. These are in centisecs,
                      # not USER_HZ, so we have to use $AGE, not $XFS_AGE.
                      echo $AGE &gt; /proc/sys/fs/xfs/age_buffer_centisecs
                      echo $AGE &gt; /proc/sys/fs/xfs/xfssyncd_centisecs
                      echo 3000 &gt; /proc/sys/fs/xfs/xfsbufd_centisecs
              fi

              case &quot;$KLEVEL&quot; in
                      &quot;2.4&quot;)
                              echo 1                                  &gt; /proc/sys/vm/laptop_mode
                              echo &quot;30 500 0 0 $AGE $AGE 60 20 0&quot;     &gt; /proc/sys/vm/bdflush
                              ;;
                      &quot;2.6&quot;)
                              echo 5                                  &gt; /proc/sys/vm/laptop_mode
                              echo &quot;$AGE&quot;                             &gt; /proc/sys/vm/dirty_writeback_centisecs
                              echo &quot;$AGE&quot;                             &gt; /proc/sys/vm/dirty_expire_centisecs
                              echo &quot;$DIRTY_RATIO&quot;                     &gt; /proc/sys/vm/dirty_ratio
                              echo &quot;$DIRTY_BACKGROUND_RATIO&quot;          &gt; /proc/sys/vm/dirty_background_ratio
                              ;;
              esac
              if [ $DO_REMOUNTS -eq 1 ]; then
                      cat /etc/mtab | while read DEV MP FST OPTS DUMP PASS ; do
                              PARSEDOPTS=&quot;$(parse_mount_opts &quot;$OPTS&quot;)&quot;
                              if [ &quot;$FST&quot; = &#39;unknown&#39; ]; then
                                      FST=$(deduce_fstype $MP)
                              fi
                              case &quot;$FST&quot; in
                                      &quot;ext3&quot;|&quot;reiserfs&quot;)
                                              PARSEDOPTS=&quot;$(parse_mount_opts commit &quot;$OPTS&quot;)&quot;
                                              mount $DEV -t $FST $MP -o remount,$PARSEDOPTS,commit=$MAX_AGE$NOATIME_OPT
                                              ;;
                                      &quot;xfs&quot;)
                                              mount $DEV -t $FST $MP -o remount,$OPTS$NOATIME_OPT
                                              ;;
                              esac
                              if [ -b $DEV ] ; then
                                      blockdev --setra $(($READAHEAD * 2)) $DEV
                              fi
                      done
              fi
              if [ $DO_HD -eq 1 ] ; then
                      for THISHD in $HD ; do
                              /sbin/hdparm -S $BATT_HD $THISHD &gt; /dev/null 2&gt;&amp;1
                              /sbin/hdparm -B 1 $THISHD &gt; /dev/null 2&gt;&amp;1
                      done
              fi
              if [ $DO_CPU -eq 1 -a -e /sys/devices/system/cpu/cpu0/cpufreq/cpuinfo_min_freq ]; then
                      if [ $CPU_MAXFREQ = &#39;slowest&#39; ]; then
                              CPU_MAXFREQ=`cat /sys/devices/system/cpu/cpu0/cpufreq/cpuinfo_min_freq`
                      fi
                      echo $CPU_MAXFREQ &gt; /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
              fi
              echo &quot;.&quot;
              ;;
      stop)
              U_AGE=$((100*$DEF_UPDATE))
              B_AGE=$((100*$DEF_AGE))
              echo -n &quot;Stopping laptop_mode&quot;
              echo 0 &gt; /proc/sys/vm/laptop_mode
              if [ -f /proc/sys/fs/xfs/age_buffer -a ! -f /proc/sys/fs/xfs/lm_age_buffer ] ; then
                      # These need to be restored, if there are no lm_*.
                      echo $(($XFS_HZ*$DEF_XFS_AGE_BUFFER))           &gt; /proc/sys/fs/xfs/age_buffer
                      echo $(($XFS_HZ*$DEF_XFS_SYNC_INTERVAL))        &gt; /proc/sys/fs/xfs/sync_interval
              elif [ -f /proc/sys/fs/xfs/age_buffer_centisecs ] ; then
                      # These need to be restored as well.
                      echo $((100*$DEF_XFS_AGE_BUFFER))       &gt; /proc/sys/fs/xfs/age_buffer_centisecs
                      echo $((100*$DEF_XFS_SYNC_INTERVAL))    &gt; /proc/sys/fs/xfs/xfssyncd_centisecs
                      echo $((100*$DEF_XFS_BUFD_INTERVAL))    &gt; /proc/sys/fs/xfs/xfsbufd_centisecs
              fi
              case &quot;$KLEVEL&quot; in
                      &quot;2.4&quot;)
                              echo &quot;30 500 0 0 $U_AGE $B_AGE 60 20 0&quot; &gt; /proc/sys/vm/bdflush
                              ;;
                      &quot;2.6&quot;)
                              echo &quot;$U_AGE&quot;                           &gt; /proc/sys/vm/dirty_writeback_centisecs
                              echo &quot;$B_AGE&quot;                           &gt; /proc/sys/vm/dirty_expire_centisecs
                              echo &quot;$DEF_DIRTY_RATIO&quot;                 &gt; /proc/sys/vm/dirty_ratio
                              echo &quot;$DEF_DIRTY_BACKGROUND_RATIO&quot;      &gt; /proc/sys/vm/dirty_background_ratio
                              ;;
              esac
              if [ $DO_REMOUNTS -eq 1 ] ; then
                      cat /etc/mtab | while read DEV MP FST OPTS DUMP PASS ; do
                              # Reset commit and atime options to defaults.
                              if [ &quot;$FST&quot; = &#39;unknown&#39; ]; then
                                      FST=$(deduce_fstype $MP)
                              fi
                              case &quot;$FST&quot; in
                                      &quot;ext3&quot;|&quot;reiserfs&quot;)
                                              PARSEDOPTS=&quot;$(parse_mount_opts_wfstab $DEV commit $OPTS)&quot;
                                              PARSEDOPTS=&quot;$(parse_yesno_opts_wfstab $DEV atime atime $PARSEDOPTS)&quot;
                                              mount $DEV -t $FST $MP -o remount,$PARSEDOPTS
                                              ;;
                                      &quot;xfs&quot;)
                                              PARSEDOPTS=&quot;$(parse_yesno_opts_wfstab $DEV atime atime $OPTS)&quot;
                                              mount $DEV -t $FST $MP -o remount,$PARSEDOPTS
                                              ;;
                              esac
                              if [ -b $DEV ] ; then
                                      blockdev --setra 256 $DEV
                              fi
                      done
              fi
              if [ $DO_HD -eq 1 ] ; then
                      for THISHD in $HD ; do
                              /sbin/hdparm -S $AC_HD $THISHD &gt; /dev/null 2&gt;&amp;1
                              /sbin/hdparm -B 255 $THISHD &gt; /dev/null 2&gt;&amp;1
                      done
              fi
              if [ $DO_CPU -eq 1 -a -e /sys/devices/system/cpu/cpu0/cpufreq/cpuinfo_min_freq ]; then
                      echo `cat /sys/devices/system/cpu/cpu0/cpufreq/cpuinfo_max_freq` &gt; /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
              fi
              echo &quot;.&quot;
              ;;
      *)
              echo &quot;Usage: $0 {start|stop}&quot; 2&gt;&amp;1
              exit 1
              ;;

esac

exit 0
</pre></div>
</div>
</div>
<div class="section" id="acpi-integration">
<h2>ACPI integration<a class="headerlink" href="#acpi-integration" title="Permalink to this headline">¶</a></h2>
<p>Dax Kelson submitted this so that the ACPI acpid daemon will
kick off the laptop_mode script and run hdparm. The part that
automatically disables laptop mode when the battery is low was
written by Jan Topinski.</p>
<p>/etc/acpi/events/ac_adapter:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>event=ac_adapter
action=/etc/acpi/actions/ac.sh %e
</pre></div>
</div>
<p>/etc/acpi/events/battery:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>event=battery.*
action=/etc/acpi/actions/battery.sh %e
</pre></div>
</div>
<p>/etc/acpi/actions/ac.sh:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#!/bin/bash

# ac on/offline event handler

status=`awk &#39;/^state: / { print $2 }&#39; /proc/acpi/ac_adapter/$2/state`

case $status in
        &quot;on-line&quot;)
                /sbin/laptop_mode stop
                exit 0
        ;;
        &quot;off-line&quot;)
                /sbin/laptop_mode start
                exit 0
        ;;
esac
</pre></div>
</div>
<p>/etc/acpi/actions/battery.sh:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#! /bin/bash

# Automatically disable laptop mode when the battery almost runs out.

BATT_INFO=/proc/acpi/battery/$2/state

if [[ -f /proc/sys/vm/laptop_mode ]]
then
   LM=`cat /proc/sys/vm/laptop_mode`
   if [[ $LM -gt 0 ]]
   then
     if [[ -f $BATT_INFO ]]
     then
        # Source the config file only now that we know we need
        if [ -f /etc/default/laptop-mode ] ; then
                # Debian
                . /etc/default/laptop-mode
        elif [ -f /etc/sysconfig/laptop-mode ] ; then
                # Others
                . /etc/sysconfig/laptop-mode
        fi
        MINIMUM_BATTERY_MINUTES=${MINIMUM_BATTERY_MINUTES:-&#39;10&#39;}

        ACTION=&quot;`cat $BATT_INFO | grep charging | cut -c 26-`&quot;
        if [[ ACTION -eq &quot;discharging&quot; ]]
        then
           PRESENT_RATE=`cat $BATT_INFO | grep &quot;present rate:&quot; | sed  &quot;s/.* \([0-9][0-9]* \).*/\1/&quot; `
           REMAINING=`cat $BATT_INFO | grep &quot;remaining capacity:&quot; | sed  &quot;s/.* \([0-9][0-9]* \).*/\1/&quot; `
        fi
        if (($REMAINING * 60 / $PRESENT_RATE &lt; $MINIMUM_BATTERY_MINUTES))
        then
           /sbin/laptop_mode stop
        fi
     else
       logger -p daemon.warning &quot;You are using laptop mode and your battery interface $BATT_INFO is missing. This may lead to loss of data when the battery runs out. Check kernel ACPI support and /proc/acpi/battery folder, and edit /etc/acpi/battery.sh to set BATT_INFO to the correct path.&quot;
     fi
   fi
fi
</pre></div>
</div>
</div>
<div class="section" id="monitoring-tool">
<h2>Monitoring tool<a class="headerlink" href="#monitoring-tool" title="Permalink to this headline">¶</a></h2>
<p>Bartek Kania submitted this, it can be used to measure how much time your disk
spends spun up/down.  See tools/laptop/dslm/dslm.c</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="lg-laptop.html" class="btn btn-neutral float-right" title="LG Gram laptop extra features" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="disk-shock-protection.html" class="btn btn-neutral float-left" title="Hard disk shock protection" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>