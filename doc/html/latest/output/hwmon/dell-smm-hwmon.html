

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Kernel driver dell-smm-hwmon &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.6.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/mm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Kernel driver dell-smm-hwmon</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/hwmon/dell-smm-hwmon.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="kernel-driver-dell-smm-hwmon">
<h1>Kernel driver dell-smm-hwmon<a class="headerlink" href="#kernel-driver-dell-smm-hwmon" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Copyright:</th><td class="field-body">© 2002-2005 Massimo Dal Zotto &lt;<a class="reference external" href="mailto:dz&#37;&#52;&#48;debian&#46;org">dz<span>&#64;</span>debian<span>&#46;</span>org</a>&gt;</td>
</tr>
<tr class="field-even field"><th class="field-name">Copyright:</th><td class="field-body">© 2019 Giovanni Mascellani &lt;<a class="reference external" href="mailto:gio&#37;&#52;&#48;debian&#46;org">gio<span>&#64;</span>debian<span>&#46;</span>org</a>&gt;</td>
</tr>
</tbody>
</table>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>On many Dell laptops the System Management Mode (SMM) BIOS can be
queried for the status of fans and temperature sensors.  Userspace
utilities like <code class="docutils literal notranslate"><span class="pre">sensors</span></code> can be used to return the readings. The
userspace suite <a class="reference external" href="https://github.com/vitorafsr/i8kutils">i8kutils</a> can also be used to read the sensors and
automatically adjust fan speed (please notice that it currently uses
the deprecated <code class="docutils literal notranslate"><span class="pre">/proc/i8k</span></code> interface).</p>
<blockquote>
<div></div></blockquote>
</div>
<div class="section" id="sysfs-interface">
<h2><code class="docutils literal notranslate"><span class="pre">sysfs</span></code> interface<a class="headerlink" href="#sysfs-interface" title="Permalink to this headline">¶</a></h2>
<p>Temperature sensors and fans can be queried and set via the standard
<code class="docutils literal notranslate"><span class="pre">hwmon</span></code> interface on <code class="docutils literal notranslate"><span class="pre">sysfs</span></code>, under the directory
<code class="docutils literal notranslate"><span class="pre">/sys/class/hwmon/hwmonX</span></code> for some value of <code class="docutils literal notranslate"><span class="pre">X</span></code> (search for the
<code class="docutils literal notranslate"><span class="pre">X</span></code> such that <code class="docutils literal notranslate"><span class="pre">/sys/class/hwmon/hwmonX/name</span></code> has content
<code class="docutils literal notranslate"><span class="pre">dell_smm</span></code>). A number of other attributes can be read or written:</p>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="9%" />
<col width="51%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Perm</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>fan[1-3]_input</td>
<td>RO</td>
<td>Fan speed in RPM.</td>
</tr>
<tr class="row-odd"><td>fan[1-3]_label</td>
<td>RO</td>
<td>Fan label.</td>
</tr>
<tr class="row-even"><td>pwm[1-3]</td>
<td>RW</td>
<td>Control the fan PWM duty-cycle.</td>
</tr>
<tr class="row-odd"><td>pwm1_enable</td>
<td>WO</td>
<td>Enable or disable automatic BIOS fan
control (not supported on all laptops,
see below for details).</td>
</tr>
<tr class="row-even"><td>temp[1-10]_input</td>
<td>RO</td>
<td>Temperature reading in milli-degrees
Celsius.</td>
</tr>
<tr class="row-odd"><td>temp[1-10]_label</td>
<td>RO</td>
<td>Temperature sensor label.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="disabling-automatic-bios-fan-control">
<h2>Disabling automatic BIOS fan control<a class="headerlink" href="#disabling-automatic-bios-fan-control" title="Permalink to this headline">¶</a></h2>
<p>On some laptops the BIOS automatically sets fan speed every few
seconds. Therefore the fan speed set by mean of this driver is quickly
overwritten.</p>
<p>There is experimental support for disabling automatic BIOS fan
control, at least on laptops where the corresponding SMM command is
known, by writing the value <code class="docutils literal notranslate"><span class="pre">1</span></code> in the attribute <code class="docutils literal notranslate"><span class="pre">pwm1_enable</span></code>
(writing <code class="docutils literal notranslate"><span class="pre">2</span></code> enables automatic BIOS control again). Even if you have
more than one fan, all of them are set to either enabled or disabled
automatic fan control at the same time and, notwithstanding the name,
<code class="docutils literal notranslate"><span class="pre">pwm1_enable</span></code> sets automatic control for all fans.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">pwm1_enable</span></code> is not available, then it means that SMM codes for
enabling and disabling automatic BIOS fan control are not whitelisted
for your hardware. It is possible that codes that work for other
laptops actually work for yours as well, or that you have to discover
new codes.</p>
<p>Check the list <code class="docutils literal notranslate"><span class="pre">i8k_whitelist_fan_control</span></code> in file
<code class="docutils literal notranslate"><span class="pre">drivers/hwmon/dell-smm-hwmon.c</span></code> in the kernel tree: as a first
attempt you can try to add your machine and use an already-known code
pair. If, after recompiling the kernel, you see that <code class="docutils literal notranslate"><span class="pre">pwm1_enable</span></code>
is present and works (i.e., you can manually control the fan speed),
then please submit your finding as a kernel patch, so that other users
can benefit from it. Please see
<a class="reference internal" href="../process/submitting-patches.html#submittingpatches"><span class="std std-ref">Documentation/process/submitting-patches.rst</span></a>
for information on submitting patches.</p>
<p>If no known code works on your machine, you need to resort to do some
probing, because unfortunately Dell does not publish datasheets for
its SMM. You can experiment with the code in <a class="reference external" href="https://github.com/clopez/dellfan/">this repository</a> to
probe the BIOS on your machine and discover the appropriate codes.</p>
<blockquote>
<div></div></blockquote>
<p>Again, when you find new codes, we’d be happy to have your patches!</p>
</div>
<div class="section" id="module-parameters">
<h2>Module parameters<a class="headerlink" href="#module-parameters" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><dl class="first docutils">
<dt>force:bool</dt>
<dd>Force loading without checking for supported
models. (default: 0)</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>ignore_dmi:bool</dt>
<dd>Continue probing hardware even if DMI data does not
match. (default: 0)</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>restricted:bool</dt>
<dd>Allow fan control only to processes with the
<code class="docutils literal notranslate"><span class="pre">CAP_SYS_ADMIN</span></code> capability set or processes run
as root when using the legacy <code class="docutils literal notranslate"><span class="pre">/proc/i8k</span></code>
interface. In this case normal users will be able
to read temperature and fan status but not to
control the fan.  If your notebook is shared with
other users and you don’t trust them you may want
to use this option. (default: 1, only available
with <code class="docutils literal notranslate"><span class="pre">CONFIG_I8K</span></code>)</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>power_status:bool</dt>
<dd>Report AC status in <code class="docutils literal notranslate"><span class="pre">/proc/i8k</span></code>. (default: 0,
only available with <code class="docutils literal notranslate"><span class="pre">CONFIG_I8K</span></code>)</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>fan_mult:uint</dt>
<dd>Factor to multiply fan speed with. (default:
autodetect)</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>fan_max:uint</dt>
<dd>Maximum configurable fan speed. (default:
autodetect)</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="legacy-proc-interface">
<h2>Legacy <code class="docutils literal notranslate"><span class="pre">/proc</span></code> interface<a class="headerlink" href="#legacy-proc-interface" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This interface is obsolete and deprecated and should not
used in new applications. This interface is only
available when kernel is compiled with option
<code class="docutils literal notranslate"><span class="pre">CONFIG_I8K</span></code>.</p>
</div>
<p>The information provided by the kernel driver can be accessed by
simply reading the <code class="docutils literal notranslate"><span class="pre">/proc/i8k</span></code> file. For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cat /proc/i8k
1.0 A17 2J59L02 52 2 1 8040 6420 1 2
</pre></div>
</div>
<p>The fields read from <code class="docutils literal notranslate"><span class="pre">/proc/i8k</span></code> are:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1.0 A17 2J59L02 52 2 1 8040 6420 1 2
|   |   |       |  | | |    |    | |
|   |   |       |  | | |    |    | +------- 10. buttons status
|   |   |       |  | | |    |    +--------- 9.  AC status
|   |   |       |  | | |    +-------------- 8.  fan0 RPM
|   |   |       |  | | +------------------- 7.  fan1 RPM
|   |   |       |  | +--------------------- 6.  fan0 status
|   |   |       |  +----------------------- 5.  fan1 status
|   |   |       +-------------------------- 4.  temp0 reading (Celsius)
|   |   +---------------------------------- 3.  Dell service tag (later known as &#39;serial number&#39;)
|   +-------------------------------------- 2.  BIOS version
+------------------------------------------ 1.  /proc/i8k format version
</pre></div>
</div>
<p>A negative value, for example -22, indicates that the BIOS doesn’t
return the corresponding information. This is normal on some
models/BIOSes.</p>
<p>For performance reasons the <code class="docutils literal notranslate"><span class="pre">/proc/i8k</span></code> doesn’t report by default
the AC status since this SMM call takes a long time to execute and is
not really needed.  If you want to see the ac status in <code class="docutils literal notranslate"><span class="pre">/proc/i8k</span></code>
you must explictitly enable this option by passing the
<code class="docutils literal notranslate"><span class="pre">power_status=1</span></code> parameter to insmod. If AC status is not
available -1 is printed instead.</p>
<p>The driver provides also an ioctl interface which can be used to
obtain the same information and to control the fan status. The ioctl
interface can be accessed from C programs or from shell using the
i8kctl utility. See the source file of <code class="docutils literal notranslate"><span class="pre">i8kutils</span></code> for more
information on how to use the ioctl interface.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>