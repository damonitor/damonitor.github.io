

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Mechanisms &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Evaluation" href="eval.html" />
    <link rel="prev" title="Frequently Asked Questions" href="faq.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">DAMON: Data Access MONitor</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="start.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide.html">The Beginner’s Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage.html">Detailed Usages</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html">API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Mechanisms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basic-access-check">Basic Access Check</a></li>
<li class="toctree-l3"><a class="reference internal" href="#region-based-sampling">Region Based Sampling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adaptive-regions-adjustment">Adaptive Regions Adjustment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#handling-virtual-memory-mappings">Handling Virtual Memory Mappings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="eval.html">Evaluation</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">DAMON: Data Access MONitor</a> &raquo;</li>
        
      <li>Mechanisms</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/admin-guide/mm/damon/mechanisms.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="mechanisms">
<h1>Mechanisms<a class="headerlink" href="#mechanisms" title="Permalink to this headline">¶</a></h1>
<p>This document describes the core mechanisms of DAMON and the five knobs for
tuning, that is, <code class="docutils literal notranslate"><span class="pre">sampling</span> <span class="pre">interval</span></code>, <code class="docutils literal notranslate"><span class="pre">aggregation</span> <span class="pre">interval</span></code>, <code class="docutils literal notranslate"><span class="pre">regions</span>
<span class="pre">update</span> <span class="pre">interval</span></code>, <code class="docutils literal notranslate"><span class="pre">minimum</span> <span class="pre">number</span> <span class="pre">of</span> <span class="pre">regions</span></code>, and <code class="docutils literal notranslate"><span class="pre">maximum</span> <span class="pre">number</span> <span class="pre">of</span>
<span class="pre">regions</span></code>.</p>
<div class="section" id="basic-access-check">
<h2>Basic Access Check<a class="headerlink" href="#basic-access-check" title="Permalink to this headline">¶</a></h2>
<p>The output of DAMON says what pages are how frequently accessed for a given
duration.  The resolution of the access frequency is controlled by setting
<code class="docutils literal notranslate"><span class="pre">sampling</span> <span class="pre">interval</span></code> and <code class="docutils literal notranslate"><span class="pre">aggregation</span> <span class="pre">interval</span></code>.  In detail,
DAMON checks access to each page per <code class="docutils literal notranslate"><span class="pre">sampling</span> <span class="pre">interval</span></code>, aggregates the
results.  In other words, counts the number of the accesses to each page.
After each <code class="docutils literal notranslate"><span class="pre">aggregation</span> <span class="pre">interval</span></code> passes, DAMON signals users to read and
save the aggregated access frequency if they want and then clears those.  For
the access check of each page, DAMON uses the Accessed bits of PTEs.  This can
be described in below simple pseudo-code:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>while monitoring_on:
    for page in monitoring_target:
        if accessed(page):
            nr_accesses[page] += 1
    if time() % aggregation_interval == 0:
        for page in monitoring_target:
            nr_accesses[page] = 0
    sleep(sampling interval)
</pre></div>
</div>
<p>The monitoring overhead of this mechanism will arbitrarily increase as the
size of the target workload grows.</p>
</div>
<div class="section" id="region-based-sampling">
<h2>Region Based Sampling<a class="headerlink" href="#region-based-sampling" title="Permalink to this headline">¶</a></h2>
<p>To avoid the unbounded increase of the overhead, DAMON groups adjacent pages
that assumed to have the same access frequencies into a region.  As long as the
assumption (pages in a region have the same access frequencies) is kept, only
one page in the region is required to be checked.  Thus, for each <code class="docutils literal notranslate"><span class="pre">sampling</span>
<span class="pre">interval</span></code>, DAMON randomly picks one page in each region, waits for one
<code class="docutils literal notranslate"><span class="pre">sampling</span> <span class="pre">interval</span></code>, checks whether the page is accessed meanwhile, and
increases the access frequency of the region if so.  Therefore, the monitoring
overhead is controllable by setting the number of regions.  DAMON allows users
to set the minimum and the maximum number of regions for the trade-off.</p>
<p>This scheme, however, cannot preserve the quality of the output if the
assumption is not guaranteed.</p>
</div>
<div class="section" id="adaptive-regions-adjustment">
<h2>Adaptive Regions Adjustment<a class="headerlink" href="#adaptive-regions-adjustment" title="Permalink to this headline">¶</a></h2>
<p>At the beginning of the monitoring, DAMON constructs the initial regions by
evenly splitting the monitoring target memory region into the user-specified
minimum number of regions.  In this initial state, the assumption is normally
not kept and therefore the quality would be low.  To keep the assumption as
much as possible, DAMON adaptively merges and splits each region based on their
access frequency.</p>
<p>For each <code class="docutils literal notranslate"><span class="pre">aggregation</span> <span class="pre">interval</span></code>, it compares the access frequencies of
adjacent regions and merges those if the frequency difference is small.  Then,
after it reports and clears the aggregated access frequency of each region, it
splits each region into two or three regions if the total number of regions
will not exceed the user-specified maximum number of regions after the split.</p>
<p>In this way, DAMON provides its best-effort quality and minimal overhead while
keeping the bounds users set for their trade-off.</p>
</div>
<div class="section" id="handling-virtual-memory-mappings">
<h2>Handling Virtual Memory Mappings<a class="headerlink" href="#handling-virtual-memory-mappings" title="Permalink to this headline">¶</a></h2>
<p>This is for monitoring of virtual memory address space only.</p>
<p>Only small parts in the super-huge virtual address space of the processes are
mapped to physical memory and accessed.  Thus, tracking the unmapped address
regions is just wasteful.  However, because DAMON can deal with some level of
noise using the adaptive regions adjustment mechanism, tracking every mapping
is not strictly required but could even incur a high overhead in some cases.
That said, too huge unmapped areas inside the monitoring target should be
removed to not take the time for the adaptive mechanism.</p>
<p>For the reason, DAMON converts the complex mappings to three distinct regions
that cover every mapped area of the address space.  Also, the two gaps between
the three regions are the two biggest unmapped areas in the given address
space.  The two biggest unmapped areas might be the gap between the heap and
the uppermost mmap()-ed region, and the gap between the lowermost mmap()-ed
region and the stack will be two biggest unmapped regions.  Because these gaps
are exceptionally huge areas in usual address space, excluding these two
biggest unmapped regions will be sufficient to make a trade-off.  Below shows
this in detail:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;heap&gt;
&lt;BIG UNMAPPED REGION 1&gt;
&lt;uppermost mmap()-ed region&gt;
(small mmap()-ed regions and munmap()-ed regions)
&lt;lowermost mmap()-ed region&gt;
&lt;BIG UNMAPPED REGION 2&gt;
&lt;stack&gt;
</pre></div>
</div>
<p>To further minimize dynamic mapping changes applying overhead, DAMON checks the
dynamic memory mapping changes and applies it to the abstracted target area
only for each of a user-specified time interval (<code class="docutils literal notranslate"><span class="pre">regions</span> <span class="pre">update</span> <span class="pre">interval</span></code>).</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="eval.html" class="btn btn-neutral float-right" title="Evaluation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="faq.html" class="btn btn-neutral float-left" title="Frequently Asked Questions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>