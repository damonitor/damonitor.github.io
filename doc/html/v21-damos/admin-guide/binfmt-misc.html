

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Kernel Support for miscellaneous Binary Formats (binfmt_misc) &mdash; The Linux Kernel  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The Linux RapidIO Subsystem" href="blockdev/index.html" />
    <link rel="prev" title="The Android binderfs Filesystem" href="binderfs.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.8.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">The Linux kernel user’s and administrator’s guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="README.html">Linux kernel release 5.x &lt;http://kernel.org/&gt;</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel-parameters.html">The kernel’s command-line parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="devices.html">Linux allocated devices (4.x+ version)</a></li>
<li class="toctree-l2"><a class="reference internal" href="sysctl/index.html">Documentation for /proc/sys</a></li>
<li class="toctree-l2"><a class="reference internal" href="hw-vuln/index.html">Hardware vulnerabilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="reporting-bugs.html">Reporting bugs</a></li>
<li class="toctree-l2"><a class="reference internal" href="security-bugs.html">Security bugs</a></li>
<li class="toctree-l2"><a class="reference internal" href="bug-hunting.html">Bug hunting</a></li>
<li class="toctree-l2"><a class="reference internal" href="bug-bisect.html">Bisecting a bug</a></li>
<li class="toctree-l2"><a class="reference internal" href="tainted-kernels.html">Tainted kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="ramoops.html">Ramoops oops/panic logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="dynamic-debug-howto.html">Dynamic debug</a></li>
<li class="toctree-l2"><a class="reference internal" href="init.html">Explaining the “No working init found.” boot hang message</a></li>
<li class="toctree-l2"><a class="reference internal" href="kdump/index.html">Documentation for Kdump - The kexec-based Crash Dumping Solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="perf/index.html">Performance monitor support</a></li>
<li class="toctree-l2"><a class="reference internal" href="sysfs-rules.html">Rules on how to access information in sysfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="acpi/index.html">ACPI Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="aoe/index.html">ATA over Ethernet (AoE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="auxdisplay/index.html">Auxiliary Display Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="bcache.html">A block layer cache (bcache)</a></li>
<li class="toctree-l2"><a class="reference internal" href="binderfs.html">The Android binderfs Filesystem</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Kernel Support for miscellaneous Binary Formats (binfmt_misc)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hints">Hints</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="blockdev/index.html">The Linux RapidIO Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="bootconfig.html">Boot Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="braille-console.html">Linux Braille Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="btmrvl.html">btmrvl driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="cgroup-v1/index.html">Control Groups version 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="cgroup-v2.html">Control Group v2</a></li>
<li class="toctree-l2"><a class="reference internal" href="cifs/index.html">CIFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="clearing-warn-once.html">Clearing WARN_ONCE</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpu-load.html">CPU load</a></li>
<li class="toctree-l2"><a class="reference internal" href="cputopology.html">How CPU topology info is exported via sysfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="dell_rbu.html">Dell Remote BIOS Update driver (dell_rbu)</a></li>
<li class="toctree-l2"><a class="reference internal" href="device-mapper/index.html">Device Mapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="edid.html">EDID</a></li>
<li class="toctree-l2"><a class="reference internal" href="efi-stub.html">The EFI Boot Stub</a></li>
<li class="toctree-l2"><a class="reference internal" href="ext4.html">ext4 General Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="nfs/index.html">NFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpio/index.html">gpio</a></li>
<li class="toctree-l2"><a class="reference internal" href="highuid.html">Notes on the change from 16-bit UIDs to 32-bit UIDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="hw_random.html">Linux support for random number generator in i8xx chipsets</a></li>
<li class="toctree-l2"><a class="reference internal" href="initrd.html">Using the initial RAM disk (initrd)</a></li>
<li class="toctree-l2"><a class="reference internal" href="iostats.html">I/O statistics fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="java.html">Java(tm) Binary Kernel Support for Linux v1.03</a></li>
<li class="toctree-l2"><a class="reference internal" href="jfs.html">IBM’s Journaled File System (JFS) for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel-per-CPU-kthreads.html">Reducing OS jitter due to per-cpu kthreads</a></li>
<li class="toctree-l2"><a class="reference internal" href="laptops/index.html">Laptop Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="lcd-panel-cgram.html">Parallel port LCD/Keypad Panel support</a></li>
<li class="toctree-l2"><a class="reference internal" href="ldm.html">LDM - Logical Disk Manager (Dynamic Disks)</a></li>
<li class="toctree-l2"><a class="reference internal" href="lockup-watchdogs.html">Softlockup detector and hardlockup detector (aka nmi_watchdog)</a></li>
<li class="toctree-l2"><a class="reference internal" href="LSM/index.html">Linux Security Module Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="md.html">RAID arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="media/index.html">Media subsystem admin and user guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="mm/index.html">Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="module-signing.html">Kernel module signing facility</a></li>
<li class="toctree-l2"><a class="reference internal" href="mono.html">Mono(tm) Binary Kernel Support for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="namespaces/index.html">Namespaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="numastat.html">Numa policy hit/miss statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="parport.html">Parport</a></li>
<li class="toctree-l2"><a class="reference internal" href="perf-security.html">Perf events and tool security</a></li>
<li class="toctree-l2"><a class="reference internal" href="pm/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="pnp.html">Linux Plug and Play Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="rapidio.html">RapidIO Subsystem Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="ras.html">Reliability, Availability and Serviceability</a></li>
<li class="toctree-l2"><a class="reference internal" href="rtc.html">Real Time Clock (RTC) Drivers for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="serial-console.html">Linux Serial Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="svga.html">Video Mode Selection Support 2.13</a></li>
<li class="toctree-l2"><a class="reference internal" href="sysrq.html">Linux Magic System Request Key Hacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="thunderbolt.html">USB4 and Thunderbolt</a></li>
<li class="toctree-l2"><a class="reference internal" href="ufs.html">Using UFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="unicode.html">Unicode support</a></li>
<li class="toctree-l2"><a class="reference internal" href="vga-softcursor.html">Software cursor for VGA</a></li>
<li class="toctree-l2"><a class="reference internal" href="video-output.html">Video Output Switcher Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="wimax/index.html">WiMAX subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="xfs.html">The SGI XFS Filesystem</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Open Firmware and Device Tree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mhi/index.html">MHI</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arm/index.html">ARM Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arm64/index.html">ARM64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ia64/index.html">IA-64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m68k/index.html">m68k Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mips/index.html">MIPS-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nios2/nios2.html">Linux on the Nios II architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../openrisc/index.html">OpenRISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parisc/index.html">PA-RISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../powerpc/index.html">powerpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../riscv/index.html">RISC-V architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../s390/index.html">s390 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sparc/index.html">Sparc Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../x86/index.html">x86-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xtensa/index.html">Xtensa Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">The Linux kernel user’s and administrator’s guide</a> &raquo;</li>
        
      <li>Kernel Support for miscellaneous Binary Formats (binfmt_misc)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/admin-guide/binfmt-misc.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="kernel-support-for-miscellaneous-binary-formats-binfmt-misc">
<h1>Kernel Support for miscellaneous Binary Formats (binfmt_misc)<a class="headerlink" href="#kernel-support-for-miscellaneous-binary-formats-binfmt-misc" title="Permalink to this headline">¶</a></h1>
<p>This Kernel feature allows you to invoke almost (for restrictions see below)
every program by simply typing its name in the shell.
This includes for example compiled Java(TM), Python or Emacs programs.</p>
<p>To achieve this you must tell binfmt_misc which interpreter has to be invoked
with which binary. Binfmt_misc recognises the binary-type by matching some bytes
at the beginning of the file with a magic byte sequence (masking out specified
bits) you have supplied. Binfmt_misc can also recognise a filename extension
aka <code class="docutils literal notranslate"><span class="pre">.com</span></code> or <code class="docutils literal notranslate"><span class="pre">.exe</span></code>.</p>
<p>First you must mount binfmt_misc:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>mount binfmt_misc -t binfmt_misc /proc/sys/fs/binfmt_misc
</pre></div>
</div>
<p>To actually register a new binary type, you have to set up a string looking like
<code class="docutils literal notranslate"><span class="pre">:name:type:offset:magic:mask:interpreter:flags</span></code> (where you can choose the
<code class="docutils literal notranslate"><span class="pre">:</span></code> upon your needs) and echo it to <code class="docutils literal notranslate"><span class="pre">/proc/sys/fs/binfmt_misc/register</span></code>.</p>
<p>Here is what the fields mean:</p>
<ul>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt><dd><p>is an identifier string. A new /proc file will be created with this
<code class="docutils literal notranslate"><span class="pre">name</span> <span class="pre">below</span> <span class="pre">/proc/sys/fs/binfmt_misc</span></code>; cannot contain slashes <code class="docutils literal notranslate"><span class="pre">/</span></code> for
obvious reasons.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">type</span></code></dt><dd><p>is the type of recognition. Give <code class="docutils literal notranslate"><span class="pre">M</span></code> for magic and <code class="docutils literal notranslate"><span class="pre">E</span></code> for extension.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">offset</span></code></dt><dd><p>is the offset of the magic/mask in the file, counted in bytes. This
defaults to 0 if you omit it (i.e. you write <code class="docutils literal notranslate"><span class="pre">:name:type::magic...</span></code>).
Ignored when using filename extension matching.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">magic</span></code></dt><dd><p>is the byte sequence binfmt_misc is matching for. The magic string
may contain hex-encoded characters like <code class="docutils literal notranslate"><span class="pre">\x0a</span></code> or <code class="docutils literal notranslate"><span class="pre">\xA4</span></code>. Note that you
must escape any NUL bytes; parsing halts at the first one. In a shell
environment you might have to write <code class="docutils literal notranslate"><span class="pre">\\x0a</span></code> to prevent the shell from
eating your <code class="docutils literal notranslate"><span class="pre">\</span></code>.
If you chose filename extension matching, this is the extension to be
recognised (without the <code class="docutils literal notranslate"><span class="pre">.</span></code>, the <code class="docutils literal notranslate"><span class="pre">\x0a</span></code> specials are not allowed).
Extension    matching is case sensitive, and slashes <code class="docutils literal notranslate"><span class="pre">/</span></code> are not allowed!</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">mask</span></code></dt><dd><p>is an (optional, defaults to all 0xff) mask. You can mask out some
bits from matching by supplying a string like magic and as long as magic.
The mask is anded with the byte sequence of the file. Note that you must
escape any NUL bytes; parsing halts at the first one. Ignored when using
filename extension matching.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">interpreter</span></code></dt><dd><p>is the program that should be invoked with the binary as first
argument (specify the full path)</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">flags</span></code></dt><dd><p>is an optional field that controls several aspects of the invocation
of the interpreter. It is a string of capital letters, each controls a
certain aspect. The following flags are supported:</p>
<blockquote>
<div><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">P</span></code> - preserve-argv[0]</dt><dd><p>Legacy behavior of binfmt_misc is to overwrite
the original argv[0] with the full path to the binary. When this
flag is included, binfmt_misc will add an argument to the argument
vector for this purpose, thus preserving the original <code class="docutils literal notranslate"><span class="pre">argv[0]</span></code>.
e.g. If your interp is set to <code class="docutils literal notranslate"><span class="pre">/bin/foo</span></code> and you run <code class="docutils literal notranslate"><span class="pre">blah</span></code>
(which is in <code class="docutils literal notranslate"><span class="pre">/usr/local/bin</span></code>), then the kernel will execute
<code class="docutils literal notranslate"><span class="pre">/bin/foo</span></code> with <code class="docutils literal notranslate"><span class="pre">argv[]</span></code> set to <code class="docutils literal notranslate"><span class="pre">[&quot;/bin/foo&quot;,</span> <span class="pre">&quot;/usr/local/bin/blah&quot;,</span> <span class="pre">&quot;blah&quot;]</span></code>.  The interp has to be aware of this so it can
execute <code class="docutils literal notranslate"><span class="pre">/usr/local/bin/blah</span></code>
with <code class="docutils literal notranslate"><span class="pre">argv[]</span></code> set to <code class="docutils literal notranslate"><span class="pre">[&quot;blah&quot;]</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">O</span></code> - open-binary</dt><dd><p>Legacy behavior of binfmt_misc is to pass the full path
of the binary to the interpreter as an argument. When this flag is
included, binfmt_misc will open the file for reading and pass its
descriptor as an argument, instead of the full path, thus allowing
the interpreter to execute non-readable binaries. This feature
should be used with care - the interpreter has to be trusted not to
emit the contents of the non-readable binary.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">C</span></code> - credentials</dt><dd><p>Currently, the behavior of binfmt_misc is to calculate
the credentials and security token of the new process according to
the interpreter. When this flag is included, these attributes are
calculated according to the binary. It also implies the <code class="docutils literal notranslate"><span class="pre">O</span></code> flag.
This feature should be used with care as the interpreter
will run with root permissions when a setuid binary owned by root
is run with binfmt_misc.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">F</span></code> - fix binary</dt><dd><p>The usual behaviour of binfmt_misc is to spawn the
binary lazily when the misc format file is invoked.  However,
this doesn``t work very well in the face of mount namespaces and
changeroots, so the <code class="docutils literal notranslate"><span class="pre">F</span></code> mode opens the binary as soon as the
emulation is installed and uses the opened image to spawn the
emulator, meaning it is always available once installed,
regardless of how the environment changes.</p>
</dd>
</dl>
</div></blockquote>
</dd>
</dl>
</li>
</ul>
<p>There are some restrictions:</p>
<blockquote>
<div><ul class="simple">
<li><p>the whole register string may not exceed 1920 characters</p></li>
<li><p>the magic must reside in the first 128 bytes of the file, i.e.
offset+size(magic) has to be less than 128</p></li>
<li><p>the interpreter string may not exceed 127 characters</p></li>
</ul>
</div></blockquote>
<p>To use binfmt_misc you have to mount it first. You can mount it with
<code class="docutils literal notranslate"><span class="pre">mount</span> <span class="pre">-t</span> <span class="pre">binfmt_misc</span> <span class="pre">none</span> <span class="pre">/proc/sys/fs/binfmt_misc</span></code> command, or you can add
a line <code class="docutils literal notranslate"><span class="pre">none</span>&#160; <span class="pre">/proc/sys/fs/binfmt_misc</span> <span class="pre">binfmt_misc</span> <span class="pre">defaults</span> <span class="pre">0</span> <span class="pre">0</span></code> to your
<code class="docutils literal notranslate"><span class="pre">/etc/fstab</span></code> so it auto mounts on boot.</p>
<p>You may want to add the binary formats in one of your <code class="docutils literal notranslate"><span class="pre">/etc/rc</span></code> scripts during
boot-up. Read the manual of your init program to figure out how to do this
right.</p>
<p>Think about the order of adding entries! Later added entries are matched first!</p>
<p>A few examples (assumed you are in <code class="docutils literal notranslate"><span class="pre">/proc/sys/fs/binfmt_misc</span></code>):</p>
<ul>
<li><p>enable support for em86 (like binfmt_em86, for Alpha AXP only):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo &#39;:i386:M::\x7fELF\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x00\x03:\xff\xff\xff\xff\xff\xfe\xfe\xff\xff\xff\xff\xff\xff\xff\xff\xff\xfb\xff\xff:/bin/em86:&#39; &gt; register
echo &#39;:i486:M::\x7fELF\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x00\x06:\xff\xff\xff\xff\xff\xfe\xfe\xff\xff\xff\xff\xff\xff\xff\xff\xff\xfb\xff\xff:/bin/em86:&#39; &gt; register
</pre></div>
</div>
</li>
<li><p>enable support for packed DOS applications (pre-configured dosemu hdimages):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo &#39;:DEXE:M::\x0eDEX::/usr/bin/dosexec:&#39; &gt; register
</pre></div>
</div>
</li>
<li><p>enable support for Windows executables using wine:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo &#39;:DOSWin:M::MZ::/usr/local/bin/wine:&#39; &gt; register
</pre></div>
</div>
</li>
</ul>
<p>For java support see Documentation/admin-guide/java.rst</p>
<p>You can enable/disable binfmt_misc or one binary type by echoing 0 (to disable)
or 1 (to enable) to <code class="docutils literal notranslate"><span class="pre">/proc/sys/fs/binfmt_misc/status</span></code> or
<code class="docutils literal notranslate"><span class="pre">/proc/.../the_name</span></code>.
Catting the file tells you the current status of <code class="docutils literal notranslate"><span class="pre">binfmt_misc/the_entry</span></code>.</p>
<p>You can remove one entry or all entries by echoing -1 to <code class="docutils literal notranslate"><span class="pre">/proc/.../the_name</span></code>
or <code class="docutils literal notranslate"><span class="pre">/proc/sys/fs/binfmt_misc/status</span></code>.</p>
<div class="section" id="hints">
<h2>Hints<a class="headerlink" href="#hints" title="Permalink to this headline">¶</a></h2>
<p>If you want to pass special arguments to your interpreter, you can
write a wrapper script for it.
See <a class="reference internal" href="java.html"><span class="doc">Documentation/admin-guide/java.rst</span></a> for an example.</p>
<p>Your interpreter should NOT look in the PATH for the filename; the kernel
passes it the full filename (or the file descriptor) to use.  Using <code class="docutils literal notranslate"><span class="pre">$PATH</span></code> can
cause unexpected behaviour and can be a security hazard.</p>
<p>Richard Günther &lt;<a class="reference external" href="mailto:rguenth&#37;&#52;&#48;tat&#46;physik&#46;uni-tuebingen&#46;de">rguenth<span>&#64;</span>tat<span>&#46;</span>physik<span>&#46;</span>uni-tuebingen<span>&#46;</span>de</a>&gt;</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="blockdev/index.html" class="btn btn-neutral float-right" title="The Linux RapidIO Subsystem" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="binderfs.html" class="btn btn-neutral float-left" title="The Android binderfs Filesystem" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright The kernel development community

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>