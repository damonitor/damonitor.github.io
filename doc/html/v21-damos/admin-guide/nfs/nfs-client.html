

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>NFS Client &mdash; The Linux Kernel  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.9.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../mm/damon/index.html">Monitoring Data Accesses</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../vm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>NFS Client</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/admin-guide/nfs/nfs-client.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="nfs-client">
<h1>NFS Client<a class="headerlink" href="#nfs-client" title="Permalink to this headline">¶</a></h1>
<div class="section" id="the-nfs-client">
<h2>The NFS client<a class="headerlink" href="#the-nfs-client" title="Permalink to this headline">¶</a></h2>
<p>The NFS version 2 protocol was first documented in RFC1094 (March 1989).
Since then two more major releases of NFS have been published, with NFSv3
being documented in RFC1813 (June 1995), and NFSv4 in RFC3530 (April
2003).</p>
<p>The Linux NFS client currently supports all the above published versions,
and work is in progress on adding support for minor version 1 of the NFSv4
protocol.</p>
<p>The purpose of this document is to provide information on some of the
special features of the NFS client that can be configured by system
administrators.</p>
</div>
<div class="section" id="the-nfs4-unique-id-parameter">
<h2>The nfs4_unique_id parameter<a class="headerlink" href="#the-nfs4-unique-id-parameter" title="Permalink to this headline">¶</a></h2>
<p>NFSv4 requires clients to identify themselves to servers with a unique
string.  File open and lock state shared between one client and one server
is associated with this identity.  To support robust NFSv4 state recovery
and transparent state migration, this identity string must not change
across client reboots.</p>
<p>Without any other intervention, the Linux client uses a string that contains
the local system’s node name.  System administrators, however, often do not
take care to ensure that node names are fully qualified and do not change
over the lifetime of a client system.  Node names can have other
administrative requirements that require particular behavior that does not
work well as part of an nfs_client_id4 string.</p>
<p>The nfs.nfs4_unique_id boot parameter specifies a unique string that can be
used instead of a system’s node name when an NFS client identifies itself to
a server.  Thus, if the system’s node name is not unique, or it changes, its
nfs.nfs4_unique_id stays the same, preventing collision with other clients
or loss of state during NFS reboot recovery or transparent state migration.</p>
<p>The nfs.nfs4_unique_id string is typically a UUID, though it can contain
anything that is believed to be unique across all NFS clients.  An
nfs4_unique_id string should be chosen when a client system is installed,
just as a system’s root file system gets a fresh UUID in its label at
install time.</p>
<p>The string should remain fixed for the lifetime of the client.  It can be
changed safely if care is taken that the client shuts down cleanly and all
outstanding NFSv4 state has expired, to prevent loss of NFSv4 state.</p>
<p>This string can be stored in an NFS client’s grub.conf, or it can be provided
via a net boot facility such as PXE.  It may also be specified as an nfs.ko
module parameter.  Specifying a uniquifier string is not support for NFS
clients running in containers.</p>
</div>
<div class="section" id="the-dns-resolver">
<h2>The DNS resolver<a class="headerlink" href="#the-dns-resolver" title="Permalink to this headline">¶</a></h2>
<p>NFSv4 allows for one server to refer the NFS client to data that has been
migrated onto another server by means of the special “fs_locations”
attribute. See <a class="reference external" href="https://tools.ietf.org/html/rfc3530#section-6">RFC3530 Section 6: Filesystem Migration and Replication</a> and
<a class="reference external" href="https://tools.ietf.org/html/draft-ietf-nfsv4-referrals-00">Implementation Guide for Referrals in NFSv4</a>.</p>
<p>The fs_locations information can take the form of either an ip address and
a path, or a DNS hostname and a path. The latter requires the NFS client to
do a DNS lookup in order to mount the new volume, and hence the need for an
upcall to allow userland to provide this service.</p>
<p>Assuming that the user has the ‘rpc_pipefs’ filesystem mounted in the usual
/var/lib/nfs/rpc_pipefs, the upcall consists of the following steps:</p>
<blockquote>
<div><ol class="arabic">
<li><p>The process checks the dns_resolve cache to see if it contains a
valid entry. If so, it returns that entry and exits.</p></li>
<li><p>If no valid entry exists, the helper script ‘/sbin/nfs_cache_getent’
(may be changed using the ‘nfs.cache_getent’ kernel boot parameter)
is run, with two arguments:
- the cache name, “dns_resolve”
- the hostname to resolve</p></li>
<li><p>After looking up the corresponding ip address, the helper script
writes the result into the rpc_pipefs pseudo-file
‘/var/lib/nfs/rpc_pipefs/cache/dns_resolve/channel’
in the following (text) format:</p>
<blockquote>
<div><p>“&lt;ip address&gt; &lt;hostname&gt; &lt;ttl&gt;n”</p>
</div></blockquote>
<p>Where &lt;ip address&gt; is in the usual IPv4 (123.456.78.90) or IPv6
(ffee:ddcc:bbaa:9988:7766:5544:3322:1100, ffee::1100, …) format.
&lt;hostname&gt; is identical to the second argument of the helper
script, and &lt;ttl&gt; is the ‘time to live’ of this cache entry (in
units of seconds).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If &lt;ip address&gt; is invalid, say the string “0”, then a negative
entry is created, which will cause the kernel to treat the hostname
as having no valid DNS translation.</p>
</div>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="a-basic-sample-sbin-nfs-cache-getent">
<h2>A basic sample /sbin/nfs_cache_getent<a class="headerlink" href="#a-basic-sample-sbin-nfs-cache-getent" title="Permalink to this headline">¶</a></h2>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#</span>
<span class="nv">ttl</span><span class="o">=</span><span class="m">600</span>
<span class="c1">#</span>
<span class="nv">cut</span><span class="o">=</span>/usr/bin/cut
<span class="nv">getent</span><span class="o">=</span>/usr/bin/getent
<span class="nv">rpc_pipefs</span><span class="o">=</span>/var/lib/nfs/rpc_pipefs
<span class="c1">#</span>
die<span class="o">()</span>
<span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">&quot;Usage: </span><span class="nv">$0</span><span class="s2"> cache_name entry_name&quot;</span>
    <span class="nb">exit</span> <span class="m">1</span>
<span class="o">}</span>

<span class="o">[</span> <span class="nv">$#</span> -lt <span class="m">2</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> die
<span class="nv">cachename</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="nv">cache_path</span><span class="o">=</span><span class="si">${</span><span class="nv">rpc_pipefs</span><span class="si">}</span>/cache/<span class="si">${</span><span class="nv">cachename</span><span class="si">}</span>/channel

<span class="k">case</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">cachename</span><span class="si">}</span><span class="s2">&quot;</span> in
    dns_resolve<span class="o">)</span>
        <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
        <span class="nv">result</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="si">${</span><span class="nv">getent</span><span class="si">}</span> hosts <span class="si">${</span><span class="nv">name</span><span class="si">}</span> <span class="p">|</span> <span class="si">${</span><span class="nv">cut</span><span class="si">}</span> -f1 -d<span class="se">\ </span><span class="k">)</span><span class="s2">&quot;</span>
        <span class="o">[</span> -z <span class="s2">&quot;</span><span class="si">${</span><span class="nv">result</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nv">result</span><span class="o">=</span><span class="s2">&quot;0&quot;</span>
        <span class="p">;;</span>
    *<span class="o">)</span>
        die
        <span class="p">;;</span>
<span class="k">esac</span>
<span class="nb">echo</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">result</span><span class="si">}</span><span class="s2"> </span><span class="si">${</span><span class="nv">name</span><span class="si">}</span><span class="s2"> </span><span class="si">${</span><span class="nv">ttl</span><span class="si">}</span><span class="s2">&quot;</span> &gt;<span class="si">${</span><span class="nv">cache_path</span><span class="si">}</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright The kernel development community

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>