

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>How to Get Your Patch Accepted Into the Hwmon Subsystem &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.8.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/mm/damon/index.html">Monitoring Data Accesses</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../vm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>How to Get Your Patch Accepted Into the Hwmon Subsystem</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/hwmon/submitting-patches.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="how-to-get-your-patch-accepted-into-the-hwmon-subsystem">
<h1>How to Get Your Patch Accepted Into the Hwmon Subsystem<a class="headerlink" href="#how-to-get-your-patch-accepted-into-the-hwmon-subsystem" title="Permalink to this headline">¶</a></h1>
<p>This text is a collection of suggestions for people writing patches or
drivers for the hwmon subsystem. Following these suggestions will greatly
increase the chances of your change being accepted.</p>
<div class="section" id="general">
<h2>1. General<a class="headerlink" href="#general" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">It should be unnecessary to mention, but please read and follow:</p>
<blockquote>
<div><ul class="simple">
<li>Documentation/process/submit-checklist.rst</li>
<li>Documentation/process/submitting-drivers.rst</li>
<li>Documentation/process/submitting-patches.rst</li>
<li>Documentation/process/coding-style.rst</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Please run your patch through ‘checkpatch –strict’. There should be no
errors, no warnings, and few if any check messages. If there are any
messages, please be prepared to explain.</p>
</li>
<li><p class="first">Please use the standard multi-line comment style. Do not mix C and C++
style comments in a single driver (with the exception of the SPDX license
identifier).</p>
</li>
<li><p class="first">If your patch generates checkpatch errors, warnings, or check messages,
please refrain from explanations such as “I prefer that coding style”.
Keep in mind that each unnecessary message helps hiding a real problem,
and a consistent coding style makes it easier for others to understand
and review the code.</p>
</li>
<li><p class="first">Please test your patch thoroughly. We are not your test group.
Sometimes a patch can not or not completely be tested because of missing
hardware. In such cases, you should test-build the code on at least one
architecture. If run-time testing was not achieved, it should be written
explicitly below the patch header.</p>
</li>
<li><p class="first">If your patch (or the driver) is affected by configuration options such as
CONFIG_SMP, make sure it compiles for all configuration variants.</p>
</li>
</ul>
</div>
<div class="section" id="adding-functionality-to-existing-drivers">
<h2>2. Adding functionality to existing drivers<a class="headerlink" href="#adding-functionality-to-existing-drivers" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Make sure the documentation in Documentation/hwmon/&lt;driver_name&gt;.rst is up to
date.</li>
<li>Make sure the information in Kconfig is up to date.</li>
<li>If the added functionality requires some cleanup or structural changes, split
your patch into a cleanup part and the actual addition. This makes it easier
to review your changes, and to bisect any resulting problems.</li>
<li>Never mix bug fixes, cleanup, and functional enhancements in a single patch.</li>
</ul>
</div>
<div class="section" id="new-drivers">
<h2>3. New drivers<a class="headerlink" href="#new-drivers" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Running your patch or driver file(s) through checkpatch does not mean its
formatting is clean. If unsure about formatting in your new driver, run it
through Lindent. Lindent is not perfect, and you may have to do some minor
cleanup, but it is a good start.</p>
</li>
<li><p class="first">Consider adding yourself to MAINTAINERS.</p>
</li>
<li><p class="first">Document the driver in Documentation/hwmon/&lt;driver_name&gt;.rst.</p>
</li>
<li><p class="first">Add the driver to Kconfig and Makefile in alphabetical order.</p>
</li>
<li><p class="first">Make sure that all dependencies are listed in Kconfig.</p>
</li>
<li><p class="first">Please list include files in alphabetic order.</p>
</li>
<li><p class="first">Please align continuation lines with ‘(‘ on the previous line.</p>
</li>
<li><p class="first">Avoid forward declarations if you can. Rearrange the code if necessary.</p>
</li>
<li><p class="first">Avoid macros to generate groups of sensor attributes. It not only confuses
checkpatch, but also makes it more difficult to review the code.</p>
</li>
<li><p class="first">Avoid calculations in macros and macro-generated functions. While such macros
may save a line or so in the source, it obfuscates the code and makes code
review more difficult. It may also result in code which is more complicated
than necessary. Use inline functions or just regular functions instead.</p>
</li>
<li><p class="first">Limit the number of kernel log messages. In general, your driver should not
generate an error message just because a runtime operation failed. Report
errors to user space instead, using an appropriate error code. Keep in mind
that kernel error log messages not only fill up the kernel log, but also are
printed synchronously, most likely with interrupt disabled, often to a serial
console. Excessive logging can seriously affect system performance.</p>
</li>
<li><p class="first">Use devres functions whenever possible to allocate resources. For rationale
and supported functions, please see Documentation/driver-api/driver-model/devres.rst.
If a function is not supported by devres, consider using <a class="reference internal" href="../driver-api/basics.html#c.devm_add_action" title="devm_add_action"><code class="xref c c-func docutils literal notranslate"><span class="pre">devm_add_action()</span></code></a>.</p>
</li>
<li><p class="first">If the driver has a detect function, make sure it is silent. Debug messages
and messages printed after a successful detection are acceptable, but it
must not print messages such as “Chip XXX not found/supported”.</p>
<p>Keep in mind that the detect function will run for all drivers supporting an
address if a chip is detected on that address. Unnecessary messages will just
pollute the kernel log and not provide any value.</p>
</li>
<li><p class="first">Provide a detect function if and only if a chip can be detected reliably.</p>
</li>
<li><p class="first">Only the following I2C addresses shall be probed: 0x18-0x1f, 0x28-0x2f,
0x48-0x4f, 0x58, 0x5c, 0x73 and 0x77. Probing other addresses is strongly
discouraged as it is known to cause trouble with other (non-hwmon) I2C
chips. If your chip lives at an address which can’t be probed then the
device will have to be instantiated explicitly (which is always better
anyway.)</p>
</li>
<li><p class="first">Avoid writing to chip registers in the detect function. If you have to write,
only do it after you have already gathered enough data to be certain that the
detection is going to be successful.</p>
<p>Keep in mind that the chip might not be what your driver believes it is, and
writing to it might cause a bad misconfiguration.</p>
</li>
<li><p class="first">Make sure there are no race conditions in the probe function. Specifically,
completely initialize your chip and your driver first, then register with
the hwmon subsystem.</p>
</li>
<li><p class="first">Use devm_hwmon_device_register_with_info() or, if your driver needs a remove
function, hwmon_device_register_with_info() to register your driver with the
hwmon subsystem. Try using <a class="reference internal" href="../driver-api/basics.html#c.devm_add_action" title="devm_add_action"><code class="xref c c-func docutils literal notranslate"><span class="pre">devm_add_action()</span></code></a> instead of a remove function if
possible. Do not use hwmon_device_register().</p>
</li>
<li><p class="first">Your driver should be buildable as module. If not, please be prepared to
explain why it has to be built into the kernel.</p>
</li>
<li><p class="first">Do not provide support for deprecated sysfs attributes.</p>
</li>
<li><p class="first">Do not create non-standard attributes unless really needed. If you have to use
non-standard attributes, or you believe you do, discuss it on the mailing list
first. Either case, provide a detailed explanation why you need the
non-standard attribute(s).
Standard attributes are specified in Documentation/hwmon/sysfs-interface.rst.</p>
</li>
<li><p class="first">When deciding which sysfs attributes to support, look at the chip’s
capabilities. While we do not expect your driver to support everything the
chip may offer, it should at least support all limits and alarms.</p>
</li>
<li><p class="first">Last but not least, please check if a driver for your chip already exists
before starting to write a new driver. Especially for temperature sensors,
new chips are often variants of previously released chips. In some cases,
a presumably new chip may simply have been relabeled.</p>
</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>