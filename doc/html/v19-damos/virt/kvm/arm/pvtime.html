

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Paravirtualized time support for arm64 &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.8.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/mm/damon/index.html">Monitoring Data Accesses</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../vm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
      <li>Paravirtualized time support for arm64</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/virt/kvm/arm/pvtime.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="paravirtualized-time-support-for-arm64">
<h1>Paravirtualized time support for arm64<a class="headerlink" href="#paravirtualized-time-support-for-arm64" title="Permalink to this headline">¶</a></h1>
<p>Arm specification DEN0057/A defines a standard for paravirtualised time
support for AArch64 guests:</p>
<p><a class="reference external" href="https://developer.arm.com/docs/den0057/a">https://developer.arm.com/docs/den0057/a</a></p>
<p>KVM/arm64 implements the stolen time part of this specification by providing
some hypervisor service calls to support a paravirtualized guest obtaining a
view of the amount of time stolen from its execution.</p>
<p>Two new SMCCC compatible hypercalls are defined:</p>
<ul class="simple">
<li>PV_TIME_FEATURES: 0xC5000020</li>
<li>PV_TIME_ST:       0xC5000021</li>
</ul>
<p>These are only available in the SMC64/HVC64 calling convention as
paravirtualized time is not available to 32 bit Arm guests. The existence of
the PV_FEATURES hypercall should be probed using the SMCCC 1.1 ARCH_FEATURES
mechanism before calling it.</p>
<dl class="docutils">
<dt>PV_TIME_FEATURES</dt>
<dd><table border="1" class="first last docutils">
<colgroup>
<col width="19%" />
<col width="11%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Function ID:</td>
<td>(uint32)</td>
<td>0xC5000020</td>
</tr>
<tr class="row-even"><td>PV_call_id:</td>
<td>(uint32)</td>
<td>The function to query for support.
Currently only PV_TIME_ST is supported.</td>
</tr>
<tr class="row-odd"><td>Return value:</td>
<td>(int64)</td>
<td>NOT_SUPPORTED (-1) or SUCCESS (0) if the relevant
PV-time feature is supported by the hypervisor.</td>
</tr>
</tbody>
</table>
</dd>
<dt>PV_TIME_ST</dt>
<dd><table border="1" class="first last docutils">
<colgroup>
<col width="19%" />
<col width="12%" />
<col width="69%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Function ID:</td>
<td>(uint32)</td>
<td>0xC5000021</td>
</tr>
<tr class="row-even"><td>Return value:</td>
<td>(int64)</td>
<td>IPA of the stolen time data structure for this
VCPU. On failure:
NOT_SUPPORTED (-1)</td>
</tr>
</tbody>
</table>
</dd>
</dl>
<p>The IPA returned by PV_TIME_ST should be mapped by the guest as normal memory
with inner and outer write back caching attributes, in the inner shareable
domain. A total of 16 bytes from the IPA returned are guaranteed to be
meaningfully filled by the hypervisor (see structure below).</p>
<p>PV_TIME_ST returns the structure for the calling VCPU.</p>
<div class="section" id="stolen-time">
<h2>Stolen Time<a class="headerlink" href="#stolen-time" title="Permalink to this headline">¶</a></h2>
<p>The structure pointed to by the PV_TIME_ST hypercall is as follows:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="19%" />
<col width="19%" />
<col width="42%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Byte Length</th>
<th class="head">Byte Offset</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Revision</td>
<td>4</td>
<td>0</td>
<td>Must be 0 for version 1.0</td>
</tr>
<tr class="row-odd"><td>Attributes</td>
<td>4</td>
<td>4</td>
<td>Must be 0</td>
</tr>
<tr class="row-even"><td>Stolen time</td>
<td>8</td>
<td>8</td>
<td>Stolen time in unsigned
nanoseconds indicating how
much time this VCPU thread
was involuntarily not
running on a physical CPU.</td>
</tr>
</tbody>
</table>
<p>All values in the structure are stored little-endian.</p>
<p>The structure will be updated by the hypervisor prior to scheduling a VCPU. It
will be present within a reserved region of the normal memory given to the
guest. The guest should not attempt to write into this memory. There is a
structure per VCPU of the guest.</p>
<p>It is advisable that one or more 64k pages are set aside for the purpose of
these structures and not used for other purposes, this enables the guest to map
the region using 64k pages and avoids conflicting attributes with other memory.</p>
<p>For the user space interface see Documentation/virt/kvm/devices/vcpu.rst
section “3. GROUP: KVM_ARM_VCPU_PVTIME_CTRL”.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>