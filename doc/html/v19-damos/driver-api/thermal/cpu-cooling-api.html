

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>CPU cooling APIs How To &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.8.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/mm/damon/index.html">Monitoring Data Accesses</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../vm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>CPU cooling APIs How To</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/driver-api/thermal/cpu-cooling-api.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cpu-cooling-apis-how-to">
<h1>CPU cooling APIs How To<a class="headerlink" href="#cpu-cooling-apis-how-to" title="Permalink to this headline">¶</a></h1>
<p>Written by Amit Daniel Kachhap &lt;<a class="reference external" href="mailto:amit&#46;kachhap&#37;&#52;&#48;linaro&#46;org">amit<span>&#46;</span>kachhap<span>&#64;</span>linaro<span>&#46;</span>org</a>&gt;</p>
<p>Updated: 6 Jan 2015</p>
<p>Copyright (c)  2012 Samsung Electronics Co., Ltd(<a class="reference external" href="http://www.samsung.com">http://www.samsung.com</a>)</p>
<div class="section" id="introduction">
<h2>0. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The generic cpu cooling(freq clipping) provides registration/unregistration APIs
to the caller. The binding of the cooling devices to the trip point is left for
the user. The registration APIs returns the cooling device pointer.</p>
</div>
<div class="section" id="cpu-cooling-apis">
<h2>1. cpu cooling APIs<a class="headerlink" href="#cpu-cooling-apis" title="Permalink to this headline">¶</a></h2>
<div class="section" id="cpufreq-registration-unregistration-apis">
<h3>1.1 cpufreq registration/unregistration APIs<a class="headerlink" href="#cpufreq-registration-unregistration-apis" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct thermal_cooling_device
*cpufreq_cooling_register(struct cpumask *clip_cpus)
</pre></div>
</div>
<p>This interface function registers the cpufreq cooling device with the name
“thermal-cpufreq-%x”. This api can support multiple instances of cpufreq
cooling devices.</p>
</div></blockquote>
<dl class="docutils">
<dt>clip_cpus:</dt>
<dd><blockquote class="first">
<div>cpumask of cpus where the frequency constraints will happen.</div></blockquote>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct thermal_cooling_device
*of_cpufreq_cooling_register(struct cpufreq_policy *policy)
</pre></div>
</div>
<p>This interface function registers the cpufreq cooling device with
the name “thermal-cpufreq-%x” linking it with a device tree node, in
order to bind it via the thermal DT code. This api can support multiple
instances of cpufreq cooling devices.</p>
<dl class="docutils">
<dt>policy:</dt>
<dd>CPUFreq policy.</dd>
</dl>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>void cpufreq_cooling_unregister(struct thermal_cooling_device *cdev)
</pre></div>
</div>
<p>This interface function unregisters the “thermal-cpufreq-%x” cooling device.</p>
<p class="last">cdev: Cooling device pointer which has to be unregistered.</p>
</dd>
</dl>
</div></blockquote>
</div>
</div>
<div class="section" id="power-models">
<h2>2. Power models<a class="headerlink" href="#power-models" title="Permalink to this headline">¶</a></h2>
<p>The power API registration functions provide a simple power model for
CPUs.  The current power is calculated as dynamic power (static power isn’t
supported currently).  This power model requires that the operating-points of
the CPUs are registered using the kernel’s opp library and the
<cite>cpufreq_frequency_table</cite> is assigned to the <cite>struct device</cite> of the
cpu.  If you are using CONFIG_CPUFREQ_DT then the
<cite>cpufreq_frequency_table</cite> should already be assigned to the cpu
device.</p>
<p>The dynamic power consumption of a processor depends on many factors.
For a given processor implementation the primary factors are:</p>
<ul class="simple">
<li>The time the processor spends running, consuming dynamic power, as
compared to the time in idle states where dynamic consumption is
negligible.  Herein we refer to this as ‘utilisation’.</li>
<li>The voltage and frequency levels as a result of DVFS.  The DVFS
level is a dominant factor governing power consumption.</li>
<li>In running time the ‘execution’ behaviour (instruction types, memory
access patterns and so forth) causes, in most cases, a second order
variation.  In pathological cases this variation can be significant,
but typically it is of a much lesser impact than the factors above.</li>
</ul>
<p>A high level dynamic power consumption model may then be represented as:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Pdyn = f(run) * Voltage^2 * Frequency * Utilisation
</pre></div>
</div>
<p>f(run) here represents the described execution behaviour and its
result has a units of Watts/Hz/Volt^2 (this often expressed in
mW/MHz/uVolt^2)</p>
<p>The detailed behaviour for f(run) could be modelled on-line.  However,
in practice, such an on-line model has dependencies on a number of
implementation specific processor support and characterisation
factors.  Therefore, in initial implementation that contribution is
represented as a constant coefficient.  This is a simplification
consistent with the relative contribution to overall power variation.</p>
<p>In this simplified representation our model becomes:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Pdyn = Capacitance * Voltage^2 * Frequency * Utilisation
</pre></div>
</div>
<p>Where <cite>capacitance</cite> is a constant that represents an indicative
running time dynamic power coefficient in fundamental units of
mW/MHz/uVolt^2.  Typical values for mobile CPUs might lie in range
from 100 to 500.  For reference, the approximate values for the SoC in
ARM’s Juno Development Platform are 530 for the Cortex-A57 cluster and
140 for the Cortex-A53 cluster.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>