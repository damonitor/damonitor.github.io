

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>What is udlfb? &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.8.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/mm/damon/index.html">Monitoring Data Accesses</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../vm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>What is udlfb?</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/fb/udlfb.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="what-is-udlfb">
<h1>What is udlfb?<a class="headerlink" href="#what-is-udlfb" title="Permalink to this headline">¶</a></h1>
<p>This is a driver for DisplayLink USB 2.0 era graphics chips.</p>
<p>DisplayLink chips provide simple hline/blit operations with some compression,
pairing that with a hardware framebuffer (16MB) on the other end of the
USB wire.  That hardware framebuffer is able to drive the VGA, DVI, or HDMI
monitor with no CPU involvement until a pixel has to change.</p>
<p>The CPU or other local resource does all the rendering; optionally compares the
result with a local shadow of the remote hardware framebuffer to identify
the minimal set of pixels that have changed; and compresses and sends those
pixels line-by-line via USB bulk transfers.</p>
<p>Because of the efficiency of bulk transfers and a protocol on top that
does not require any acks - the effect is very low latency that
can support surprisingly high resolutions with good performance for
non-gaming and non-video applications.</p>
<p>Mode setting, EDID read, etc are other bulk or control transfers. Mode
setting is very flexible - able to set nearly arbitrary modes from any timing.</p>
<p>Advantages of USB graphics in general:</p>
<blockquote>
<div><ul class="simple">
<li>Ability to add a nearly arbitrary number of displays to any USB 2.0
capable system. On Linux, number of displays is limited by fbdev interface
(FB_MAX is currently 32). Of course, all USB devices on the same
host controller share the same 480Mbs USB 2.0 interface.</li>
</ul>
</div></blockquote>
<p>Advantages of supporting DisplayLink chips with kernel framebuffer interface:</p>
<blockquote>
<div><ul class="simple">
<li>The actual hardware functionality of DisplayLink chips matches nearly
one-to-one with the fbdev interface, making the driver quite small and
tight relative to the functionality it provides.</li>
<li>X servers and other applications can use the standard fbdev interface
from user mode to talk to the device, without needing to know anything
about USB or DisplayLink’s protocol at all. A “displaylink” X driver
and a slightly modified “fbdev” X driver are among those that already do.</li>
</ul>
</div></blockquote>
<p>Disadvantages:</p>
<blockquote>
<div><ul class="simple">
<li>Fbdev’s mmap interface assumes a real hardware framebuffer is mapped.
In the case of USB graphics, it is just an allocated (virtual) buffer.
Writes need to be detected and encoded into USB bulk transfers by the CPU.
Accurate damage/changed area notifications work around this problem.
In the future, hopefully fbdev will be enhanced with an small standard
interface to allow mmap clients to report damage, for the benefit
of virtual or remote framebuffers.</li>
<li>Fbdev does not arbitrate client ownership of the framebuffer well.</li>
<li>Fbcon assumes the first framebuffer it finds should be consumed for console.</li>
<li>It’s not clear what the future of fbdev is, given the rise of KMS/DRM.</li>
</ul>
</div></blockquote>
<div class="section" id="how-to-use-it">
<h2>How to use it?<a class="headerlink" href="#how-to-use-it" title="Permalink to this headline">¶</a></h2>
<p>Udlfb, when loaded as a module, will match against all USB 2.0 generation
DisplayLink chips (Alex and Ollie family). It will then attempt to read the EDID
of the monitor, and set the best common mode between the DisplayLink device
and the monitor’s capabilities.</p>
<p>If the DisplayLink device is successful, it will paint a “green screen” which
means that from a hardware and fbdev software perspective, everything is good.</p>
<p>At that point, a /dev/fb? interface will be present for user-mode applications
to open and begin writing to the framebuffer of the DisplayLink device using
standard fbdev calls.  Note that if mmap() is used, by default the user mode
application must send down damage notifications to trigger repaints of the
changed regions.  Alternatively, udlfb can be recompiled with experimental
defio support enabled, to support a page-fault based detection mechanism
that can work without explicit notification.</p>
<p>The most common client of udlfb is xf86-video-displaylink or a modified
xf86-video-fbdev X server. These servers have no real DisplayLink specific
code. They write to the standard framebuffer interface and rely on udlfb
to do its thing.  The one extra feature they have is the ability to report
rectangles from the X DAMAGE protocol extension down to udlfb via udlfb’s
damage interface (which will hopefully be standardized for all virtual
framebuffers that need damage info). These damage notifications allow
udlfb to efficiently process the changed pixels.</p>
</div>
<div class="section" id="module-options">
<h2>Module Options<a class="headerlink" href="#module-options" title="Permalink to this headline">¶</a></h2>
<p>Special configuration for udlfb is usually unnecessary. There are a few
options, however.</p>
<p>From the command line, pass options to modprobe
modprobe udlfb fb_defio=0 console=1 shadow=1</p>
<p>Or modify options on the fly at /sys/module/udlfb/parameters directory via
sudo nano fb_defio
change the parameter in place, and save the file.</p>
<p>Unplug/replug USB device to apply with new settings</p>
<p>Or for permanent option, create file like /etc/modprobe.d/udlfb.conf with text
options udlfb fb_defio=0 console=1 shadow=1</p>
<p>Accepted boolean options:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>fb_defio</td>
<td>Make use of the fb_defio (CONFIG_FB_DEFERRED_IO) kernel
module to track changed areas of the framebuffer by page faults.
Standard fbdev applications that use mmap but that do not
report damage, should be able to work with this enabled.
Disable when running with X server that supports reporting
changed regions via ioctl, as this method is simpler,
more stable, and higher performance.
default: fb_defio=1</td>
</tr>
<tr class="row-even"><td>console</td>
<td>Allow fbcon to attach to udlfb provided framebuffers.
Can be disabled if fbcon and other clients
(e.g. X with –shared-vt) are in conflict.
default: console=1</td>
</tr>
<tr class="row-odd"><td>shadow</td>
<td>Allocate a 2nd framebuffer to shadow what’s currently across
the USB bus in device memory. If any pixels are unchanged,
do not transmit. Spends host memory to save USB transfers.
Enabled by default. Only disable on very low memory systems.
default: shadow=1</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="sysfs-attributes">
<h2>Sysfs Attributes<a class="headerlink" href="#sysfs-attributes" title="Permalink to this headline">¶</a></h2>
<p>Udlfb creates several files in /sys/class/graphics/fb?
Where ? is the sequential framebuffer id of the particular DisplayLink device</p>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>edid</td>
<td>If a valid EDID blob is written to this file (typically
by a udev rule), then udlfb will use this EDID as a
backup in case reading the actual EDID of the monitor
attached to the DisplayLink device fails. This is
especially useful for fixed panels, etc. that cannot
communicate their capabilities via EDID. Reading
this file returns the current EDID of the attached
monitor (or last backup value written). This is
useful to get the EDID of the attached monitor,
which can be passed to utilities like parse-edid.</td>
</tr>
<tr class="row-even"><td>metrics_bytes_rendered</td>
<td>32-bit count of pixel bytes rendered</td>
</tr>
<tr class="row-odd"><td>metrics_bytes_identical</td>
<td>32-bit count of how many of those bytes were found to be
unchanged, based on a shadow framebuffer check</td>
</tr>
<tr class="row-even"><td>metrics_bytes_sent</td>
<td>32-bit count of how many bytes were transferred over
USB to communicate the resulting changed pixels to the
hardware. Includes compression and protocol overhead</td>
</tr>
<tr class="row-odd"><td>metrics_cpu_kcycles_used</td>
<td>32-bit count of CPU cycles used in processing the
above pixels (in thousands of cycles).</td>
</tr>
<tr class="row-even"><td>metrics_reset</td>
<td>Write-only. Any write to this file resets all metrics
above to zero.  Note that the 32-bit counters above
roll over very quickly. To get reliable results, design
performance tests to start and finish in a very short
period of time (one minute or less is safe).</td>
</tr>
</tbody>
</table>
<p>Bernie Thompson &lt;<a class="reference external" href="mailto:bernie&#37;&#52;&#48;plugable&#46;com">bernie<span>&#64;</span>plugable<span>&#46;</span>com</a>&gt;</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>