

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Upgrading BIOS using intel-spi &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/mm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Upgrading BIOS using intel-spi</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/driver-api/mtd/intel-spi.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="upgrading-bios-using-intel-spi">
<h1>Upgrading BIOS using intel-spi<a class="headerlink" href="#upgrading-bios-using-intel-spi" title="Permalink to this headline">¶</a></h1>
<p>Many Intel CPUs like Baytrail and Braswell include SPI serial flash host
controller which is used to hold BIOS and other platform specific data.
Since contents of the SPI serial flash is crucial for machine to function,
it is typically protected by different hardware protection mechanisms to
avoid accidental (or on purpose) overwrite of the content.</p>
<p>Not all manufacturers protect the SPI serial flash, mainly because it
allows upgrading the BIOS image directly from an OS.</p>
<p>The intel-spi driver makes it possible to read and write the SPI serial
flash, if certain protection bits are not set and locked. If it finds
any of them set, the whole MTD device is made read-only to prevent
partial overwrites. By default the driver exposes SPI serial flash
contents as read-only but it can be changed from kernel command line,
passing “intel-spi.writeable=1”.</p>
<p>Please keep in mind that overwriting the BIOS image on SPI serial flash
might render the machine unbootable and requires special equipment like
Dediprog to revive. You have been warned!</p>
<p>Below are the steps how to upgrade MinnowBoard MAX BIOS directly from
Linux.</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Download and extract the latest Minnowboard MAX BIOS SPI image
[1]. At the time writing this the latest image is v92.</p>
</li>
<li><p class="first">Install mtd-utils package [2]. We need this in order to erase the SPI
serial flash. Distros like Debian and Fedora have this prepackaged with
name “mtd-utils”.</p>
</li>
<li><p class="first">Add “intel-spi.writeable=1” to the kernel command line and reboot
the board (you can also reload the driver passing “writeable=1” as
module parameter to modprobe).</p>
</li>
<li><p class="first">Once the board is up and running again, find the right MTD partition
(it is named as “BIOS”):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cat /proc/mtd
dev:    size   erasesize  name
mtd0: 00800000 00001000 &quot;BIOS&quot;
</pre></div>
</div>
<p>So here it will be /dev/mtd0 but it may vary.</p>
</li>
<li><p class="first">Make backup of the existing image first:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># dd if=/dev/mtd0ro of=bios.bak
16384+0 records in
16384+0 records out
8388608 bytes (8.4 MB) copied, 10.0269 s, 837 kB/s
</pre></div>
</div>
</li>
<li><p class="first">Verify the backup:</p>
<blockquote>
<div><p># sha1sum /dev/mtd0ro bios.bak
fdbb011920572ca6c991377c4b418a0502668b73  /dev/mtd0ro
fdbb011920572ca6c991377c4b418a0502668b73  bios.bak</p>
</div></blockquote>
<p>The SHA1 sums must match. Otherwise do not continue any further!</p>
</li>
<li><p class="first">Erase the SPI serial flash. After this step, do not reboot the
board! Otherwise it will not start anymore:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># flash_erase /dev/mtd0 0 0
Erasing 4 Kibyte @ 7ff000 -- 100 % complete
</pre></div>
</div>
</li>
<li><p class="first">Once completed without errors you can write the new BIOS image:</p>
<p># dd if=MNW2MAX1.X64.0092.R01.1605221712.bin of=/dev/mtd0</p>
</li>
<li><p class="first">Verify that the new content of the SPI serial flash matches the new
BIOS image:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># sha1sum /dev/mtd0ro MNW2MAX1.X64.0092.R01.1605221712.bin
9b4df9e4be2057fceec3a5529ec3d950836c87a2  /dev/mtd0ro
9b4df9e4be2057fceec3a5529ec3d950836c87a2 MNW2MAX1.X64.0092.R01.1605221712.bin
</pre></div>
</div>
<p>The SHA1 sums should match.</p>
</li>
<li><p class="first">Now you can reboot your board and observe the new BIOS starting up
properly.</p>
</li>
</ol>
</div></blockquote>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>[1] <a class="reference external" href="https://firmware.intel.com/sites/default/files/MinnowBoard%2EMAX_%2EX64%2E92%2ER01%2Ezip">https://firmware.intel.com/sites/default/files/MinnowBoard%2EMAX_%2EX64%2E92%2ER01%2Ezip</a></p>
<p>[2] <a class="reference external" href="http://www.linux-mtd.infradead.org/">http://www.linux-mtd.infradead.org/</a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>