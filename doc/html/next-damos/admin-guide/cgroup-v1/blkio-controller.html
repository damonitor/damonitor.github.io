

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Block IO Controller &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../mm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Block IO Controller</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/admin-guide/cgroup-v1/blkio-controller.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="block-io-controller">
<h1>Block IO Controller<a class="headerlink" href="#block-io-controller" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>cgroup subsys “blkio” implements the block io controller. There seems to be
a need of various kinds of IO control policies (like proportional BW, max BW)
both at leaf nodes as well as at intermediate nodes in a storage hierarchy.
Plan is to use the same cgroup based management interface for blkio controller
and based on user options switch IO policies in the background.</p>
<p>One IO control policy is throttling policy which can be used to
specify upper IO rate limits on devices. This policy is implemented in
generic block layer and can be used on leaf nodes as well as higher
level logical devices like device mapper.</p>
</div>
<div class="section" id="howto">
<h2>HOWTO<a class="headerlink" href="#howto" title="Permalink to this headline">¶</a></h2>
<div class="section" id="throttling-upper-limit-policy">
<h3>Throttling/Upper Limit policy<a class="headerlink" href="#throttling-upper-limit-policy" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Enable Block IO controller:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_BLK_CGROUP=y
</pre></div>
</div>
</li>
<li><p class="first">Enable throttling in block layer:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONFIG_BLK_DEV_THROTTLING=y
</pre></div>
</div>
</li>
<li><p class="first">Mount blkio controller (see cgroups.txt, Why are cgroups needed?):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>mount -t cgroup -o blkio none /sys/fs/cgroup/blkio
</pre></div>
</div>
</li>
<li><p class="first">Specify a bandwidth rate on particular device for root group. The format
for policy is “&lt;major&gt;:&lt;minor&gt;  &lt;bytes_per_second&gt;”:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo &quot;8:16  1048576&quot; &gt; /sys/fs/cgroup/blkio/blkio.throttle.read_bps_device
</pre></div>
</div>
<p>Above will put a limit of 1MB/second on reads happening for root group
on device having major/minor number 8:16.</p>
</li>
<li><p class="first">Run dd to read a file and see if rate is throttled to 1MB/s or not:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># dd iflag=direct if=/mnt/common/zerofile of=/dev/null bs=4K count=1024
1024+0 records in
1024+0 records out
4194304 bytes (4.2 MB) copied, 4.0001 s, 1.0 MB/s
</pre></div>
</div>
</li>
</ul>
<blockquote>
<div>Limits for writes can be put using blkio.throttle.write_bps_device file.</div></blockquote>
</div>
</div>
<div class="section" id="hierarchical-cgroups">
<h2>Hierarchical Cgroups<a class="headerlink" href="#hierarchical-cgroups" title="Permalink to this headline">¶</a></h2>
<p>Throttling implements hierarchy support; however,
throttling’s hierarchy support is enabled iff “sane_behavior” is
enabled from cgroup side, which currently is a development option and
not publicly available.</p>
<p>If somebody created a hierarchy like as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   root
   /  \
test1 test2
   |
test3
</pre></div>
</div>
<p>Throttling with “sane_behavior” will handle the
hierarchy correctly. For throttling, all limits apply
to the whole subtree while all statistics are local to the IOs
directly generated by tasks in that cgroup.</p>
<p>Throttling without “sane_behavior” enabled from cgroup side will
practically treat all groups at same level as if it looks like the
following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>        pivot
     /  /   \  \
root  test1 test2  test3
</pre></div>
</div>
</div>
<div class="section" id="various-user-visible-config-options">
<h2>Various user visible config options<a class="headerlink" href="#various-user-visible-config-options" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>CONFIG_BLK_CGROUP</dt>
<dd><ul class="first last simple">
<li>Block IO controller.</li>
</ul>
</dd>
<dt>CONFIG_BFQ_CGROUP_DEBUG</dt>
<dd><ul class="first last simple">
<li>Debug help. Right now some additional stats file show up in cgroup
if this option is enabled.</li>
</ul>
</dd>
<dt>CONFIG_BLK_DEV_THROTTLING</dt>
<dd><ul class="first last simple">
<li>Enable block device throttling support in block layer.</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="details-of-cgroup-files">
<h2>Details of cgroup files<a class="headerlink" href="#details-of-cgroup-files" title="Permalink to this headline">¶</a></h2>
<div class="section" id="proportional-weight-policy-files">
<h3>Proportional weight policy files<a class="headerlink" href="#proportional-weight-policy-files" title="Permalink to this headline">¶</a></h3>
<ul>
<li><dl class="first docutils">
<dt>blkio.weight</dt>
<dd><ul class="first last simple">
<li>Specifies per cgroup weight. This is default weight of the group
on all the devices until and unless overridden by per device rule.
(See blkio.weight_device).
Currently allowed range of weights is from 10 to 1000.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>blkio.weight_device</dt>
<dd><ul class="first last">
<li><p class="first">One can specify per cgroup per device rules using this interface.
These rules override the default value of group weight as specified
by blkio.weight.</p>
<p>Following is the format:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo dev_maj:dev_minor weight &gt; blkio.weight_device
</pre></div>
</div>
<p>Configure weight=300 on /dev/sdb (8:16) in this cgroup:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo 8:16 300 &gt; blkio.weight_device
# cat blkio.weight_device
dev     weight
8:16    300
</pre></div>
</div>
<p>Configure weight=500 on /dev/sda (8:0) in this cgroup:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo 8:0 500 &gt; blkio.weight_device
# cat blkio.weight_device
dev     weight
8:0     500
8:16    300
</pre></div>
</div>
<p>Remove specific weight for /dev/sda in this cgroup:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo 8:0 0 &gt; blkio.weight_device
# cat blkio.weight_device
dev     weight
8:16    300
</pre></div>
</div>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>blkio.time</dt>
<dd><ul class="first last simple">
<li>disk time allocated to cgroup per device in milliseconds. First
two fields specify the major and minor number of the device and
third field specifies the disk time allocated to group in
milliseconds.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>blkio.sectors</dt>
<dd><ul class="first last simple">
<li>number of sectors transferred to/from disk by the group. First
two fields specify the major and minor number of the device and
third field specifies the number of sectors transferred by the
group to/from the device.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>blkio.io_service_bytes</dt>
<dd><ul class="first last simple">
<li>Number of bytes transferred to/from the disk by the group. These
are further divided by the type of operation - read or write, sync
or async. First two fields specify the major and minor number of the
device, third field specifies the operation type and the fourth field
specifies the number of bytes.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>blkio.io_serviced</dt>
<dd><ul class="first last simple">
<li>Number of IOs (bio) issued to the disk by the group. These
are further divided by the type of operation - read or write, sync
or async. First two fields specify the major and minor number of the
device, third field specifies the operation type and the fourth field
specifies the number of IOs.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>blkio.io_service_time</dt>
<dd><ul class="first last simple">
<li>Total amount of time between request dispatch and request completion
for the IOs done by this cgroup. This is in nanoseconds to make it
meaningful for flash devices too. For devices with queue depth of 1,
this time represents the actual service time. When queue_depth &gt; 1,
that is no longer true as requests may be served out of order. This
may cause the service time for a given IO to include the service time
of multiple IOs when served out of order which may result in total
io_service_time &gt; actual time elapsed. This time is further divided by
the type of operation - read or write, sync or async. First two fields
specify the major and minor number of the device, third field
specifies the operation type and the fourth field specifies the
io_service_time in ns.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>blkio.io_wait_time</dt>
<dd><ul class="first last simple">
<li>Total amount of time the IOs for this cgroup spent waiting in the
scheduler queues for service. This can be greater than the total time
elapsed since it is cumulative io_wait_time for all IOs. It is not a
measure of total time the cgroup spent waiting but rather a measure of
the wait_time for its individual IOs. For devices with queue_depth &gt; 1
this metric does not include the time spent waiting for service once
the IO is dispatched to the device but till it actually gets serviced
(there might be a time lag here due to re-ordering of requests by the
device). This is in nanoseconds to make it meaningful for flash
devices too. This time is further divided by the type of operation -
read or write, sync or async. First two fields specify the major and
minor number of the device, third field specifies the operation type
and the fourth field specifies the io_wait_time in ns.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>blkio.io_merged</dt>
<dd><ul class="first last simple">
<li>Total number of bios/requests merged into requests belonging to this
cgroup. This is further divided by the type of operation - read or
write, sync or async.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>blkio.io_queued</dt>
<dd><ul class="first last simple">
<li>Total number of requests queued up at any given instant for this
cgroup. This is further divided by the type of operation - read or
write, sync or async.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>blkio.avg_queue_size</dt>
<dd><ul class="first last simple">
<li>Debugging aid only enabled if CONFIG_BFQ_CGROUP_DEBUG=y.
The average queue size for this cgroup over the entire time of this
cgroup’s existence. Queue size samples are taken each time one of the
queues of this cgroup gets a timeslice.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>blkio.group_wait_time</dt>
<dd><ul class="first last simple">
<li>Debugging aid only enabled if CONFIG_BFQ_CGROUP_DEBUG=y.
This is the amount of time the cgroup had to wait since it became busy
(i.e., went from 0 to 1 request queued) to get a timeslice for one of
its queues. This is different from the io_wait_time which is the
cumulative total of the amount of time spent by each IO in that cgroup
waiting in the scheduler queue. This is in nanoseconds. If this is
read when the cgroup is in a waiting (for timeslice) state, the stat
will only report the group_wait_time accumulated till the last time it
got a timeslice and will not include the current delta.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>blkio.empty_time</dt>
<dd><ul class="first last simple">
<li>Debugging aid only enabled if CONFIG_BFQ_CGROUP_DEBUG=y.
This is the amount of time a cgroup spends without any pending
requests when not being served, i.e., it does not include any time
spent idling for one of the queues of the cgroup. This is in
nanoseconds. If this is read when the cgroup is in an empty state,
the stat will only report the empty_time accumulated till the last
time it had a pending request and will not include the current delta.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>blkio.idle_time</dt>
<dd><ul class="first last simple">
<li>Debugging aid only enabled if CONFIG_BFQ_CGROUP_DEBUG=y.
This is the amount of time spent by the IO scheduler idling for a
given cgroup in anticipation of a better request than the existing ones
from other queues/cgroups. This is in nanoseconds. If this is read
when the cgroup is in an idling state, the stat will only report the
idle_time accumulated till the last idle period and will not include
the current delta.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>blkio.dequeue</dt>
<dd><ul class="first last simple">
<li>Debugging aid only enabled if CONFIG_BFQ_CGROUP_DEBUG=y. This
gives the statistics about how many a times a group was dequeued
from service tree of the device. First two fields specify the major
and minor number of the device and third field specifies the number
of times a group was dequeued from a particular device.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>blkio.*_recursive</dt>
<dd><ul class="first last simple">
<li>Recursive version of various stats. These files show the
same information as their non-recursive counterparts but
include stats from all the descendant cgroups.</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="throttling-upper-limit-policy-files">
<h3>Throttling/Upper limit policy files<a class="headerlink" href="#throttling-upper-limit-policy-files" title="Permalink to this headline">¶</a></h3>
<ul>
<li><dl class="first docutils">
<dt>blkio.throttle.read_bps_device</dt>
<dd><ul class="first last">
<li><p class="first">Specifies upper limit on READ rate from the device. IO rate is
specified in bytes per second. Rules are per device. Following is
the format:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo &quot;&lt;major&gt;:&lt;minor&gt;  &lt;rate_bytes_per_second&gt;&quot; &gt; /cgrp/blkio.throttle.read_bps_device
</pre></div>
</div>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>blkio.throttle.write_bps_device</dt>
<dd><ul class="first last">
<li><p class="first">Specifies upper limit on WRITE rate to the device. IO rate is
specified in bytes per second. Rules are per device. Following is
the format:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo &quot;&lt;major&gt;:&lt;minor&gt;  &lt;rate_bytes_per_second&gt;&quot; &gt; /cgrp/blkio.throttle.write_bps_device
</pre></div>
</div>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>blkio.throttle.read_iops_device</dt>
<dd><ul class="first last">
<li><p class="first">Specifies upper limit on READ rate from the device. IO rate is
specified in IO per second. Rules are per device. Following is
the format:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo &quot;&lt;major&gt;:&lt;minor&gt;  &lt;rate_io_per_second&gt;&quot; &gt; /cgrp/blkio.throttle.read_iops_device
</pre></div>
</div>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>blkio.throttle.write_iops_device</dt>
<dd><ul class="first last">
<li><p class="first">Specifies upper limit on WRITE rate to the device. IO rate is
specified in io per second. Rules are per device. Following is
the format:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo &quot;&lt;major&gt;:&lt;minor&gt;  &lt;rate_io_per_second&gt;&quot; &gt; /cgrp/blkio.throttle.write_iops_device
</pre></div>
</div>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
<dl class="docutils">
<dt>Note: If both BW and IOPS rules are specified for a device, then IO is</dt>
<dd>subjected to both the constraints.</dd>
</dl>
<ul class="simple">
<li><dl class="first docutils">
<dt>blkio.throttle.io_serviced</dt>
<dd><ul class="first last">
<li>Number of IOs (bio) issued to the disk by the group. These
are further divided by the type of operation - read or write, sync
or async. First two fields specify the major and minor number of the
device, third field specifies the operation type and the fourth field
specifies the number of IOs.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>blkio.throttle.io_service_bytes</dt>
<dd><ul class="first last">
<li>Number of bytes transferred to/from the disk by the group. These
are further divided by the type of operation - read or write, sync
or async. First two fields specify the major and minor number of the
device, third field specifies the operation type and the fourth field
specifies the number of bytes.</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="common-files-among-various-policies">
<h3>Common files among various policies<a class="headerlink" href="#common-files-among-various-policies" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><dl class="first docutils">
<dt>blkio.reset_stats</dt>
<dd><ul class="first last">
<li>Writing an int to this file will result in resetting all the stats
for that cgroup.</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>