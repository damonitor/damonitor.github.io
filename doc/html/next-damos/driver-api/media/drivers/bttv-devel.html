

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>7.1.1. The bttv driver &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.8.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/mm/damon/index.html">Monitoring Data Accesses</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../vm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
      <li>7.1.1. The bttv driver</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/driver-api/media/drivers/bttv-devel.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-bttv-driver">
<h1>7.1.1. The bttv driver<a class="headerlink" href="#the-bttv-driver" title="Permalink to this headline">¶</a></h1>
<div class="section" id="bttv-and-sound-mini-howto">
<h2>7.1.1.1. bttv and sound mini howto<a class="headerlink" href="#bttv-and-sound-mini-howto" title="Permalink to this headline">¶</a></h2>
<p>There are a lot of different bt848/849/878/879 based boards available.
Making video work often is not a big deal, because this is handled
completely by the bt8xx chip, which is common on all boards.  But
sound is handled in slightly different ways on each board.</p>
<p>To handle the grabber boards correctly, there is a array tvcards[] in
bttv-cards.c, which holds the information required for each board.
Sound will work only, if the correct entry is used (for video it often
makes no difference).  The bttv driver prints a line to the kernel
log, telling which card type is used.  Like this one:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>bttv0: model: BT848(Hauppauge old) [autodetected]
</pre></div>
</div>
<p>You should verify this is correct.  If it isn’t, you have to pass the
correct board type as insmod argument, <code class="docutils literal notranslate"><span class="pre">insmod</span> <span class="pre">bttv</span> <span class="pre">card=2</span></code> for
example.  The file <a class="reference internal" href="../../../admin-guide/media/bttv-cardlist.html"><span class="doc">BTTV cards list</span></a> has a list
of valid arguments for card.</p>
<p>If your card isn’t listed there, you might check the source code for
new entries which are not listed yet.  If there isn’t one for your
card, you can check if one of the existing entries does work for you
(just trial and error…).</p>
<p>Some boards have an extra processor for sound to do stereo decoding
and other nice features.  The msp34xx chips are used by Hauppauge for
example.  If your board has one, you might have to load a helper
module like <code class="docutils literal notranslate"><span class="pre">msp3400</span></code> to make sound work.  If there isn’t one for the
chip used on your board:  Bad luck.  Start writing a new one.  Well,
you might want to check the video4linux mailing list archive first…</p>
<p>Of course you need a correctly installed soundcard unless you have the
speakers connected directly to the grabber board.  Hint: check the
mixer settings too.  ALSA for example has everything muted by default.</p>
<div class="section" id="how-sound-works-in-detail">
<h3>7.1.1.1.1. How sound works in detail<a class="headerlink" href="#how-sound-works-in-detail" title="Permalink to this headline">¶</a></h3>
<p>Still doesn’t work?  Looks like some driver hacking is required.
Below is a do-it-yourself description for you.</p>
<p>The bt8xx chips have 32 general purpose pins, and registers to control
these pins.  One register is the output enable register
(<code class="docutils literal notranslate"><span class="pre">BT848_GPIO_OUT_EN</span></code>), it says which pins are actively driven by the
bt848 chip.  Another one is the data register (<code class="docutils literal notranslate"><span class="pre">BT848_GPIO_DATA</span></code>), where
you can get/set the status if these pins.  They can be used for input
and output.</p>
<p>Most grabber board vendors use these pins to control an external chip
which does the sound routing.  But every board is a little different.
These pins are also used by some companies to drive remote control
receiver chips.  Some boards use the i2c bus instead of the gpio pins
to connect the mux chip.</p>
<p>As mentioned above, there is a array which holds the required
information for each known board.  You basically have to create a new
line for your board.  The important fields are these two:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct tvcard
{
      [ ... ]
      u32 gpiomask;
      u32 audiomux[6]; /* Tuner, Radio, external, internal, mute, stereo */
};
</pre></div>
</div>
<p>gpiomask specifies which pins are used to control the audio mux chip.
The corresponding bits in the output enable register
(<code class="docutils literal notranslate"><span class="pre">BT848_GPIO_OUT_EN</span></code>) will be set as these pins must be driven by the
bt848 chip.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">audiomux[]</span></code> array holds the data values for the different inputs
(i.e. which pins must be high/low for tuner/mute/…).  This will be
written to the data register (<code class="docutils literal notranslate"><span class="pre">BT848_GPIO_DATA</span></code>) to switch the audio
mux.</p>
<p>What you have to do is figure out the correct values for gpiomask and
the audiomux array.  If you have Windows and the drivers four your
card installed, you might to check out if you can read these registers
values used by the windows driver.  A tool to do this is available
from <a class="reference external" href="http://btwincap.sourceforge.net/download.html">http://btwincap.sourceforge.net/download.html</a>.</p>
<p>You might also dig around in the <code class="docutils literal notranslate"><span class="pre">*.ini</span></code> files of the Windows applications.
You can have a look at the board to see which of the gpio pins are
connected at all and then start trial-and-error …</p>
<p>Starting with release 0.7.41 bttv has a number of insmod options to
make the gpio debugging easier:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>bttv_gpio=0/1</td>
<td>enable/disable gpio debug messages</td>
</tr>
<tr class="row-even"><td>gpiomask=n</td>
<td>set the gpiomask value</td>
</tr>
<tr class="row-odd"><td>audiomux=i,j,…</td>
<td>set the values of the audiomux array</td>
</tr>
<tr class="row-even"><td>audioall=a</td>
<td>set the values of the audiomux array (one
value for all array elements, useful to check
out which effect the particular value has).</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The messages printed with <code class="docutils literal notranslate"><span class="pre">bttv_gpio=1</span></code> look like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>bttv0: gpio: en=00000027, out=00000024 in=00ffffd8 [audio: off]

en  =   output _en_able register (BT848_GPIO_OUT_EN)
out =   _out_put bits of the data register (BT848_GPIO_DATA),
        i.e. BT848_GPIO_DATA &amp; BT848_GPIO_OUT_EN
in  =   _in_put bits of the data register,
        i.e. BT848_GPIO_DATA &amp; ~BT848_GPIO_OUT_EN
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>