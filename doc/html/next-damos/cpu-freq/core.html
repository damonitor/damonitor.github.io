

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>General description of the CPUFreq core and CPUFreq notifiers &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/mm/damon/index.html">Monitoring Data Accesses</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../vm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>General description of the CPUFreq core and CPUFreq notifiers</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/cpu-freq/core.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="general-description-of-the-cpufreq-core-and-cpufreq-notifiers">
<h1>General description of the CPUFreq core and CPUFreq notifiers<a class="headerlink" href="#general-description-of-the-cpufreq-core-and-cpufreq-notifiers" title="Permalink to this headline">¶</a></h1>
<dl class="docutils">
<dt>Authors:</dt>
<dd><ul class="first last simple">
<li>Dominik Brodowski  &lt;<a class="reference external" href="mailto:linux&#37;&#52;&#48;brodo&#46;de">linux<span>&#64;</span>brodo<span>&#46;</span>de</a>&gt;</li>
<li>David Kimdon &lt;<a class="reference external" href="mailto:dwhedon&#37;&#52;&#48;debian&#46;org">dwhedon<span>&#64;</span>debian<span>&#46;</span>org</a>&gt;</li>
<li>Rafael J. Wysocki &lt;<a class="reference external" href="mailto:rafael&#46;j&#46;wysocki&#37;&#52;&#48;intel&#46;com">rafael<span>&#46;</span>j<span>&#46;</span>wysocki<span>&#64;</span>intel<span>&#46;</span>com</a>&gt;</li>
<li>Viresh Kumar &lt;<a class="reference external" href="mailto:viresh&#46;kumar&#37;&#52;&#48;linaro&#46;org">viresh<span>&#46;</span>kumar<span>&#64;</span>linaro<span>&#46;</span>org</a>&gt;</li>
</ul>
</dd>
</dl>
<div class="section" id="general-information">
<h2>1. General Information<a class="headerlink" href="#general-information" title="Permalink to this headline">¶</a></h2>
<p>The CPUFreq core code is located in drivers/cpufreq/cpufreq.c. This
cpufreq code offers a standardized interface for the CPUFreq
architecture drivers (those pieces of code that do actual
frequency transitions), as well as to “notifiers”. These are device
drivers or other part of the kernel that need to be informed of
policy changes (ex. thermal modules like ACPI) or of all
frequency changes (ex. timing code) or even need to force certain
speed limits (like LCD drivers on ARM architecture). Additionally, the
kernel “constant” loops_per_jiffy is updated on frequency changes
here.</p>
<p>Reference counting of the cpufreq policies is done by cpufreq_cpu_get
and cpufreq_cpu_put, which make sure that the cpufreq driver is
correctly registered with the core, and will not be unloaded until
cpufreq_put_cpu is called. That also ensures that the respective cpufreq
policy doesn’t get freed while being used.</p>
</div>
<div class="section" id="cpufreq-notifiers">
<h2>2. CPUFreq notifiers<a class="headerlink" href="#cpufreq-notifiers" title="Permalink to this headline">¶</a></h2>
<p>CPUFreq notifiers conform to the standard kernel notifier interface.
See linux/include/linux/notifier.h for details on notifiers.</p>
<p>There are two different CPUFreq notifiers - policy notifiers and
transition notifiers.</p>
<div class="section" id="cpufreq-policy-notifiers">
<h3>2.1 CPUFreq policy notifiers<a class="headerlink" href="#cpufreq-policy-notifiers" title="Permalink to this headline">¶</a></h3>
<p>These are notified when a new policy is created or removed.</p>
<p>The phase is specified in the second argument to the notifier.  The phase is
CPUFREQ_CREATE_POLICY when the policy is first created and it is
CPUFREQ_REMOVE_POLICY when the policy is removed.</p>
<p>The third argument, a <code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*pointer</span></code>, points to a struct cpufreq_policy
consisting of several values, including min, max (the lower and upper
frequencies (in kHz) of the new policy).</p>
</div>
<div class="section" id="cpufreq-transition-notifiers">
<h3>2.2 CPUFreq transition notifiers<a class="headerlink" href="#cpufreq-transition-notifiers" title="Permalink to this headline">¶</a></h3>
<p>These are notified twice for each online CPU in the policy, when the
CPUfreq driver switches the CPU core frequency and this change has no
any external implications.</p>
<p>The second argument specifies the phase - CPUFREQ_PRECHANGE or
CPUFREQ_POSTCHANGE.</p>
<p>The third argument is a struct cpufreq_freqs with the following
values:</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>cpu</td>
<td>number of the affected CPU</td>
</tr>
<tr class="row-even"><td>old</td>
<td>old frequency</td>
</tr>
<tr class="row-odd"><td>new</td>
<td>new frequency</td>
</tr>
<tr class="row-even"><td>flags</td>
<td>flags of the cpufreq driver</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="cpufreq-table-generation-with-operating-performance-point-opp">
<h2>3. CPUFreq Table Generation with Operating Performance Point (OPP)<a class="headerlink" href="#cpufreq-table-generation-with-operating-performance-point-opp" title="Permalink to this headline">¶</a></h2>
<p>For details about OPP, see Documentation/power/opp.rst</p>
<dl class="docutils">
<dt>dev_pm_opp_init_cpufreq_table -</dt>
<dd><p class="first">This function provides a ready to use conversion routine to translate
the OPP layer’s internal information about the available frequencies
into a format readily providable to cpufreq.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Do not use this function in interrupt context.</p>
</div>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>soc_pm_init()
{
       /* Do things */
       r = dev_pm_opp_init_cpufreq_table(dev, &amp;freq_table);
       if (!r)
               policy-&gt;freq_table = freq_table;
       /* Do other things */
}
</pre></div>
</div>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This function is available only if CONFIG_CPU_FREQ is enabled in
addition to CONFIG_PM_OPP.</p>
</div>
</dd>
<dt>dev_pm_opp_free_cpufreq_table</dt>
<dd>Free up the table allocated by dev_pm_opp_init_cpufreq_table</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>