

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Active MM &mdash; The Linux Kernel  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.14.0-rc1-mm1</div><div>NOTE: This is not the latest version of the doc.  Visit <a href="https://docs.kernel.org" style="color:#bbbbbb"> here </a> for the latest version.
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/mm/damon/index.html">Monitoring Data Accesses</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Active MM</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/vm/active_mm.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="active-mm">
<span id="id1"></span><h1>Active MM<a class="headerlink" href="#active-mm" title="Permalink to this headline">Â¶</a></h1>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>List:       linux-kernel
Subject:    Re: active_mm
From:       Linus Torvalds &lt;torvalds () transmeta ! com&gt;
Date:       1999-07-30 21:36:24

Cc&#39;d to linux-kernel, because I don&#39;t write explanations all that often,
and when I do I feel better about more people reading them.

On Fri, 30 Jul 1999, David Mosberger wrote:
&gt;
&gt; Is there a brief description someplace on how &quot;mm&quot; vs. &quot;active_mm&quot; in
&gt; the task_struct are supposed to be used?  (My apologies if this was
&gt; discussed on the mailing lists---I just returned from vacation and
&gt; wasn&#39;t able to follow linux-kernel for a while).

Basically, the new setup is:

 - we have &quot;real address spaces&quot; and &quot;anonymous address spaces&quot;. The
   difference is that an anonymous address space doesn&#39;t care about the
   user-level page tables at all, so when we do a context switch into an
   anonymous address space we just leave the previous address space
   active.

   The obvious use for a &quot;anonymous address space&quot; is any thread that
   doesn&#39;t need any user mappings - all kernel threads basically fall into
   this category, but even &quot;real&quot; threads can temporarily say that for
   some amount of time they are not going to be interested in user space,
   and that the scheduler might as well try to avoid wasting time on
   switching the VM state around. Currently only the old-style bdflush
   sync does that.

 - &quot;tsk-&gt;mm&quot; points to the &quot;real address space&quot;. For an anonymous process,
   tsk-&gt;mm will be NULL, for the logical reason that an anonymous process
   really doesn&#39;t _have_ a real address space at all.

 - however, we obviously need to keep track of which address space we
   &quot;stole&quot; for such an anonymous user. For that, we have &quot;tsk-&gt;active_mm&quot;,
   which shows what the currently active address space is.

   The rule is that for a process with a real address space (ie tsk-&gt;mm is
   non-NULL) the active_mm obviously always has to be the same as the real
   one.

   For a anonymous process, tsk-&gt;mm == NULL, and tsk-&gt;active_mm is the
   &quot;borrowed&quot; mm while the anonymous process is running. When the
   anonymous process gets scheduled away, the borrowed address space is
   returned and cleared.

To support all that, the &quot;struct mm_struct&quot; now has two counters: a
&quot;mm_users&quot; counter that is how many &quot;real address space users&quot; there are,
and a &quot;mm_count&quot; counter that is the number of &quot;lazy&quot; users (ie anonymous
users) plus one if there are any real users.

Usually there is at least one real user, but it could be that the real
user exited on another CPU while a lazy user was still active, so you do
actually get cases where you have a address space that is _only_ used by
lazy users. That is often a short-lived state, because once that thread
gets scheduled away in favour of a real thread, the &quot;zombie&quot; mm gets
released because &quot;mm_count&quot; becomes zero.

Also, a new rule is that _nobody_ ever has &quot;init_mm&quot; as a real MM any
more. &quot;init_mm&quot; should be considered just a &quot;lazy context when no other
context is available&quot;, and in fact it is mainly used just at bootup when
no real VM has yet been created. So code that used to check

       if (current-&gt;mm == &amp;init_mm)

should generally just do

       if (!current-&gt;mm)

instead (which makes more sense anyway - the test is basically one of &quot;do
we have a user context&quot;, and is generally done by the page fault handler
and things like that).

Anyway, I put a pre-patch-2.3.13-1 on ftp.kernel.org just a moment ago,
because it slightly changes the interfaces to accommodate the alpha (who
would have thought it, but the alpha actually ends up having one of the
ugliest context switch codes - unlike the other architectures where the MM
and register state is separate, the alpha PALcode joins the two, and you
need to switch both together).

(From http://marc.info/?l=linux-kernel&amp;m=93337278602211&amp;w=2)
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright The kernel development community

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>