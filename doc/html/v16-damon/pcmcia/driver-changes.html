

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Driver changes &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/mm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Driver changes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/pcmcia/driver-changes.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="driver-changes">
<h1>Driver changes<a class="headerlink" href="#driver-changes" title="Permalink to this headline">¶</a></h1>
<p>This file details changes in 2.6 which affect PCMCIA card driver authors:</p>
<ul>
<li><dl class="first docutils">
<dt>pcmcia_loop_config() and autoconfiguration (as of 2.6.36)</dt>
<dd><p class="first">If <cite>struct pcmcia_device *p_dev-&gt;config_flags</cite> is set accordingly,
pcmcia_loop_config() now sets up certain configuration values
automatically, though the driver may still override the settings
in the callback function. The following autoconfiguration options
are provided at the moment:</p>
<blockquote class="last">
<div><ul class="simple">
<li>CONF_AUTO_CHECK_VCC : check for matching Vcc</li>
<li>CONF_AUTO_SET_VPP   : set Vpp</li>
<li>CONF_AUTO_AUDIO     : auto-enable audio line, if required</li>
<li>CONF_AUTO_SET_IO    : set ioport resources (-&gt;resource[0,1])</li>
<li>CONF_AUTO_SET_IOMEM : set first iomem resource (-&gt;resource[2])</li>
</ul>
</div></blockquote>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>pcmcia_request_configuration -&gt; pcmcia_enable_device (as of 2.6.36)</dt>
<dd><p class="first last">pcmcia_request_configuration() got renamed to pcmcia_enable_device(),
as it mirrors pcmcia_disable_device(). Configuration settings are now
stored in struct pcmcia_device, e.g. in the fields config_flags,
config_index, config_base, vpp.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>pcmcia_request_window changes (as of 2.6.36)</dt>
<dd><p class="first last">Instead of win_req_t, drivers are now requested to fill out
<cite>struct pcmcia_device *p_dev-&gt;resource[2,3,4,5]</cite> for up to four ioport
ranges. After a call to pcmcia_request_window(), the regions found there
are reserved and may be used immediately – until pcmcia_release_window()
is called.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>pcmcia_request_io changes (as of 2.6.36)</dt>
<dd><p class="first last">Instead of io_req_t, drivers are now requested to fill out
<cite>struct pcmcia_device *p_dev-&gt;resource[0,1]</cite> for up to two ioport
ranges. After a call to pcmcia_request_io(), the ports found there
are reserved, after calling pcmcia_request_configuration(), they may
be used.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>No dev_info_t, no cs_types.h (as of 2.6.36)</dt>
<dd><p class="first last">dev_info_t and a few other typedefs are removed. No longer use them
in PCMCIA device drivers. Also, do not include pcmcia/cs_types.h, as
this file is gone.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>No dev_node_t (as of 2.6.35)</dt>
<dd><p class="first last">There is no more need to fill out a “dev_node_t” structure.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>New IRQ request rules (as of 2.6.35)</dt>
<dd><p class="first">Instead of the old pcmcia_request_irq() interface, drivers may now
choose between:</p>
<ul class="last simple">
<li>calling request_irq/free_irq directly. Use the IRQ from <cite>*p_dev-&gt;irq</cite>.</li>
<li>use pcmcia_request_irq(p_dev, handler_t); the PCMCIA core will
clean up automatically on calls to pcmcia_disable_device() or
device ejection.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>no cs_error / CS_CHECK / CONFIG_PCMCIA_DEBUG (as of 2.6.33)</dt>
<dd><p class="first last">Instead of the cs_error() callback or the CS_CHECK() macro, please use
Linux-style checking of return values, and – if necessary – debug
messages using “dev_dbg()” or “pr_debug()”.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>New CIS tuple access (as of 2.6.33)</dt>
<dd><p class="first last">Instead of pcmcia_get_{first,next}_tuple(), pcmcia_get_tuple_data() and
pcmcia_parse_tuple(), a driver shall use “pcmcia_get_tuple()” if it is
only interested in one (raw) tuple, or “pcmcia_loop_tuple()” if it is
interested in all tuples of one type. To decode the MAC from CISTPL_FUNCE,
a new helper “pcmcia_get_mac_from_cis()” was added.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>New configuration loop helper (as of 2.6.28)</dt>
<dd><p class="first last">By calling pcmcia_loop_config(), a driver can iterate over all available
configuration options. During a driver’s probe() phase, one doesn’t need
to use pcmcia_get_{first,next}_tuple, pcmcia_get_tuple_data and
pcmcia_parse_tuple directly in most if not all cases.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>New release helper (as of 2.6.17)</dt>
<dd><p class="first last">Instead of calling pcmcia_release_{configuration,io,irq,win}, all that’s
necessary now is calling pcmcia_disable_device. As there is no valid
reason left to call pcmcia_release_io and pcmcia_release_irq, the
exports for them were removed.</p>
</dd>
</dl>
</li>
<li><p class="first">Unify detach and REMOVAL event code, as well as attach and INSERTION
code (as of 2.6.16):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>void (*remove)          (struct pcmcia_device *dev);
int (*probe)            (struct pcmcia_device *dev);
</pre></div>
</div>
</li>
<li><p class="first">Move suspend, resume and reset out of event handler (as of 2.6.16):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int (*suspend)          (struct pcmcia_device *dev);
int (*resume)           (struct pcmcia_device *dev);
</pre></div>
</div>
<p>should be initialized in struct pcmcia_driver, and handle
(SUSPEND == RESET_PHYSICAL) and (RESUME == CARD_RESET) events</p>
</li>
<li><dl class="first docutils">
<dt>event handler initialization in struct pcmcia_driver (as of 2.6.13)</dt>
<dd><p class="first last">The event handler is notified of all events, and must be initialized
as the event() callback in the driver’s struct pcmcia_driver.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>pcmcia/version.h should not be used (as of 2.6.13)</dt>
<dd><p class="first last">This file will be removed eventually.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>in-kernel device&lt;-&gt;driver matching (as of 2.6.13)</dt>
<dd><p class="first last">PCMCIA devices and their correct drivers can now be matched in
kernelspace. See ‘devicetable.txt’ for details.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Device model integration (as of 2.6.11)</dt>
<dd><p class="first last">A struct pcmcia_device is registered with the device model core,
and can be used (e.g. for SET_NETDEV_DEV) by using
handle_to_dev(client_handle_t * handle).</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Convert internal I/O port addresses to unsigned int (as of 2.6.11)</dt>
<dd><p class="first last">ioaddr_t should be replaced by unsigned int in PCMCIA card drivers.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>irq_mask and irq_list parameters (as of 2.6.11)</dt>
<dd><p class="first last">The irq_mask and irq_list parameters should no longer be used in
PCMCIA card drivers. Instead, it is the job of the PCMCIA core to
determine which IRQ should be used. Therefore, link-&gt;irq.IRQInfo2
is ignored.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>client-&gt;PendingEvents is gone (as of 2.6.11)</dt>
<dd><p class="first last">client-&gt;PendingEvents is no longer available.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>client-&gt;Attributes are gone (as of 2.6.11)</dt>
<dd><p class="first last">client-&gt;Attributes is unused, therefore it is removed from all
PCMCIA card drivers</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>core functions no longer available (as of 2.6.11)</dt>
<dd><p class="first">The following functions have been removed from the kernel source
because they are unused by all in-kernel drivers, and no external
driver was reported to rely on them:</p>
<div class="last highlight-none notranslate"><div class="highlight"><pre><span></span>pcmcia_get_first_region()
pcmcia_get_next_region()
pcmcia_modify_window()
pcmcia_set_event_mask()
pcmcia_get_first_window()
pcmcia_get_next_window()
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>device list iteration upon module removal (as of 2.6.10)</dt>
<dd><p class="first last">It is no longer necessary to iterate on the driver’s internal
client list and call the -&gt;detach() function upon module removal.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Resource management. (as of 2.6.8)</dt>
<dd><p class="first last">Although the PCMCIA subsystem will allocate resources for cards,
it no longer marks these resources busy. This means that driver
authors are now responsible for claiming your resources as per
other drivers in Linux. You should use request_region() to mark
your IO regions in-use, and request_mem_region() to mark your
memory regions in-use. The name argument should be a pointer to
your driver name. Eg, for pcnet_cs, name should point to the
string “pcnet_cs”.</p>
</dd>
</dl>
</li>
<li><p class="first">CardServices is gone
CardServices() in 2.4 is just a big switch statement to call various
services.  In 2.6, all of those entry points are exported and called
directly (except for pcmcia_report_error(), just use cs_error() instead).</p>
</li>
<li><p class="first">struct pcmcia_driver
You need to use struct pcmcia_driver and pcmcia_{un,}register_driver
instead of {un,}register_pccard_driver</p>
</li>
</ul>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>