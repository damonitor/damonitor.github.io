

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Linux Magic System Request Key Hacks &mdash; The Linux Kernel  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="USB4 and Thunderbolt" href="thunderbolt.html" />
    <link rel="prev" title="Video Mode Selection Support 2.13" href="svga.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.8.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">The Linux kernel user’s and administrator’s guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="README.html">Linux kernel release 5.x &lt;http://kernel.org/&gt;</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel-parameters.html">The kernel’s command-line parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="devices.html">Linux allocated devices (4.x+ version)</a></li>
<li class="toctree-l2"><a class="reference internal" href="sysctl/index.html">Documentation for /proc/sys</a></li>
<li class="toctree-l2"><a class="reference internal" href="hw-vuln/index.html">Hardware vulnerabilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="reporting-bugs.html">Reporting bugs</a></li>
<li class="toctree-l2"><a class="reference internal" href="security-bugs.html">Security bugs</a></li>
<li class="toctree-l2"><a class="reference internal" href="bug-hunting.html">Bug hunting</a></li>
<li class="toctree-l2"><a class="reference internal" href="bug-bisect.html">Bisecting a bug</a></li>
<li class="toctree-l2"><a class="reference internal" href="tainted-kernels.html">Tainted kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="ramoops.html">Ramoops oops/panic logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="dynamic-debug-howto.html">Dynamic debug</a></li>
<li class="toctree-l2"><a class="reference internal" href="init.html">Explaining the “No working init found.” boot hang message</a></li>
<li class="toctree-l2"><a class="reference internal" href="kdump/index.html">Documentation for Kdump - The kexec-based Crash Dumping Solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="perf/index.html">Performance monitor support</a></li>
<li class="toctree-l2"><a class="reference internal" href="sysfs-rules.html">Rules on how to access information in sysfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="acpi/index.html">ACPI Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="aoe/index.html">ATA over Ethernet (AoE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="auxdisplay/index.html">Auxiliary Display Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="bcache.html">A block layer cache (bcache)</a></li>
<li class="toctree-l2"><a class="reference internal" href="binderfs.html">The Android binderfs Filesystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="binfmt-misc.html">Kernel Support for miscellaneous Binary Formats (binfmt_misc)</a></li>
<li class="toctree-l2"><a class="reference internal" href="blockdev/index.html">The Linux RapidIO Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="bootconfig.html">Boot Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="braille-console.html">Linux Braille Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="btmrvl.html">btmrvl driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="cgroup-v1/index.html">Control Groups version 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="cgroup-v2.html">Control Group v2</a></li>
<li class="toctree-l2"><a class="reference internal" href="cifs/index.html">CIFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="clearing-warn-once.html">Clearing WARN_ONCE</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpu-load.html">CPU load</a></li>
<li class="toctree-l2"><a class="reference internal" href="cputopology.html">How CPU topology info is exported via sysfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="dell_rbu.html">Dell Remote BIOS Update driver (dell_rbu)</a></li>
<li class="toctree-l2"><a class="reference internal" href="device-mapper/index.html">Device Mapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="edid.html">EDID</a></li>
<li class="toctree-l2"><a class="reference internal" href="efi-stub.html">The EFI Boot Stub</a></li>
<li class="toctree-l2"><a class="reference internal" href="ext4.html">ext4 General Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="nfs/index.html">NFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpio/index.html">gpio</a></li>
<li class="toctree-l2"><a class="reference internal" href="highuid.html">Notes on the change from 16-bit UIDs to 32-bit UIDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="hw_random.html">Linux support for random number generator in i8xx chipsets</a></li>
<li class="toctree-l2"><a class="reference internal" href="initrd.html">Using the initial RAM disk (initrd)</a></li>
<li class="toctree-l2"><a class="reference internal" href="iostats.html">I/O statistics fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="java.html">Java(tm) Binary Kernel Support for Linux v1.03</a></li>
<li class="toctree-l2"><a class="reference internal" href="jfs.html">IBM’s Journaled File System (JFS) for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel-per-CPU-kthreads.html">Reducing OS jitter due to per-cpu kthreads</a></li>
<li class="toctree-l2"><a class="reference internal" href="laptops/index.html">Laptop Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="lcd-panel-cgram.html">Parallel port LCD/Keypad Panel support</a></li>
<li class="toctree-l2"><a class="reference internal" href="ldm.html">LDM - Logical Disk Manager (Dynamic Disks)</a></li>
<li class="toctree-l2"><a class="reference internal" href="lockup-watchdogs.html">Softlockup detector and hardlockup detector (aka nmi_watchdog)</a></li>
<li class="toctree-l2"><a class="reference internal" href="LSM/index.html">Linux Security Module Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="md.html">RAID arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="media/index.html">Media subsystem admin and user guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="mm/index.html">Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="module-signing.html">Kernel module signing facility</a></li>
<li class="toctree-l2"><a class="reference internal" href="mono.html">Mono(tm) Binary Kernel Support for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="namespaces/index.html">Namespaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="numastat.html">Numa policy hit/miss statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="parport.html">Parport</a></li>
<li class="toctree-l2"><a class="reference internal" href="perf-security.html">Perf events and tool security</a></li>
<li class="toctree-l2"><a class="reference internal" href="pm/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="pnp.html">Linux Plug and Play Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="rapidio.html">RapidIO Subsystem Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="ras.html">Reliability, Availability and Serviceability</a></li>
<li class="toctree-l2"><a class="reference internal" href="rtc.html">Real Time Clock (RTC) Drivers for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="serial-console.html">Linux Serial Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="svga.html">Video Mode Selection Support 2.13</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Linux Magic System Request Key Hacks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#what-is-the-magic-sysrq-key">What is the magic SysRq key?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-do-i-enable-the-magic-sysrq-key">How do I enable the magic SysRq key?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-do-i-use-the-magic-sysrq-key">How do I use the magic SysRq key?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-are-the-command-keys">What are the ‘command’ keys?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#okay-so-what-can-i-use-them-for">Okay, so what can I use them for?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sometimes-sysrq-seems-to-get-stuck-after-using-it-what-can-i-do">Sometimes SysRq seems to get ‘stuck’ after using it, what can I do?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#i-hit-sysrq-but-nothing-seems-to-happen-what-s-wrong">I hit SysRq, but nothing seems to happen, what’s wrong?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#i-want-to-add-sysrq-key-events-to-a-module-how-does-it-work">I want to add SysRQ key events to a module, how does it work?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#when-i-hit-a-sysrq-key-combination-only-the-header-appears-on-the-console">When I hit a SysRq key combination only the header appears on the console?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#i-have-more-questions-who-can-i-ask">I have more questions, who can I ask?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#credits">Credits</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="thunderbolt.html">USB4 and Thunderbolt</a></li>
<li class="toctree-l2"><a class="reference internal" href="ufs.html">Using UFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="unicode.html">Unicode support</a></li>
<li class="toctree-l2"><a class="reference internal" href="vga-softcursor.html">Software cursor for VGA</a></li>
<li class="toctree-l2"><a class="reference internal" href="video-output.html">Video Output Switcher Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="wimax/index.html">WiMAX subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="xfs.html">The SGI XFS Filesystem</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Open Firmware and Device Tree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mhi/index.html">MHI</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arm/index.html">ARM Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arm64/index.html">ARM64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ia64/index.html">IA-64 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m68k/index.html">m68k Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mips/index.html">MIPS-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nios2/nios2.html">Linux on the Nios II architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../openrisc/index.html">OpenRISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parisc/index.html">PA-RISC Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../powerpc/index.html">powerpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../riscv/index.html">RISC-V architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../s390/index.html">s390 Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sh/index.html">SuperH Interfaces Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sparc/index.html">Sparc Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../x86/index.html">x86-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xtensa/index.html">Xtensa Architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/ext4/index.html">ext4 Data Structures and Algorithms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">The Linux kernel user’s and administrator’s guide</a> &raquo;</li>
        
      <li>Linux Magic System Request Key Hacks</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/admin-guide/sysrq.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="linux-magic-system-request-key-hacks">
<h1>Linux Magic System Request Key Hacks<a class="headerlink" href="#linux-magic-system-request-key-hacks" title="Permalink to this headline">¶</a></h1>
<p>Documentation for sysrq.c</p>
<div class="section" id="what-is-the-magic-sysrq-key">
<h2>What is the magic SysRq key?<a class="headerlink" href="#what-is-the-magic-sysrq-key" title="Permalink to this headline">¶</a></h2>
<p>It is a ‘magical’ key combo you can hit which the kernel will respond to
regardless of whatever else it is doing, unless it is completely locked up.</p>
</div>
<div class="section" id="how-do-i-enable-the-magic-sysrq-key">
<h2>How do I enable the magic SysRq key?<a class="headerlink" href="#how-do-i-enable-the-magic-sysrq-key" title="Permalink to this headline">¶</a></h2>
<p>You need to say “yes” to ‘Magic SysRq key (CONFIG_MAGIC_SYSRQ)’ when
configuring the kernel. When running a kernel with SysRq compiled in,
/proc/sys/kernel/sysrq controls the functions allowed to be invoked via
the SysRq key. The default value in this file is set by the
CONFIG_MAGIC_SYSRQ_DEFAULT_ENABLE config symbol, which itself defaults
to 1. Here is the list of possible values in /proc/sys/kernel/sysrq:</p>
<blockquote>
<div><ul>
<li><p>0 - disable sysrq completely</p></li>
<li><p>1 - enable all functions of sysrq</p></li>
<li><p>&gt;1 - bitmask of allowed sysrq functions (see below for detailed function
description):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  2 =   0x2 - enable control of console logging level
  4 =   0x4 - enable control of keyboard (SAK, unraw)
  8 =   0x8 - enable debugging dumps of processes etc.
 16 =  0x10 - enable sync command
 32 =  0x20 - enable remount read-only
 64 =  0x40 - enable signalling of processes (term, kill, oom-kill)
128 =  0x80 - allow reboot/poweroff
256 = 0x100 - allow nicing of all RT tasks
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
<p>You can set the value in the file by the following command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo &quot;number&quot; &gt;/proc/sys/kernel/sysrq
</pre></div>
</div>
<p>The number may be written here either as decimal or as hexadecimal
with the 0x prefix. CONFIG_MAGIC_SYSRQ_DEFAULT_ENABLE must always be
written in hexadecimal.</p>
<p>Note that the value of <code class="docutils literal notranslate"><span class="pre">/proc/sys/kernel/sysrq</span></code> influences only the invocation
via a keyboard. Invocation of any operation via <code class="docutils literal notranslate"><span class="pre">/proc/sysrq-trigger</span></code> is
always allowed (by a user with admin privileges).</p>
</div>
<div class="section" id="how-do-i-use-the-magic-sysrq-key">
<h2>How do I use the magic SysRq key?<a class="headerlink" href="#how-do-i-use-the-magic-sysrq-key" title="Permalink to this headline">¶</a></h2>
<dl>
<dt>On x86</dt><dd><p>You press the key combo <kbd class="kbd docutils literal notranslate">ALT-SysRq-&lt;command key&gt;</kbd>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some
keyboards may not have a key labeled ‘SysRq’. The ‘SysRq’ key is
also known as the ‘Print Screen’ key. Also some keyboards cannot
handle so many keys being pressed at the same time, so you might
have better luck with press <kbd class="kbd docutils literal notranslate">Alt</kbd>, press <kbd class="kbd docutils literal notranslate">SysRq</kbd>,
release <kbd class="kbd docutils literal notranslate">SysRq</kbd>, press <kbd class="kbd docutils literal notranslate">&lt;command key&gt;</kbd>, release everything.</p>
</div>
</dd>
<dt>On SPARC</dt><dd><p>You press <kbd class="kbd docutils literal notranslate">ALT-STOP-&lt;command key&gt;</kbd>, I believe.</p>
</dd>
<dt>On the serial console (PC style standard serial ports only)</dt><dd><p>You send a <code class="docutils literal notranslate"><span class="pre">BREAK</span></code>, then within 5 seconds a command key. Sending
<code class="docutils literal notranslate"><span class="pre">BREAK</span></code> twice is interpreted as a normal BREAK.</p>
</dd>
<dt>On PowerPC</dt><dd><p>Press <kbd class="kbd docutils literal notranslate">ALT - Print Screen</kbd> (or <kbd class="kbd docutils literal notranslate">F13</kbd>) - <kbd class="kbd docutils literal notranslate">&lt;command key&gt;</kbd>.
<kbd class="kbd docutils literal notranslate">Print Screen</kbd> (or <kbd class="kbd docutils literal notranslate">F13</kbd>) - <kbd class="kbd docutils literal notranslate">&lt;command key&gt;</kbd> may suffice.</p>
</dd>
<dt>On other</dt><dd><p>If you know of the key combos for other architectures, please
let me know so I can add them to this section.</p>
</dd>
<dt>On all</dt><dd><p>Write a character to /proc/sysrq-trigger.  e.g.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo t &gt; /proc/sysrq-trigger
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="what-are-the-command-keys">
<h2>What are the ‘command’ keys?<a class="headerlink" href="#what-are-the-command-keys" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 14%" />
<col style="width: 86%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Command</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">b</span></code></p></td>
<td><p>Will immediately reboot the system without syncing or unmounting
your disks.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">c</span></code></p></td>
<td><p>Will perform a system crash by a NULL pointer dereference.
A crashdump will be taken if configured.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">d</span></code></p></td>
<td><p>Shows all locks that are held.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">e</span></code></p></td>
<td><p>Send a SIGTERM to all processes, except for init.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">f</span></code></p></td>
<td><p>Will call the oom killer to kill a memory hog process, but do not
panic if nothing can be killed.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">g</span></code></p></td>
<td><p>Used by kgdb (kernel debugger)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">h</span></code></p></td>
<td><p>Will display help (actually any other key than those listed
here will display help. but <code class="docutils literal notranslate"><span class="pre">h</span></code> is easy to remember :-)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">i</span></code></p></td>
<td><p>Send a SIGKILL to all processes, except for init.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">j</span></code></p></td>
<td><p>Forcibly “Just thaw it” - filesystems frozen by the FIFREEZE ioctl.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">k</span></code></p></td>
<td><p>Secure Access Key (SAK) Kills all programs on the current virtual
console. NOTE: See important comments below in SAK section.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">l</span></code></p></td>
<td><p>Shows a stack backtrace for all active CPUs.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">m</span></code></p></td>
<td><p>Will dump current memory info to your console.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">n</span></code></p></td>
<td><p>Used to make RT tasks nice-able</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">o</span></code></p></td>
<td><p>Will shut your system off (if configured and supported).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">p</span></code></p></td>
<td><p>Will dump the current registers and flags to your console.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">q</span></code></p></td>
<td><p>Will dump per CPU lists of all armed hrtimers (but NOT regular
timer_list timers) and detailed information about all
clockevent devices.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">r</span></code></p></td>
<td><p>Turns off keyboard raw mode and sets it to XLATE.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">s</span></code></p></td>
<td><p>Will attempt to sync all mounted filesystems.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">t</span></code></p></td>
<td><p>Will dump a list of current tasks and their information to your
console.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">u</span></code></p></td>
<td><p>Will attempt to remount all mounted filesystems read-only.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">v</span></code></p></td>
<td><p>Forcefully restores framebuffer console</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">v</span></code></p></td>
<td><p>Causes ETM buffer dump [ARM-specific]</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">w</span></code></p></td>
<td><p>Dumps tasks that are in uninterruptable (blocked) state.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">x</span></code></p></td>
<td><p>Used by xmon interface on ppc/powerpc platforms.
Show global PMU Registers on sparc64.
Dump all TLB entries on MIPS.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">y</span></code></p></td>
<td><p>Show global CPU Registers [SPARC-64 specific]</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">z</span></code></p></td>
<td><p>Dump the ftrace buffer</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0</span></code>-<code class="docutils literal notranslate"><span class="pre">9</span></code></p></td>
<td><p>Sets the console log level, controlling which kernel messages
will be printed to your console. (<code class="docutils literal notranslate"><span class="pre">0</span></code>, for example would make
it so that only emergency messages like PANICs or OOPSes would
make it to your console.)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="okay-so-what-can-i-use-them-for">
<h2>Okay, so what can I use them for?<a class="headerlink" href="#okay-so-what-can-i-use-them-for" title="Permalink to this headline">¶</a></h2>
<p>Well, unraw(r) is very handy when your X server or a svgalib program crashes.</p>
<p>sak(k) (Secure Access Key) is useful when you want to be sure there is no
trojan program running at console which could grab your password
when you would try to login. It will kill all programs on given console,
thus letting you make sure that the login prompt you see is actually
the one from init, not some trojan program.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>In its true form it is not a true SAK like the one in a
c2 compliant system, and it should not be mistaken as
such.</p>
</div>
<p>It seems others find it useful as (System Attention Key) which is
useful when you want to exit a program that will not let you switch consoles.
(For example, X or a svgalib program.)</p>
<p><code class="docutils literal notranslate"><span class="pre">reboot(b)</span></code> is good when you’re unable to shut down, it is an equivalent
of pressing the “reset” button.</p>
<p><code class="docutils literal notranslate"><span class="pre">crash(c)</span></code> can be used to manually trigger a crashdump when the system is hung.
Note that this just triggers a crash if there is no dump mechanism available.</p>
<p><code class="docutils literal notranslate"><span class="pre">sync(s)</span></code> is handy before yanking removable medium or after using a rescue
shell that provides no graceful shutdown – it will ensure your data is
safely written to the disk. Note that the sync hasn’t taken place until you see
the “OK” and “Done” appear on the screen.</p>
<p><code class="docutils literal notranslate"><span class="pre">umount(u)</span></code> can be used to mark filesystems as properly unmounted. From the
running system’s point of view, they will be remounted read-only. The remount
isn’t complete until you see the “OK” and “Done” message appear on the screen.</p>
<p>The loglevels <code class="docutils literal notranslate"><span class="pre">0</span></code>-<code class="docutils literal notranslate"><span class="pre">9</span></code> are useful when your console is being flooded with
kernel messages you do not want to see. Selecting <code class="docutils literal notranslate"><span class="pre">0</span></code> will prevent all but
the most urgent kernel messages from reaching your console. (They will
still be logged if syslogd/klogd are alive, though.)</p>
<p><code class="docutils literal notranslate"><span class="pre">term(e)</span></code> and <code class="docutils literal notranslate"><span class="pre">kill(i)</span></code> are useful if you have some sort of runaway process
you are unable to kill any other way, especially if it’s spawning other
processes.</p>
<p>“just thaw <code class="docutils literal notranslate"><span class="pre">it(j)</span></code>” is useful if your system becomes unresponsive due to a
frozen (probably root) filesystem via the FIFREEZE ioctl.</p>
</div>
<div class="section" id="sometimes-sysrq-seems-to-get-stuck-after-using-it-what-can-i-do">
<h2>Sometimes SysRq seems to get ‘stuck’ after using it, what can I do?<a class="headerlink" href="#sometimes-sysrq-seems-to-get-stuck-after-using-it-what-can-i-do" title="Permalink to this headline">¶</a></h2>
<p>That happens to me, also. I’ve found that tapping shift, alt, and control
on both sides of the keyboard, and hitting an invalid sysrq sequence again
will fix the problem. (i.e., something like <kbd class="kbd docutils literal notranslate">alt-sysrq-z</kbd>). Switching to
another virtual console (<kbd class="kbd docutils literal notranslate">ALT+Fn</kbd>) and then back again should also help.</p>
</div>
<div class="section" id="i-hit-sysrq-but-nothing-seems-to-happen-what-s-wrong">
<h2>I hit SysRq, but nothing seems to happen, what’s wrong?<a class="headerlink" href="#i-hit-sysrq-but-nothing-seems-to-happen-what-s-wrong" title="Permalink to this headline">¶</a></h2>
<p>There are some keyboards that produce a different keycode for SysRq than the
pre-defined value of 99
(see <code class="docutils literal notranslate"><span class="pre">KEY_SYSRQ</span></code> in <code class="docutils literal notranslate"><span class="pre">include/uapi/linux/input-event-codes.h</span></code>), or
which don’t have a SysRq key at all. In these cases, run <code class="docutils literal notranslate"><span class="pre">showkey</span> <span class="pre">-s</span></code> to find
an appropriate scancode sequence, and use <code class="docutils literal notranslate"><span class="pre">setkeycodes</span> <span class="pre">&lt;sequence&gt;</span> <span class="pre">99</span></code> to map
this sequence to the usual SysRq code (e.g., <code class="docutils literal notranslate"><span class="pre">setkeycodes</span> <span class="pre">e05b</span> <span class="pre">99</span></code>). It’s
probably best to put this command in a boot script. Oh, and by the way, you
exit <code class="docutils literal notranslate"><span class="pre">showkey</span></code> by not typing anything for ten seconds.</p>
</div>
<div class="section" id="i-want-to-add-sysrq-key-events-to-a-module-how-does-it-work">
<h2>I want to add SysRQ key events to a module, how does it work?<a class="headerlink" href="#i-want-to-add-sysrq-key-events-to-a-module-how-does-it-work" title="Permalink to this headline">¶</a></h2>
<p>In order to register a basic function with the table, you must first include
the header <code class="docutils literal notranslate"><span class="pre">include/linux/sysrq.h</span></code>, this will define everything else you need.
Next, you must create a <code class="docutils literal notranslate"><span class="pre">sysrq_key_op</span></code> struct, and populate it with A) the key
handler function you will use, B) a help_msg string, that will print when SysRQ
prints help, and C) an action_msg string, that will print right before your
handler is called. Your handler must conform to the prototype in ‘sysrq.h’.</p>
<p>After the <code class="docutils literal notranslate"><span class="pre">sysrq_key_op</span></code> is created, you can call the kernel function
<code class="docutils literal notranslate"><span class="pre">register_sysrq_key(int</span> <span class="pre">key,</span> <span class="pre">const</span> <span class="pre">struct</span> <span class="pre">sysrq_key_op</span> <span class="pre">*op_p);</span></code> this will
register the operation pointed to by <code class="docutils literal notranslate"><span class="pre">op_p</span></code> at table key ‘key’,
if that slot in the table is blank. At module unload time, you must call
the function <code class="docutils literal notranslate"><span class="pre">unregister_sysrq_key(int</span> <span class="pre">key,</span> <span class="pre">const</span> <span class="pre">struct</span> <span class="pre">sysrq_key_op</span> <span class="pre">*op_p)</span></code>,
which will remove the key op pointed to by ‘op_p’ from the key ‘key’, if and
only if it is currently registered in that slot. This is in case the slot has
been overwritten since you registered it.</p>
<p>The Magic SysRQ system works by registering key operations against a key op
lookup table, which is defined in ‘drivers/tty/sysrq.c’. This key table has
a number of operations registered into it at compile time, but is mutable,
and 2 functions are exported for interface to it:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>register_sysrq_key and unregister_sysrq_key.
</pre></div>
</div>
<p>Of course, never ever leave an invalid pointer in the table. I.e., when
your module that called register_sysrq_key() exits, it must call
unregister_sysrq_key() to clean up the sysrq key table entry that it used.
Null pointers in the table are always safe. :)</p>
<p>If for some reason you feel the need to call the handle_sysrq function from
within a function called by handle_sysrq, you must be aware that you are in
a lock (you are also in an interrupt handler, which means don’t sleep!), so
you must call <code class="docutils literal notranslate"><span class="pre">__handle_sysrq_nolock</span></code> instead.</p>
</div>
<div class="section" id="when-i-hit-a-sysrq-key-combination-only-the-header-appears-on-the-console">
<h2>When I hit a SysRq key combination only the header appears on the console?<a class="headerlink" href="#when-i-hit-a-sysrq-key-combination-only-the-header-appears-on-the-console" title="Permalink to this headline">¶</a></h2>
<p>Sysrq output is subject to the same console loglevel control as all
other console output.  This means that if the kernel was booted ‘quiet’
as is common on distro kernels the output may not appear on the actual
console, even though it will appear in the dmesg buffer, and be accessible
via the dmesg command and to the consumers of <code class="docutils literal notranslate"><span class="pre">/proc/kmsg</span></code>.  As a specific
exception the header line from the sysrq command is passed to all console
consumers as if the current loglevel was maximum.  If only the header
is emitted it is almost certain that the kernel loglevel is too low.
Should you require the output on the console channel then you will need
to temporarily up the console loglevel using <kbd class="kbd docutils literal notranslate">alt-sysrq-8</kbd> or:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo 8 &gt; /proc/sysrq-trigger
</pre></div>
</div>
<p>Remember to return the loglevel to normal after triggering the sysrq
command you are interested in.</p>
</div>
<div class="section" id="i-have-more-questions-who-can-i-ask">
<h2>I have more questions, who can I ask?<a class="headerlink" href="#i-have-more-questions-who-can-i-ask" title="Permalink to this headline">¶</a></h2>
<dl class="simple">
<dt>Just ask them on the linux-kernel mailing list:</dt><dd><p><a class="reference external" href="mailto:linux-kernel&#37;&#52;&#48;vger&#46;kernel&#46;org">linux-kernel<span>&#64;</span>vger<span>&#46;</span>kernel<span>&#46;</span>org</a></p>
</dd>
</dl>
</div>
<div class="section" id="credits">
<h2>Credits<a class="headerlink" href="#credits" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Written by Mydraal &lt;<a class="reference external" href="mailto:vulpyne&#37;&#52;&#48;vulpyne&#46;net">vulpyne<span>&#64;</span>vulpyne<span>&#46;</span>net</a>&gt;</p></li>
<li><p>Updated by Adam Sulmicki &lt;<a class="reference external" href="mailto:adam&#37;&#52;&#48;cfar&#46;umd&#46;edu">adam<span>&#64;</span>cfar<span>&#46;</span>umd<span>&#46;</span>edu</a>&gt;</p></li>
<li><p>Updated by Jeremy M. Dolan &lt;<a class="reference external" href="mailto:jmd&#37;&#52;&#48;turbogeek&#46;org">jmd<span>&#64;</span>turbogeek<span>&#46;</span>org</a>&gt; 2001/01/28 10:15:59</p></li>
<li><p>Added to by Crutcher Dunnavant &lt;<a class="reference external" href="mailto:crutcher+kernel&#37;&#52;&#48;datastacks&#46;com">crutcher+kernel<span>&#64;</span>datastacks<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="thunderbolt.html" class="btn btn-neutral float-right" title="USB4 and Thunderbolt" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="svga.html" class="btn btn-neutral float-left" title="Video Mode Selection Support 2.13" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright The kernel development community

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>