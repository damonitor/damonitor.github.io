

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Getting Started &mdash; The Linux Kernel  documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Optimization Guide" href="guide.html" />
    <link rel="prev" title="Monitoring Data Accesses" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.12.0-rc3-mm1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Monitoring Data Accesses</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Getting Started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tl-dr">TL; DR</a></li>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#kernel">Kernel</a></li>
<li class="toctree-l4"><a class="reference internal" href="#user-space-tool">User Space Tool</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#recording-data-access-patterns">Recording Data Access Patterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="#visualizing-recorded-patterns">Visualizing Recorded Patterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-access-pattern-aware-memory-management">Data Access Pattern Aware Memory Management</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="guide.html">Optimization Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage.html">Detailed Usages</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../vm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Monitoring Data Accesses</a> &raquo;</li>
        
      <li>Getting Started</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/admin-guide/mm/damon/start.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="getting-started">
<h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<p>This document briefly describes how you can use DAMON by demonstrating its
default user space tool.  Please note that this document describes only a part
of its features for brevity.  Please refer to <a class="reference internal" href="usage.html"><span class="doc">Detailed Usages</span></a> for more details.</p>
<div class="section" id="tl-dr">
<h2>TL; DR<a class="headerlink" href="#tl-dr" title="Permalink to this headline">¶</a></h2>
<p>Follow below 5 commands to monitor and visualize the access pattern of your
workload.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/sjp38/linux -b damon/master
/* build the kernel with CONFIG_DAMON=y, install, reboot */
$ mount -t debugfs none /sys/kernel/debug/
$ cd linux/tools/damon
$ ./damo record $(pidof &lt;your workload&gt;)
$ ./damo report heats --heatmap access_pattern.png
</pre></div>
</div>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<div class="section" id="kernel">
<h3>Kernel<a class="headerlink" href="#kernel" title="Permalink to this headline">¶</a></h3>
<p>You should first ensure your system is running on a kernel built with
<code class="docutils literal notranslate"><span class="pre">CONFIG_DAMON=y</span></code>.</p>
</div>
<div class="section" id="user-space-tool">
<h3>User Space Tool<a class="headerlink" href="#user-space-tool" title="Permalink to this headline">¶</a></h3>
<p>For the demonstration, we will use the default user space tool for DAMON,
called DAMON Operator (DAMO).  It is located at <code class="docutils literal notranslate"><span class="pre">tools/damon/damo</span></code> of the
DAMON development kernel source tree (<code class="docutils literal notranslate"><span class="pre">damon/master</span></code> branch of
<a class="reference external" href="https://github.com/sjp38/linux">https://github.com/sjp38/linux</a>).  For brevity, below examples assume you set
<code class="docutils literal notranslate"><span class="pre">$PATH</span></code> to point it.  It’s not mandatory, though.</p>
<p>Because DAMO is using the debugfs interface (refer to <a class="reference internal" href="usage.html"><span class="doc">Detailed Usages</span></a> for the
detail) of DAMON, you should ensure debugfs is mounted.  Mount it manually as
below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># mount -t debugfs none /sys/kernel/debug/
</pre></div>
</div>
<p>or append below line to your <code class="docutils literal notranslate"><span class="pre">/etc/fstab</span></code> file so that your system can
automatically mount debugfs from next booting:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>debugfs /sys/kernel/debug debugfs defaults 0 0
</pre></div>
</div>
</div>
</div>
<div class="section" id="recording-data-access-patterns">
<h2>Recording Data Access Patterns<a class="headerlink" href="#recording-data-access-patterns" title="Permalink to this headline">¶</a></h2>
<p>Below commands record memory access pattern of a program and save the
monitoring results in a file.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/sjp38/masim
$ cd masim; make; ./masim ./configs/zigzag.cfg &amp;
$ sudo damo record -o damon.data $(pidof masim)
</pre></div>
</div>
<p>The first two lines of the commands get an artificial memory access generator
program and runs it in the background.  It will repeatedly access two 100 MiB
sized memory regions one by one.  You can substitute this with your real
workload.  The last line asks <code class="docutils literal notranslate"><span class="pre">damo</span></code> to record the access pattern in
<code class="docutils literal notranslate"><span class="pre">damon.data</span></code> file.</p>
</div>
<div class="section" id="visualizing-recorded-patterns">
<h2>Visualizing Recorded Patterns<a class="headerlink" href="#visualizing-recorded-patterns" title="Permalink to this headline">¶</a></h2>
<p>Below three commands visualize the recorded access patterns into three
image files.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ damo report heats --heatmap access_pattern_heatmap.png
$ damo report wss --range 0 101 1 --plot wss_dist.png
$ damo report wss --range 0 101 1 --sortby time --plot wss_chron_change.png
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">access_pattern_heatmap.png</span></code> will show the data access pattern in a
heatmap, which shows when (x-axis) what memory region (y-axis) is how
frequently accessed (color).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wss_dist.png</span></code> will show the distribution of the working set size.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wss_chron_change.png</span></code> will show how the working set size has
chronologically changed.</p></li>
</ul>
<p>Below are the three images.  You can show those made with other realistic
workloads at external web pages <a class="footnote-reference brackets" href="#id4" id="id1">1</a> <a class="footnote-reference brackets" href="#id5" id="id2">2</a> <a class="footnote-reference brackets" href="#id6" id="id3">3</a>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="figure align-center" id="id7">
<img alt="the access pattern in heatmap format" src="../../../_images/damon_heatmap.png" />
<p class="caption"><span class="caption-text">The access pattern in heatmap format.</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</div>
</td>
<td><div class="figure align-center" id="id8">
<img alt="the distribution of working set size" src="../../../_images/damon_wss_dist.png" />
<p class="caption"><span class="caption-text">The distribution of working set size.</span><a class="headerlink" href="#id8" title="Permalink to this image">¶</a></p>
</div>
</td>
<td><div class="figure align-center" id="id9">
<img alt="the chronological changes of working set size" src="../../../_images/damon_wss_change.png" />
<p class="caption"><span class="caption-text">The chronological changes of working set size.</span><a class="headerlink" href="#id9" title="Permalink to this image">¶</a></p>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="data-access-pattern-aware-memory-management">
<h2>Data Access Pattern Aware Memory Management<a class="headerlink" href="#data-access-pattern-aware-memory-management" title="Permalink to this headline">¶</a></h2>
<p>Below three commands make every memory region of size &gt;=4K that doesn’t
accessed for &gt;=60 seconds in your workload to be swapped out.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo &quot;#min-size max-size min-acc max-acc min-age max-age action&quot; &gt; scheme
$ echo &quot;4K        max      0       0       60s     max     pageout&quot; &gt;&gt; scheme
$ damo schemes -c my_thp_scheme &lt;pid of your workload&gt;
</pre></div>
</div>
<dl class="footnote brackets">
<dt class="label" id="id4"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p><a class="reference external" href="https://damonitor.github.io/test/result/visual/latest/rec.heatmap.1.png.html">https://damonitor.github.io/test/result/visual/latest/rec.heatmap.1.png.html</a></p>
</dd>
<dt class="label" id="id5"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p><a class="reference external" href="https://damonitor.github.io/test/result/visual/latest/rec.wss_sz.png.html">https://damonitor.github.io/test/result/visual/latest/rec.wss_sz.png.html</a></p>
</dd>
<dt class="label" id="id6"><span class="brackets"><a class="fn-backref" href="#id3">3</a></span></dt>
<dd><p><a class="reference external" href="https://damonitor.github.io/test/result/visual/latest/rec.wss_time.png.html">https://damonitor.github.io/test/result/visual/latest/rec.wss_time.png.html</a></p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="guide.html" class="btn btn-neutral float-right" title="Optimization Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Monitoring Data Accesses" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright The kernel development community

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>