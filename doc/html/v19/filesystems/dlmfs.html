

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>DLMFS &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.8.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/mm/damon/index.html">Monitoring Data Accesses</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../vm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>DLMFS</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/filesystems/dlmfs.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="dlmfs">
<h1>DLMFS<a class="headerlink" href="#dlmfs" title="Permalink to this headline">¶</a></h1>
<p>A minimal DLM userspace interface implemented via a virtual file
system.</p>
<p>dlmfs is built with OCFS2 as it requires most of its infrastructure.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Project web page:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><a class="reference external" href="http://ocfs2.wiki.kernel.org">http://ocfs2.wiki.kernel.org</a></td>
</tr>
<tr class="field-even field"><th class="field-name">Tools web page:</th><td class="field-body"><a class="reference external" href="https://github.com/markfasheh/ocfs2-tools">https://github.com/markfasheh/ocfs2-tools</a></td>
</tr>
<tr class="field-odd field"><th class="field-name" colspan="2">OCFS2 mailing lists:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><a class="reference external" href="http://oss.oracle.com/projects/ocfs2/mailman/">http://oss.oracle.com/projects/ocfs2/mailman/</a></td>
</tr>
</tbody>
</table>
<p>All code copyright 2005 Oracle except when otherwise noted.</p>
<div class="section" id="credits">
<h2>Credits<a class="headerlink" href="#credits" title="Permalink to this headline">¶</a></h2>
<p>Some code taken from ramfs which is Copyright © 2000 Linus Torvalds
and Transmeta Corp.</p>
<p>Mark Fasheh &lt;<a class="reference external" href="mailto:mark&#46;fasheh&#37;&#52;&#48;oracle&#46;com">mark<span>&#46;</span>fasheh<span>&#64;</span>oracle<span>&#46;</span>com</a>&gt;</p>
</div>
<div class="section" id="caveats">
<h2>Caveats<a class="headerlink" href="#caveats" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Right now it only works with the OCFS2 DLM, though support for other
DLM implementations should not be a major issue.</li>
</ul>
</div>
<div class="section" id="mount-options">
<h2>Mount options<a class="headerlink" href="#mount-options" title="Permalink to this headline">¶</a></h2>
<p>None</p>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>If you’re just interested in OCFS2, then please see ocfs2.txt. The
rest of this document will be geared towards those who want to use
dlmfs for easy to setup and easy to use clustered locking in
userspace.</p>
</div>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>dlmfs requires that the OCFS2 cluster infrastructure be in
place. Please download ocfs2-tools from the above url and configure a
cluster.</p>
<p>You’ll want to start heartbeating on a volume which all the nodes in
your lockspace can access. The easiest way to do this is via
ocfs2_hb_ctl (distributed with ocfs2-tools). Right now it requires
that an OCFS2 file system be in place so that it can automatically
find its heartbeat area, though it will eventually support heartbeat
against raw disks.</p>
<p>Please see the ocfs2_hb_ctl and mkfs.ocfs2 manual pages distributed
with ocfs2-tools.</p>
<p>Once you’re heartbeating, DLM lock ‘domains’ can be easily created /
destroyed and locks within them accessed.</p>
</div>
<div class="section" id="locking">
<h2>Locking<a class="headerlink" href="#locking" title="Permalink to this headline">¶</a></h2>
<p>Users may access dlmfs via standard file system calls, or they can use
‘libo2dlm’ (distributed with ocfs2-tools) which abstracts the file
system calls and presents a more traditional locking api.</p>
<p>dlmfs handles lock caching automatically for the user, so a lock
request for an already acquired lock will not generate another DLM
call. Userspace programs are assumed to handle their own local
locking.</p>
<p>Two levels of locks are supported - Shared Read, and Exclusive.
Also supported is a Trylock operation.</p>
<p>For information on the libo2dlm interface, please see o2dlm.h,
distributed with ocfs2-tools.</p>
<p>Lock value blocks can be read and written to a resource via read(2)
and write(2) against the fd obtained via your open(2) call. The
maximum currently supported LVB length is 64 bytes (though that is an
OCFS2 DLM limitation). Through this mechanism, users of dlmfs can share
small amounts of data amongst their nodes.</p>
<p>mkdir(2) signals dlmfs to join a domain (which will have the same name
as the resulting directory)</p>
<p>rmdir(2) signals dlmfs to leave the domain</p>
<p>Locks for a given domain are represented by regular inodes inside the
domain directory.  Locking against them is done via the open(2) system
call.</p>
<p>The open(2) call will not return until your lock has been granted or
an error has occurred, unless it has been instructed to do a trylock
operation. If the lock succeeds, you’ll get an fd.</p>
<p>open(2) with O_CREAT to ensure the resource inode is created - dlmfs does
not automatically create inodes for existing lock resources.</p>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Open Flag</th>
<th class="head">Lock Request Type</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>O_RDONLY</td>
<td>Shared Read</td>
</tr>
<tr class="row-odd"><td>O_RDWR</td>
<td>Exclusive</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Open Flag</th>
<th class="head">Resulting Locking Behavior</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>O_NONBLOCK</td>
<td>Trylock operation</td>
</tr>
</tbody>
</table>
<p>You must provide exactly one of O_RDONLY or O_RDWR.</p>
<p>If O_NONBLOCK is also provided and the trylock operation was valid but
could not lock the resource then open(2) will return ETXTBUSY.</p>
<p>close(2) drops the lock associated with your fd.</p>
<p>Modes passed to mkdir(2) or open(2) are adhered to locally. Chown is
supported locally as well. This means you can use them to restrict
access to the resources via dlmfs on your local node only.</p>
<p>The resource LVB may be read from the fd in either Shared Read or
Exclusive modes via the read(2) system call. It can be written via
write(2) only when open in Exclusive mode.</p>
<p>Once written, an LVB will be visible to other nodes who obtain Read
Only or higher level locks on the resource.</p>
</div>
<div class="section" id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://opendlm.sourceforge.net/cvsmirror/opendlm/docs/dlmbook_final.pdf">http://opendlm.sourceforge.net/cvsmirror/opendlm/docs/dlmbook_final.pdf</a></p>
<p>For more information on the VMS distributed locking API.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>