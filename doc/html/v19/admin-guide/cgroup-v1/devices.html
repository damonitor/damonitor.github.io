

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Device Whitelist Controller &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.8.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../mm/damon/index.html">Monitoring Data Accesses</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../vm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Device Whitelist Controller</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/admin-guide/cgroup-v1/devices.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="device-whitelist-controller">
<h1>Device Whitelist Controller<a class="headerlink" href="#device-whitelist-controller" title="Permalink to this headline">¶</a></h1>
<div class="section" id="description">
<h2>1. Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>Implement a cgroup to track and enforce open and mknod restrictions
on device files.  A device cgroup associates a device access
whitelist with each cgroup.  A whitelist entry has 4 fields.
‘type’ is a (all), c (char), or b (block).  ‘all’ means it applies
to all types and all major and minor numbers.  Major and minor are
either an integer or * for all.  Access is a composition of r
(read), w (write), and m (mknod).</p>
<p>The root device cgroup starts with rwm to ‘all’.  A child device
cgroup gets a copy of the parent.  Administrators can then remove
devices from the whitelist or add new entries.  A child cgroup can
never receive a device access which is denied by its parent.</p>
</div>
<div class="section" id="user-interface">
<h2>2. User Interface<a class="headerlink" href="#user-interface" title="Permalink to this headline">¶</a></h2>
<p>An entry is added using devices.allow, and removed using
devices.deny.  For instance:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo &#39;c 1:3 mr&#39; &gt; /sys/fs/cgroup/1/devices.allow
</pre></div>
</div>
<p>allows cgroup 1 to read and mknod the device usually known as
/dev/null.  Doing:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo a &gt; /sys/fs/cgroup/1/devices.deny
</pre></div>
</div>
<p>will remove the default ‘a <em>:</em> rwm’ entry. Doing:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo a &gt; /sys/fs/cgroup/1/devices.allow
</pre></div>
</div>
<p>will add the ‘a <em>:</em> rwm’ entry to the whitelist.</p>
</div>
<div class="section" id="security">
<h2>3. Security<a class="headerlink" href="#security" title="Permalink to this headline">¶</a></h2>
<p>Any task can move itself between cgroups.  This clearly won’t
suffice, but we can decide the best way to adequately restrict
movement as people get some experience with this.  We may just want
to require CAP_SYS_ADMIN, which at least is a separate bit from
CAP_MKNOD.  We may want to just refuse moving to a cgroup which
isn’t a descendant of the current one.  Or we may want to use
CAP_MAC_ADMIN, since we really are trying to lock down root.</p>
<p>CAP_SYS_ADMIN is needed to modify the whitelist or move another
task to a new cgroup.  (Again we’ll probably want to change that).</p>
<p>A cgroup may not be granted more permissions than the cgroup’s
parent has.</p>
</div>
<div class="section" id="hierarchy">
<h2>4. Hierarchy<a class="headerlink" href="#hierarchy" title="Permalink to this headline">¶</a></h2>
<p>device cgroups maintain hierarchy by making sure a cgroup never has more
access permissions than its parent.  Every time an entry is written to
a cgroup’s devices.deny file, all its children will have that entry removed
from their whitelist and all the locally set whitelist entries will be
re-evaluated.  In case one of the locally set whitelist entries would provide
more access than the cgroup’s parent, it’ll be removed from the whitelist.</p>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  A
 / \
    B

group        behavior       exceptions
A            allow          &quot;b 8:* rwm&quot;, &quot;c 116:1 rw&quot;
B            deny           &quot;c 1:3 rwm&quot;, &quot;c 116:2 rwm&quot;, &quot;b 3:* rwm&quot;
</pre></div>
</div>
<p>If a device is denied in group A:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo &quot;c 116:* r&quot; &gt; A/devices.deny
</pre></div>
</div>
<p>it’ll propagate down and after revalidating B’s entries, the whitelist entry
“c 116:2 rwm” will be removed:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>group        whitelist entries                        denied devices
A            all                                      &quot;b 8:* rwm&quot;, &quot;c 116:* rw&quot;
B            &quot;c 1:3 rwm&quot;, &quot;b 3:* rwm&quot;                 all the rest
</pre></div>
</div>
<p>In case parent’s exceptions change and local exceptions are not allowed
anymore, they’ll be deleted.</p>
<p>Notice that new whitelist entries will not be propagated:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  A
 / \
    B

group        whitelist entries                        denied devices
A            &quot;c 1:3 rwm&quot;, &quot;c 1:5 r&quot;                   all the rest
B            &quot;c 1:3 rwm&quot;, &quot;c 1:5 r&quot;                   all the rest
</pre></div>
</div>
<p>when adding <code class="docutils literal notranslate"><span class="pre">c</span> <span class="pre">*:3</span> <span class="pre">rwm</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo &quot;c *:3 rwm&quot; &gt;A/devices.allow
</pre></div>
</div>
<p>the result:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>group        whitelist entries                        denied devices
A            &quot;c *:3 rwm&quot;, &quot;c 1:5 r&quot;                   all the rest
B            &quot;c 1:3 rwm&quot;, &quot;c 1:5 r&quot;                   all the rest
</pre></div>
</div>
<p>but now it’ll be possible to add new entries to B:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo &quot;c 2:3 rwm&quot; &gt;B/devices.allow
# echo &quot;c 50:3 r&quot; &gt;B/devices.allow
</pre></div>
</div>
<p>or even:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo &quot;c *:3 rwm&quot; &gt;B/devices.allow
</pre></div>
</div>
<p>Allowing or denying all by writing ‘a’ to devices.allow or devices.deny will
not be possible once the device cgroups has children.</p>
<div class="section" id="hierarchy-internal-implementation">
<h3>4.1 Hierarchy (internal implementation)<a class="headerlink" href="#hierarchy-internal-implementation" title="Permalink to this headline">¶</a></h3>
<p>device cgroups is implemented internally using a behavior (ALLOW, DENY) and a
list of exceptions.  The internal state is controlled using the same user
interface to preserve compatibility with the previous whitelist-only
implementation.  Removal or addition of exceptions that will reduce the access
to devices will be propagated down the hierarchy.
For every propagated exception, the effective rules will be re-evaluated based
on current parent’s access rules.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>