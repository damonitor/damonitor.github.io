

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Parport &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.8.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="mm/damon/index.html">Monitoring Data Accesses</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../vm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Parport</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/admin-guide/parport.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="parport">
<h1>Parport<a class="headerlink" href="#parport" title="Permalink to this headline">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">parport</span></code> code provides parallel-port support under Linux.  This
includes the ability to share one port between multiple device
drivers.</p>
<p>You can pass parameters to the <code class="docutils literal notranslate"><span class="pre">parport</span></code> code to override its automatic
detection of your hardware.  This is particularly useful if you want
to use IRQs, since in general these can’t be autoprobed successfully.
By default IRQs are not used even if they <strong>can</strong> be probed.  This is
because there are a lot of people using the same IRQ for their
parallel port and a sound card or network card.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">parport</span></code> code is split into two parts: generic (which deals with
port-sharing) and architecture-dependent (which deals with actually
using the port).</p>
<div class="section" id="parport-as-modules">
<h2>Parport as modules<a class="headerlink" href="#parport-as-modules" title="Permalink to this headline">¶</a></h2>
<p>If you load the <cite>parport`</cite> code as a module, say:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># insmod parport
</pre></div>
</div>
<p>to load the generic <code class="docutils literal notranslate"><span class="pre">parport</span></code> code.  You then must load the
architecture-dependent code with (for example):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># insmod parport_pc io=0x3bc,0x378,0x278 irq=none,7,auto
</pre></div>
</div>
<p>to tell the <code class="docutils literal notranslate"><span class="pre">parport</span></code> code that you want three PC-style ports, one at
0x3bc with no IRQ, one at 0x378 using IRQ 7, and one at 0x278 with an
auto-detected IRQ.  Currently, PC-style (<code class="docutils literal notranslate"><span class="pre">parport_pc</span></code>), Sun <code class="docutils literal notranslate"><span class="pre">bpp</span></code>,
Amiga, Atari, and MFC3 hardware is supported.</p>
<p>PCI parallel I/O card support comes from <code class="docutils literal notranslate"><span class="pre">parport_pc</span></code>.  Base I/O
addresses should not be specified for supported PCI cards since they
are automatically detected.</p>
<div class="section" id="modprobe">
<h3>modprobe<a class="headerlink" href="#modprobe" title="Permalink to this headline">¶</a></h3>
<p>If you use modprobe , you will find it useful to add lines as below to a
configuration file in /etc/modprobe.d/ directory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>alias parport_lowlevel parport_pc
options parport_pc io=0x378,0x278 irq=7,auto
</pre></div>
</div>
<p>modprobe will load <code class="docutils literal notranslate"><span class="pre">parport_pc</span></code> (with the options <code class="docutils literal notranslate"><span class="pre">io=0x378,0x278</span> <span class="pre">irq=7,auto</span></code>)
whenever a parallel port device driver (such as <code class="docutils literal notranslate"><span class="pre">lp</span></code>) is loaded.</p>
<p>Note that these are example lines only!  You shouldn’t in general need
to specify any options to <code class="docutils literal notranslate"><span class="pre">parport_pc</span></code> in order to be able to use a
parallel port.</p>
</div>
<div class="section" id="parport-probe-optional">
<h3>Parport probe [optional]<a class="headerlink" href="#parport-probe-optional" title="Permalink to this headline">¶</a></h3>
<p>In 2.2 kernels there was a module called <code class="docutils literal notranslate"><span class="pre">parport_probe</span></code>, which was used
for collecting IEEE 1284 device ID information.  This has now been
enhanced and now lives with the IEEE 1284 support.  When a parallel
port is detected, the devices that are connected to it are analysed,
and information is logged like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>parport0: Printer, BJC-210 (Canon)
</pre></div>
</div>
<p>The probe information is available from files in <code class="docutils literal notranslate"><span class="pre">/proc/sys/dev/parport/</span></code>.</p>
</div>
</div>
<div class="section" id="parport-linked-into-the-kernel-statically">
<h2>Parport linked into the kernel statically<a class="headerlink" href="#parport-linked-into-the-kernel-statically" title="Permalink to this headline">¶</a></h2>
<p>If you compile the <code class="docutils literal notranslate"><span class="pre">parport</span></code> code into the kernel, then you can use
kernel boot parameters to get the same effect.  Add something like the
following to your LILO command line:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>parport=0x3bc parport=0x378,7 parport=0x278,auto,nofifo
</pre></div>
</div>
<p>You can have many <code class="docutils literal notranslate"><span class="pre">parport=...</span></code> statements, one for each port you want
to add.  Adding <code class="docutils literal notranslate"><span class="pre">parport=0</span></code> to the kernel command-line will disable
parport support entirely.  Adding <code class="docutils literal notranslate"><span class="pre">parport=auto</span></code> to the kernel
command-line will make <code class="docutils literal notranslate"><span class="pre">parport</span></code> use any IRQ lines or DMA channels that
it auto-detects.</p>
</div>
<div class="section" id="files-in-proc">
<h2>Files in /proc<a class="headerlink" href="#files-in-proc" title="Permalink to this headline">¶</a></h2>
<p>If you have configured the <code class="docutils literal notranslate"><span class="pre">/proc</span></code> filesystem into your kernel, you will
see a new directory entry: <code class="docutils literal notranslate"><span class="pre">/proc/sys/dev/parport</span></code>.  In there will be a
directory entry for each parallel port for which parport is
configured.  In each of those directories are a collection of files
describing that parallel port.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">/proc/sys/dev/parport</span></code> directory tree looks like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>parport
|-- default
|   |-- spintime
|   `-- timeslice
|-- parport0
|   |-- autoprobe
|   |-- autoprobe0
|   |-- autoprobe1
|   |-- autoprobe2
|   |-- autoprobe3
|   |-- devices
|   |   |-- active
|   |   `-- lp
|   |       `-- timeslice
|   |-- base-addr
|   |-- irq
|   |-- dma
|   |-- modes
|   `-- spintime
`-- parport1
|-- autoprobe
|-- autoprobe0
|-- autoprobe1
|-- autoprobe2
|-- autoprobe3
|-- devices
|   |-- active
|   `-- ppa
|       `-- timeslice
|-- base-addr
|-- irq
|-- dma
|-- modes
`-- spintime
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">File</th>
<th class="head">Contents</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">devices/active</span></code></td>
<td>A list of the device drivers using that port.  A “+”
will appear by the name of the device currently using
the port (it might not appear against any).  The
string “none” means that there are no device drivers
using that port.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">base-addr</span></code></td>
<td>Parallel port’s base address, or addresses if the port
has more than one in which case they are separated
with tabs.  These values might not have any sensible
meaning for some ports.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">irq</span></code></td>
<td>Parallel port’s IRQ, or -1 if none is being used.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">dma</span></code></td>
<td>Parallel port’s DMA channel, or -1 if none is being
used.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">modes</span></code></td>
<td><p class="first">Parallel port’s hardware modes, comma-separated,
meaning:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>PCSPP</dt>
<dd>PC-style SPP registers are available.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>TRISTATE</dt>
<dd>Port is bidirectional.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>COMPAT</dt>
<dd>Hardware acceleration for printers is
available and will be used.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>EPP</dt>
<dd>Hardware acceleration for EPP protocol
is available and will be used.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>ECP</dt>
<dd>Hardware acceleration for ECP protocol
is available and will be used.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>DMA</dt>
<dd>DMA is available and will be used.</dd>
</dl>
</li>
</ul>
<p class="last">Note that the current implementation will only take
advantage of COMPAT and ECP modes if it has an IRQ
line to use.</p>
</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">autoprobe</span></code></td>
<td>Any IEEE-1284 device ID information that has been
acquired from the (non-IEEE 1284.3) device.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">autoprobe[0-3]</span></code></td>
<td>IEEE 1284 device ID information retrieved from
daisy-chain devices that conform to IEEE 1284.3.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">spintime</span></code></td>
<td>The number of microseconds to busy-loop while waiting
for the peripheral to respond.  You might find that
adjusting this improves performance, depending on your
peripherals.  This is a port-wide setting, i.e. it
applies to all devices on a particular port.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">timeslice</span></code></td>
<td>The number of milliseconds that a device driver is
allowed to keep a port claimed for.  This is advisory,
and driver can ignore it if it must.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">default/*</span></code></td>
<td>The defaults for spintime and timeslice. When a new
port is registered, it picks up the default spintime.
When a new device is registered, it picks up the
default timeslice.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="device-drivers">
<h2>Device drivers<a class="headerlink" href="#device-drivers" title="Permalink to this headline">¶</a></h2>
<p>Once the parport code is initialised, you can attach device drivers to
specific ports.  Normally this happens automatically; if the lp driver
is loaded it will create one lp device for each port found.  You can
override this, though, by using parameters either when you load the lp
driver:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># insmod lp parport=0,2
</pre></div>
</div>
<p>or on the LILO command line:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>lp=parport0 lp=parport2
</pre></div>
</div>
<p>Both the above examples would inform lp that you want <code class="docutils literal notranslate"><span class="pre">/dev/lp0</span></code> to be
the first parallel port, and /dev/lp1 to be the <strong>third</strong> parallel port,
with no lp device associated with the second port (parport1).  Note
that this is different to the way older kernels worked; there used to
be a static association between the I/O port address and the device
name, so <code class="docutils literal notranslate"><span class="pre">/dev/lp0</span></code> was always the port at 0x3bc.  This is no longer the
case - if you only have one port, it will default to being <code class="docutils literal notranslate"><span class="pre">/dev/lp0</span></code>,
regardless of base address.</p>
<p>Also:</p>
<blockquote>
<div><ul class="simple">
<li>If you selected the IEEE 1284 support at compile time, you can say
<code class="docutils literal notranslate"><span class="pre">lp=auto</span></code> on the kernel command line, and lp will create devices
only for those ports that seem to have printers attached.</li>
<li>If you give PLIP the <code class="docutils literal notranslate"><span class="pre">timid</span></code> parameter, either with <code class="docutils literal notranslate"><span class="pre">plip=timid</span></code> on
the command line, or with <code class="docutils literal notranslate"><span class="pre">insmod</span> <span class="pre">plip</span> <span class="pre">timid=1</span></code> when using modules,
it will avoid any ports that seem to be in use by other devices.</li>
<li>IRQ autoprobing works only for a few port types at the moment.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="reporting-printer-problems-with-parport">
<h2>Reporting printer problems with parport<a class="headerlink" href="#reporting-printer-problems-with-parport" title="Permalink to this headline">¶</a></h2>
<p>If you are having problems printing, please go through these steps to
try to narrow down where the problem area is.</p>
<p>When reporting problems with parport, really you need to give all of
the messages that <code class="docutils literal notranslate"><span class="pre">parport_pc</span></code> spits out when it initialises.  There are
several code paths:</p>
<ul class="simple">
<li>polling</li>
<li>interrupt-driven, protocol in software</li>
<li>interrupt-driven, protocol in hardware using PIO</li>
<li>interrupt-driven, protocol in hardware using DMA</li>
</ul>
<p>The kernel messages that <code class="docutils literal notranslate"><span class="pre">parport_pc</span></code> logs give an indication of which
code path is being used. (They could be a lot better actually..)</p>
<p>For normal printer protocol, having IEEE 1284 modes enabled or not
should not make a difference.</p>
<p>To turn off the ‘protocol in hardware’ code paths, disable
<code class="docutils literal notranslate"><span class="pre">CONFIG_PARPORT_PC_FIFO</span></code>.  Note that when they are enabled they are not
necessarily <strong>used</strong>; it depends on whether the hardware is available,
enabled by the BIOS, and detected by the driver.</p>
<p>So, to start with, disable <code class="docutils literal notranslate"><span class="pre">CONFIG_PARPORT_PC_FIFO</span></code>, and load <code class="docutils literal notranslate"><span class="pre">parport_pc</span></code>
with <code class="docutils literal notranslate"><span class="pre">irq=none</span></code>. See if printing works then.  It really should,
because this is the simplest code path.</p>
<p>If that works fine, try with <code class="docutils literal notranslate"><span class="pre">io=0x378</span> <span class="pre">irq=7</span></code> (adjust for your
hardware), to make it use interrupt-driven in-software protocol.</p>
<p>If <strong>that</strong> works fine, then one of the hardware modes isn’t working
right.  Enable <code class="docutils literal notranslate"><span class="pre">CONFIG_FIFO</span></code> (no, it isn’t a module option,
and yes, it should be), set the port to ECP mode in the BIOS and note
the DMA channel, and try with:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>io=0x378 irq=7 dma=none (for PIO)
io=0x378 irq=7 dma=3 (for DMA)
</pre></div>
</div>
<hr class="docutils" />
<p><a class="reference external" href="mailto:philb&#37;&#52;&#48;gnu&#46;org">philb<span>&#64;</span>gnu<span>&#46;</span>org</a>
<a class="reference external" href="mailto:tim&#37;&#52;&#48;cyberelk&#46;net">tim<span>&#64;</span>cyberelk<span>&#46;</span>net</a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>