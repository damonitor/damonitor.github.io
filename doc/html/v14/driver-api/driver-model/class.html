

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Device Classes &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/mm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Device Classes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/driver-api/driver-model/class.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="device-classes">
<h1>Device Classes<a class="headerlink" href="#device-classes" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>A device class describes a type of device, like an audio or network
device. The following device classes have been identified:</p>
<p>&lt;Insert List of Device Classes Here&gt;</p>
<p>Each device class defines a set of semantics and a programming interface
that devices of that class adhere to. Device drivers are the
implementation of that programming interface for a particular device on
a particular bus.</p>
<p>Device classes are agnostic with respect to what bus a device resides
on.</p>
</div>
<div class="section" id="programming-interface">
<h2>Programming Interface<a class="headerlink" href="#programming-interface" title="Permalink to this headline">¶</a></h2>
<p>The device class structure looks like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>typedef int (*devclass_add)(struct device *);
typedef void (*devclass_remove)(struct device *);
</pre></div>
</div>
<p>See the kerneldoc for the struct class.</p>
<p>A typical device class definition would look like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct device_class input_devclass = {
      .name           = &quot;input&quot;,
      .add_device     = input_add_device,
      .remove_device  = input_remove_device,
};
</pre></div>
</div>
<p>Each device class structure should be exported in a header file so it
can be used by drivers, extensions and interfaces.</p>
<p>Device classes are registered and unregistered with the core using:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int devclass_register(struct device_class * cls);
void devclass_unregister(struct device_class * cls);
</pre></div>
</div>
</div>
<div class="section" id="devices">
<h2>Devices<a class="headerlink" href="#devices" title="Permalink to this headline">¶</a></h2>
<p>As devices are bound to drivers, they are added to the device class
that the driver belongs to. Before the driver model core, this would
typically happen during the driver’s probe() callback, once the device
has been initialized. It now happens after the probe() callback
finishes from the core.</p>
<p>The device is enumerated in the class. Each time a device is added to
the class, the class’s devnum field is incremented and assigned to the
device. The field is never decremented, so if the device is removed
from the class and re-added, it will receive a different enumerated
value.</p>
<p>The class is allowed to create a class-specific structure for the
device and store it in the device’s class_data pointer.</p>
<p>There is no list of devices in the device class. Each driver has a
list of devices that it supports. The device class has a list of
drivers of that particular class. To access all of the devices in the
class, iterate over the device lists of each driver in the class.</p>
</div>
<div class="section" id="device-drivers">
<h2>Device Drivers<a class="headerlink" href="#device-drivers" title="Permalink to this headline">¶</a></h2>
<p>Device drivers are added to device classes when they are registered
with the core. A driver specifies the class it belongs to by setting
the struct device_driver::devclass field.</p>
</div>
<div class="section" id="sysfs-directory-structure">
<h2>sysfs directory structure<a class="headerlink" href="#sysfs-directory-structure" title="Permalink to this headline">¶</a></h2>
<p>There is a top-level sysfs directory named ‘class’.</p>
<p>Each class gets a directory in the class directory, along with two
default subdirectories:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>class/
`-- input
    |-- devices
    `-- drivers
</pre></div>
</div>
<p>Drivers registered with the class get a symlink in the drivers/ directory
that points to the driver’s directory (under its bus directory):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>class/
`-- input
    |-- devices
    `-- drivers
        `-- usb:usb_mouse -&gt; ../../../bus/drivers/usb_mouse/
</pre></div>
</div>
<p>Each device gets a symlink in the devices/ directory that points to the
device’s directory in the physical hierarchy:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>class/
`-- input
    |-- devices
    |   `-- 1 -&gt; ../../../root/pci0/00:1f.0/usb_bus/00:1f.2-1:0/
    `-- drivers
</pre></div>
</div>
</div>
<div class="section" id="exporting-attributes">
<h2>Exporting Attributes<a class="headerlink" href="#exporting-attributes" title="Permalink to this headline">¶</a></h2>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct devclass_attribute {
      struct attribute        attr;
      ssize_t (*show)(struct device_class *, char * buf, size_t count, loff_t off);
      ssize_t (*store)(struct device_class *, const char * buf, size_t count, loff_t off);
};
</pre></div>
</div>
<p>Class drivers can export attributes using the DEVCLASS_ATTR macro that works
similarly to the DEVICE_ATTR macro for devices. For example, a definition
like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>static DEVCLASS_ATTR(debug,0644,show_debug,store_debug);
</pre></div>
</div>
<p>is equivalent to declaring:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>static devclass_attribute devclass_attr_debug;
</pre></div>
</div>
<p>The bus driver can add and remove the attribute from the class’s
sysfs directory using:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int devclass_create_file(struct device_class *, struct devclass_attribute *);
void devclass_remove_file(struct device_class *, struct devclass_attribute *);
</pre></div>
</div>
<p>In the example above, the file will be named ‘debug’ in placed in the
class’s directory in sysfs.</p>
</div>
<div class="section" id="interfaces">
<h2>Interfaces<a class="headerlink" href="#interfaces" title="Permalink to this headline">¶</a></h2>
<p>There may exist multiple mechanisms for accessing the same device of a
particular class type. Device interfaces describe these mechanisms.</p>
<p>When a device is added to a device class, the core attempts to add it
to every interface that is registered with the device class.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>