

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>drm/vkms Virtual Kernel Modesetting &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.8.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/mm/damon/index.html">Monitoring Data Accesses</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../vm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>drm/vkms Virtual Kernel Modesetting</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/gpu/vkms.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="drm-vkms-virtual-kernel-modesetting">
<span id="vkms"></span><h1>drm/vkms Virtual Kernel Modesetting<a class="headerlink" href="#drm-vkms-virtual-kernel-modesetting" title="Permalink to this headline">¶</a></h1>
<p>VKMS is a software-only model of a KMS driver that is useful for testing
and for running X (or similar) on headless machines. VKMS aims to enable
a virtual display with no need of a hardware display capability, releasing
the GPU in DRM API tests.</p>
<div class="section" id="todo">
<h2>TODO<a class="headerlink" href="#todo" title="Permalink to this headline">¶</a></h2>
<div class="section" id="crc-api-improvements">
<h3>CRC API Improvements<a class="headerlink" href="#crc-api-improvements" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Optimize CRC computation <code class="docutils literal notranslate"><span class="pre">compute_crc()</span></code> and plane blending <code class="docutils literal notranslate"><span class="pre">blend()</span></code></li>
<li>Use the alpha value to blend vaddr_src with vaddr_dst instead of
overwriting it in <code class="docutils literal notranslate"><span class="pre">blend()</span></code>.</li>
<li>Add igt test to check cleared alpha value for XRGB plane format.</li>
<li>Add igt test to check extreme alpha values i.e. fully opaque and fully
transparent (intermediate values are affected by hw-specific rounding modes).</li>
</ul>
</div>
<div class="section" id="runtime-configuration">
<h3>Runtime Configuration<a class="headerlink" href="#runtime-configuration" title="Permalink to this headline">¶</a></h3>
<p>We want to be able to reconfigure vkms instance without having to reload the
module. Use/Test-cases:</p>
<ul class="simple">
<li>Hotplug/hotremove connectors on the fly (to be able to test DP MST handling of
compositors).</li>
<li>Configure planes/crtcs/connectors (we’d need some code to have more than 1 of
them first).</li>
<li>Change output configuration: Plug/unplug screens, change EDID, allow changing
the refresh rate.</li>
</ul>
<p>The currently proposed solution is to expose vkms configuration through
configfs.  All existing module options should be supported through configfs too.</p>
</div>
<div class="section" id="add-plane-features">
<h3>Add Plane Features<a class="headerlink" href="#add-plane-features" title="Permalink to this headline">¶</a></h3>
<p>There’s lots of plane features we could add support for:</p>
<ul class="simple">
<li>Real overlay planes, not just cursor.</li>
<li>Full alpha blending on all planes.</li>
<li>Rotation, scaling.</li>
<li>Additional buffer formats, especially YUV formats for video like NV12.
Low/high bpp RGB formats would also be interesting.</li>
<li>Async updates (currently only possible on cursor plane using the legacy cursor
api).</li>
</ul>
<p>For all of these, we also want to review the igt test coverage and make sure all
relevant igt testcases work on vkms.</p>
</div>
<div class="section" id="writeback-support">
<h3>Writeback support<a class="headerlink" href="#writeback-support" title="Permalink to this headline">¶</a></h3>
<p>Currently vkms only computes a CRC for each frame. Once we have additional plane
features, we could write back the entire composited frame, and expose it as:</p>
<ul class="simple">
<li>Writeback connector. This is useful for testing compositors if you don’t have
hardware with writeback support.</li>
<li>As a v4l device. This is useful for debugging compositors on special vkms
configurations, so that developers see what’s really going on.</li>
</ul>
</div>
<div class="section" id="prime-buffer-sharing">
<h3>Prime Buffer Sharing<a class="headerlink" href="#prime-buffer-sharing" title="Permalink to this headline">¶</a></h3>
<p>We already have vgem, which is a gem driver for testing rendering, similar to
how vkms is for testing the modeset side. Adding buffer sharing support to vkms
allows us to test them together, to test synchronization and lots of other
features. Also, this allows compositors to test whether they work correctly on
SoC chips, where the display and rendering is very often split between 2
drivers.</p>
</div>
<div class="section" id="output-features">
<h3>Output Features<a class="headerlink" href="#output-features" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Variable refresh rate/freesync support. This probably needs prime buffer
sharing support, so that we can use vgem fences to simulate rendering in
testing. Also needs support to specify the EDID.</li>
<li>Add support for link status, so that compositors can validate their runtime
fallbacks when e.g. a Display Port link goes bad.</li>
<li>All the hotplug handling describe under “Runtime Configuration”.</li>
</ul>
</div>
<div class="section" id="atomic-check-using-ebpf">
<h3>Atomic Check using eBPF<a class="headerlink" href="#atomic-check-using-ebpf" title="Permalink to this headline">¶</a></h3>
<p>Atomic drivers have lots of restrictions which are not exposed to userspace in
any explicit form through e.g. possible property values. Userspace can only
inquiry about these limits through the atomic IOCTL, possibly using the
TEST_ONLY flag. Trying to add configurable code for all these limits, to allow
compositors to be tested against them, would be rather futile exercise. Instead
we could add support for eBPF to validate any kind of atomic state, and
implement a library of different restrictions.</p>
<p>This needs a bunch of features (plane compositing, multiple outputs, …)
enabled already to make sense.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>