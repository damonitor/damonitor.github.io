

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Linux NFC subsystem &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.8.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/mm/damon/index.html">Monitoring Data Accesses</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../vm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Linux NFC subsystem</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/networking/nfc.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="linux-nfc-subsystem">
<h1>Linux NFC subsystem<a class="headerlink" href="#linux-nfc-subsystem" title="Permalink to this headline">¶</a></h1>
<p>The Near Field Communication (NFC) subsystem is required to standardize the
NFC device drivers development and to create an unified userspace interface.</p>
<p>This document covers the architecture overview, the device driver interface
description and the userspace interface description.</p>
<div class="section" id="architecture-overview">
<h2>Architecture overview<a class="headerlink" href="#architecture-overview" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>The NFC subsystem is responsible for:</dt>
<dd><ul class="first last simple">
<li>NFC adapters management;</li>
<li>Polling for targets;</li>
<li>Low-level data exchange;</li>
</ul>
</dd>
</dl>
<p>The subsystem is divided in some parts. The ‘core’ is responsible for
providing the device driver interface. On the other side, it is also
responsible for providing an interface to control operations and low-level
data exchange.</p>
<p>The control operations are available to userspace via generic netlink.</p>
<p>The low-level data exchange interface is provided by the new socket family
PF_NFC. The NFC_SOCKPROTO_RAW performs raw communication with NFC targets.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>+--------------------------------------+
|              USER SPACE              |
+--------------------------------------+
    ^                       ^
    | low-level             | control
    | data exchange         | operations
    |                       |
    |                       v
    |                  +-----------+
    | AF_NFC           |  netlink  |
    | socket           +-----------+
    | raw                   ^
    |                       |
    v                       v
+---------+            +-----------+
| rawsock | &lt;--------&gt; |   core    |
+---------+            +-----------+
                            ^
                            |
                            v
                       +-----------+
                       |  driver   |
                       +-----------+
</pre></div>
</div>
</div>
<div class="section" id="device-driver-interface">
<h2>Device Driver Interface<a class="headerlink" href="#device-driver-interface" title="Permalink to this headline">¶</a></h2>
<p>When registering on the NFC subsystem, the device driver must inform the core
of the set of supported NFC protocols and the set of ops callbacks. The ops
callbacks that must be implemented are the following:</p>
<ul class="simple">
<li>start_poll - setup the device to poll for targets</li>
<li>stop_poll - stop on progress polling operation</li>
<li>activate_target - select and initialize one of the targets found</li>
<li>deactivate_target - deselect and deinitialize the selected target</li>
<li>data_exchange - send data and receive the response (transceive operation)</li>
</ul>
</div>
<div class="section" id="userspace-interface">
<h2>Userspace interface<a class="headerlink" href="#userspace-interface" title="Permalink to this headline">¶</a></h2>
<p>The userspace interface is divided in control operations and low-level data
exchange operation.</p>
<p>CONTROL OPERATIONS:</p>
<p>Generic netlink is used to implement the interface to the control operations.
The operations are composed by commands and events, all listed below:</p>
<ul class="simple">
<li>NFC_CMD_GET_DEVICE - get specific device info or dump the device list</li>
<li>NFC_CMD_START_POLL - setup a specific device to polling for targets</li>
<li>NFC_CMD_STOP_POLL - stop the polling operation in a specific device</li>
<li>NFC_CMD_GET_TARGET - dump the list of targets found by a specific device</li>
<li>NFC_EVENT_DEVICE_ADDED - reports an NFC device addition</li>
<li>NFC_EVENT_DEVICE_REMOVED - reports an NFC device removal</li>
<li>NFC_EVENT_TARGETS_FOUND - reports START_POLL results when 1 or more targets
are found</li>
</ul>
<p>The user must call START_POLL to poll for NFC targets, passing the desired NFC
protocols through NFC_ATTR_PROTOCOLS attribute. The device remains in polling
state until it finds any target. However, the user can stop the polling
operation by calling STOP_POLL command. In this case, it will be checked if
the requester of STOP_POLL is the same of START_POLL.</p>
<p>If the polling operation finds one or more targets, the event TARGETS_FOUND is
sent (including the device id). The user must call GET_TARGET to get the list of
all targets found by such device. Each reply message has target attributes with
relevant information such as the supported NFC protocols.</p>
<p>All polling operations requested through one netlink socket are stopped when
it’s closed.</p>
<p>LOW-LEVEL DATA EXCHANGE:</p>
<p>The userspace must use PF_NFC sockets to perform any data communication with
targets. All NFC sockets use AF_NFC:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct sockaddr_nfc {
       sa_family_t sa_family;
       __u32 dev_idx;
       __u32 target_idx;
       __u32 nfc_protocol;
};
</pre></div>
</div>
<p>To establish a connection with one target, the user must create an
NFC_SOCKPROTO_RAW socket and call the ‘connect’ syscall with the sockaddr_nfc
struct correctly filled. All information comes from NFC_EVENT_TARGETS_FOUND
netlink event. As a target can support more than one NFC protocol, the user
must inform which protocol it wants to use.</p>
<p>Internally, ‘connect’ will result in an activate_target call to the driver.
When the socket is closed, the target is deactivated.</p>
<p>The data format exchanged through the sockets is NFC protocol dependent. For
instance, when communicating with MIFARE tags, the data exchanged are MIFARE
commands and their responses.</p>
<p>The first received package is the response to the first sent package and so
on. In order to allow valid “empty” responses, every data received has a NULL
header of 1 byte.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>