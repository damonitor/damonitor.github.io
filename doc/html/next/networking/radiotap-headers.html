

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>How to use radiotap headers &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.8.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/mm/damon/index.html">Monitoring Data Accesses</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../vm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>How to use radiotap headers</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/networking/radiotap-headers.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="how-to-use-radiotap-headers">
<h1>How to use radiotap headers<a class="headerlink" href="#how-to-use-radiotap-headers" title="Permalink to this headline">¶</a></h1>
<div class="section" id="pointer-to-the-radiotap-include-file">
<h2>Pointer to the radiotap include file<a class="headerlink" href="#pointer-to-the-radiotap-include-file" title="Permalink to this headline">¶</a></h2>
<p>Radiotap headers are variable-length and extensible, you can get most of the
information you need to know on them from:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./include/net/ieee80211_radiotap.h
</pre></div>
</div>
<p>This document gives an overview and warns on some corner cases.</p>
</div>
<div class="section" id="structure-of-the-header">
<h2>Structure of the header<a class="headerlink" href="#structure-of-the-header" title="Permalink to this headline">¶</a></h2>
<p>There is a fixed portion at the start which contains a u32 bitmap that defines
if the possible argument associated with that bit is present or not.  So if b0
of the it_present member of ieee80211_radiotap_header is set, it means that
the header for argument index 0 (IEEE80211_RADIOTAP_TSFT) is present in the
argument area.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt; 8-byte ieee80211_radiotap_header &gt;
[ &lt;possible argument bitmap extensions ... &gt; ]
[ &lt;argument&gt; ... ]
</pre></div>
</div>
<p>At the moment there are only 13 possible argument indexes defined, but in case
we run out of space in the u32 it_present member, it is defined that b31 set
indicates that there is another u32 bitmap following (shown as “possible
argument bitmap extensions…” above), and the start of the arguments is moved
forward 4 bytes each time.</p>
<p>Note also that the it_len member __le16 is set to the total number of bytes
covered by the ieee80211_radiotap_header and any arguments following.</p>
</div>
<div class="section" id="requirements-for-arguments">
<h2>Requirements for arguments<a class="headerlink" href="#requirements-for-arguments" title="Permalink to this headline">¶</a></h2>
<p>After the fixed part of the header, the arguments follow for each argument
index whose matching bit is set in the it_present member of
ieee80211_radiotap_header.</p>
<blockquote>
<div><ul class="simple">
<li>the arguments are all stored little-endian!</li>
<li>the argument payload for a given argument index has a fixed size.  So
IEEE80211_RADIOTAP_TSFT being present always indicates an 8-byte argument is
present.  See the comments in ./include/net/ieee80211_radiotap.h for a nice
breakdown of all the argument sizes</li>
<li>the arguments must be aligned to a boundary of the argument size using
padding.  So a u16 argument must start on the next u16 boundary if it isn’t
already on one, a u32 must start on the next u32 boundary and so on.</li>
<li>“alignment” is relative to the start of the ieee80211_radiotap_header, ie,
the first byte of the radiotap header.  The absolute alignment of that first
byte isn’t defined.  So even if the whole radiotap header is starting at, eg,
address 0x00000003, still the first byte of the radiotap header is treated as
0 for alignment purposes.</li>
<li>the above point that there may be no absolute alignment for multibyte
entities in the fixed radiotap header or the argument region means that you
have to take special evasive action when trying to access these multibyte
entities.  Some arches like Blackfin cannot deal with an attempt to
dereference, eg, a u16 pointer that is pointing to an odd address.  Instead
you have to use a kernel API get_unaligned() to dereference the pointer,
which will do it bytewise on the arches that require that.</li>
<li>The arguments for a given argument index can be a compound of multiple types
together.  For example IEEE80211_RADIOTAP_CHANNEL has an argument payload
consisting of two u16s of total length 4.  When this happens, the padding
rule is applied dealing with a u16, NOT dealing with a 4-byte single entity.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="example-valid-radiotap-header">
<h2>Example valid radiotap header<a class="headerlink" href="#example-valid-radiotap-header" title="Permalink to this headline">¶</a></h2>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0x00, 0x00, // &lt;-- radiotap version + pad byte
0x0b, 0x00, // &lt;- radiotap header length
0x04, 0x0c, 0x00, 0x00, // &lt;-- bitmap
0x6c, // &lt;-- rate (in 500kHz units)
0x0c, //&lt;-- tx power
0x01 //&lt;-- antenna
</pre></div>
</div>
</div>
<div class="section" id="using-the-radiotap-parser">
<h2>Using the Radiotap Parser<a class="headerlink" href="#using-the-radiotap-parser" title="Permalink to this headline">¶</a></h2>
<p>If you are having to parse a radiotap struct, you can radically simplify the
job by using the radiotap parser that lives in net/wireless/radiotap.c and has
its prototypes available in include/net/cfg80211.h.  You use it like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#include &lt;net/cfg80211.h&gt;

/* buf points to the start of the radiotap header part */

int MyFunction(u8 * buf, int buflen)
{
        int pkt_rate_100kHz = 0, antenna = 0, pwr = 0;
        struct ieee80211_radiotap_iterator iterator;
        int ret = ieee80211_radiotap_iterator_init(&amp;iterator, buf, buflen);

        while (!ret) {

                ret = ieee80211_radiotap_iterator_next(&amp;iterator);

                if (ret)
                        continue;

                /* see if this argument is something we can use */

                switch (iterator.this_arg_index) {
                /*
                * You must take care when dereferencing iterator.this_arg
                * for multibyte types... the pointer is not aligned.  Use
                * get_unaligned((type *)iterator.this_arg) to dereference
                * iterator.this_arg for type &quot;type&quot; safely on all arches.
                */
                case IEEE80211_RADIOTAP_RATE:
                        /* radiotap &quot;rate&quot; u8 is in
                        * 500kbps units, eg, 0x02=1Mbps
                        */
                        pkt_rate_100kHz = (*iterator.this_arg) * 5;
                        break;

                case IEEE80211_RADIOTAP_ANTENNA:
                        /* radiotap uses 0 for 1st ant */
                        antenna = *iterator.this_arg);
                        break;

                case IEEE80211_RADIOTAP_DBM_TX_POWER:
                        pwr = *iterator.this_arg;
                        break;

                default:
                        break;
                }
        }  /* while more rt headers */

        if (ret != -ENOENT)
                return TXRX_DROP;

        /* discard the radiotap header part */
        buf += iterator.max_length;
        buflen -= iterator.max_length;

        ...

}
</pre></div>
</div>
<p>Andy Green &lt;<a class="reference external" href="mailto:andy&#37;&#52;&#48;warmcat&#46;com">andy<span>&#64;</span>warmcat<span>&#46;</span>com</a>&gt;</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>