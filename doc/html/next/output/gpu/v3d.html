

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>drm/v3d Broadcom V3D Graphics Driver &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.6.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/mm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>drm/v3d Broadcom V3D Graphics Driver</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/gpu/v3d.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="drm-v3d-broadcom-v3d-graphics-driver">
<h1>drm/v3d Broadcom V3D Graphics Driver<a class="headerlink" href="#drm-v3d-broadcom-v3d-graphics-driver" title="Permalink to this headline">¶</a></h1>
<p>This driver supports the Broadcom V3D 3.3 and 4.1 OpenGL ES GPUs.
For V3D 2.x support, see the VC4 driver.</p>
<p>The V3D GPU includes a tiled render (composed of a bin and render
pipelines), the TFU (texture formatting unit), and the CSD (compute
shader dispatch).</p>
<div class="section" id="gpu-buffer-object-bo-management">
<h2>GPU buffer object (BO) management<a class="headerlink" href="#gpu-buffer-object-bo-management" title="Permalink to this headline">¶</a></h2>
<p>Compared to VC4 (V3D 2.x), V3D 3.3 introduces an MMU between the
GPU and the bus, allowing us to use shmem objects for our storage
instead of CMA.</p>
<p>Physically contiguous objects may still be imported to V3D, but the
driver doesn’t allocate physically contiguous objects on its own.
Display engines requiring physically contiguous allocations should
look into Mesa’s “renderonly” support (as used by the Mesa pl111
driver) for an example of how to integrate with V3D.</p>
<p>Long term, we should support evicting pages from the MMU when under
memory pressure (thus the v3d_bo_get_pages() refcounting), but
that’s not a high priority since our systems tend to not have swap.</p>
<div class="section" id="address-space-management">
<h3>Address space management<a class="headerlink" href="#address-space-management" title="Permalink to this headline">¶</a></h3>
<p>The V3D 3.x hardware (compared to VC4) now includes an MMU.  It has
a single level of page tables for the V3D’s 4GB address space to
map to AXI bus addresses, thus it could need up to 4MB of
physically contiguous memory to store the PTEs.</p>
<p>Because the 4MB of contiguous memory for page tables is precious,
and switching between them is expensive, we load all BOs into the
same 4GB address space.</p>
<p>To protect clients from each other, we should use the GMP to
quickly mask out (at 128kb granularity) what pages are available to
each client.  This is not yet implemented.</p>
</div>
<div class="section" id="gpu-scheduling">
<h3>GPU Scheduling<a class="headerlink" href="#gpu-scheduling" title="Permalink to this headline">¶</a></h3>
<p>The shared DRM GPU scheduler is used to coordinate submitting jobs
to the hardware.  Each DRM fd (roughly a client process) gets its
own scheduler entity, which will process jobs in order.  The GPU
scheduler will round-robin between clients to submit the next job.</p>
<p>For simplicity, and in order to keep latency low for interactive
jobs when bulk background jobs are queued up, we submit a new job
to the HW only when it has completed the last one, instead of
filling up the CT[01]Q FIFOs with jobs.  Similarly, we use
v3d_job_dependency() to manage the dependency between bin and
render, instead of having the clients submit jobs using the HW’s
semaphores to interlock between them.</p>
</div>
</div>
<div class="section" id="interrupts">
<h2>Interrupts<a class="headerlink" href="#interrupts" title="Permalink to this headline">¶</a></h2>
<p>When we take a bin, render, TFU done, or CSD done interrupt, we
need to signal the fence for that job so that the scheduler can
queue up the next one and unblock any waiters.</p>
<p>When we take the binner out of memory interrupt, we need to
allocate some new memory and pass it to the binner so that the
current job can make progress.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>