

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>SCTP &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.8.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/mm/damon/index.html">Monitoring Data Accesses</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../vm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>SCTP</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/security/SCTP.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="sctp">
<h1>SCTP<a class="headerlink" href="#sctp" title="Permalink to this headline">¶</a></h1>
<div class="section" id="sctp-lsm-support">
<h2>SCTP LSM Support<a class="headerlink" href="#sctp-lsm-support" title="Permalink to this headline">¶</a></h2>
<div class="section" id="security-hooks">
<h3>Security Hooks<a class="headerlink" href="#security-hooks" title="Permalink to this headline">¶</a></h3>
<p>For security module support, three SCTP specific hooks have been implemented:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>security_sctp_assoc_request()
security_sctp_bind_connect()
security_sctp_sk_clone()
</pre></div>
</div>
<p>Also the following security hook has been utilised:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>security_inet_conn_established()
</pre></div>
</div>
<p>The usage of these hooks are described below with the SELinux implementation
described in the <a class="reference internal" href="#sctp-selinux-support">SCTP SELinux Support</a> chapter.</p>
<div class="section" id="security-sctp-assoc-request">
<h4>security_sctp_assoc_request()<a class="headerlink" href="#security-sctp-assoc-request" title="Permalink to this headline">¶</a></h4>
<p>Passes the <code class="docutils literal notranslate"><span class="pre">&#64;ep</span></code> and <code class="docutils literal notranslate"><span class="pre">&#64;chunk-&gt;skb</span></code> of the association INIT packet to the
security module. Returns 0 on success, error on failure.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>@ep - pointer to sctp endpoint structure.
@skb - pointer to skbuff of association packet.
</pre></div>
</div>
</div>
<div class="section" id="security-sctp-bind-connect">
<h4>security_sctp_bind_connect()<a class="headerlink" href="#security-sctp-bind-connect" title="Permalink to this headline">¶</a></h4>
<p>Passes one or more ipv4/ipv6 addresses to the security module for validation
based on the <code class="docutils literal notranslate"><span class="pre">&#64;optname</span></code> that will result in either a bind or connect
service as shown in the permission check tables below.
Returns 0 on success, error on failure.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  @sk      - Pointer to sock structure.
  @optname - Name of the option to validate.
  @address - One or more ipv4 / ipv6 addresses.
  @addrlen - The total length of address(s). This is calculated on each
             ipv4 or ipv6 address using sizeof(struct sockaddr_in) or
             sizeof(struct sockaddr_in6).

------------------------------------------------------------------
|                     BIND Type Checks                           |
|       @optname             |         @address contains         |
|----------------------------|-----------------------------------|
| SCTP_SOCKOPT_BINDX_ADD     | One or more ipv4 / ipv6 addresses |
| SCTP_PRIMARY_ADDR          | Single ipv4 or ipv6 address       |
| SCTP_SET_PEER_PRIMARY_ADDR | Single ipv4 or ipv6 address       |
------------------------------------------------------------------

------------------------------------------------------------------
|                   CONNECT Type Checks                          |
|       @optname             |         @address contains         |
|----------------------------|-----------------------------------|
| SCTP_SOCKOPT_CONNECTX      | One or more ipv4 / ipv6 addresses |
| SCTP_PARAM_ADD_IP          | One or more ipv4 / ipv6 addresses |
| SCTP_SENDMSG_CONNECT       | Single ipv4 or ipv6 address       |
| SCTP_PARAM_SET_PRIMARY     | Single ipv4 or ipv6 address       |
------------------------------------------------------------------
</pre></div>
</div>
<p>A summary of the <code class="docutils literal notranslate"><span class="pre">&#64;optname</span></code> entries is as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SCTP_SOCKOPT_BINDX_ADD - Allows additional bind addresses to be
                         associated after (optionally) calling
                         bind(3).
                         sctp_bindx(3) adds a set of bind
                         addresses on a socket.

SCTP_SOCKOPT_CONNECTX - Allows the allocation of multiple
                        addresses for reaching a peer
                        (multi-homed).
                        sctp_connectx(3) initiates a connection
                        on an SCTP socket using multiple
                        destination addresses.

SCTP_SENDMSG_CONNECT  - Initiate a connection that is generated by a
                        sendmsg(2) or sctp_sendmsg(3) on a new asociation.

SCTP_PRIMARY_ADDR     - Set local primary address.

SCTP_SET_PEER_PRIMARY_ADDR - Request peer sets address as
                             association primary.

SCTP_PARAM_ADD_IP          - These are used when Dynamic Address
SCTP_PARAM_SET_PRIMARY     - Reconfiguration is enabled as explained below.
</pre></div>
</div>
<p>To support Dynamic Address Reconfiguration the following parameters must be
enabled on both endpoints (or use the appropriate <strong>setsockopt</strong>(2)):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/proc/sys/net/sctp/addip_enable
/proc/sys/net/sctp/addip_noauth_enable
</pre></div>
</div>
<p>then the following <em>_PARAM_</em>’s are sent to the peer in an
ASCONF chunk when the corresponding <code class="docutils literal notranslate"><span class="pre">&#64;optname</span></code>’s are present:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>      @optname                      ASCONF Parameter
     ----------                    ------------------
SCTP_SOCKOPT_BINDX_ADD     -&gt;   SCTP_PARAM_ADD_IP
SCTP_SET_PEER_PRIMARY_ADDR -&gt;   SCTP_PARAM_SET_PRIMARY
</pre></div>
</div>
</div>
<div class="section" id="security-sctp-sk-clone">
<h4>security_sctp_sk_clone()<a class="headerlink" href="#security-sctp-sk-clone" title="Permalink to this headline">¶</a></h4>
<p>Called whenever a new socket is created by <strong>accept</strong>(2)
(i.e. a TCP style socket) or when a socket is ‘peeled off’ e.g userspace
calls <strong>sctp_peeloff</strong>(3).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>@ep - pointer to current sctp endpoint structure.
@sk - pointer to current sock structure.
@sk - pointer to new sock structure.
</pre></div>
</div>
</div>
<div class="section" id="security-inet-conn-established">
<h4>security_inet_conn_established()<a class="headerlink" href="#security-inet-conn-established" title="Permalink to this headline">¶</a></h4>
<p>Called when a COOKIE ACK is received:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>@sk  - pointer to sock structure.
@skb - pointer to skbuff of the COOKIE ACK packet.
</pre></div>
</div>
</div>
</div>
<div class="section" id="security-hooks-used-for-association-establishment">
<h3>Security Hooks used for Association Establishment<a class="headerlink" href="#security-hooks-used-for-association-establishment" title="Permalink to this headline">¶</a></h3>
<p>The following diagram shows the use of <code class="docutils literal notranslate"><span class="pre">security_sctp_bind_connect()</span></code>,
<code class="docutils literal notranslate"><span class="pre">security_sctp_assoc_request()</span></code>, <code class="docutils literal notranslate"><span class="pre">security_inet_conn_established()</span></code> when
establishing an association.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>     SCTP endpoint &quot;A&quot;                                SCTP endpoint &quot;Z&quot;
     =================                                =================
   sctp_sf_do_prm_asoc()
Association setup can be initiated
by a connect(2), sctp_connectx(3),
sendmsg(2) or sctp_sendmsg(3).
These will result in a call to
security_sctp_bind_connect() to
initiate an association to
SCTP peer endpoint &quot;Z&quot;.
        INIT ---------------------------------------------&gt;
                                                  sctp_sf_do_5_1B_init()
                                                Respond to an INIT chunk.
                                            SCTP peer endpoint &quot;A&quot; is
                                            asking for an association. Call
                                            security_sctp_assoc_request()
                                            to set the peer label if first
                                            association.
                                            If not first association, check
                                            whether allowed, IF so send:
         &lt;----------------------------------------------- INIT ACK
         |                                  ELSE audit event and silently
         |                                       discard the packet.
         |
   COOKIE ECHO ------------------------------------------&gt;
                                                         |
                                                         |
                                                         |
         &lt;------------------------------------------- COOKIE ACK
         |                                               |
   sctp_sf_do_5_1E_ca                                    |
Call security_inet_conn_established()                    |
to set the peer label.                                   |
         |                                               |
         |                               If SCTP_SOCKET_TCP or peeled off
         |                               socket security_sctp_sk_clone() is
         |                               called to clone the new socket.
         |                                               |
     ESTABLISHED                                    ESTABLISHED
         |                                               |
   ------------------------------------------------------------------
   |                     Association Established                    |
   ------------------------------------------------------------------
</pre></div>
</div>
</div>
</div>
<div class="section" id="sctp-selinux-support">
<h2>SCTP SELinux Support<a class="headerlink" href="#sctp-selinux-support" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>Security Hooks<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="#sctp-lsm-support">SCTP LSM Support</a> chapter above describes the following SCTP security
hooks with the SELinux specifics expanded below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>security_sctp_assoc_request()
security_sctp_bind_connect()
security_sctp_sk_clone()
security_inet_conn_established()
</pre></div>
</div>
<div class="section" id="id2">
<h4>security_sctp_assoc_request()<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>Passes the <code class="docutils literal notranslate"><span class="pre">&#64;ep</span></code> and <code class="docutils literal notranslate"><span class="pre">&#64;chunk-&gt;skb</span></code> of the association INIT packet to the
security module. Returns 0 on success, error on failure.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>@ep - pointer to sctp endpoint structure.
@skb - pointer to skbuff of association packet.
</pre></div>
</div>
<dl class="docutils">
<dt>The security module performs the following operations:</dt>
<dd><p class="first">IF this is the first association on <code class="docutils literal notranslate"><span class="pre">&#64;ep-&gt;base.sk</span></code>, then set the peer
sid to that in <code class="docutils literal notranslate"><span class="pre">&#64;skb</span></code>. This will ensure there is only one peer sid
assigned to <code class="docutils literal notranslate"><span class="pre">&#64;ep-&gt;base.sk</span></code> that may support multiple associations.</p>
<p>ELSE validate the <code class="docutils literal notranslate"><span class="pre">&#64;ep-&gt;base.sk</span> <span class="pre">peer_sid</span></code> against the <code class="docutils literal notranslate"><span class="pre">&#64;skb</span> <span class="pre">peer</span> <span class="pre">sid</span></code>
to determine whether the association should be allowed or denied.</p>
<p>Set the sctp <code class="docutils literal notranslate"><span class="pre">&#64;ep</span> <span class="pre">sid</span></code> to socket’s sid (from <code class="docutils literal notranslate"><span class="pre">ep-&gt;base.sk</span></code>) with
MLS portion taken from <code class="docutils literal notranslate"><span class="pre">&#64;skb</span> <span class="pre">peer</span> <span class="pre">sid</span></code>. This will be used by SCTP
TCP style sockets and peeled off connections as they cause a new socket
to be generated.</p>
<p class="last">If IP security options are configured (CIPSO/CALIPSO), then the ip
options are set on the socket.</p>
</dd>
</dl>
</div>
<div class="section" id="id3">
<h4>security_sctp_bind_connect()<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>Checks permissions required for ipv4/ipv6 addresses based on the <code class="docutils literal notranslate"><span class="pre">&#64;optname</span></code>
as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>------------------------------------------------------------------
|                   BIND Permission Checks                       |
|       @optname             |         @address contains         |
|----------------------------|-----------------------------------|
| SCTP_SOCKOPT_BINDX_ADD     | One or more ipv4 / ipv6 addresses |
| SCTP_PRIMARY_ADDR          | Single ipv4 or ipv6 address       |
| SCTP_SET_PEER_PRIMARY_ADDR | Single ipv4 or ipv6 address       |
------------------------------------------------------------------

------------------------------------------------------------------
|                 CONNECT Permission Checks                      |
|       @optname             |         @address contains         |
|----------------------------|-----------------------------------|
| SCTP_SOCKOPT_CONNECTX      | One or more ipv4 / ipv6 addresses |
| SCTP_PARAM_ADD_IP          | One or more ipv4 / ipv6 addresses |
| SCTP_SENDMSG_CONNECT       | Single ipv4 or ipv6 address       |
| SCTP_PARAM_SET_PRIMARY     | Single ipv4 or ipv6 address       |
------------------------------------------------------------------
</pre></div>
</div>
<p><a class="reference internal" href="#sctp-lsm-support">SCTP LSM Support</a> gives a summary of the <code class="docutils literal notranslate"><span class="pre">&#64;optname</span></code>
entries and also describes ASCONF chunk processing when Dynamic Address
Reconfiguration is enabled.</p>
</div>
<div class="section" id="id4">
<h4>security_sctp_sk_clone()<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>Called whenever a new socket is created by <strong>accept</strong>(2) (i.e. a TCP style
socket) or when a socket is ‘peeled off’ e.g userspace calls
<strong>sctp_peeloff</strong>(3). <code class="docutils literal notranslate"><span class="pre">security_sctp_sk_clone()</span></code> will set the new
sockets sid and peer sid to that contained in the <code class="docutils literal notranslate"><span class="pre">&#64;ep</span> <span class="pre">sid</span></code> and
<code class="docutils literal notranslate"><span class="pre">&#64;ep</span> <span class="pre">peer</span> <span class="pre">sid</span></code> respectively.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>@ep - pointer to current sctp endpoint structure.
@sk - pointer to current sock structure.
@sk - pointer to new sock structure.
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h4>security_inet_conn_established()<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>Called when a COOKIE ACK is received where it sets the connection’s peer sid
to that in <code class="docutils literal notranslate"><span class="pre">&#64;skb</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>@sk  - pointer to sock structure.
@skb - pointer to skbuff of the COOKIE ACK packet.
</pre></div>
</div>
</div>
</div>
<div class="section" id="policy-statements">
<h3>Policy Statements<a class="headerlink" href="#policy-statements" title="Permalink to this headline">¶</a></h3>
<p>The following class and permissions to support SCTP are available within the
kernel:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>class sctp_socket inherits socket { node_bind }
</pre></div>
</div>
<p>whenever the following policy capability is enabled:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>policycap extended_socket_class;
</pre></div>
</div>
<p>SELinux SCTP support adds the <code class="docutils literal notranslate"><span class="pre">name_connect</span></code> permission for connecting
to a specific port type and the <code class="docutils literal notranslate"><span class="pre">association</span></code> permission that is explained
in the section below.</p>
<p>If userspace tools have been updated, SCTP will support the <code class="docutils literal notranslate"><span class="pre">portcon</span></code>
statement as shown in the following example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>portcon sctp 1024-1036 system_u:object_r:sctp_ports_t:s0
</pre></div>
</div>
</div>
<div class="section" id="sctp-peer-labeling">
<h3>SCTP Peer Labeling<a class="headerlink" href="#sctp-peer-labeling" title="Permalink to this headline">¶</a></h3>
<p>An SCTP socket will only have one peer label assigned to it. This will be
assigned during the establishment of the first association. Any further
associations on this socket will have their packet peer label compared to
the sockets peer label, and only if they are different will the
<code class="docutils literal notranslate"><span class="pre">association</span></code> permission be validated. This is validated by checking the
socket peer sid against the received packets peer sid to determine whether
the association should be allowed or denied.</p>
<dl class="docutils">
<dt>NOTES:</dt>
<dd><ol class="first last arabic">
<li><p class="first">If peer labeling is not enabled, then the peer context will always be
<code class="docutils literal notranslate"><span class="pre">SECINITSID_UNLABELED</span></code> (<code class="docutils literal notranslate"><span class="pre">unlabeled_t</span></code> in Reference Policy).</p>
</li>
<li><p class="first">As SCTP can support more than one transport address per endpoint
(multi-homing) on a single socket, it is possible to configure policy
and NetLabel to provide different peer labels for each of these. As the
socket peer label is determined by the first associations transport
address, it is recommended that all peer labels are consistent.</p>
</li>
<li><p class="first"><strong>getpeercon</strong>(3) may be used by userspace to retrieve the sockets peer
context.</p>
</li>
<li><p class="first">While not SCTP specific, be aware when using NetLabel that if a label
is assigned to a specific interface, and that interface ‘goes down’,
then the NetLabel service will remove the entry. Therefore ensure that
the network startup scripts call <strong>netlabelctl</strong>(8) to set the required
label (see <strong>netlabel-config</strong>(8) helper script for details).</p>
</li>
<li><p class="first">The NetLabel SCTP peer labeling rules apply as discussed in the following
set of posts tagged “netlabel” at: <a class="reference external" href="https://www.paul-moore.com/blog/t">https://www.paul-moore.com/blog/t</a>.</p>
</li>
<li><p class="first">CIPSO is only supported for IPv4 addressing: <code class="docutils literal notranslate"><span class="pre">socket(AF_INET,</span> <span class="pre">...)</span></code>
CALIPSO is only supported for IPv6 addressing: <code class="docutils literal notranslate"><span class="pre">socket(AF_INET6,</span> <span class="pre">...)</span></code></p>
<dl class="docutils">
<dt>Note the following when testing CIPSO/CALIPSO:</dt>
<dd><ol class="first last loweralpha simple">
<li>CIPSO will send an ICMP packet if an SCTP packet cannot be
delivered because of an invalid label.</li>
<li>CALIPSO does not send an ICMP packet, just silently discards it.</li>
</ol>
</dd>
</dl>
</li>
<li><p class="first">IPSEC is not supported as RFC 3554 - sctp/ipsec support has not been
implemented in userspace (<strong>racoon</strong>(8) or <strong>ipsec_pluto</strong>(8)),
although the kernel supports SCTP/IPSEC.</p>
</li>
</ol>
</dd>
</dl>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>