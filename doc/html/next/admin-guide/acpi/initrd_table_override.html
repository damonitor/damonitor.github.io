

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Upgrading ACPI tables via initrd &mdash; The Linux Kernel  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.12.0-rc4-mm1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../mm/damon/index.html">Monitoring Data Accesses</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../vm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Upgrading ACPI tables via initrd</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/admin-guide/acpi/initrd_table_override.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="upgrading-acpi-tables-via-initrd">
<h1>Upgrading ACPI tables via initrd<a class="headerlink" href="#upgrading-acpi-tables-via-initrd" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-is-this-about">
<h2>What is this about<a class="headerlink" href="#what-is-this-about" title="Permalink to this headline">¶</a></h2>
<p>If the ACPI_TABLE_UPGRADE compile option is true, it is possible to
upgrade the ACPI execution environment that is defined by the ACPI tables
via upgrading the ACPI tables provided by the BIOS with an instrumented,
modified, more recent version one, or installing brand new ACPI tables.</p>
<p>When building initrd with kernel in a single image, option
ACPI_TABLE_OVERRIDE_VIA_BUILTIN_INITRD should also be true for this
feature to work.</p>
<p>For a full list of ACPI tables that can be upgraded/installed, take a look
at the char <cite>*table_sigs[MAX_ACPI_SIGNATURE];</cite> definition in
drivers/acpi/tables.c.</p>
<p>All ACPI tables iasl (Intel’s ACPI compiler and disassembler) knows should
be overridable, except:</p>
<blockquote>
<div><ul class="simple">
<li><p>ACPI_SIG_RSDP (has a signature of 6 bytes)</p></li>
<li><p>ACPI_SIG_FACS (does not have an ordinary ACPI table header)</p></li>
</ul>
</div></blockquote>
<p>Both could get implemented as well.</p>
</div>
<div class="section" id="what-is-this-for">
<h2>What is this for<a class="headerlink" href="#what-is-this-for" title="Permalink to this headline">¶</a></h2>
<p>Complain to your platform/BIOS vendor if you find a bug which is so severe
that a workaround is not accepted in the Linux kernel. And this facility
allows you to upgrade the buggy tables before your platform/BIOS vendor
releases an upgraded BIOS binary.</p>
<p>This facility can be used by platform/BIOS vendors to provide a Linux
compatible environment without modifying the underlying platform firmware.</p>
<p>This facility also provides a powerful feature to easily debug and test
ACPI BIOS table compatibility with the Linux kernel by modifying old
platform provided ACPI tables or inserting new ACPI tables.</p>
<p>It can and should be enabled in any kernel because there is no functional
change with not instrumented initrds.</p>
</div>
<div class="section" id="how-does-it-work">
<h2>How does it work<a class="headerlink" href="#how-does-it-work" title="Permalink to this headline">¶</a></h2>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Extract the machine&#39;s ACPI tables:
cd /tmp
acpidump &gt;acpidump
acpixtract -a acpidump
# Disassemble, modify and recompile them:
iasl -d *.dat
# For example add this statement into a _PRT (PCI Routing Table) function
# of the DSDT:
Store(&quot;HELLO WORLD&quot;, debug)
# And increase the OEM Revision. For example, before modification:
DefinitionBlock (&quot;DSDT.aml&quot;, &quot;DSDT&quot;, 2, &quot;INTEL &quot;, &quot;TEMPLATE&quot;, 0x00000000)
# After modification:
DefinitionBlock (&quot;DSDT.aml&quot;, &quot;DSDT&quot;, 2, &quot;INTEL &quot;, &quot;TEMPLATE&quot;, 0x00000001)
iasl -sa dsdt.dsl
# Add the raw ACPI tables to an uncompressed cpio archive.
# They must be put into a /kernel/firmware/acpi directory inside the cpio
# archive. Note that if the table put here matches a platform table
# (similar Table Signature, and similar OEMID, and similar OEM Table ID)
# with a more recent OEM Revision, the platform table will be upgraded by
# this table. If the table put here doesn&#39;t match a platform table
# (dissimilar Table Signature, or dissimilar OEMID, or dissimilar OEM Table
# ID), this table will be appended.
mkdir -p kernel/firmware/acpi
cp dsdt.aml kernel/firmware/acpi
# A maximum of &quot;NR_ACPI_INITRD_TABLES (64)&quot; tables are currently allowed
# (see osl.c):
iasl -sa facp.dsl
iasl -sa ssdt1.dsl
cp facp.aml kernel/firmware/acpi
cp ssdt1.aml kernel/firmware/acpi
# The uncompressed cpio archive must be the first. Other, typically
# compressed cpio archives, must be concatenated on top of the uncompressed
# one. Following command creates the uncompressed cpio archive and
# concatenates the original initrd on top:
find kernel | cpio -H newc --create &gt; /boot/instrumented_initrd
cat /boot/initrd &gt;&gt;/boot/instrumented_initrd
# reboot with increased acpi debug level, e.g. boot params:
acpi.debug_level=0x2 acpi.debug_layer=0xFFFFFFFF
# and check your syslog:
[    1.268089] ACPI: PCI Interrupt Routing Table [\_SB_.PCI0._PRT]
[    1.272091] [ACPI Debug]  String [0x0B] &quot;HELLO WORLD&quot;
</pre></div>
</div>
<p>iasl is able to disassemble and recompile quite a lot different,
also static ACPI tables.</p>
</div>
<div class="section" id="where-to-retrieve-userspace-tools">
<h2>Where to retrieve userspace tools<a class="headerlink" href="#where-to-retrieve-userspace-tools" title="Permalink to this headline">¶</a></h2>
<p>iasl and acpixtract are part of Intel’s ACPICA project:
<a class="reference external" href="https://acpica.org/">https://acpica.org/</a></p>
<p>and should be packaged by distributions (for example in the acpica package
on SUSE).</p>
<p>acpidump can be found in Len Browns pmtools:
<a class="reference external" href="ftp://kernel.org/pub/linux/kernel/people/lenb/acpi/utils/pmtools/acpidump">ftp://kernel.org/pub/linux/kernel/people/lenb/acpi/utils/pmtools/acpidump</a></p>
<p>This tool is also part of the acpica package on SUSE.
Alternatively, used ACPI tables can be retrieved via sysfs in latest kernels:
/sys/firmware/acpi/tables</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright The kernel development community

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>