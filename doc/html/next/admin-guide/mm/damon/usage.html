

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>DAMON User Interfaces &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Mechanisms of DAMON" href="mechanisms.html" />
    <link rel="prev" title="Getting Started" href="start.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.6.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">DAMON: Data Access MONitor</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="start.html">Getting Started</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">DAMON User Interfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#what-interface-to-use">What Interface to Use?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debugfs-interface">debugfs Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#attributes">Attributes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#target-pids">Target PIDs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#record">Record</a></li>
<li class="toctree-l4"><a class="reference internal" href="#schemes">Schemes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#turning-on-off">Turning On/Off</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#user-space-tool-for-damon">User Space Tool for DAMON</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#recording-data-access-pattern">Recording Data Access Pattern</a></li>
<li class="toctree-l4"><a class="reference internal" href="#analyzing-data-access-pattern">Analyzing Data Access Pattern</a></li>
<li class="toctree-l4"><a class="reference internal" href="#damon-based-operation-schemes">DAMON-based Operation Schemes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#kernel-space-programming-interface">Kernel Space Programming Interface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mechanisms.html">Mechanisms of DAMON</a></li>
<li class="toctree-l2"><a class="reference internal" href="plans.html">Future Plans</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#frequently-asked-questions">Frequently Asked Questions</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#more-documents-to-read">More Documents To Read</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">DAMON: Data Access MONitor</a> &raquo;</li>
        
      <li>DAMON User Interfaces</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/admin-guide/mm/damon/usage.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="damon-user-interfaces">
<h1>DAMON User Interfaces<a class="headerlink" href="#damon-user-interfaces" title="Permalink to this headline">¶</a></h1>
<p>This document describes how you can use DAMON via its user interfaces.</p>
<p>DAMON provides following three user interfaces, kernel space programming
interface, debugfs interface and user space tool for various use cases.</p>
<ul class="simple">
<li><em>Kernel Space Programming Interface.</em>
This is for kernel space programmers.  Using this, you can utilize every
feature of DAMON in most flexible and efficient way by writing kernel space
DAMON application programs for you.</li>
<li><em>debugfs interface.</em>
This is for user space programmers who want optimized use of DAMON. Using
this interface, you can use DAMON’s major features by reading from and
writing to specific debugfs files.  Of course, you can write and use your
personalized DAMON debugfs wrapper user space tool that reads/writes the
debugfs files instead of you and provides more human friendly interface.</li>
<li><em>DAMON user space tool.</em>
This is for privileged people such as system administrators who want
just-working human-friendly interface.  Acutally, this interface is a
reference implementation of the DAMON debugfs wrapper user space tool.  Using
this tool, you can easily use the DAMON’s major features in human-friendly
way, though it may not be highly tuned for your specific use-cases.  Please
read ‘User Space Tool for DAMON’ section below for detail.</li>
</ul>
<div class="section" id="what-interface-to-use">
<h2>What Interface to Use?<a class="headerlink" href="#what-interface-to-use" title="Permalink to this headline">¶</a></h2>
<p>We recommend you to start with the DAMON user space tool and move to debugfs
interface only if the real requirement is found, and prohibit use of the kernel
space programming interface unless you really need it, for following reasons.
First of all, there will be no big difference between the overheads of these
three interfaces, unless the use case is so special.  Also, all these three
interfaces support all major features of DAMON.  We especially prohibit
careless use of the kernel space programming interface because it could easily
results in the kernel space bugs.  This document therefore does not describe
the kernel space programming interface in detail.</p>
</div>
<div class="section" id="debugfs-interface">
<h2>debugfs Interface<a class="headerlink" href="#debugfs-interface" title="Permalink to this headline">¶</a></h2>
<p>DAMON exports five files, <code class="docutils literal notranslate"><span class="pre">attrs</span></code>, <code class="docutils literal notranslate"><span class="pre">pids</span></code>, <code class="docutils literal notranslate"><span class="pre">record</span></code>, <code class="docutils literal notranslate"><span class="pre">schemes</span></code> and
<code class="docutils literal notranslate"><span class="pre">monitor_on</span></code> under its debugfs directory, <code class="docutils literal notranslate"><span class="pre">&lt;debugfs&gt;/damon/</span></code>.</p>
<div class="section" id="attributes">
<h3>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">¶</a></h3>
<p>Users can read and write the <code class="docutils literal notranslate"><span class="pre">sampling</span> <span class="pre">interval</span></code>, <code class="docutils literal notranslate"><span class="pre">aggregation</span> <span class="pre">interval</span></code>,
<code class="docutils literal notranslate"><span class="pre">regions</span> <span class="pre">update</span> <span class="pre">interval</span></code>, and min/max number of monitoring target regions by
reading from and writing to the <code class="docutils literal notranslate"><span class="pre">attrs</span></code> file.  For example, below commands
set those values to 5 ms, 100 ms, 1,000 ms, 10, 1000 and check it again:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# echo 5000 100000 1000000 10 1000 &gt; attrs
# cat attrs
5000 100000 1000000 10 1000
</pre></div>
</div>
</div>
<div class="section" id="target-pids">
<h3>Target PIDs<a class="headerlink" href="#target-pids" title="Permalink to this headline">¶</a></h3>
<p>Users can read and write the pids of current monitoring target processes by
reading from and writing to the <code class="docutils literal notranslate"><span class="pre">pids</span></code> file.  For example, below commands set
processes having pids 42 and 4242 as the processes to be monitored and check it
again:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# echo 42 4242 &gt; pids
# cat pids
42 4242
</pre></div>
</div>
<p>Note that setting the pids doesn’t start the monitoring.</p>
</div>
<div class="section" id="record">
<h3>Record<a class="headerlink" href="#record" title="Permalink to this headline">¶</a></h3>
<p>DAMON supports direct monitoring result record feature.  The recorded results
are first written to a buffer and flushed to a file in batch.  Users can set
the size of the buffer and the path to the result file by reading from and
writing to the <code class="docutils literal notranslate"><span class="pre">record</span></code> file.  For example, below commands set the buffer to
be 4 KiB and the result to be saved in <code class="docutils literal notranslate"><span class="pre">/damon.data</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# echo &quot;4096 /damon.data&quot; &gt; record
# cat record
4096 /damon.data
</pre></div>
</div>
</div>
<div class="section" id="schemes">
<h3>Schemes<a class="headerlink" href="#schemes" title="Permalink to this headline">¶</a></h3>
<p>For usual DAMON-based data access awared memory management optimizations, users
would simply want the system to apply a memory management action to a memory
region of a specific size having a specific access frequency for a specific
time.  DAMON receives such formalized operation schemes from user and applies
those to the target processes.</p>
<p>Users can get and set the schemes by reading from and writing to <code class="docutils literal notranslate"><span class="pre">schemes</span></code>
debugfs file.  To the file, each of the schemes should represented in each line
in below form:</p>
<blockquote>
<div>min-size max-size min-acc max-acc min-age max-age action</div></blockquote>
<p>Bytes for size of regions (<code class="docutils literal notranslate"><span class="pre">min-size</span></code> and <code class="docutils literal notranslate"><span class="pre">max-size</span></code>), number of monitored
accesses per aggregate interval for access frequency (<code class="docutils literal notranslate"><span class="pre">min-acc</span></code> and
<code class="docutils literal notranslate"><span class="pre">max-acc</span></code>), number of aggregate intervals for age of regions (<code class="docutils literal notranslate"><span class="pre">min-age</span></code> and
<code class="docutils literal notranslate"><span class="pre">max-age</span></code>), and predefined integer for memory management actions should be
used.  <code class="docutils literal notranslate"><span class="pre">madvise()</span></code> system call with specific hint are currently available.
The numbers and their representing memory hint are as below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0   MADV_WILLNEED
1   MADV_COLD
2   MADV_PAGEOUT
3   MADV_HUGEPAGE
4   MADV_NOHUGEPAGE
</pre></div>
</div>
<p>You can disable schemes by simply writing empty string to the file.  For
example, below commands applies a scheme saying “If a memory region larger than
4 KiB (4096 0) is showing less than 5 accesses per aggregate interval (0 5) for
more than 5 aggregate interval (5 0), page out the region (2)”, check the
entered scheme again, and finally remove the scheme.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# echo &quot;4096 0 0 5 5 0 2&quot; &gt; schemes
# cat schemes
4096 0 0 5 5 0 2
# echo &gt; schemes
</pre></div>
</div>
</div>
<div class="section" id="turning-on-off">
<h3>Turning On/Off<a class="headerlink" href="#turning-on-off" title="Permalink to this headline">¶</a></h3>
<p>You can check current status, start and stop the monitoring by reading from and
writing to the <code class="docutils literal notranslate"><span class="pre">monitor_on</span></code> file.  Writing <code class="docutils literal notranslate"><span class="pre">on</span></code> to the file starts DAMON to
monitor the target processes with the attributes.  Writing <code class="docutils literal notranslate"><span class="pre">off</span></code> to the file
stops DAMON.  DAMON also stops if every target processes is terminated.
Below example commands turn on, off, and check status of DAMON:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# echo on &gt; monitor_on
# echo off &gt; monitor_on
# cat monitor_on
off
</pre></div>
</div>
<p>Please note that you cannot write to the <code class="docutils literal notranslate"><span class="pre">attrs</span></code> and <code class="docutils literal notranslate"><span class="pre">pids</span></code> files while the
monitoring is turned on.  If you write to the files while DAMON is running, an
error code such as <code class="docutils literal notranslate"><span class="pre">-EBUSY</span></code> will be returned.</p>
</div>
</div>
<div class="section" id="user-space-tool-for-damon">
<h2>User Space Tool for DAMON<a class="headerlink" href="#user-space-tool-for-damon" title="Permalink to this headline">¶</a></h2>
<p>There is a user space tool for DAMON, <code class="docutils literal notranslate"><span class="pre">/tools/damon/damo</span></code>.  It provides
another user interface which more convenient than the debugfs interface.
Nevertheless, note that it is only aimed to be used for minimal reference of
the DAMON’s debugfs interfaces and for tests of the DAMON itself.  Based on the
debugfs interface, you can create another cool and more convenient user space
tools.</p>
<p>The interface of the tool is basically subcommand based.  You can almost always
use <code class="docutils literal notranslate"><span class="pre">-h</span></code> option to get help of the use of each subcommand.  Currently, it
supports two subcommands, <code class="docutils literal notranslate"><span class="pre">record</span></code> and <code class="docutils literal notranslate"><span class="pre">report</span></code>.</p>
<div class="section" id="recording-data-access-pattern">
<h3>Recording Data Access Pattern<a class="headerlink" href="#recording-data-access-pattern" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">record</span></code> subcommand records the data access pattern of target process in
a file (<code class="docutils literal notranslate"><span class="pre">./damon.data</span></code> by default) using DAMON.  You can specifies the target
as either pid or a command for an execution of the process.  Below example
shows a command target usage:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;kernel&gt;/tools/damon/
# ./damo record &quot;sleep 5&quot;
</pre></div>
</div>
<p>The tool will execute <code class="docutils literal notranslate"><span class="pre">sleep</span> <span class="pre">5</span></code> by itself and record the data access patterns
of the process.  Below example shows a pid target usage:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># sleep 5 &amp;
# ./damo record `pidof sleep`
</pre></div>
</div>
<p>You can set more detailed attributes and path to the recorded data file using
optional arguments to the subcommand.  Use the <code class="docutils literal notranslate"><span class="pre">-h</span></code> option for more help.</p>
</div>
<div class="section" id="analyzing-data-access-pattern">
<h3>Analyzing Data Access Pattern<a class="headerlink" href="#analyzing-data-access-pattern" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">report</span></code> subcommand reads a data access pattern record file (if not
explicitly specified, reads <code class="docutils literal notranslate"><span class="pre">./damon.data</span></code> file if exists) and generates
reports of various types.  You can specify what type of report you want using
sub-subcommand to <code class="docutils literal notranslate"><span class="pre">report</span></code> subcommand.  For supported types, pass the <code class="docutils literal notranslate"><span class="pre">-h</span></code>
option to <code class="docutils literal notranslate"><span class="pre">report</span></code> subcommand.</p>
<div class="section" id="raw">
<h4>raw<a class="headerlink" href="#raw" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">raw</span></code> sub-subcommand simply transforms the record, which is storing the data
access patterns in binary format to human readable text.  For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ./damo report raw
start_time:  193485829398
rel time:                0
nr_tasks:  1
pid:  1348
nr_regions:  4
560189609000-56018abce000(  22827008):  0
7fbdff59a000-7fbdffaf1a00(   5601792):  0
7fbdffaf1a00-7fbdffbb5000(    800256):  1
7ffea0dc0000-7ffea0dfd000(    249856):  0

rel time:        100000731
nr_tasks:  1
pid:  1348
nr_regions:  6
560189609000-56018abce000(  22827008):  0
7fbdff59a000-7fbdff8ce933(   3361075):  0
7fbdff8ce933-7fbdffaf1a00(   2240717):  1
7fbdffaf1a00-7fbdffb66d99(    480153):  0
7fbdffb66d99-7fbdffbb5000(    320103):  1
7ffea0dc0000-7ffea0dfd000(    249856):  0
</pre></div>
</div>
<p>The first line shows recording started timestamp (nanosecond).  Records of data
access patterns are following this.  Each record is sperated by a blank line.
Each record first specifies the recorded time (<code class="docutils literal notranslate"><span class="pre">rel</span> <span class="pre">time</span></code>), number of
monitored tasks in this record (<code class="docutils literal notranslate"><span class="pre">nr_tasks</span></code>).  Multiple number of records of
data access pattern for each task continue.  Each data access pattern for each
task shows first it’s pid (<code class="docutils literal notranslate"><span class="pre">pid</span></code>) and number of monitored virtual address
regions in this access pattern (<code class="docutils literal notranslate"><span class="pre">nr_regions</span></code>).  After that, each line shows
start/end address, size, and number of monitored accesses to the region for
each of the regions.</p>
</div>
<div class="section" id="heats">
<h4>heats<a class="headerlink" href="#heats" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">raw</span></code> type shows detailed information but it is exhaustive to manually
read and analyzed.  For the reason, <code class="docutils literal notranslate"><span class="pre">heats</span></code> plots the data in heatmap form,
using time as x-axis, virtual address as y-axis, and access frequency as
z-axis.  Also, users set the resolution and start/end point of each axis via
optional arguments.  For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ./damo report heats --tres 3 --ares 3
0               0               0.0
0               7609002         0.0
0               15218004        0.0
66112620851     0               0.0
66112620851     7609002         0.0
66112620851     15218004        0.0
132225241702    0               0.0
132225241702    7609002         0.0
132225241702    15218004        0.0
</pre></div>
</div>
<p>This command shows the recorded access pattern of the <code class="docutils literal notranslate"><span class="pre">sleep</span></code> command using 3
data points for each of time axis and address axis.  Therefore, it shows 9 data
points in total.</p>
<p>Users can easily converts this text output into heatmap image or other 3D
representation using various tools such as ‘gnuplot’.  <code class="docutils literal notranslate"><span class="pre">raw</span></code> sub-subcommand
also provides ‘gnuplot’ based heatmap image creation.  For this, you can use
<code class="docutils literal notranslate"><span class="pre">--heatmap</span></code> option.  Also, note that because it uses ‘gnuplot’ internally, it
will fail if ‘gnuplot’ is not installed on your system.  For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ./damo report heats --heatmap heatmap.png
</pre></div>
</div>
<p>Creates <code class="docutils literal notranslate"><span class="pre">heatmap.png</span></code> file containing the heatmap image.  It supports
<code class="docutils literal notranslate"><span class="pre">pdf</span></code>, <code class="docutils literal notranslate"><span class="pre">png</span></code>, <code class="docutils literal notranslate"><span class="pre">jpeg</span></code>, and <code class="docutils literal notranslate"><span class="pre">svg</span></code>.</p>
<p>For proper zoom in / zoom out, you need to see the layout of the record.  For
that, use ‘–guide’ option.  If the option is given, it will provide useful
information about the records in the record file.  For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ./damo report heats --guide
pid:1348
time: 193485829398-198337863555 (4852034157)
region   0: 00000094564599762944-00000094564622589952 (22827008)
region   1: 00000140454009610240-00000140454016012288 (6402048)
region   2: 00000140731597193216-00000140731597443072 (249856)
</pre></div>
</div>
<p>The output shows monitored regions (start and end addresses in byte) and
monitored time duration (start and end time in nanosecond) of each target task.
Therefore, it would be wise to plot only each region rather than plotting
entire address space in one heatmap because the gaps between the regions are so
huge in this case.</p>
</div>
<div class="section" id="wss">
<h4>wss<a class="headerlink" href="#wss" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">wss</span></code> type shows the distribution or time-varying working set sizes of
the recorded workload using the records.  For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ./damo report wss
# &lt;percentile&gt; &lt;wss&gt;
# pid   1348
# avr:  66228
0       0
25      0
50      0
75      0
100     1920615
</pre></div>
</div>
<p>Without any option, it shows the distribution of the working set sizes as
above.  Basically it shows 0th, 25th, 50th, 75th, and 100th percentile and
average of the measured working set sizes in the access pattern records.  In
this case, the working set size was zero for 75th percentile but 1,920,615
bytes in max and 66,228 in average.</p>
<p>By setting the sort key of the percentile using ‘–sortby’, you can also see
how the working set size is chronologically changed.  For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ./damo report wss --sortby time
# &lt;percentile&gt; &lt;wss&gt;
# pid   1348
# avr:  66228
0       0
25      0
50      0
75      0
100     0
</pre></div>
</div>
<p>The average is still 66,228.  And, because we sorted the working set using
recorded time and the access is very short, we cannot show when the access
made.</p>
<p>Users can specify the resolution of the distribution (<code class="docutils literal notranslate"><span class="pre">--range</span></code>).  It also
supports ‘gnuplot’ based simple visualization (<code class="docutils literal notranslate"><span class="pre">--plot</span></code>) of the distribution.</p>
</div>
</div>
<div class="section" id="damon-based-operation-schemes">
<h3>DAMON-based Operation Schemes<a class="headerlink" href="#damon-based-operation-schemes" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">schemes</span></code> subcommand applies given data access pattern based operation
schemes to the given target processes.  The target processes are described
using the command to spawn the processes or pid of running processes, as
similar to that of <code class="docutils literal notranslate"><span class="pre">record</span></code> subcommand.  Meanwhile, the operation schemes
should be saved in a text file using below format and passed to <code class="docutils literal notranslate"><span class="pre">schemes</span></code>
subcommand via <code class="docutils literal notranslate"><span class="pre">--schemes</span></code> option.</p>
<blockquote>
<div>min-size max-size min-acc max-acc min-age max-age action</div></blockquote>
<p>The format also supports comments, several units for size and age of regions,
and human readable action names.  Currently supported operation actions are
WILLNEED, COLD, PAGEOUT, HUGEPAGE, and NOHUGEPAGE.  Each of the actions works
as same to that of madvise() system call.  Below is an example schemes file.
Please also note that 0 for max values means infinite.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># format is:
# &lt;min/max size&gt; &lt;min/max frequency (0-99)&gt; &lt;min/max age&gt; &lt;action&gt;
#
# B/K/M/G/T for Bytes/KiB/MiB/GiB/TiB
# us/ms/s/m/h/d for micro-seconds/milli-seconds/seconds/minutes/hours/days
# &#39;null&#39; means zero for size and age.

# if a region keeps a high access frequency for more than 100ms, put the
# region on the head of the LRU list (call madvise() with MADV_WILLNEED).
null    null    80      null    100ms   0s      willneed

# if a region keeps a low access frequency for more than 200ms and less
# than one hour, put the # region on the tail of the LRU list (call
# madvise() with MADV_COLD).
0B      0B      10      20      200ms   1h cold

# if a region keeps a very low access frequency for more than 1 minute,
# swap out the region immediately (call madvise() with MADV_PAGEOUT).
0B      null    0       10      60s     0s pageout

# if a region of a size bigger than 2MiB keeps a very high access frequency
# for more than 100ms, let the region to use huge pages (call madvise()
# with MADV_HUGEPAGE).
2M      null    90      99      100ms   0s hugepage

# If a regions of a size bigger than 2MiB keeps small access frequency for
# more than 100ms, avoid the region using huge pages (call madvise() with
# MADV_NOHUGEPAGE).
2M      null    0       25      100ms   0s nohugepage
</pre></div>
</div>
<p>For example, you can make a running process named ‘foo’ to use THP for memory
regions keeping 2MB or larger size and having very high access frequency for
more than 100 milliseconds using below commands:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo &quot;2M null 90 99 100ms 0s hugepage&quot; &gt; my_thp_scheme
$ ./damo schemes --schemes my_thp_scheme `pidof foo`
</pre></div>
</div>
</div>
</div>
<div class="section" id="kernel-space-programming-interface">
<h2>Kernel Space Programming Interface<a class="headerlink" href="#kernel-space-programming-interface" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.damon_check_reset_time_interval">
bool <code class="descname">damon_check_reset_time_interval</code><span class="sig-paren">(</span>struct timespec64 *<em>&nbsp;baseline</em>, unsigned long<em>&nbsp;interval</em><span class="sig-paren">)</span><a class="headerlink" href="#c.damon_check_reset_time_interval" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if a time interval is elapsed.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">timespec64</span> <span class="pre">*</span> <span class="pre">baseline</span></code></dt>
<dd>the time to check whether the interval has elapsed since</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">interval</span></code></dt>
<dd>the time interval (microseconds)</dd>
</dl>
<p><strong>Description</strong></p>
<p>See whether the given time interval has passed since the given baseline
time.  If so, it also updates the baseline to current time for next check.</p>
<p><strong>Return</strong></p>
<p>true if the time interval has passed, or false otherwise.</p>
<dl class="function">
<dt id="c.damon_start">
int <code class="descname">damon_start</code><span class="sig-paren">(</span>struct damon_ctx *<em>&nbsp;ctx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.damon_start" title="Permalink to this definition">¶</a></dt>
<dd><p>Starts monitoring with given context.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">damon_ctx</span> <span class="pre">*</span> <span class="pre">ctx</span></code></dt>
<dd>monitoring context</dd>
</dl>
<p><strong>Return</strong></p>
<p>0 on success, negative error code otherwise.</p>
<dl class="function">
<dt id="c.damon_stop">
int <code class="descname">damon_stop</code><span class="sig-paren">(</span>struct damon_ctx *<em>&nbsp;ctx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.damon_stop" title="Permalink to this definition">¶</a></dt>
<dd><p>Stops monitoring of given context.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">damon_ctx</span> <span class="pre">*</span> <span class="pre">ctx</span></code></dt>
<dd>monitoring context</dd>
</dl>
<p><strong>Return</strong></p>
<p>0 on success, negative error code otherwise.</p>
<dl class="function">
<dt id="c.damon_set_schemes">
int <code class="descname">damon_set_schemes</code><span class="sig-paren">(</span>struct damon_ctx *<em>&nbsp;ctx</em>, struct damos **<em>&nbsp;schemes</em>, ssize_t<em>&nbsp;nr_schemes</em><span class="sig-paren">)</span><a class="headerlink" href="#c.damon_set_schemes" title="Permalink to this definition">¶</a></dt>
<dd><p>Set data access monitoring based operation schemes.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">damon_ctx</span> <span class="pre">*</span> <span class="pre">ctx</span></code></dt>
<dd>monitoring context</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">damos</span> <span class="pre">**</span> <span class="pre">schemes</span></code></dt>
<dd>array of the schemes</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ssize_t</span> <span class="pre">nr_schemes</span></code></dt>
<dd>number of entries in <strong>schemes</strong></dd>
</dl>
<p><strong>Description</strong></p>
<p>This function should not be called while the kdamond of the context is
running.</p>
<p><strong>Return</strong></p>
<p>0 if success, or negative error code otherwise.</p>
<dl class="function">
<dt id="c.damon_set_pids">
int <code class="descname">damon_set_pids</code><span class="sig-paren">(</span>struct damon_ctx *<em>&nbsp;ctx</em>, int *<em>&nbsp;pids</em>, ssize_t<em>&nbsp;nr_pids</em><span class="sig-paren">)</span><a class="headerlink" href="#c.damon_set_pids" title="Permalink to this definition">¶</a></dt>
<dd><p>Set monitoring target processes.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">damon_ctx</span> <span class="pre">*</span> <span class="pre">ctx</span></code></dt>
<dd>monitoring context</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">*</span> <span class="pre">pids</span></code></dt>
<dd>array of target processes pids</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ssize_t</span> <span class="pre">nr_pids</span></code></dt>
<dd>number of entries in <strong>pids</strong></dd>
</dl>
<p><strong>Description</strong></p>
<p>This function should not be called while the kdamond is running.</p>
<p><strong>Return</strong></p>
<p>0 on success, negative error code otherwise.</p>
<dl class="function">
<dt id="c.damon_set_recording">
int <code class="descname">damon_set_recording</code><span class="sig-paren">(</span>struct damon_ctx *<em>&nbsp;ctx</em>, unsigned int<em>&nbsp;rbuf_len</em>, char *<em>&nbsp;rfile_path</em><span class="sig-paren">)</span><a class="headerlink" href="#c.damon_set_recording" title="Permalink to this definition">¶</a></dt>
<dd><p>Set attributes for the recording.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">damon_ctx</span> <span class="pre">*</span> <span class="pre">ctx</span></code></dt>
<dd>target kdamond context</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">rbuf_len</span></code></dt>
<dd>length of the result buffer</dd>
<dt><code class="docutils literal notranslate"><span class="pre">char</span> <span class="pre">*</span> <span class="pre">rfile_path</span></code></dt>
<dd>path to the monitor result files</dd>
</dl>
<p><strong>Description</strong></p>
<p>Setting ‘rbuf_len’ 0 disables recording.</p>
<p>This function should not be called while the kdamond is running.</p>
<p><strong>Return</strong></p>
<p>0 on success, negative error code otherwise.</p>
<dl class="function">
<dt id="c.damon_set_attrs">
int <code class="descname">damon_set_attrs</code><span class="sig-paren">(</span>struct damon_ctx *<em>&nbsp;ctx</em>, unsigned long<em>&nbsp;sample_int</em>, unsigned long<em>&nbsp;aggr_int</em>, unsigned long<em>&nbsp;regions_update_int</em>, unsigned long<em>&nbsp;min_nr_reg</em>, unsigned long<em>&nbsp;max_nr_reg</em><span class="sig-paren">)</span><a class="headerlink" href="#c.damon_set_attrs" title="Permalink to this definition">¶</a></dt>
<dd><p>Set attributes for the monitoring.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">damon_ctx</span> <span class="pre">*</span> <span class="pre">ctx</span></code></dt>
<dd>monitoring context</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">sample_int</span></code></dt>
<dd>time interval between samplings</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">aggr_int</span></code></dt>
<dd>time interval between aggregations</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">regions_update_int</span></code></dt>
<dd>time interval between vma update checks</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">min_nr_reg</span></code></dt>
<dd>minimal number of regions</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">max_nr_reg</span></code></dt>
<dd>maximum number of regions</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function should not be called while the kdamond is running.
Every time interval is in micro-seconds.</p>
<p><strong>Return</strong></p>
<p>0 on success, negative error code otherwise.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mechanisms.html" class="btn btn-neutral float-right" title="Mechanisms of DAMON" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="start.html" class="btn btn-neutral float-left" title="Getting Started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>