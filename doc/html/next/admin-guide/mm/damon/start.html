<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Getting Started &mdash; The Linux Kernel  documentation</title><link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/theme_rtd_colors.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Optimization Guide" href="guide.html" />
    <link rel="prev" title="Monitoring Data Accesses" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> The Linux Kernel
          </a>
              <div class="version">
                5.19.0-rc4-mm-unstable-damon
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Monitoring Data Accesses</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Getting Started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#kernel">Kernel</a></li>
<li class="toctree-l4"><a class="reference internal" href="#user-space-tool">User Space Tool</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#recording-data-access-patterns">Recording Data Access Patterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="#visualizing-recorded-patterns">Visualizing Recorded Patterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-access-pattern-aware-memory-management">Data Access Pattern Aware Memory Management</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="guide.html">Optimization Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage.html">Detailed Usages</a></li>
<li class="toctree-l2"><a class="reference internal" href="reclaim.html">DAMON-based Reclamation</a></li>
<li class="toctree-l2"><a class="reference internal" href="lru_sort.html">DAMON-based LRU-lists Sorting</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">The Linux Kernel</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Monitoring Data Accesses</a> &raquo;</li>
      <li>Getting Started</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/admin-guide/mm/damon/start.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="getting-started">
<h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<p>This document briefly describes how you can use DAMON by demonstrating its
default user space tool.  Please note that this document describes only a part
of its features for brevity.  Please refer to the usage <a class="reference external" href="https://github.com/awslabs/damo/blob/next/USAGE.md">doc</a> of the tool for more
details.</p>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<section id="kernel">
<h3>Kernel<a class="headerlink" href="#kernel" title="Permalink to this headline">¶</a></h3>
<p>You should first ensure your system is running on a kernel built with
<code class="docutils literal notranslate"><span class="pre">CONFIG_DAMON_*=y</span></code>.</p>
</section>
<section id="user-space-tool">
<h3>User Space Tool<a class="headerlink" href="#user-space-tool" title="Permalink to this headline">¶</a></h3>
<p>For the demonstration, we will use the default user space tool for DAMON,
called DAMON Operator (DAMO).  It is available at
<a class="reference external" href="https://github.com/awslabs/damo">https://github.com/awslabs/damo</a>.  The examples below assume that <code class="docutils literal notranslate"><span class="pre">damo</span></code> is on
your <code class="docutils literal notranslate"><span class="pre">$PATH</span></code>.  It’s not mandatory, though.</p>
<p>Because DAMO is using the debugfs interface (refer to <a class="reference internal" href="usage.html"><span class="doc">Detailed Usages</span></a> for the
detail) of DAMON, you should ensure debugfs is mounted.  Mount it manually as
below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># mount -t debugfs none /sys/kernel/debug/
</pre></div>
</div>
<p>or append the following line to your <code class="docutils literal notranslate"><span class="pre">/etc/fstab</span></code> file so that your system
can automatically mount debugfs upon booting:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>debugfs /sys/kernel/debug debugfs defaults 0 0
</pre></div>
</div>
</section>
</section>
<section id="recording-data-access-patterns">
<h2>Recording Data Access Patterns<a class="headerlink" href="#recording-data-access-patterns" title="Permalink to this headline">¶</a></h2>
<p>The commands below record the memory access patterns of a program and save the
monitoring results to a file.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/sjp38/masim
$ cd masim; make; ./masim ./configs/zigzag.cfg &amp;
$ sudo damo record -o damon.data $(pidof masim)
</pre></div>
</div>
<p>The first two lines of the commands download an artificial memory access
generator program and run it in the background.  The generator will repeatedly
access two 100 MiB sized memory regions one by one.  You can substitute this
with your real workload.  The last line asks <code class="docutils literal notranslate"><span class="pre">damo</span></code> to record the access
pattern in the <code class="docutils literal notranslate"><span class="pre">damon.data</span></code> file.</p>
</section>
<section id="visualizing-recorded-patterns">
<h2>Visualizing Recorded Patterns<a class="headerlink" href="#visualizing-recorded-patterns" title="Permalink to this headline">¶</a></h2>
<p>You can visualize the pattern in a heatmap, showing which memory region
(x-axis) got accessed when (y-axis) and how frequently (number).:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo damo report heats --heatmap stdout
22222222222222222222222222222222222222211111111111111111111111111111111111111100
44444444444444444444444444444444444444434444444444444444444444444444444444443200
44444444444444444444444444444444444444433444444444444444444444444444444444444200
33333333333333333333333333333333333333344555555555555555555555555555555555555200
33333333333333333333333333333333333344444444444444444444444444444444444444444200
22222222222222222222222222222222222223355555555555555555555555555555555555555200
00000000000000000000000000000000000000288888888888888888888888888888888888888400
00000000000000000000000000000000000000288888888888888888888888888888888888888400
33333333333333333333333333333333333333355555555555555555555555555555555555555200
88888888888888888888888888888888888888600000000000000000000000000000000000000000
88888888888888888888888888888888888888600000000000000000000000000000000000000000
33333333333333333333333333333333333333444444444444444444444444444444444444443200
00000000000000000000000000000000000000288888888888888888888888888888888888888400
[...]
# access_frequency:  0  1  2  3  4  5  6  7  8  9
# x-axis: space (139728247021568-139728453431248: 196.848 MiB)
# y-axis: time (15256597248362-15326899978162: 1 m 10.303 s)
# resolution: 80x40 (2.461 MiB and 1.758 s for each character)
</pre></div>
</div>
<p>You can also visualize the distribution of the working set size, sorted by the
size.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo damo report wss --range 0 101 10
# &lt;percentile&gt; &lt;wss&gt;
# target_id     18446632103789443072
# avr:  107.708 MiB
  0             0 B |                                                           |
 10      95.328 MiB |****************************                               |
 20      95.332 MiB |****************************                               |
 30      95.340 MiB |****************************                               |
 40      95.387 MiB |****************************                               |
 50      95.387 MiB |****************************                               |
 60      95.398 MiB |****************************                               |
 70      95.398 MiB |****************************                               |
 80      95.504 MiB |****************************                               |
 90     190.703 MiB |*********************************************************  |
100     196.875 MiB |***********************************************************|
</pre></div>
</div>
<p>Using <code class="docutils literal notranslate"><span class="pre">--sortby</span></code> option with the above command, you can show how the working
set size has chronologically changed.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo damo report wss --range 0 101 10 --sortby time
# &lt;percentile&gt; &lt;wss&gt;
# target_id     18446632103789443072
# avr:  107.708 MiB
  0       3.051 MiB |                                                           |
 10     190.703 MiB |***********************************************************|
 20      95.336 MiB |*****************************                              |
 30      95.328 MiB |*****************************                              |
 40      95.387 MiB |*****************************                              |
 50      95.332 MiB |*****************************                              |
 60      95.320 MiB |*****************************                              |
 70      95.398 MiB |*****************************                              |
 80      95.398 MiB |*****************************                              |
 90      95.340 MiB |*****************************                              |
100      95.398 MiB |*****************************                              |
</pre></div>
</div>
</section>
<section id="data-access-pattern-aware-memory-management">
<h2>Data Access Pattern Aware Memory Management<a class="headerlink" href="#data-access-pattern-aware-memory-management" title="Permalink to this headline">¶</a></h2>
<p>Below three commands make every memory region of size &gt;=4K that doesn’t
accessed for &gt;=60 seconds in your workload to be swapped out.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo &quot;#min-size max-size min-acc max-acc min-age max-age action&quot; &gt; test_scheme
$ echo &quot;4K        max      0       0       60s     max     pageout&quot; &gt;&gt; test_scheme
$ damo schemes -c test_scheme &lt;pid of your workload&gt;
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Monitoring Data Accesses" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="guide.html" class="btn btn-neutral float-right" title="Optimization Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright The kernel development community.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>