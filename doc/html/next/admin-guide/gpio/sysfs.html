

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>GPIO Sysfs Interface for Userspace &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../mm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>GPIO Sysfs Interface for Userspace</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/admin-guide/gpio/sysfs.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="gpio-sysfs-interface-for-userspace">
<h1>GPIO Sysfs Interface for Userspace<a class="headerlink" href="#gpio-sysfs-interface-for-userspace" title="Permalink to this headline">¶</a></h1>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">THIS ABI IS DEPRECATED, THE ABI DOCUMENTATION HAS BEEN MOVED TO
Documentation/ABI/obsolete/sysfs-gpio AND NEW USERSPACE CONSUMERS
ARE SUPPOSED TO USE THE CHARACTER DEVICE ABI. THIS OLD SYSFS ABI WILL
NOT BE DEVELOPED (NO NEW FEATURES), IT WILL JUST BE MAINTAINED.</p>
</div>
<p>Refer to the examples in tools/gpio/* for an introduction to the new
character device ABI. Also see the userspace header in
include/uapi/linux/gpio.h</p>
<div class="section" id="the-deprecated-sysfs-abi">
<h2>The deprecated sysfs ABI<a class="headerlink" href="#the-deprecated-sysfs-abi" title="Permalink to this headline">¶</a></h2>
<p>Platforms which use the “gpiolib” implementors framework may choose to
configure a sysfs user interface to GPIOs. This is different from the
debugfs interface, since it provides control over GPIO direction and
value instead of just showing a gpio state summary. Plus, it could be
present on production systems without debugging support.</p>
<p>Given appropriate hardware documentation for the system, userspace could
know for example that GPIO #23 controls the write protect line used to
protect boot loader segments in flash memory. System upgrade procedures
may need to temporarily remove that protection, first importing a GPIO,
then changing its output state, then updating the code before re-enabling
the write protection. In normal use, GPIO #23 would never be touched,
and the kernel would have no need to know about it.</p>
<p>Again depending on appropriate hardware documentation, on some systems
userspace GPIO can be used to determine system configuration data that
standard kernels won’t know about. And for some tasks, simple userspace
GPIO drivers could be all that the system really needs.</p>
<p>DO NOT ABUSE SYSFS TO CONTROL HARDWARE THAT HAS PROPER KERNEL DRIVERS.
PLEASE READ THE DOCUMENT AT Documentation/driver-api/gpio/drivers-on-gpio.rst
TO AVOID REINVENTING KERNEL WHEELS IN USERSPACE. I MEAN IT. REALLY.</p>
</div>
<div class="section" id="paths-in-sysfs">
<h2>Paths in Sysfs<a class="headerlink" href="#paths-in-sysfs" title="Permalink to this headline">¶</a></h2>
<p>There are three kinds of entries in /sys/class/gpio:</p>
<blockquote>
<div><ul class="simple">
<li>Control interfaces used to get userspace control over GPIOs;</li>
<li>GPIOs themselves; and</li>
<li>GPIO controllers (“gpio_chip” instances).</li>
</ul>
</div></blockquote>
<p>That’s in addition to standard files including the “device” symlink.</p>
<p>The control interfaces are write-only:</p>
<blockquote>
<div><p>/sys/class/gpio/</p>
<blockquote>
<div><dl class="docutils">
<dt>“export” …</dt>
<dd><p class="first">Userspace may ask the kernel to export control of
a GPIO to userspace by writing its number to this file.</p>
<p class="last">Example:  “echo 19 &gt; export” will create a “gpio19” node
for GPIO #19, if that’s not requested by kernel code.</p>
</dd>
<dt>“unexport” …</dt>
<dd><p class="first">Reverses the effect of exporting to userspace.</p>
<p class="last">Example:  “echo 19 &gt; unexport” will remove a “gpio19”
node exported using the “export” file.</p>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
<p>GPIO signals have paths like /sys/class/gpio/gpio42/ (for GPIO #42)
and have the following read/write attributes:</p>
<blockquote>
<div><p>/sys/class/gpio/gpioN/</p>
<blockquote>
<div><dl class="docutils">
<dt>“direction” …</dt>
<dd><p class="first">reads as either “in” or “out”. This value may
normally be written. Writing as “out” defaults to
initializing the value as low. To ensure glitch free
operation, values “low” and “high” may be written to
configure the GPIO as an output with that initial value.</p>
<p class="last">Note that this attribute <em>will not exist</em> if the kernel
doesn’t support changing the direction of a GPIO, or
it was exported by kernel code that didn’t explicitly
allow userspace to reconfigure this GPIO’s direction.</p>
</dd>
<dt>“value” …</dt>
<dd><p class="first">reads as either 0 (low) or 1 (high). If the GPIO
is configured as an output, this value may be written;
any nonzero value is treated as high.</p>
<p class="last">If the pin can be configured as interrupt-generating interrupt
and if it has been configured to generate interrupts (see the
description of “edge”), you can poll(2) on that file and
poll(2) will return whenever the interrupt was triggered. If
you use poll(2), set the events POLLPRI and POLLERR. If you
use select(2), set the file descriptor in exceptfds. After
poll(2) returns, either lseek(2) to the beginning of the sysfs
file and read the new value or close the file and re-open it
to read the value.</p>
</dd>
<dt>“edge” …</dt>
<dd><p class="first">reads as either “none”, “rising”, “falling”, or
“both”. Write these strings to select the signal edge(s)
that will make poll(2) on the “value” file return.</p>
<p class="last">This file exists only if the pin can be configured as an
interrupt generating input pin.</p>
</dd>
<dt>“active_low” …</dt>
<dd>reads as either 0 (false) or 1 (true). Write
any nonzero value to invert the value attribute both
for reading and writing. Existing and subsequent
poll(2) support configuration via the edge attribute
for “rising” and “falling” edges will follow this
setting.</dd>
</dl>
</div></blockquote>
</div></blockquote>
<p>GPIO controllers have paths like /sys/class/gpio/gpiochip42/ (for the
controller implementing GPIOs starting at #42) and have the following
read-only attributes:</p>
<blockquote>
<div><p>/sys/class/gpio/gpiochipN/</p>
<blockquote>
<div><dl class="docutils">
<dt>“base” …</dt>
<dd>same as N, the first GPIO managed by this chip</dd>
<dt>“label” …</dt>
<dd>provided for diagnostics (not always unique)</dd>
<dt>“ngpio” …</dt>
<dd>how many GPIOs this manages (N to N + ngpio - 1)</dd>
</dl>
</div></blockquote>
</div></blockquote>
<p>Board documentation should in most cases cover what GPIOs are used for
what purposes. However, those numbers are not always stable; GPIOs on
a daughtercard might be different depending on the base board being used,
or other cards in the stack. In such cases, you may need to use the
gpiochip nodes (possibly in conjunction with schematics) to determine
the correct GPIO number to use for a given signal.</p>
</div>
<div class="section" id="exporting-from-kernel-code">
<h2>Exporting from Kernel code<a class="headerlink" href="#exporting-from-kernel-code" title="Permalink to this headline">¶</a></h2>
<p>Kernel code can explicitly manage exports of GPIOs which have already been
requested using gpio_request():</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/* export the GPIO to userspace */
int gpiod_export(struct gpio_desc *desc, bool direction_may_change);

/* reverse gpio_export() */
void gpiod_unexport(struct gpio_desc *desc);

/* create a sysfs link to an exported GPIO node */
int gpiod_export_link(struct device *dev, const char *name,
              struct gpio_desc *desc);
</pre></div>
</div>
<p>After a kernel driver requests a GPIO, it may only be made available in
the sysfs interface by <a class="reference internal" href="../../driver-api/gpio/index.html#c.gpiod_export" title="gpiod_export"><code class="xref c c-func docutils literal notranslate"><span class="pre">gpiod_export()</span></code></a>. The driver can control whether the
signal direction may change. This helps drivers prevent userspace code
from accidentally clobbering important system state.</p>
<p>This explicit exporting can help with debugging (by making some kinds
of experiments easier), or can provide an always-there interface that’s
suitable for documenting as part of a board support package.</p>
<p>After the GPIO has been exported, <a class="reference internal" href="../../driver-api/gpio/index.html#c.gpiod_export_link" title="gpiod_export_link"><code class="xref c c-func docutils literal notranslate"><span class="pre">gpiod_export_link()</span></code></a> allows creating
symlinks from elsewhere in sysfs to the GPIO sysfs node. Drivers can
use this to provide the interface under their own device in sysfs with
a descriptive name.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>