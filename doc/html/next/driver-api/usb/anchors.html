

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>USB Anchors &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/mm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>USB Anchors</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/driver-api/usb/anchors.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="usb-anchors">
<h1>USB Anchors<a class="headerlink" href="#usb-anchors" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-is-anchor">
<h2>What is anchor?<a class="headerlink" href="#what-is-anchor" title="Permalink to this headline">¶</a></h2>
<p>A USB driver needs to support some callbacks requiring
a driver to cease all IO to an interface. To do so, a
driver has to keep track of the URBs it has submitted
to know they’ve all completed or to call usb_kill_urb
for them. The anchor is a data structure takes care of
keeping track of URBs and provides methods to deal with
multiple URBs.</p>
</div>
<div class="section" id="allocation-and-initialisation">
<h2>Allocation and Initialisation<a class="headerlink" href="#allocation-and-initialisation" title="Permalink to this headline">¶</a></h2>
<p>There’s no API to allocate an anchor. It is simply declared
as struct usb_anchor. <code class="xref c c-func docutils literal notranslate"><span class="pre">init_usb_anchor()</span></code> must be called to
initialise the data structure.</p>
</div>
<div class="section" id="deallocation">
<h2>Deallocation<a class="headerlink" href="#deallocation" title="Permalink to this headline">¶</a></h2>
<p>Once it has no more URBs associated with it, the anchor can be
freed with normal memory management operations.</p>
</div>
<div class="section" id="association-and-disassociation-of-urbs-with-anchors">
<h2>Association and disassociation of URBs with anchors<a class="headerlink" href="#association-and-disassociation-of-urbs-with-anchors" title="Permalink to this headline">¶</a></h2>
<p>An association of URBs to an anchor is made by an explicit
call to <a class="reference internal" href="usb.html#c.usb_anchor_urb" title="usb_anchor_urb"><code class="xref c c-func docutils literal notranslate"><span class="pre">usb_anchor_urb()</span></code></a>. The association is maintained until
an URB is finished by (successful) completion. Thus disassociation
is automatic. A function is provided to forcibly finish (kill)
all URBs associated with an anchor.
Furthermore, disassociation can be made with <a class="reference internal" href="usb.html#c.usb_unanchor_urb" title="usb_unanchor_urb"><code class="xref c c-func docutils literal notranslate"><span class="pre">usb_unanchor_urb()</span></code></a></p>
</div>
<div class="section" id="operations-on-multitudes-of-urbs">
<h2>Operations on multitudes of URBs<a class="headerlink" href="#operations-on-multitudes-of-urbs" title="Permalink to this headline">¶</a></h2>
<div class="section" id="usb-kill-anchored-urbs">
<h3><a class="reference internal" href="usb.html#c.usb_kill_anchored_urbs" title="usb_kill_anchored_urbs"><code class="xref c c-func docutils literal notranslate"><span class="pre">usb_kill_anchored_urbs()</span></code></a><a class="headerlink" href="#usb-kill-anchored-urbs" title="Permalink to this headline">¶</a></h3>
<p>This function kills all URBs associated with an anchor. The URBs
are called in the reverse temporal order they were submitted.
This way no data can be reordered.</p>
</div>
<div class="section" id="usb-unlink-anchored-urbs">
<h3><a class="reference internal" href="usb.html#c.usb_unlink_anchored_urbs" title="usb_unlink_anchored_urbs"><code class="xref c c-func docutils literal notranslate"><span class="pre">usb_unlink_anchored_urbs()</span></code></a><a class="headerlink" href="#usb-unlink-anchored-urbs" title="Permalink to this headline">¶</a></h3>
<p>This function unlinks all URBs associated with an anchor. The URBs
are processed in the reverse temporal order they were submitted.
This is similar to <a class="reference internal" href="usb.html#c.usb_kill_anchored_urbs" title="usb_kill_anchored_urbs"><code class="xref c c-func docutils literal notranslate"><span class="pre">usb_kill_anchored_urbs()</span></code></a>, but it will not sleep.
Therefore no guarantee is made that the URBs have been unlinked when
the call returns. They may be unlinked later but will be unlinked in
finite time.</p>
</div>
<div class="section" id="usb-scuttle-anchored-urbs">
<h3><a class="reference internal" href="usb.html#c.usb_scuttle_anchored_urbs" title="usb_scuttle_anchored_urbs"><code class="xref c c-func docutils literal notranslate"><span class="pre">usb_scuttle_anchored_urbs()</span></code></a><a class="headerlink" href="#usb-scuttle-anchored-urbs" title="Permalink to this headline">¶</a></h3>
<p>All URBs of an anchor are unanchored en masse.</p>
</div>
<div class="section" id="usb-wait-anchor-empty-timeout">
<h3><a class="reference internal" href="usb.html#c.usb_wait_anchor_empty_timeout" title="usb_wait_anchor_empty_timeout"><code class="xref c c-func docutils literal notranslate"><span class="pre">usb_wait_anchor_empty_timeout()</span></code></a><a class="headerlink" href="#usb-wait-anchor-empty-timeout" title="Permalink to this headline">¶</a></h3>
<p>This function waits for all URBs associated with an anchor to finish
or a timeout, whichever comes first. Its return value will tell you
whether the timeout was reached.</p>
</div>
<div class="section" id="usb-anchor-empty">
<h3><a class="reference internal" href="usb.html#c.usb_anchor_empty" title="usb_anchor_empty"><code class="xref c c-func docutils literal notranslate"><span class="pre">usb_anchor_empty()</span></code></a><a class="headerlink" href="#usb-anchor-empty" title="Permalink to this headline">¶</a></h3>
<p>Returns true if no URBs are associated with an anchor. Locking
is the caller’s responsibility.</p>
</div>
<div class="section" id="usb-get-from-anchor">
<h3><a class="reference internal" href="usb.html#c.usb_get_from_anchor" title="usb_get_from_anchor"><code class="xref c c-func docutils literal notranslate"><span class="pre">usb_get_from_anchor()</span></code></a><a class="headerlink" href="#usb-get-from-anchor" title="Permalink to this headline">¶</a></h3>
<p>Returns the oldest anchored URB of an anchor. The URB is unanchored
and returned with a reference. As you may mix URBs to several
destinations in one anchor you have no guarantee the chronologically
first submitted URB is returned.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>