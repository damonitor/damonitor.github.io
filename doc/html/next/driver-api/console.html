

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Console Drivers &mdash; The Linux Kernel  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/mm/damon/index.html">Monitoring Data Accesses</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../vm/damon/index.html">DAMON: Data Access MONitor</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Console Drivers</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/driver-api/console.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="console-drivers">
<h1>Console Drivers<a class="headerlink" href="#console-drivers" title="Permalink to this headline">¶</a></h1>
<p>The Linux kernel has 2 general types of console drivers.  The first type is
assigned by the kernel to all the virtual consoles during the boot process.
This type will be called ‘system driver’, and only one system driver is allowed
to exist. The system driver is persistent and it can never be unloaded, though
it may become inactive.</p>
<p>The second type has to be explicitly loaded and unloaded. This will be called
‘modular driver’ by this document. Multiple modular drivers can coexist at
any time with each driver sharing the console with other drivers including
the system driver. However, modular drivers cannot take over the console
that is currently occupied by another modular driver. (Exception: Drivers that
call do_take_over_console() will succeed in the takeover regardless of the type
of driver occupying the consoles.) They can only take over the console that is
occupied by the system driver. In the same token, if the modular driver is
released by the console, the system driver will take over.</p>
<p>Modular drivers, from the programmer’s point of view, have to call:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>do_take_over_console() - load and bind driver to console layer
give_up_console() - unload driver; it will only work if driver
                    is fully unbound
</pre></div>
</div>
<p>In newer kernels, the following are also available:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>do_register_con_driver()
do_unregister_con_driver()
</pre></div>
</div>
<p>If sysfs is enabled, the contents of /sys/class/vtconsole can be
examined. This shows the console backends currently registered by the
system which are named vtcon&lt;n&gt; where &lt;n&gt; is an integer from 0 to 15.
Thus:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ls /sys/class/vtconsole
.  ..  vtcon0  vtcon1
</pre></div>
</div>
<p>Each directory in /sys/class/vtconsole has 3 files:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ls /sys/class/vtconsole/vtcon0
.  ..  bind  name  uevent
</pre></div>
</div>
<p>What do these files signify?</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">bind - this is a read/write file. It shows the status of the driver if
read, or acts to bind or unbind the driver to the virtual consoles
when written to. The possible values are:</p>
<dl class="docutils">
<dt>0</dt>
<dd><ul class="first last simple">
<li>means the driver is not bound and if echo’ed, commands the driver
to unbind</li>
</ul>
</dd>
<dt>1</dt>
<dd><ul class="first last simple">
<li>means the driver is bound and if echo’ed, commands the driver to
bind</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">name - read-only file. Shows the name of the driver in this format:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cat /sys/class/vtconsole/vtcon0/name
(S) VGA+

    &#39;(S)&#39; stands for a (S)ystem driver, i.e., it cannot be directly
    commanded to bind or unbind

    &#39;VGA+&#39; is the name of the driver

cat /sys/class/vtconsole/vtcon1/name
(M) frame buffer device

    In this case, &#39;(M)&#39; stands for a (M)odular driver, one that can be
    directly commanded to bind or unbind.
</pre></div>
</div>
</li>
<li><p class="first">uevent - ignore this file</p>
</li>
</ol>
</div></blockquote>
<p>When unbinding, the modular driver is detached first, and then the system
driver takes over the consoles vacated by the driver. Binding, on the other
hand, will bind the driver to the consoles that are currently occupied by a
system driver.</p>
<dl class="docutils">
<dt>NOTE1:</dt>
<dd><p class="first">Binding and unbinding must be selected in Kconfig. It’s under:</p>
<div class="last highlight-none notranslate"><div class="highlight"><pre><span></span>Device Drivers -&gt;
    Character devices -&gt;
            Support for binding and unbinding console drivers
</pre></div>
</div>
</dd>
<dt>NOTE2:</dt>
<dd>If any of the virtual consoles are in KD_GRAPHICS mode, then binding or
unbinding will not succeed. An example of an application that sets the
console to KD_GRAPHICS is X.</dd>
</dl>
<p>How useful is this feature? This is very useful for console driver
developers. By unbinding the driver from the console layer, one can unload the
driver, make changes, recompile, reload and rebind the driver without any need
for rebooting the kernel. For regular users who may want to switch from
framebuffer console to VGA console and vice versa, this feature also makes
this possible. (NOTE NOTE NOTE: Please read fbcon.txt under Documentation/fb
for more details.)</p>
<div class="section" id="notes-for-developers">
<h2>Notes for developers<a class="headerlink" href="#notes-for-developers" title="Permalink to this headline">¶</a></h2>
<p>do_take_over_console() is now broken up into:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>do_register_con_driver()
do_bind_con_driver() - private function
</pre></div>
</div>
<p>give_up_console() is a wrapper to do_unregister_con_driver(), and a driver must
be fully unbound for this call to succeed. con_is_bound() will check if the
driver is bound or not.</p>
</div>
<div class="section" id="guidelines-for-console-driver-writers">
<h2>Guidelines for console driver writers<a class="headerlink" href="#guidelines-for-console-driver-writers" title="Permalink to this headline">¶</a></h2>
<p>In order for binding to and unbinding from the console to properly work,
console drivers must follow these guidelines:</p>
<ol class="arabic simple">
<li>All drivers, except system drivers, must call either do_register_con_driver()
or do_take_over_console(). do_register_con_driver() will just add the driver
to the console’s internal list. It won’t take over the
console. do_take_over_console(), as it name implies, will also take over (or
bind to) the console.</li>
<li>All resources allocated during con-&gt;con_init() must be released in
con-&gt;con_deinit().</li>
<li>All resources allocated in con-&gt;con_startup() must be released when the
driver, which was previously bound, becomes unbound.  The console layer
does not have a complementary call to con-&gt;con_startup() so it’s up to the
driver to check when it’s legal to release these resources. Calling
con_is_bound() in con-&gt;con_deinit() will help.  If the call returned
false(), then it’s safe to release the resources.  This balance has to be
ensured because con-&gt;con_startup() can be called again when a request to
rebind the driver to the console arrives.</li>
<li>Upon exit of the driver, ensure that the driver is totally unbound. If the
condition is satisfied, then the driver must call do_unregister_con_driver()
or give_up_console().</li>
<li>do_unregister_con_driver() can also be called on conditions which make it
impossible for the driver to service console requests.  This can happen
with the framebuffer console that suddenly lost all of its drivers.</li>
</ol>
<p>The current crop of console drivers should still work correctly, but binding
and unbinding them may cause problems. With minimal fixes, these drivers can
be made to work correctly.</p>
<p>Antonino Daplas &lt;<a class="reference external" href="mailto:adaplas&#37;&#52;&#48;pol&#46;net">adaplas<span>&#64;</span>pol<span>&#46;</span>net</a>&gt;</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>